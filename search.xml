<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Learn Vue3 目录</title>
      <link href="/2024/11/16/learn-vue3-000/"/>
      <url>/2024/11/16/learn-vue3-000/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 11 Professional [Version 10.0.26100], locale zh-CN</p></li><li><p>Node.js: 20.18.0</p></li><li><p>Mozilla Firefox Extended Support Release 128.4.0(64-bit)</p></li><li><p>Visual Studio Code, 64-bit edition, Version: 1.95.3 (system setup)</p></li></ul><hr><h1 id="Learn-Vue-3-Table-of-Content"><a href="#Learn-Vue-3-Table-of-Content" class="headerlink" title="Learn Vue 3 Table of Content"></a><center>Learn Vue 3 Table of Content</center></h1><ol><li><p><a href="https://hujiyi.github.io/">创建项目</a></p></li><li><p><a href="https://hujiyi.github.io/">创建项目</a></p></li><li><p><a href="https://hujiyi.github.io/">创建项目</a></p></li><li><p><a href="https://hujiyi.github.io/">创建项目</a></p></li><li><p><a href="https://hujiyi.github.io/">创建项目</a></p></li><li><p><a href="https://hujiyi.github.io/">创建项目</a></p></li><li><p><a href="https://hujiyi.github.io/">创建项目</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> learn vue3 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter Tutorial Table Of Content</title>
      <link href="/2023/02/27/flutter-tutorial-toc/"/>
      <url>/2023/02/27/flutter-tutorial-toc/</url>
      
        <content type="html"><![CDATA[<h1 id="目录"><a href="#目录" class="headerlink" title=" 目录 "></a><center> 目录 </center></h1><h2 id="基础组件"><a href="#基础组件" class="headerlink" title="基础组件"></a>基础组件</h2><ol><li><a href="https://hujiyi.github.io/2023/03/06/flutter-tutorial-003/"><font color=red>Flutter 基础组件</font> - <font color=red>图片和图标组件</font></a></li></ol><h2 id="布局组件"><a href="#布局组件" class="headerlink" title="布局组件"></a>布局组件</h2><ol><li><p><a href="https://hujiyi.github.io/2023/02/27/flutter-tutorial-001/"><font color=red>Flutter 布局组件</font> - <font color=red>水平&#x2F;垂直组件(Row&#x2F;Column)</font></a></p></li><li><p>[<font color=red>Flutter 布局组件</font> - <font color=red>叠加布局组件(Stack&#x2F;IndexedStack)</font>]</p></li><li><p>[<font color=red>Flutter 布局组件</font> - <font color=red>流式布局组件(Wrap)</font>]</p></li><li><p>[<font color=red>Flutter 布局组件</font> - <font color=red>自定义布局组件(Flow)</font>]</p></li></ol><h2 id="定位装饰权重组件"><a href="#定位装饰权重组件" class="headerlink" title="定位装饰权重组件"></a>定位装饰权重组件</h2><ol><li><a href="https://hujiyi.github.io/2023/02/27/flutter-tutorial-002/"><font color=red>Flutter 定位装饰权重组件</font> - <font color=red>定位装饰组件(Container)</font></a></li></ol><h2 id="滚动组件"><a href="#滚动组件" class="headerlink" title="滚动组件"></a>滚动组件</h2><ol><li><p>[<font color=red>Flutter 滚动组件</font> - <font color=red>ListView</font>]</p></li><li><p>[<font color=red>Flutter 滚动组件</font> - <font color=red>GridView</font>]</p></li><li><p>[<font color=red>Flutter 滚动组件</font> - <font color=red>PageView</font>]</p></li></ol><h2 id="数据组件"><a href="#数据组件" class="headerlink" title="数据组件"></a>数据组件</h2><ol><li>[<font color=red>Flutter 数据组件</font> - <font color=red>DataTable</font>]</li></ol><h2 id="布局实例"><a href="#布局实例" class="headerlink" title="布局实例"></a>布局实例</h2><ol><li><p><a href="https://hujiyi.github.io/2023/02/27/flutter-tutorial-layout-001/"><font color=red>Flutter 布局实例</font> - <font color=red>静态布局构建实例</font></a></p></li><li><p>[<font color=red>Flutter 布局实例</font> - <font color=red>无限滚动布局实例</font>]</p></li></ol><h2 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h2><ol><li><p><a href="https://hujiyi.github.io/2023/03/27/flutter-riverpod-example-001/"><font color=red>Flutter Riverpod 使用示例</font> - <font color=red>计数器</font></a></p></li><li><p><a href="https://hujiyi.github.io/2023/03/27/flutter-riverpod-example-001/"><font color=red>开始使用 Flutter Riverpod 进行状态管理(一)</font></a></p></li><li><p><a href="https://hujiyi.github.io/2023/03/27/flutter-riverpod-example-002/"><font color=red>开始使用 Flutter Riverpod 进行状态管理(二)</font></a></p></li><li><p><a href="https://hujiyi.github.io/2023/03/27/flutter-riverpod-example-003/"><font color=red>开始使用 Flutter Riverpod 进行状态管理(三)</font></a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从 Linux From Scratch 构建自己的操作系统 - 目录</title>
      <link href="/2023/02/16/linux-from-scratch-toc/"/>
      <url>/2023/02/16/linux-from-scratch-toc/</url>
      
        <content type="html"><![CDATA[<p>hexo new ‘linux from scratch 001’</p><h1 id="目录"><a href="#目录" class="headerlink" title=" 目录 "></a><center> 目录 </center></h1><ol><li><p><a href="https://hujiyi.github.io/2023/02/16/linux-from-scratch-001/">从 <font color=red>Linux From Scratch</font> 构建自己的操作系统(一) - <font color=red>准备工作</font></a></p></li><li><p><a href="https://hujiyi.github.io/2023/02/18/linux-from-scratch-002/">从 <font color=red>Linux From Scratch</font> 构建自己的操作系统(二) - <font color=red>创建新的分区</font></a></p></li><li><p><a href="https://hujiyi.github.io/2023/02/21/linux-from-scratch-003/">从 <font color=red>Linux From Scratch</font> 构建自己的操作系统(三) - <font color=red>下载软件包和补丁</font></a></p></li><li><p><a href="">从 <font color=red>Linux From Scratch</font> 构建自己的操作系统(四) - <font color=red>待续</font></a></p></li><li><p><a href="">从 <font color=red>Linux From Scratch</font> 构建自己的操作系统(五) - <font color=red>待续</font></a></p></li><li><p><a href="">从 <font color=red>Linux From Scratch</font> 构建自己的操作系统(六) - <font color=red>待续</font></a></p></li><li><p><a href="">从 <font color=red>Linux From Scratch</font> 构建自己的操作系统(七) - <font color=red>待续</font></a></p></li><li><p><a href="">从 <font color=red>Linux From Scratch</font> 构建自己的操作系统(八) - <font color=red>待续</font></a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LFS </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Windows 安装解压版的 MySQL 8</title>
      <link href="/2023/01/05/installing-mysql-zip-archive-in-windows/"/>
      <url>/2023/01/05/installing-mysql-zip-archive-in-windows/</url>
      
        <content type="html"><![CDATA[<h1 id="使用国内镜像下载-MySQL-8"><a href="#使用国内镜像下载-MySQL-8" class="headerlink" title="使用国内镜像下载 MySQL 8"></a>使用国内镜像下载 MySQL 8</h1><p>可以使用华为云镜像快速下载 <code>MySQL 8</code> 或是其他版本, 华为云镜像下载地址：<br><a href="https://repo.huaweicloud.com/mysql/Downloads/">https://repo.huaweicloud.com/mysql/Downloads/</a></p><p>请选择需要的版本下载, 当前使用的是的 <code>mysql-8.0.29-winx64.zip</code>, 下载地址为: <a href="https://repo.huaweicloud.com/mysql/Downloads/MySQL-8.0/mysql-8.0.29-winx64.zip">https://repo.huaweicloud.com/mysql/Downloads/MySQL-8.0/mysql-8.0.29-winx64.zip</a></p><h1 id="下载数据库客户端-HeidiSQL"><a href="#下载数据库客户端-HeidiSQL" class="headerlink" title="下载数据库客户端 HeidiSQL"></a>下载数据库客户端 HeidiSQL</h1><p><code>HeidiSQL</code>是一个免费开源的轻量级数据库客户端软件，支持访问 <code>MySQL</code>、<code>MariaDB</code> 和 <code>SQL Server</code>等多种数据库。允许浏览数据库，管理表，浏览和编辑记录，管理用户权限等等。从我自己使用的情况来看, 功能并不输给 <code>Navicat</code>, <code>HeidiSQL</code>是免费的, 并且自带中文界面。</p><p>下载地址：<a href="https://www.heidisql.com/download.php">https://www.heidisql.com/download.php</a></p><blockquote><p>建议先安装 <code>HeidiSQL</code>, 因为 <code>MySQL 8</code> 可能需要使用到 <code>Visual C++ Redistributable for Visual Studio 2015</code> 这样的组件, 安装<code>HeidiSQL</code>时会安装这个组件。</p></blockquote><h1 id="解压-MySQL"><a href="#解压-MySQL" class="headerlink" title="解压 MySQL"></a>解压 MySQL</h1><p>解压下载好的 <code>MySQL</code> 文件，我这里直接解压至<code>当前用户</code>的<code>AppData</code>目录下，如下图所示：</p><img src="/2023/01/05/installing-mysql-zip-archive-in-windows/001.png" class="" title="mysql"><h1 id="配置系统环境变量"><a href="#配置系统环境变量" class="headerlink" title="配置系统环境变量"></a>配置系统环境变量</h1><p>为了让 <code>Windows</code> 系统可以识别我们这里后面会用到的 <code>MySQL</code> 命令，需要给当前系统环境变量 <code>path</code> 添加 <code>MySQL命令</code> 所在的路径： <br><code>我的电脑</code> -&gt; <code>右键</code> —&gt; <code> 属性</code> —&gt; <code>高级系统设置</code> —&gt; <code>环境变量</code>。在系统变量的 <code>Path</code> 中添加MySQL目录下的 <code>bin</code> 文件夹所在的路径, 如下所示：</p><img src="/2023/01/05/installing-mysql-zip-archive-in-windows/002.png" class="" title="path"><h1 id="安装MySQL数据库"><a href="#安装MySQL数据库" class="headerlink" title="安装MySQL数据库"></a>安装MySQL数据库</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>使用 <code>管理员身份</code> 运行、打开 <code>命令提示符</code> 窗口, 如下图所示：</p><img src="/2023/01/05/installing-mysql-zip-archive-in-windows/003.png" class="" title="path"><blockquote><p>必须使用 <code>管理员身份</code> 运行 <code>命令提示符</code> 或是 <code>powershell</code> 窗口</p></blockquote><h2 id="初始化MySQL数据库"><a href="#初始化MySQL数据库" class="headerlink" title="初始化MySQL数据库"></a>初始化MySQL数据库</h2><p>命令：<code>mysqld --initialize-insecure</code></p><p>作用：初始化数据库，并设置默认 <code>root</code> 密码为空 </p><blockquote><p>重装系统后保留之前使用过的 <code>MySQL</code> , 则密码不是空密码, 而是之前在旧系统中设置过的密码。</p></blockquote><blockquote><p>执行初始化命令出错时,　可能是因为系统当前没有安装<code>Visual C++ Redistributable for Visual Studio 2015</code>, 可以下载安装后再次进行初始化, 下载地址: <a href="https://www.microsoft.com/zh-CN/download/details.aspx?id=48145">https://www.microsoft.com/zh-CN/download/details.aspx?id=48145</a></p></blockquote><h2 id="为Windows系统安装MySQL服务"><a href="#为Windows系统安装MySQL服务" class="headerlink" title="为Windows系统安装MySQL服务"></a>为Windows系统安装MySQL服务</h2><p>命令：<code>mysqld install </code><br>作用：为<code>Windows</code>系统安装<code>MySQL服务</code>，默认服务名为：<code>mysql</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;mysqld install</span><br><span class="line">Service successfully installed.</span><br></pre></td></tr></table></figure><h2 id="启动MySQL服务"><a href="#启动MySQL服务" class="headerlink" title="启动MySQL服务"></a>启动MySQL服务</h2><p>命令：<code>net start mysql</code><br>作用：启动<code>MySQL</code>服务，注意此时的 <code>mysql</code> 表示服务名 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;net start mysql</span><br><span class="line">MySQL 服务正在启动 .</span><br><span class="line">MySQL 服务已经启动成功。</span><br></pre></td></tr></table></figure><blockquote><p>特别提示：如果当前的 <code>MySQL</code> 不是第一次解压后安装的（例如重装系统后再次使用已有的 <code>MySQL</code>）, 就不需要再执行后续的步骤了, <code>MySQL</code> 保留着之前做过的配置(包括用户名、密码) 和 以前创建好的数据库</p></blockquote><h2 id="修改MySQL默认字符集"><a href="#修改MySQL默认字符集" class="headerlink" title="修改MySQL默认字符集"></a>修改MySQL默认字符集</h2><p>在解压后的 <code>MySQL</code> 文件中创建名为 <code>my.ini</code> 的配置文件, 如下图所示:</p><img src="/2023/01/05/installing-mysql-zip-archive-in-windows/004.png" class="" title="myini"><p>编辑 <code>my.ini</code> 文件内容, 设置使用默认字符为<code>utf8mb4</code>, 如下所示：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对本地的mysql客户端的配置</span></span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span> = utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对其他远程连接的mysql客户端的配置</span></span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="attr">default-character-set</span> = utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地mysql服务的配置</span></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">character-set-client-handshake</span> = <span class="literal">FALSE</span></span><br><span class="line"><span class="attr">character-set-server</span> = utf8mb4</span><br><span class="line"><span class="attr">collation-server</span> = utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure><h1 id="连接到MySQL"><a href="#连接到MySQL" class="headerlink" title="连接到MySQL"></a>连接到MySQL</h1><p>在命令提示符窗口输入命令, 连接到MySQL服务器：<code>mysql -uroot -p</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 8</span><br><span class="line">Server version: 8.0.29 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2022, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br></pre></td></tr></table></figure><h1 id="查看当前使用的字符集"><a href="#查看当前使用的字符集" class="headerlink" title="查看当前使用的字符集"></a>查看当前使用的字符集</h1><p>在 <code>MySQL</code> 提示符输入命令查看当前使用的字符集：<code>show variables like &#39;%character%&#39;;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;%character%&#x27;</span>;</span><br><span class="line">+--------------------------+-------------------------------------------------------------------+</span><br><span class="line">| Variable_name            | Value                                                             |</span><br><span class="line">+--------------------------+-------------------------------------------------------------------+</span><br><span class="line">| character_set_client     | utf8mb4                                                           |</span><br><span class="line">| character_set_connection | utf8mb4                                                           |</span><br><span class="line">| character_set_database   | utf8mb4                                                           |</span><br><span class="line">| character_set_filesystem | binary                                                            |</span><br><span class="line">| character_set_results    | utf8mb4                                                           |</span><br><span class="line">| character_set_server     | utf8mb4                                                           |</span><br><span class="line">| character_set_system     | utf8mb3                                                           |</span><br><span class="line">| character_sets_dir       | C:\Users\laohoo\AppData\Local\mysql-8.0.29-winx64\share\charsets\ |</span><br><span class="line">+--------------------------+-------------------------------------------------------------------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span>, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><h1 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h1><p>之前初始化 <code>MySQL</code> 服务器的时候, 使用的是<code>空密码</code>, 如果想<code>修改密码</code>, 可按以下步骤操作:</p><ol><li>查看当前数据库： <code>show databases;</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><ol start="2"><li>指定当前数据库为 <code>mysql</code>： <code>use mysql;</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use mysql;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure><ol start="3"><li>修改密码: <code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;your password&#39;;</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified with mysql_native_password by <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure><ol start="4"><li>刷新MySQL的系统权限相关表： <code>FLUSH PRIVILEGES;</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 electron 和 vuetify 创建 Vue3 桌面应用程序</title>
      <link href="/2022/11/21/build-vue3-desktop-app-with-vite-electron-vuetify/"/>
      <url>/2022/11/21/build-vue3-desktop-app-with-vite-electron-vuetify/</url>
      
        <content type="html"><![CDATA[<p>最近打算做一个桌面应用程序, 考虑了几种不同的方案:</p><ol><li><p><code>.NET </code>: 这是以前最熟悉的, 不过<code>.NET</code> 的框架也有好几个版本, 因为使用的 <code>Winddows</code> 版本不同, 最终用户还是可能需要安装不用的 <code>.NET Framework</code>, 当然, <code>.NET</code> 现在已经忘得差不多了。</p></li><li><p><code>Flutter</code> : <code>Flutter</code> 现在已经可以支持各种不同的操作系统桌面开发, 但是它的<code>路由</code>不怎么好用, 没有类似<code> Vue</code> 的那个子路由, 想要更新界面中的局部内容, 操作比较麻烦, 输入数据的处理也不够方便。</p></li><li><p><code>Electron</code>: 可以配合<code>Vue</code> 等前端框架开发应用, 方便灵活, 前两天发现自己最爱用的UI框架 <code>Vuetify</code> 已经发布了 <code>3.0.1</code> 的正式版, 正式支持 <code>Vue3</code>, 所以打算用这个来试一下。另外的一好处是, 要实现 <code>Web</code> 版本, 代码几乎不需要做什么修改。</p></li></ol><h1 id="使用-Vuetify-模板创建-Vue3项目"><a href="#使用-Vuetify-模板创建-Vue3项目" class="headerlink" title="使用 Vuetify 模板创建 Vue3项目"></a>使用 <code>Vuetify</code> 模板创建 <code>Vue3</code>项目</h1><p><code>Vuetify</code> 带有一个创建项目的模板, 使用该模板创建好的项目已经完成了 Vuetify 及相关依赖的配置, 比手动方式更加方便。创建项目命令如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create vuetify</span><br></pre></td></tr></table></figure><p>代码执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\electron_repos&gt; yarn create vuetify</span><br><span class="line">yarn create v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Installed <span class="string">&quot;create-vuetify@1.0.4&quot;</span> with binaries:</span><br><span class="line">      - create-vuetify</span><br><span class="line">[############] 12/12</span><br><span class="line">Vuetify.js - Material Component Framework <span class="keyword">for</span> Vue</span><br><span class="line"></span><br><span class="line">√ Project name: ... vite-vuetify-electron-app</span><br><span class="line">√ Use TypeScript? ... No / Yes</span><br><span class="line">√ Would you like to install dependencies with yarn, npm, or pnpm? » yarn</span><br><span class="line"></span><br><span class="line">◌ Generating scaffold...</span><br><span class="line">◌ Installing dependencies with yarn...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">info No lockfile found.</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 3.35s.</span><br><span class="line"></span><br><span class="line">vite-vuetify-electron-app has been generated at D:\sources\electron_repos\vite-vuetify-electron-app</span><br><span class="line"></span><br><span class="line">Discord community: https://community.vuetifyjs.com</span><br><span class="line">Github: https://github.com/vuetifyjs/vuetify</span><br><span class="line">Support Vuetify: https://github.com/sponsors/johnleider</span><br><span class="line">Done <span class="keyword">in</span> 34.09s.</span><br></pre></td></tr></table></figure><p>进入项目文件夹, 运行项目, 效果如以下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\electron_repos&gt; <span class="built_in">cd</span> .\vite-vuetify-electron-app\</span><br><span class="line">PS D:\sources\electron_repos\vite-vuetify-electron-app&gt; yarn dev</span><br><span class="line">yarn run v1.22.5</span><br><span class="line">warning package.json: No license field</span><br><span class="line">$ vite</span><br><span class="line"></span><br><span class="line">  VITE v3.2.4  ready <span class="keyword">in</span> 382 ms</span><br><span class="line"></span><br><span class="line">  ➜  Local:   http://127.0.0.1:3000/</span><br><span class="line">  ➜  Network: use --host to expose</span><br></pre></td></tr></table></figure><img src="/2022/11/21/build-vue3-desktop-app-with-vite-electron-vuetify/001.png" class="" title="vuetify"><blockquote><p>使用 <code>yarn create vuetify</code> 创建的项目不包含<code>路由</code>和<code>状态管理</code>模块, 需要自行添加。</p></blockquote><h1 id="配置-Electron"><a href="#配置-Electron" class="headerlink" title="配置 Electron"></a>配置 <code>Electron</code></h1><h2 id="安装-Electron"><a href="#安装-Electron" class="headerlink" title="安装 Electron"></a>安装 <code>Electron</code></h2><p>首先安装<code>electron</code>至<code>Vuetify</code>项目, 命令如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev electron</span><br></pre></td></tr></table></figure><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><ol><li>在 <code>vite.config.js</code> 中添加 <code>path</code> 配置</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>  <span class="comment">// 新增引入模块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">base</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./dist/&#x27;</span>),<span class="comment">// 新增</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>完整代码如下所示: </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Plugins</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vuetify <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-vuetify&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Utilities</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>  <span class="comment">// 新增引入模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">base</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./dist/&#x27;</span>),<span class="comment">// 新增</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="comment">// https://github.com/vuetifyjs/vuetify-loader/tree/next/packages/vite-plugin</span></span><br><span class="line">    <span class="title function_">vuetify</span>(&#123;</span><br><span class="line">      <span class="attr">autoImport</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">define</span>: &#123; <span class="string">&#x27;process.env&#x27;</span>: &#123;&#125; &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">fileURLToPath</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;./src&#x27;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">extensions</span>: [</span><br><span class="line">      <span class="string">&#x27;.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.json&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.jsx&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.mjs&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.ts&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.tsx&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.vue&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>在项目根目录创建名为 <code>index.js</code> 的新文件, 编辑内容如下:</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制应用生命周期和创建原生浏览器窗口的模组</span></span><br><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createWindow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 创建浏览器窗口</span></span><br><span class="line">    <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">        <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">            <span class="attr">preload</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;preload.js&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载 index.html</span></span><br><span class="line">    mainWindow.<span class="title function_">loadFile</span>(<span class="string">&#x27;dist/index.html&#x27;</span>) <span class="comment">// 此处跟electron官网路径不同，需要注意</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开开发工具</span></span><br><span class="line">    <span class="comment">// mainWindow.webContents.openDevTools()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这段程序将会在 Electron 结束初始化</span></span><br><span class="line"><span class="comment">// 和创建浏览器窗口的时候调用</span></span><br><span class="line"><span class="comment">// 部分 API 在 ready 事件触发后才能使用。</span></span><br><span class="line">app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">createWindow</span>()</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">on</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 通常在 macOS 上，当点击 dock 中的应用程序图标时，如果没有其他</span></span><br><span class="line">        <span class="comment">// 打开的窗口，那么程序会重新创建一个窗口。</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">createWindow</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 除了 macOS 外，当所有窗口都被关闭的时候退出程序。 因此，通常对程序和它们在</span></span><br><span class="line"><span class="comment">// 任务栏上的图标来说，应当保持活跃状态，直到用户使用 Cmd + Q 退出。</span></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&#x27;darwin&#x27;</span>) app.<span class="title function_">quit</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这个文件中，你可以包含应用程序剩余的所有部分的代码，</span></span><br><span class="line"><span class="comment">// 也可以拆分成几个文件，然后用 require 导入。</span></span><br></pre></td></tr></table></figure><ol start="3"><li>在项目根目录创建名为 <code>preload.js</code> 的新文件, 编辑内容如下:</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// preload.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有Node.js API都可以在预加载过程中使用。</span></span><br><span class="line"><span class="comment">// 它拥有与Chrome扩展一样的沙盒。</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">replaceText</span> = (<span class="params">selector, text</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(selector)</span><br><span class="line">        <span class="keyword">if</span> (element) element.<span class="property">innerText</span> = text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> dependency <span class="keyword">of</span> [<span class="string">&#x27;chrome&#x27;</span>, <span class="string">&#x27;node&#x27;</span>, <span class="string">&#x27;electron&#x27;</span>]) &#123;</span><br><span class="line">        <span class="title function_">replaceText</span>(<span class="string">`<span class="subst">$&#123;dependency&#125;</span>-version`</span>, process.<span class="property">versions</span>[dependency])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>编辑 <code>package.json</code></li></ol><p>为了确保能够运行相关<code>electron</code>的命令，需要修改<code>package.json</code>文件。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite-vuetify-electron-app&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span> <span class="comment">// 新增</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron:serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;electron .&quot;</span> <span class="comment">// 新增</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@mdi/font&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.0.96&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roboto-fontface&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.2.38&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vuetify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webfontloader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@vitejs/plugin-vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^21.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.1.9&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite-plugin-vuetify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0-alpha.12&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>package.json</code>文件不能包含 <code>注释</code>, 上面代码的注释只是为了方便标识修改的内容, 在实际开发的时候要把注释<code>删除</code>, 否则项目运行会出现<code>异常</code></p></blockquote><h1 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h1><p>运行 Electron 项目时, 要先执行 <code>yarn build</code> 构建项目, 生成 <code>dist</code> 文件夹, 才能执行 <code>yarn electron:serve</code> 运行项目</p><h2 id="先构建项目"><a href="#先构建项目" class="headerlink" title="先构建项目"></a>先构建项目</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\electron_repos\vite-vuetify-electron-app&gt; yarn build</span><br><span class="line">yarn run v1.22.5</span><br><span class="line">warning package.json: No license field</span><br><span class="line">$ vite build</span><br><span class="line">(!) <span class="string">&quot;base&quot;</span> option should start with a slash.</span><br><span class="line">(!) <span class="string">&quot;base&quot;</span> option should end with a slash.</span><br><span class="line">vite v3.2.4 building <span class="keyword">for</span> production...</span><br><span class="line">✓ 154 modules transformed.</span><br><span class="line">dist/assets/materialdesignicons-webfont.861aea05.eot     1214.57 KiB</span><br><span class="line">dist/assets/materialdesignicons-webfont.e52d60f6.woff2   376.33 KiB</span><br><span class="line">dist/assets/materialdesignicons-webfont.48d3eec6.woff    548.61 KiB</span><br><span class="line">dist/assets/materialdesignicons-webfont.bd725a7a.ttf     1214.36 KiB</span><br><span class="line">dist/index.html                                          0.58 KiB</span><br><span class="line">dist/assets/webfontloader.b777d690.js                    12.42 KiB / gzip: 4.98 KiB</span><br><span class="line">dist/assets/index.5048f0d0.js                            113.46 KiB / gzip: 42.44 KiB</span><br><span class="line">dist/assets/index.3b4c9523.css                           567.04 KiB / gzip: 81.33 KiB</span><br><span class="line">Done <span class="keyword">in</span> 2.30s.</span><br></pre></td></tr></table></figure><h2 id="运行项目-1"><a href="#运行项目-1" class="headerlink" title="运行项目"></a>运行项目</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\electron_repos\vite-vuetify-electron-app&gt; yarn electron:serve</span><br><span class="line">yarn run v1.22.5</span><br><span class="line">warning package.json: No license field</span><br><span class="line">$ electron .</span><br></pre></td></tr></table></figure><p>项目运行效果如下图所示:</p><img src="/2022/11/21/build-vue3-desktop-app-with-vite-electron-vuetify/002.png" class="" title="electron"><h1 id="动态模块热重载"><a href="#动态模块热重载" class="headerlink" title="动态模块热重载"></a>动态模块热重载</h1><p>按上面步骤建好的项目存在一个问题, 运行中的项目不能实时响应编辑修改后的代码, 所以为了方便开发调试, 需要添加动态模块热重载功能。</p><h2 id="编辑index-js"><a href="#编辑index-js" class="headerlink" title="编辑index.js"></a>编辑<code>index.js</code></h2><p>将<code>mainWindow.loadFile(&#39;dist/index.html&#39;)</code>更新为<code>mainWindow.loadURL(&quot;http://localhost:3000&quot;)</code>, 更新后的文件如下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 控制应用生命周期和创建原生浏览器窗口的模组</span></span><br><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">NODE_ENV</span> = process.<span class="property">env</span>.<span class="property">NODE_ENV</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createWindow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 创建浏览器窗口</span></span><br><span class="line">    <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">        <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">            <span class="attr">preload</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;preload.js&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载 index.html</span></span><br><span class="line">    <span class="comment">// mainWindow.loadFile(&#x27;dist/index.html&#x27;) // 此处跟electron官网路径不同，需要注意</span></span><br><span class="line"></span><br><span class="line">    mainWindow.<span class="title function_">loadURL</span>(<span class="string">&quot;http://localhost:3000&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable constant_">NODE_ENV</span> === <span class="string">&quot;development&quot;</span>) &#123;</span><br><span class="line">        mainWindow.<span class="property">webContents</span>.<span class="title function_">openDevTools</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开开发工具</span></span><br><span class="line">    <span class="comment">// mainWindow.webContents.openDevTools()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这段程序将会在 Electron 结束初始化</span></span><br><span class="line"><span class="comment">// 和创建浏览器窗口的时候调用</span></span><br><span class="line"><span class="comment">// 部分 API 在 ready 事件触发后才能使用。</span></span><br><span class="line">app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">createWindow</span>()</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">on</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 通常在 macOS 上，当点击 dock 中的应用程序图标时，如果没有其他</span></span><br><span class="line">        <span class="comment">// 打开的窗口，那么程序会重新创建一个窗口。</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">createWindow</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 除了 macOS 外，当所有窗口都被关闭的时候退出程序。 因此，通常对程序和它们在</span></span><br><span class="line"><span class="comment">// 任务栏上的图标来说，应当保持活跃状态，直到用户使用 Cmd + Q 退出。</span></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&#x27;darwin&#x27;</span>) app.<span class="title function_">quit</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这个文件中，你可以包含应用程序剩余的所有部分的代码，</span></span><br><span class="line"><span class="comment">// 也可以拆分成几个文件，然后用 require 导入。</span></span><br></pre></td></tr></table></figure><h2 id="编辑vite-config-js"><a href="#编辑vite-config-js" class="headerlink" title="编辑vite.config.js"></a>编辑<code>vite.config.js</code></h2><p>修改文件<code>vite.config.js</code>的<code>base</code>，修改后的文件如下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Plugins</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vuetify <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-vuetify&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Utilities</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="comment">// base: path.resolve(__dirname, &#x27;./dist/&#x27;),// 新增</span></span><br><span class="line">    <span class="attr">base</span>: <span class="string">&quot;./&quot;</span>,<span class="comment">// 新增</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">vue</span>(),</span><br><span class="line">        <span class="comment">// https://github.com/vuetifyjs/vuetify-loader/tree/next/packages/vite-plugin</span></span><br><span class="line">        <span class="title function_">vuetify</span>(&#123;</span><br><span class="line">            <span class="attr">autoImport</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">define</span>: &#123; <span class="string">&#x27;process.env&#x27;</span>: &#123;&#125; &#125;,</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;@&#x27;</span>: <span class="title function_">fileURLToPath</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;./src&#x27;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">extensions</span>: [</span><br><span class="line">            <span class="string">&#x27;.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;.json&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;.jsx&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;.mjs&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;.ts&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;.tsx&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;.vue&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="同时开启vite和electron服务"><a href="#同时开启vite和electron服务" class="headerlink" title="同时开启vite和electron服务"></a>同时开启<code>vite</code>和<code>electron</code>服务</h2><p>为了使<code>vite</code>和<code>electron</code>正常运行，需要先运行<code>vite</code>, 使得其开发服务器的<code>url</code>可以正常访问，然后再开启<code>electron</code>去加载<code>url</code>。</p><p>此处需要安装两个库：</p><blockquote><p><code>concurrently</code>：阻塞运行多个命令, <code>-k</code>参数用来清除其它已经存在或者挂掉的进程</p></blockquote><blockquote><p><code>wait-on</code>：等待资源，此处用来等待url可访问</p></blockquote><p>首先来安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D concurrently wait-on</span><br></pre></td></tr></table></figure><p>接着更新文件<code>package.json</code>, <code>scripts</code>新增两条命令：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wait-on tcp:3000 &amp;&amp; electron .&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;electron:serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;concurrently -k \&quot;yarn dev\&quot; \&quot;yarn electron\&quot;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>更新后完整内容如下：</p>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite-vuetify-electron-app&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wait-on tcp:3000 &amp;&amp; electron .&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron:serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;concurrently -k \&quot;yarn dev\&quot; \&quot;yarn electron\&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@mdi/font&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.0.96&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roboto-fontface&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.2.38&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vuetify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webfontloader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@vitejs/plugin-vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^21.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.1.9&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite-plugin-vuetify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0-alpha.12&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>现已添加两条命令：</p><blockquote><p><code>yarn electron</code>为等待<code>tcp</code>协议<code>3000</code>端口可访问，然后执行<code>electron</code></p></blockquote><blockquote><p><code>yarn electron:serve</code>为阻塞执行开发服务器运行和<code>yarn electron</code>命令</p></blockquote><p>运行项目只要执行命令<code>yarn electron:serve</code>即可，当修改项目文件时，桌面应用也将自动更新。</p><p>运行项目执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\electron_repos\vite-vuetify-electron-app&gt; yarn electron:serve</span><br><span class="line">yarn run v1.22.5</span><br><span class="line">warning package.json: No license field</span><br><span class="line">$ concurrently -k <span class="string">&quot;yarn dev&quot;</span> <span class="string">&quot;yarn electron&quot;</span></span><br><span class="line">warning package.json: No license field</span><br><span class="line">warning package.json: No license field</span><br><span class="line">$ wait-on tcp:3000 &amp;&amp; electron .</span><br><span class="line">$ vite</span><br><span class="line">[0]</span><br><span class="line">[0]   VITE v3.2.4  ready <span class="keyword">in</span> 451 ms</span><br><span class="line">[0]</span><br><span class="line">[0]   ➜  Local:   http://127.0.0.1:3000/</span><br><span class="line">[0]   ➜  Network: use --host to expose</span><br></pre></td></tr></table></figure><h1 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h1><p>之前为了方便开发过程中的调试设置的<code>热重载</code>, 在打包后还是加载<code>http://localhost:3000</code>是无法运行的,因此, 此处需要先用<code>vite</code>打包好，然后使用<code>electron-builder</code>加载<code>vite</code>打包后的文件进行打包。</p><p>为了代码能够根据不同环境在运行时加载<code>http://localhost:3000</code>, 在打包时加载文件, 此处需要使用<code>环境变量</code>来切换<code>生产</code>和<code>开发</code>环境。</p><h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>此处使用环境变量<code>NODE_ENV</code>来切换<code>生产</code>和<code>开发</code>环境，生产环境为<code>NODE_ENV=production</code>, 开发环境为<code>NODE_ENV=development</code>,若有其它如<code>release</code>等环境可在此基础上拓展。</p><h2 id="创建electron文件夹"><a href="#创建electron文件夹" class="headerlink" title="创建electron文件夹"></a>创建<code>electron</code>文件夹</h2><p>在项目根目录下创建文件夹<code>electron</code>, 将<code>index.js</code>和<code>preload.js</code>文件移动进来。其结构如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── electron</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   └── preload.js</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="编辑electron-index-js"><a href="#编辑electron-index-js" class="headerlink" title="编辑electron/index.js"></a>编辑<code>electron/index.js</code></h2><p>该文件主要是需要根据环境变量切换<code>electron</code>加载的内容，修改内容如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.<span class="title function_">loadURL</span>(</span><br><span class="line">  <span class="variable constant_">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span></span><br><span class="line">  ? <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">  :<span class="string">`file://<span class="subst">$&#123;path.join(__dirname, <span class="string">&#x27;../dist/index.html&#x27;</span>)&#125;</span>`</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>编辑后的完整代码如下:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 控制应用生命周期和创建原生浏览器窗口的模组</span></span><br><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">NODE_ENV</span> = process.<span class="property">env</span>.<span class="property">NODE_ENV</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createWindow</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 创建浏览器窗口</span></span><br><span class="line">  <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">preload</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;preload.js&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载 index.html</span></span><br><span class="line"><span class="comment">//   mainWindow.loadFile(&#x27;dist/index.html&#x27;) // 此处跟electron官网路径不同，需要注意</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// mainWindow.loadURL(&quot;http://localhost:3000&quot;)</span></span><br><span class="line">  mainWindow.<span class="title function_">loadURL</span>(</span><br><span class="line">    <span class="variable constant_">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span></span><br><span class="line">    ? <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">    :<span class="string">`file://<span class="subst">$&#123;path.join(__dirname, <span class="string">&#x27;../dist/index.html&#x27;</span>)&#125;</span>`</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable constant_">NODE_ENV</span> === <span class="string">&quot;development&quot;</span>) &#123;</span><br><span class="line">    mainWindow.<span class="property">webContents</span>.<span class="title function_">openDevTools</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 打开开发工具</span></span><br><span class="line">  <span class="comment">// mainWindow.webContents.openDevTools()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这段程序将会在 Electron 结束初始化</span></span><br><span class="line"><span class="comment">// 和创建浏览器窗口的时候调用</span></span><br><span class="line"><span class="comment">// 部分 API 在 ready 事件触发后才能使用。</span></span><br><span class="line">app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">createWindow</span>()</span><br><span class="line"></span><br><span class="line">  app.<span class="title function_">on</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 通常在 macOS 上，当点击 dock 中的应用程序图标时，如果没有其他</span></span><br><span class="line">    <span class="comment">// 打开的窗口，那么程序会重新创建一个窗口。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">createWindow</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 除了 macOS 外，当所有窗口都被关闭的时候退出程序。 因此，通常对程序和它们在</span></span><br><span class="line"><span class="comment">// 任务栏上的图标来说，应当保持活跃状态，直到用户使用 Cmd + Q 退出。</span></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&#x27;darwin&#x27;</span>) app.<span class="title function_">quit</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这个文件中，你可以包含应用程序剩余的所有部分的代码，</span></span><br><span class="line"><span class="comment">// 也可以拆分成几个文件，然后用 require 导入。</span></span><br></pre></td></tr></table></figure><h2 id="编辑package-json"><a href="#编辑package-json" class="headerlink" title="编辑package.json"></a>编辑<code>package.json</code></h2><p>首先修改<code>main</code> 属性，将<code>main: index.js</code>改为<code>main: electron/index.js</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kuari&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;electron/index.js&quot;</span>,</span><br><span class="line"> ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着, 添加<code>build</code>属性：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;build&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;appId&quot;</span>: <span class="string">&quot;com.your-website.your-app&quot;</span>,</span><br><span class="line">  <span class="string">&quot;productName&quot;</span>: <span class="string">&quot;ElectronApp&quot;</span>,</span><br><span class="line">  <span class="string">&quot;copyright&quot;</span>: <span class="string">&quot;Copyright © 2021 &lt;your-name&gt;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mac&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;category&quot;</span>: <span class="string">&quot;public.app-category.utilities&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;nsis&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;oneClick&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;allowToChangeInstallationDirectory&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;dist/**/*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;electron/**/*&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;directories&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;buildResources&quot;</span>: <span class="string">&quot;assets&quot;</span>,</span><br><span class="line">    <span class="string">&quot;output&quot;</span>: <span class="string">&quot;dist_electron&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="更新scripts属性"><a href="#更新scripts属性" class="headerlink" title="更新scripts属性"></a>更新<code>scripts</code>属性</h2><p>先安装两个库：</p><blockquote><p><code>cross-env</code>: 该库让开发者只需要注重环境变量的设置，而无需担心平台设置</p></blockquote><blockquote><p><code>electron-builder: electron</code>打包库</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D cross-env electron-builder</span><br></pre></td></tr></table></figure><p>更新后的<code>scripts</code>如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wait-on tcp:3000 &amp;&amp; cross-env NODE_ENV=development electron .&quot;</span><span class="punctuation">,</span> <span class="comment">// 此处需要设置环境变量以保证开发时加载url</span></span><br><span class="line">  <span class="attr">&quot;electron:serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;concurrently -k \&quot;yarn dev\&quot; \&quot;yarn electron\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;electron:build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build &amp;&amp; electron-builder&quot;</span> <span class="comment">// 新增打包命令</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>更新后完整的<code>packages.json</code>代码如下:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vuetify-electron-app&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;electron/index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wait-on tcp:3000 &amp;&amp; cross-env NODE_ENV=development electron .&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron:serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;concurrently -k \&quot;yarn dev\&quot; \&quot;yarn electron\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron:build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build &amp;&amp; electron-builder&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@mdi/font&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.0.96&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;leancloud-storage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.13.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pinia&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.24&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;roboto-fontface&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.2.38&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vue-router&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.1.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vuetify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webfontloader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@vitejs/plugin-vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;concurrently&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.5.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cross-env&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.0.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^21.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;electron-builder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^23.6.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.1.9&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vite-plugin-vuetify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0-alpha.12&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;wait-on&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.0.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;appId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hujiyi.github.io&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;productName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Teaching Plan&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;copyright&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Copyright © 2022 laohoo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mac&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public.app-category.utilities&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nsis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;oneClick&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;allowToChangeInstallationDirectory&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;dist/**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;electron/**/*&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;directories&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;buildResources&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assets&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dist_electron&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="打包-1"><a href="#打包-1" class="headerlink" title="打包"></a>打包</h2><p>直接执行打包命令即可开始打包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn electron:build</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>打包完成之后，会多出两个文件夹<code>dist</code>和<code>dist_electron</code>,其文件结构如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── dist</span><br><span class="line">│   ├── assets</span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   └── index.html</span><br><span class="line">├── dist_electron</span><br><span class="line">│   ├── MyApp-0.0.0-mac.zip</span><br><span class="line">│   ├── MyApp-0.0.0-mac.zip.blockmap</span><br><span class="line">│   ├── MyApp-0.0.0.dmg</span><br><span class="line">│   ├── MyApp-0.0.0.dmg.blockmap</span><br><span class="line">│   ├── builder-debug.yml</span><br><span class="line">│   ├── builder-effective-config.yaml</span><br><span class="line">│   └── mac</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h1 id="错误修改"><a href="#错误修改" class="headerlink" title="错误修改"></a>错误修改</h1><p>在第一次运行 <code>Electron</code> 项目的时候, 有可能会遇到类似包含有 <code>Electron failed to install correctly, please delete node_modules/electron and try installing again；</code> 信息的错误提示。</p><p>这个问题是因为在<code>install</code>的时候<code>node_modules/electron/ </code>中文件的丢失造成程序无法执行。缺少了<code>path.txt</code>和<code>dist</code>文件夹。</p><p>可以通过 <code>electron-fix</code> 来修改解决</p><ol><li><p>安装<code>electron-fix</code>, 执行命令: <code>npm install electron-fix -g</code></p></li><li><p>进行修改, 执行命令: <code>electron-fix start</code></p></li><li><p>执行 <code>npm run fix</code></p></li></ol><p>完成以上三个步骤之后, 再运行 <code>Electron</code> 项目就没有问题了。</p>]]></content>
      
      
      <categories>
          
          <category> electron </category>
          
      </categories>
      
      
        <tags>
            
            <tag> electron </tag>
            
            <tag> vite </tag>
            
            <tag> vuetify </tag>
            
            <tag> vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TamperMonkey 常用的代码</title>
      <link href="/2022/10/14/code-snippets-of-tampermonkey/"/>
      <url>/2022/10/14/code-snippets-of-tampermonkey/</url>
      
        <content type="html"><![CDATA[<p>偶尔会写一些 <code>TamperMonkey</code> 的脚本, 但每次间隔时间久了之后, 就经常忘记要怎么写了, 所以在这里记录一下一些常用的代码段, 有需要的时候可以直接拿来使用。</p><h1 id="使用-insertAdjacentHTML-添加-HTML-代码"><a href="#使用-insertAdjacentHTML-添加-HTML-代码" class="headerlink" title="使用 insertAdjacentHTML 添加 HTML 代码"></a>使用 <code>insertAdjacentHTML</code> 添加 <code>HTML</code> 代码</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加样式或其他HTML元素</span></span><br><span class="line"><span class="keyword">let</span> style = <span class="string">`&lt;style&gt;</span></span><br><span class="line"><span class="string">    .sidebar &#123;</span></span><br><span class="line"><span class="string">        display: none !important;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    .content&#123;</span></span><br><span class="line"><span class="string">        margin: 0 !important;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&#x27;beforeend&#x27;</span>, style);</span><br></pre></td></tr></table></figure><blockquote><p><code>insertAdjacentHTML()</code> 方法将指定的文本解析为 <code>Element</code> 元素，并将结果节点插入到 <code>DOM</code> 树中的指定位置</p></blockquote><ul><li><p><code>&#39;beforebegin&#39;</code>：元素自身的前面。</p></li><li><p><code>&#39;afterbegin&#39;</code>：插入元素内部的第一个子节点之前。</p></li><li><p><code>&#39;beforeend&#39;</code>：插入元素内部的最后一个子节点之后。</p></li><li><p><code>&#39;afterend&#39;</code>：元素自身的后面。</p></li></ul><h1 id="添加外部样式文件"><a href="#添加外部样式文件" class="headerlink" title="添加外部样式文件"></a>添加外部样式文件</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加其他网站上的外部样式文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; href 外部样式文件的url</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addLinkCss</span>(<span class="params">href</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;link&#x27;</span>);</span><br><span class="line">    link.<span class="property">type</span> = <span class="string">&#x27;text/css&#x27;</span>;</span><br><span class="line">    link.<span class="property">rel</span> = <span class="string">&#x27;stylesheet&#x27;</span>;</span><br><span class="line">    link.<span class="property">href</span> = href;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(link);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="添加样式使用示例"><a href="#添加样式使用示例" class="headerlink" title="添加样式使用示例"></a>添加样式使用示例</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义的样式(为防止样式冲突, 建议每个样式名称取专有的前缀, 例如此处的 acme-)</span></span><br><span class="line"><span class="keyword">let</span> style = <span class="string">`</span></span><br><span class="line"><span class="string">    .acme-button&#123;</span></span><br><span class="line"><span class="string">        position:fixed;</span></span><br><span class="line"><span class="string">        bottom: 20px;</span></span><br><span class="line"><span class="string">        right: 20px;</span></span><br><span class="line"><span class="string">        color: red;</span></span><br><span class="line"><span class="string">        padding: 15px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .acme-speed&#123;</span></span><br><span class="line"><span class="string">        display: none;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .acme-button:hover&#123;</span></span><br><span class="line"><span class="string">        color: green;</span></span><br><span class="line"><span class="string">        width: 300px;</span></span><br><span class="line"><span class="string">        height: 200px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .acme-button:hover .acme-speed&#123;</span></span><br><span class="line"><span class="string">        display:inline;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .acme-shadow &#123;</span></span><br><span class="line"><span class="string">        box-shadow: 0 2px 12px 2px rgba(0, 0, 0, 0.1);</span></span><br><span class="line"><span class="string">        border-radius: 8px;</span></span><br><span class="line"><span class="string">        border: 1px solid #ebeef5;</span></span><br><span class="line"><span class="string">        background-color: #fff;</span></span><br><span class="line"><span class="string">        color: #303133;</span></span><br><span class="line"><span class="string">        transition: 0.3s;</span></span><br><span class="line"><span class="string">    &#125;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&#x27;beforeend&#x27;</span>, style);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> htmL =<span class="string">`</span></span><br><span class="line"><span class="string">&lt;div class=&quot;acme-button acme-shadow&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;show&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;select name=&quot;speedx&quot; class=&quot;acme-speed&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;option value=&quot;16&quot;&gt;16.0x&lt;/option&gt;</span></span><br><span class="line"><span class="string">            &lt;option value=&quot;12&quot;&gt;12.0x&lt;/option&gt;</span></span><br><span class="line"><span class="string">            &lt;option value=&quot;8&quot;&gt;8.0x&lt;/option&gt;</span></span><br><span class="line"><span class="string">            &lt;option value=&quot;6&quot;&gt;6.0x&lt;/option&gt;</span></span><br><span class="line"><span class="string">            &lt;option value=&quot;4&quot;&gt;4.0x&lt;/option&gt;</span></span><br><span class="line"><span class="string">            &lt;option value=&quot;2&quot;&gt;2.0x&lt;/option&gt;</span></span><br><span class="line"><span class="string">            &lt;option value=&quot;1&quot;&gt;1.0x&lt;/option&gt;</span></span><br><span class="line"><span class="string">            &lt;option value=&quot;0.5&quot;&gt;0.5x&lt;/option&gt;</span></span><br><span class="line"><span class="string">        &lt;/select&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>;    </span><br><span class="line"></span><br><span class="line"><span class="comment">//  在 &lt;/body&gt; 标签前添加 html 代码</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&#x27;beforeend&#x27;</span>, html);    </span><br></pre></td></tr></table></figure><h1 id="添加外部-JavaScript-文件"><a href="#添加外部-JavaScript-文件" class="headerlink" title="添加外部 JavaScript 文件"></a>添加外部 JavaScript 文件</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加自定义的样式 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; src 外部JavaScript 文件 url</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; cb 在脚本加载并执行完成时触发的函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; onerror 处理发生在脚本加载期间的错误的函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addLinkScript</span>(<span class="params">src, cb, onerror</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    script.<span class="property">type</span> = <span class="string">&quot;text/javascript&quot;</span>;</span><br><span class="line">    script.<span class="property">src</span> = src;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;addScript&quot;</span>, script)</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;head&#x27;</span>).<span class="title function_">appendChild</span>(script);</span><br><span class="line">    script.<span class="property">onload</span> = <span class="keyword">typeof</span> cb === <span class="string">&quot;function&quot;</span> ? cb : <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;;</span><br><span class="line">    script.<span class="property">onerror</span> = <span class="keyword">typeof</span> onerror === <span class="string">&quot;function&quot;</span> ? onerror : <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="查找嵌套的-iframe-中的元素"><a href="#查找嵌套的-iframe-中的元素" class="headerlink" title="查找嵌套的 iframe 中的元素"></a>查找嵌套的 <code>iframe</code> 中的元素</h1><p>如果网页内包含的 <code>iframe</code> 元素时, 其内部元素不能被直接定位查找, 查找<code>iframe</code> 内部元素方法如下:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;iframe&#x27;</span>).<span class="title function_">forEach</span>( <span class="function"><span class="params">item</span> =&gt;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="property">body</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;iframe&quot;</span>).<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;button&quot;</span>) ;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="等待指定的时间"><a href="#等待指定的时间" class="headerlink" title="等待指定的时间"></a>等待指定的时间</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 等待指定的时间, 调用时在函数名前加上： await</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; s 等待时间，单位：秒</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">waitTime</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">resolve</span>();</span><br><span class="line">        &#125;, s * <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="延迟查找元素"><a href="#延迟查找元素" class="headerlink" title="延迟查找元素"></a>延迟查找元素</h1><p>有一些网页元素不能被直接定位查找, 例如使用 <code>JavaScript</code> 框架渲染或是从服务器读取数据后渲染的网页(如<code>Vue.js</code>)、 部分添加了<code>反爬虫</code>措施的网页(故意等待几秒钟后才显示内容)等。这些网页的脚本可以在等到某个特定元素出现后再开始执行, 方法如下:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 延迟查找元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; selector 被查找元素的选择器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; parent 父元素, 默认为 document</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; timeout 最长查找时间, 单位 毫秒</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">untilLoaded</span>(<span class="params">selector, parent = <span class="variable language_">document</span>, timeout = <span class="number">10</span> * <span class="number">1000</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果能找到元素, 直接返回</span></span><br><span class="line">        <span class="keyword">let</span> result = parent.<span class="title function_">querySelector</span>(selector);</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">            <span class="comment">// 此处不能缺少 return, 不然后续代码会继续执行</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">resolve</span>(result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> timer;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 找不到元素, 使用 MutationObserver 监听元素变动时目标是否出现</span></span><br><span class="line">        <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(<span class="function">(<span class="params">mutations</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> mutation <span class="keyword">of</span> mutations) &#123;</span><br><span class="line">                <span class="comment">//仅搜寻新增的dom元素</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> addedNode <span class="keyword">of</span> mutation.<span class="property">addedNodes</span>) &#123;</span><br><span class="line">                    <span class="comment">//判断单个元素是否为元素类型。</span></span><br><span class="line">                    <span class="keyword">if</span> (addedNode <span class="keyword">instanceof</span> <span class="title class_">Element</span>) &#123;</span><br><span class="line">                        <span class="comment">//matches函数判断元素是否符合选择器</span></span><br><span class="line">                        <span class="comment">//如果为真则返回该元素，如果不为真则进行querySelector对其子树进行搜寻</span></span><br><span class="line">                        <span class="comment">//matches的意义在于检查自身</span></span><br><span class="line">                        <span class="comment">//因为queryselector检查的是子级，无法检测自身是否是匹配元素。</span></span><br><span class="line">                        result = addedNode.<span class="title function_">matches</span>(selector)</span><br><span class="line">                            ? addedNode</span><br><span class="line">                            : addedNode.<span class="title function_">querySelector</span>(selector);</span><br><span class="line">                        <span class="comment">//如果搜寻到就解除监听，删除超时的定时器并返回结果</span></span><br><span class="line">                        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">                            observer.<span class="title function_">disconnect</span>();</span><br><span class="line">                            timer &amp;&amp; <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">                            <span class="keyword">return</span> <span class="title function_">resolve</span>(result);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//监听子元素改变，并监听该元素下的所有Dom元素</span></span><br><span class="line">        observer.<span class="title function_">observe</span>(parent, &#123;</span><br><span class="line">            <span class="attr">childList</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">subtree</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            observer.<span class="title function_">disconnect</span>();</span><br><span class="line">            timer &amp;&amp; <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查找元素超时, 找不到目标元素:&#x27;</span>, selector);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">resolve</span>(<span class="literal">null</span>);</span><br><span class="line">        &#125;, timeout);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="事件劫持"><a href="#事件劫持" class="headerlink" title="事件劫持"></a>事件劫持</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> oldEventListener = <span class="title class_">EventTarget</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addEventListener</span>;</span><br><span class="line">    <span class="title class_">EventTarget</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addEventListener</span> = <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> events = [<span class="string">&#x27;visibilitychange&#x27;</span>, <span class="string">&#x27;blur&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>, <span class="string">&#x27;contextmenu&#x27;</span>, <span class="string">&#x27;selectstart&#x27;</span>];</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;args:&#x27;</span>, args);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">onblur</span>!==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">onblur</span>=<span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">oncopy</span>!==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">oncopy</span>=<span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">oncontextmenu</span>!==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">oncontextmenu</span>=<span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">onselectstart</span>!==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">onselectstart</span>=<span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (args.<span class="property">length</span> !== <span class="number">0</span> &amp;&amp; events.<span class="title function_">includes</span>(args[<span class="number">0</span>])) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`劫持 <span class="subst">$&#123;args[<span class="number">0</span>]&#125;</span> 事件成功! `</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> oldEventListener.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...args)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tampermonkey脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tampermonkey </tag>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Linux Mint 21 安装 Flutter 开发环境</title>
      <link href="/2022/10/09/install-flutter-on-linux-mint-21/"/>
      <url>/2022/10/09/install-flutter-on-linux-mint-21/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Dell Inspiron I5 7559 </p></li><li><p>Intel Core i5 6th Gen 6300HQ (2.30GHz)</p></li><li><p>NVIDIA GeForce GTX 960M </p></li><li><p>Linux Mint 21 5.15.0-48-generic, locale en_US.UTF-8 </p></li><li><p>OpenJDK Runtime Environment (build 11.0.16+8-post-Ubuntu-0ubuntu122.04)</p></li><li><p>Visual Studio Code 1.72.0</p></li><li><p>Flutter version 3.3.4 on channel stable</p></li><li><p>Git 2.34.1</p></li></ul><hr><p>前段时间把用了六年的 <code>Dell Inspiron I5 7559</code> 处理了一下: 拆掉失效的电池; 把买电脑时自带的 <code>128GB</code> 固态硬盘装回去; 把<code>500GB</code>的机械硬盘拆下来, 放到硬盘底座上当个移动硬盘用; 然后给它安装了一个 <code>Linux Mint 21</code>。</p><p>本来想给 <code>NVIDIA GeForce GTX 960M</code> 显卡安装一个 <code>NVIDIA</code> 驱动的, 试着安装了几个版本不成功, 安装驱动后无法进入桌面, <code>CRTL+ALT+F1</code> 进入 <code>tty</code> 也不成功, 命令界面闪了一下就不见了。显卡驱动装不上, 那就只能拿它来弄其他的吧, 于是就尝试一下在 <code>Linux</code> 上安装 <code>Flutter</code> 的开发环境。</p><h1 id="安装-Flutter-SDK"><a href="#安装-Flutter-SDK" class="headerlink" title="安装 Flutter SDK"></a>安装 <code>Flutter SDK</code></h1><blockquote><p><code>Flutter SDK</code> (stable channel) 下载地址：<a href="https://docs.flutter.dev/development/tools/sdk/releases">https://docs.flutter.dev/development/tools/sdk/releases</a> </p></blockquote><ol><li><p>在 <code>$HOME</code> 新建名为 <code>AppData</code> 的文件夹</p></li><li><p>下载最新版的 <code>flutter_linux_3.3.4-stable.tar.xz</code> 到 <code>$HOME/AppData</code> 文件夹</p></li><li><p>将<code>flutter_linux_3.3.4-stable.tar.xz</code>文件 解压到当前位置(Extact here), 解压后 <code>Flutter SDK</code> 的路径为 <code>$HOME/AppData/flutter</code></p></li><li><p>添加 <code>Flutter</code> 相关的环境变量</p></li></ol><p>执行命令:<code>xed ~/.bashrc</code>, 在<code>.bashrc</code> 文件的最末尾添加以下内容:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;$PATH:$HOME/AppData/flutter/bin&quot;</span><br><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br></pre></td></tr></table></figure><blockquote><ol><li><code>xed</code> 是 <code>Linux Mint</code> 自带的文本编辑器, 使用其他版本的 <code>Linux</code>时用相应的命令替换</li><li>可以执行 <code>source ~/.bashrc</code> 命令让修改后的环境变量立即生效</li></ol></blockquote><ol start="5"><li><code>Flutter</code> 环境检查</li></ol><p>执行 <code>Flutter</code> 环境检查命令: <code>flutter doctor -v</code></p><blockquote><p><code>Linux</code> 环境下 <code>flutter doctor</code> 命令需要依赖 <code>Git</code>, 在命令执行前要先确保电脑已经安装 <code>Git</code></p></blockquote><p>命令执行结果如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ flutter doctor -v</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Running <span class="string">&quot;flutter pub get&quot;</span> <span class="keyword">in</span> flutter_tools...                       4.9s</span><br><span class="line">[✓] Flutter (Channel stable, 3.3.4, on Linux Mint 21 5.15.0-48-generic, locale en_US.UTF-8)</span><br><span class="line">    • Flutter version 3.3.4 on channel stable at /home/laohoo/AppData/flutter</span><br><span class="line">    • Upstream repository https://github.com/flutter/flutter.git</span><br><span class="line">    • Framework revision eb6d86ee27 (3 days ago), 2022-10-04 22:31:45 -0700</span><br><span class="line">    • Engine revision c08d7d5efc</span><br><span class="line">    • Dart version 2.18.2</span><br><span class="line">    • DevTools version 2.15.0</span><br><span class="line">    • Pub download mirror https://pub.flutter-io.cn</span><br><span class="line">    • Flutter download mirror https://storage.flutter-io.cn</span><br><span class="line"></span><br><span class="line">[✗] Android toolchain - develop <span class="keyword">for</span> Android devices</span><br><span class="line">    ✗ Unable to locate Android SDK.</span><br><span class="line">      Install Android Studio from: https://developer.android.com/studio/index.html</span><br><span class="line">      On first launch it will assist you <span class="keyword">in</span> installing the Android SDK components.</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/linux#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line">      If the Android SDK has been installed to a custom location, please use</span><br><span class="line">      `flutter config --android-sdk` to update to that location.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[✗] Chrome - develop <span class="keyword">for</span> the web (Cannot find Chrome executable at google-chrome)</span><br><span class="line">    ! Cannot find Chrome. Try setting CHROME_EXECUTABLE to a Chrome executable.</span><br><span class="line"></span><br><span class="line">[✗] Linux toolchain - develop <span class="keyword">for</span> Linux desktop</span><br><span class="line">    • Ubuntu clang version 14.0.0-1ubuntu1</span><br><span class="line">    • cmake version 3.22.1</span><br><span class="line">    • ninja version 1.10.1</span><br><span class="line">    • pkg-config version 0.29.2</span><br><span class="line">    ✗ GTK 3.0 development libraries are required <span class="keyword">for</span> Linux development.</span><br><span class="line">      They are likely available from your distribution (e.g.: apt install libgtk-3-dev)</span><br><span class="line"></span><br><span class="line">[!] Android Studio (not installed)</span><br><span class="line">    • Android Studio not found; download from https://developer.android.com/studio/index.html</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/linux#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line"></span><br><span class="line">[✓] VS Code (version 1.72.0)</span><br><span class="line">    • VS Code at /usr/share/code</span><br><span class="line">    • Flutter extension version 3.50.0</span><br><span class="line"></span><br><span class="line">[✓] Connected device (1 available)</span><br><span class="line">    • Linux (desktop) • linux • linux-x64 • Linux Mint 21 5.15.0-48-generic</span><br><span class="line"></span><br><span class="line">[✓] HTTP Host Availability</span><br><span class="line">    • All required HTTP hosts are available</span><br><span class="line"></span><br><span class="line">! Doctor found issues <span class="keyword">in</span> 4 categories.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>检查结果显示有4类问题:</p><ol><li><p><code>[✗] Android toolchain - develop for Android devices</code> : 用于生成和运行 <code>Android</code> 应用程序的开发工具链, 目前还没有安装  Android SDK</p></li><li><p><code>[✗] Chrome - develop for the web </code>: 生成和运行 Web 项目时需要使用 <code>Chrome</code> 浏览器, <code>Linux Mint</code> 自带的 <code>Firefox</code> 不认</p></li><li><p><code>[✗] Linux toolchain - develop for Linux desktop</code>: 用于生成和运行 <code>Linux</code>桌面应用程序的开发工具链</p></li><li><p><code>[!] Android Studio (not installed)</code>: 没有安装 <code>Android Studio</code>, 这个不打算安装了</p></li></ol><blockquote><p>并不是所有的工具链都要安装, 只安装需要的<code>目标平台</code>的工具链就要以了。</p></blockquote><h1 id="安装-Linux-工具链-Linux-toolchain-develop-for-Linux-desktop"><a href="#安装-Linux-工具链-Linux-toolchain-develop-for-Linux-desktop" class="headerlink" title="安装 Linux 工具链(Linux toolchain - develop for Linux desktop)"></a>安装 Linux 工具链(Linux toolchain - develop for Linux desktop)</h1><p><code>Linux</code> 工具链的安装比较简单,直接执行以下命令即可: </p><p><code>sudo apt-get install clang cmake ninja-build pkg-config libgtk-3-dev liblzma-dev libstdc++-12-dev</code></p><p>命令执行过程(部分), 如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ <span class="built_in">sudo</span> apt-get install clang cmake ninja-build pkg-config libgtk-3-dev liblzma-dev libstdc++-12-dev</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">liblzma-dev is already the newest version (5.2.5-2ubuntu1).</span><br><span class="line">pkg-config is already the newest version (0.29.2-1ubuntu3).</span><br><span class="line">clang is already the newest version (1:14.0-55~exp2).</span><br><span class="line">ninja-build is already the newest version (1.10.1-1).</span><br><span class="line">cmake is already the newest version (3.22.1-1ubuntu1.22.04.1).</span><br></pre></td></tr></table></figure><blockquote><p><code>Flutter</code> 官方网站安装指导中缺少了 <code>libstdc++-12-dev</code>, 在部分系统上调试项目时, 会出现</p></blockquote><h2 id="可能出现的错误"><a href="#可能出现的错误" class="headerlink" title="可能出现的错误"></a>可能出现的错误</h2><p>在部分<code>Linux</code>系统上调试<code>Flutter</code>项目时, 可能会出现以下的错误:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Launching lib/main.dart on Linux <span class="keyword">in</span> debug mode...</span><br><span class="line">CMake Error at /usr/share/cmake-3.22/Modules/CMakeTestCXXCompiler.cmake:62 (message):</span><br><span class="line">  The C++ compiler</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;/usr/bin/clang++&quot;</span></span><br><span class="line"></span><br><span class="line">  is not able to compile a simple <span class="built_in">test</span> program.</span><br><span class="line"></span><br><span class="line">  It fails with the following output:</span><br><span class="line"></span><br><span class="line">    Change Dir: /home/bul/Desktop/app_test/build/linux/x64/debug/CMakeFiles/CMakeTmp</span><br><span class="line"></span><br><span class="line">    Run Build Command(s):/usr/bin/ninja cmTC_6702a &amp;&amp; [1/2] Building CXX object CMakeFiles/cmTC_6702a.<span class="built_in">dir</span>/testCXXCompiler.cxx.o</span><br><span class="line">    [2/2] Linking CXX executable cmTC_6702a</span><br><span class="line">    FAILED: cmTC_6702a </span><br><span class="line">    : &amp;&amp; /usr/bin/clang++   CMakeFiles/cmTC_6702a.<span class="built_in">dir</span>/testCXXCompiler.cxx.o -o cmTC_6702a   &amp;&amp; :</span><br><span class="line">    /usr/bin/ld: cannot find -lstdc++: No such file or directory</span><br><span class="line">    clang: error: linker <span class="built_in">command</span> failed with <span class="built_in">exit</span> code 1 (use -v to see invocation)</span><br><span class="line">    ninja: build stopped: subcommand failed.</span><br><span class="line"></span><br><span class="line">  CMake will not be able to correctly generate this project.</span><br><span class="line">Call Stack (most recent call first):</span><br><span class="line">  CMakeLists.txt:3 (project)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Building Linux application...                                           </span><br><span class="line">Exception: Unable to generate build files</span><br></pre></td></tr></table></figure><p>错误的原因是官方的文档少安装了一个依赖: <code>libstdc++-12-dev</code>, 安装上去即可(上面的<code>Linux</code>工具链安装命令中已包含)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install lib32stdc++-12-dev</span><br></pre></td></tr></table></figure><h1 id="安装-Android-toolchain"><a href="#安装-Android-toolchain" class="headerlink" title="安装 Android toolchain"></a>安装 <code>Android toolchain</code></h1><p><code>Android toolchain</code> 需要的组件包括两大块: <code>Android SDK</code>, <code>Android 模拟器</code></p><h2 id="使用Command-line-Tools安装-Android-SDK"><a href="#使用Command-line-Tools安装-Android-SDK" class="headerlink" title="使用Command-line Tools安装 Android SDK"></a>使用<code>Command-line Tools</code>安装 <code>Android SDK</code></h2><blockquote><p><code>Android SDK Command-line Tools(latest)</code> 下载地址：<a href="https://developer.android.google.cn/studio?hl=zh-cn#command-tools">https://developer.android.google.cn/studio?hl=zh-cn#command-tools</a></p></blockquote><ol><li>下载、解压缩  <code>Android SDK Command-line Tools(latest)</code></li></ol><p>在 <code>$HOME/AppData/</code> 文件夹中新建名为<code>android_sdk</code> 的文件夹, 下载最新的 <code>Linux</code> 版本的 <code>Android SDK Command-line Tools(latest)</code>文件 <code>commandlinetools-linux-8512546_latest.zip</code> (如有更新的版本, 请自行替换), 解压缩到以下位置: <code>$HOME/AppData/android_sdk/cmdline-tools/latest</code> , <code>latest</code> 文件夹内包含 <code>bin</code>、<code>lib</code> 文件夹。</p><ol start="2"><li>修改用户环境变量</li></ol><p>执行命令: <code>xed ~/.bashrc</code>, 添加 <code>ANDROID_HOME</code> 环境变量 和 <code>Android SDK Command-line Tools(latest)</code>路径, 如下所示:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;$PATH:$HOME/AppData/flutter/bin&quot;</span><br><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br><span class="line"></span><br><span class="line">export PATH=&quot;$PATH:$HOME/AppData/android_sdk/cmdline-tools/latest/bin&quot;</span><br><span class="line">export ANDROID_HOME=$HOME/AppData/android_sdk</span><br></pre></td></tr></table></figure><ol start="3"><li>安装 <code>Android SDK</code> 软件包(组件)</li></ol><p>配置好 <code>Android SDK Command-line Tools(latest)</code> 路径后, 可以用<code>sdkmanager</code> 命令来安装 <code>Android SDK</code> 软件包, 安装命令格式: <code>sdkmanager &lt;packages&gt;</code></p><p><code>Flutter SDK</code>最少需要三个组件: <code>platform-tools</code>, <code>build-tools</code>, <code>platforms</code>, 其中 <code>build-tools</code>和<code>platforms</code> 的版本会跟随 <code>Flutter SDK</code> 版本而不同。</p><blockquote><ol><li>如果不能确定当前 <code>Flutter SDK</code> 需要的版本号, 可以任意安装某个版本, 当第一次运行程序时, 会自动检查并安装合适的版本。</li><li><code>Flutter SDK 3.3.4</code> 需要的版本为: <code>&quot;build-tools;30.0.3&quot;</code>、 <code>&quot;platforms;android-31&quot; </code></li></ol></blockquote><p>安装命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdkmanager <span class="string">&quot;platform-tools&quot;</span> <span class="string">&quot;build-tools;30.0.3&quot;</span> <span class="string">&quot;platforms;android-31&quot;</span> </span><br></pre></td></tr></table></figure><p>显示已安装和可用的<code>Android SDK</code> 组件: <code>sdkmanager --list</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ sdkmanager --list</span><br><span class="line">Installed packages:=====================] 100% Computing updates...             </span><br><span class="line">  Path                 | Version | Description                | Location            </span><br><span class="line">  -------              | ------- | -------                    | -------             </span><br><span class="line">  build-tools;30.0.3   | 30.0.3  | Android SDK Build-Tools 30.0.3 | build-tools/30.0.3 </span><br><span class="line">  platform-tools       | 33.0.3  | Android SDK Platform-Tools | platform-tools      </span><br><span class="line">  platforms;android-31 | 1       | Android SDK Platform 31    | platforms/android-31 </span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>执行 <code>Flutter</code> 环境检查, 结果如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ flutter doctor -v</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">[✓] Flutter (Channel stable, 3.3.4, on Linux Mint 21 5.15.0-48-generic, locale en_US.UTF-8)</span><br><span class="line">    • Flutter version 3.3.4 on channel stable at /home/laohoo/AppData/flutter</span><br><span class="line">    • Upstream repository https://github.com/flutter/flutter.git</span><br><span class="line">    • Framework revision eb6d86ee27 (3 days ago), 2022-10-04 22:31:45 -0700</span><br><span class="line">    • Engine revision c08d7d5efc</span><br><span class="line">    • Dart version 2.18.2</span><br><span class="line">    • DevTools version 2.15.0</span><br><span class="line">    • Pub download mirror https://pub.flutter-io.cn</span><br><span class="line">    • Flutter download mirror https://storage.flutter-io.cn</span><br><span class="line"></span><br><span class="line">[!] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 31.0.0)</span><br><span class="line">    • Android SDK at /home/laohoo/AppData/android_sdk</span><br><span class="line">    • Platform android-33, build-tools 31.0.0</span><br><span class="line">    • ANDROID_HOME = /home/laohoo/AppData/android_sdk</span><br><span class="line">    • Java binary at: /usr/bin/java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 11.0.16+8-post-Ubuntu-0ubuntu122.04)</span><br><span class="line">    ! Some Android licenses not accepted.  To resolve this, run: flutter doctor --android-licenses</span><br><span class="line"></span><br><span class="line">[✗] Chrome - develop <span class="keyword">for</span> the web (Cannot find Chrome executable at google-chrome)</span><br><span class="line">    ! Cannot find Chrome. Try setting CHROME_EXECUTABLE to a Chrome executable.</span><br><span class="line"></span><br><span class="line">[✓] Linux toolchain - develop <span class="keyword">for</span> Linux desktop</span><br><span class="line">    • Ubuntu clang version 14.0.0-1ubuntu1</span><br><span class="line">    • cmake version 3.22.1</span><br><span class="line">    • ninja version 1.10.1</span><br><span class="line">    • pkg-config version 0.29.2</span><br><span class="line"></span><br><span class="line">[!] Android Studio (not installed)</span><br><span class="line">    • Android Studio not found; download from https://developer.android.com/studio/index.html</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/linux#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line"></span><br><span class="line">[✓] VS Code (version 1.72.0)</span><br><span class="line">    • VS Code at /usr/share/code</span><br><span class="line">    • Flutter extension version 3.50.0</span><br><span class="line"></span><br><span class="line">[✓] Connected device (1 available)</span><br><span class="line">    • Linux (desktop) • linux • linux-x64 • Linux Mint 21 5.15.0-48-generic</span><br><span class="line"></span><br><span class="line">[✓] HTTP Host Availability</span><br><span class="line">    • All required HTTP hosts are available</span><br><span class="line"></span><br><span class="line">! Doctor found issues <span class="keyword">in</span> 3 categories.</span><br></pre></td></tr></table></figure><p><code>Android 工具链</code>变成感叹号, 表示还没有完全解决问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[!] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 31.0.0)</span><br><span class="line">    • Android SDK at /home/laohoo/AppData/android_sdk</span><br><span class="line">    • Platform android-33, build-tools 31.0.0</span><br><span class="line">    • ANDROID_HOME = /home/laohoo/AppData/android_sdk</span><br><span class="line">    • Java binary at: /usr/bin/java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 11.0.16+8-post-Ubuntu-0ubuntu122.04)</span><br><span class="line">    ! Some Android licenses not accepted.  To resolve this, run: flutter doctor --android-licenses</span><br></pre></td></tr></table></figure><blockquote><p><code>! Some Android licenses not accepted.  To resolve this, run: flutter doctor --android-licenses</code>: 还没有接受 Andorid 的协议, 执行命令: <code>flutter doctor --android-licenses</code></p></blockquote><p>接受 <code>Android licenses</code>, 执行命令 <code>flutter doctor --android-licenses</code>, 全部问题回答 <code>yes</code>, 如下所示(内容太长, 只显示一小部分):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ flutter doctor --android-licenses</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">5 of 6 SDK package licenses not accepted. 100% Computing updates...             </span><br><span class="line">Review licenses that have not been accepted (y/N)? y</span><br></pre></td></tr></table></figure><p>接受协议后再次执行 <code>Flutter</code> 环境检查, 结果如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ flutter doctor -v</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">[✓] Flutter (Channel stable, 3.3.4, on Linux Mint 21 5.15.0-48-generic, locale en_US.UTF-8)</span><br><span class="line">    • Flutter version 3.3.4 on channel stable at /home/laohoo/AppData/flutter</span><br><span class="line">    • Upstream repository https://github.com/flutter/flutter.git</span><br><span class="line">    • Framework revision eb6d86ee27 (3 days ago), 2022-10-04 22:31:45 -0700</span><br><span class="line">    • Engine revision c08d7d5efc</span><br><span class="line">    • Dart version 2.18.2</span><br><span class="line">    • DevTools version 2.15.0</span><br><span class="line">    • Pub download mirror https://pub.flutter-io.cn</span><br><span class="line">    • Flutter download mirror https://storage.flutter-io.cn</span><br><span class="line"></span><br><span class="line">[✓] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 31.0.0)</span><br><span class="line">    • Android SDK at /home/laohoo/AppData/android_sdk</span><br><span class="line">    • Platform android-33, build-tools 31.0.0</span><br><span class="line">    • ANDROID_HOME = /home/laohoo/AppData/android_sdk</span><br><span class="line">    • Java binary at: /usr/bin/java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 11.0.16+8-post-Ubuntu-0ubuntu122.04)</span><br><span class="line">    • All Android licenses accepted.</span><br><span class="line"></span><br><span class="line">[✗] Chrome - develop <span class="keyword">for</span> the web (Cannot find Chrome executable at google-chrome)</span><br><span class="line">    ! Cannot find Chrome. Try setting CHROME_EXECUTABLE to a Chrome executable.</span><br><span class="line"></span><br><span class="line">[✓] Linux toolchain - develop <span class="keyword">for</span> Linux desktop</span><br><span class="line">    • Ubuntu clang version 14.0.0-1ubuntu1</span><br><span class="line">    • cmake version 3.22.1</span><br><span class="line">    • ninja version 1.10.1</span><br><span class="line">    • pkg-config version 0.29.2</span><br><span class="line"></span><br><span class="line">[!] Android Studio (not installed)</span><br><span class="line">    • Android Studio not found; download from https://developer.android.com/studio/index.html</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/linux#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line"></span><br><span class="line">[✓] VS Code (version 1.72.0)</span><br><span class="line">    • VS Code at /usr/share/code</span><br><span class="line">    • Flutter extension version 3.50.0</span><br><span class="line"></span><br><span class="line">[✓] Connected device (1 available)</span><br><span class="line">    • Linux (desktop) • linux • linux-x64 • Linux Mint 21 5.15.0-48-generic</span><br><span class="line"></span><br><span class="line">[✓] HTTP Host Availability</span><br><span class="line">    • All required HTTP hosts are available</span><br><span class="line"></span><br><span class="line">! Doctor found issues <span class="keyword">in</span> 2 categories.</span><br></pre></td></tr></table></figure><h1 id="安装模拟器"><a href="#安装模拟器" class="headerlink" title="安装模拟器"></a>安装模拟器</h1><p>使用命令 <code>sdkmanager emulator</code> 安装模拟器, 命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ sdkmanager emulator</span><br><span class="line">[=======================================] 100% Unzipping... emulator/bin64/tune2</span><br></pre></td></tr></table></figure><p>安装模拟器镜像前, 可以通过 <code>sdkmanager --list</code> 查看当前可用的<code>模拟器镜像</code>, 选择合适的镜像安装。</p><p><code>sdkmanager</code>安装模拟器镜像过程如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ sdkmanager <span class="string">&quot;system-images;android-31;default;x86_64&quot;</span></span><br><span class="line">[=======================================] 100% Unzipping... x86_64/data/misc/mod</span><br></pre></td></tr></table></figure><h1 id="配置模拟器硬件加速"><a href="#配置模拟器硬件加速" class="headerlink" title="配置模拟器硬件加速"></a>配置模拟器硬件加速</h1><p><code>Linux</code> 使用 <code>KVM</code> 来支持模拟器的硬件加速, 在安装使用 <code>KVM</code> 之前先要检查电脑是否支持虚拟化功能</p><p>安装 <code>cpu-checker</code> 软件包: <code>sudo apt install cpu-checker</code>, 命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ <span class="built_in">sudo</span> apt install cpu-checker</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> laohoo:       </span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  msr-tools</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  cpu-checker msr-tools</span><br><span class="line">0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.</span><br><span class="line">Need to get 17.1 kB of archives.</span><br><span class="line">After this operation, 67.6 kB of additional disk space will be used.</span><br><span class="line">Do you want to <span class="built_in">continue</span>? [Y/n] y</span><br><span class="line">Get:1 http://mirrors.aliyun.com/ubuntu jammy/main amd64 msr-tools amd64 1.3-4 [10.3 kB]</span><br><span class="line">Get:2 http://mirrors.aliyun.com/ubuntu jammy/main amd64 cpu-checker amd64 0.7-1.3build1 [6,800 B]</span><br><span class="line">Fetched 17.1 kB <span class="keyword">in</span> 0s (187 kB/s)       </span><br><span class="line">Selecting previously unselected package msr-tools.</span><br><span class="line">(Reading database ... 295693 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../msr-tools_1.3-4_amd64.deb ...</span><br><span class="line">Unpacking msr-tools (1.3-4) ...</span><br><span class="line">Selecting previously unselected package cpu-checker.</span><br><span class="line">Preparing to unpack .../cpu-checker_0.7-1.3build1_amd64.deb ...</span><br><span class="line">Unpacking cpu-checker (0.7-1.3build1) ...</span><br><span class="line">Setting up msr-tools (1.3-4) ...</span><br><span class="line">Setting up cpu-checker (0.7-1.3build1) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> man-db (2.10.2-1) ...</span><br></pre></td></tr></table></figure><p>检查是否支持虚拟化: <code>egrep -c &#39;(vmx|svm)&#39; /proc/cpuinfo</code>, 命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ egrep -c <span class="string">&#x27;(vmx|svm)&#x27;</span> /proc/cpuinfo</span><br><span class="line">8</span><br></pre></td></tr></table></figure><blockquote><p>输出值 1 或更大值表示支持虚拟化。输出值 0 表示您的 CPU 不支持硬件虚拟化。</p></blockquote><p>确定电脑是否能够运行硬件加速的 KVM 虚拟机: <code>kvm-ok</code>, 命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ kvm-ok</span><br><span class="line">INFO: /dev/kvm exists</span><br><span class="line">KVM acceleration can be used</span><br></pre></td></tr></table></figure><blockquote><p>上述结果表示当前电脑能够运行硬件加速的 <code>KVM</code> 虚拟机</p></blockquote><p>在 <code>Linux</code> 上安装 <code>KVM</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils</span><br></pre></td></tr></table></figure><h1 id="创建Android模拟器"><a href="#创建Android模拟器" class="headerlink" title="创建Android模拟器"></a>创建<code>Android</code>模拟器</h1><p>通过命令 <code>avdmanager</code> 来创建<code>Android</code>模拟器, 命令格式: <code>avdmanager create avd -n 模拟器名 -k &quot;模拟器镜像名&quot;</code></p><blockquote><ol><li><code>模拟器名</code> 用于运行模拟器时调用</li><li><code>模拟器镜像名</code> 为之前已经安装的镜像</li></ol></blockquote><p>命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ avdmanager create avd -n huawei -k <span class="string">&quot;system-images;android-31;default;x86_64&quot;</span></span><br><span class="line">Auto-selecting single ABI x86_64========] 100% Fetch remote repository...       </span><br><span class="line">Do you wish to create a custom hardware profile? [no] </span><br></pre></td></tr></table></figure><blockquote><ol><li>此处为方便回答 <code>no</code>, <code>yes</code> 的选项太多了, 回答了70几项还没有结束, 最关键是还看不懂.</li><li><code>huawei</code> 是模拟器的名字</li><li><code>&quot;system-images;android-31;default;x86_64&quot;</code> 是模拟器镜像名</li></ol></blockquote><h1 id="启动模拟器"><a href="#启动模拟器" class="headerlink" title="启动模拟器"></a>启动模拟器</h1><p>查看当前已经建好的模拟器: <code>avdmanager list avd</code>, 命令执行结果如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aohoo@laohoo-Inspiron-7559:~/Desktop$ avdmanager list avd</span><br><span class="line">Available Android Virtual Devices:</span><br><span class="line">    Name: huawei</span><br><span class="line">    Path: /home/laohoo/.android/avd/huawei.avd</span><br><span class="line">  Target: Default Android System Image</span><br><span class="line">          Based on: Android 12.0 (S) Tag/ABI: default/x86_64</span><br><span class="line">  Sdcard: 512 MB</span><br></pre></td></tr></table></figure><p>启动模拟器的命令位于 <code>Android SDK</code> 的 <code>emulator</code> 文件夹下, 需要先添加该文件夹的路径到环境变量中。</p><p>修改环境变量: <code>xed ~/.bashrc</code></p><p><code>~/.bashrc</code> 文件末尾修改后的内容如下: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;$PATH:$HOME/AppData/flutter/bin&quot;</span><br><span class="line">export PATH=&quot;$PATH:$HOME/AppData/android_sdk/cmdline-tools/latest/bin&quot;</span><br><span class="line">export PATH=&quot;$PATH:$HOME/AppData/android_sdk/emulator&quot;</span><br><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br><span class="line">export ANDROID_HOME=$HOME/AppData/android_sdk</span><br></pre></td></tr></table></figure><p>启动模拟器的命令: <code>emulator -avd 模拟器名</code>, 命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Desktop$ emulator -avd huawei</span><br><span class="line">INFO    | Android emulator version 31.3.11.0 (build_id 9058569) (CL:N/A)</span><br><span class="line">emulator: INFO: Found systemPath /home/laohoo/AppData/android_sdk/system-images/android-31/default/x86_64/</span><br><span class="line">INFO    | Duplicate loglines will be removed, <span class="keyword">if</span> you wish to see each indiviudal line launch with the -log-nofilter flag.</span><br><span class="line">WARNING | unexpected system image feature string, emulator might not <span class="keyword">function</span> correctly, please try updating the emulator.</span><br><span class="line">WARNING | cannot add library /home/laohoo/AppData/android_sdk/emulator/qemu/linux-x86_64/lib64/vulkan/libvulkan.so: failed</span><br><span class="line">INFO    | added library /home/laohoo/AppData/android_sdk/emulator/lib64/vulkan/libvulkan.so</span><br><span class="line">MESA-INTEL: warning: Performance support disabled, consider sysctl dev.i915.perf_stream_paranoid=0</span><br><span class="line"></span><br><span class="line">INFO    | configAndStartRenderer: setting vsync to 60 hz</span><br><span class="line">INFO    | Sending adb public key [QAAAACPLTUN1QxgyNvTke2ABrlB0HlUVCDlT/YFb/fooM9bItTYvgmZ9+lCSgqgYyQxmkF+TOiBom0UMQ8iidd9qr0yLKd+12SVI5GxZLch4gE7KY+Dm/7MRLso5k6XsMWu4wusaWXIsShzHkMh86Tx16H1OB+GqPaJA5EIjcVHiovK2mRHBz8swQ5+2xJ5fqN4oOEzCRq71se4U5ykFBLmGRSY+BGwGgfqtRAWBZFhZCzL7Jy8ten9Q1cIkOyzLOvOFAZFqdEdMmtTPjBeug1VtTUcL16wGm+PH0MsO0rOH7M7Y7WxjsETt5qXw7BnY80eAyBNCURzxXMoAtX0YBxk9NL3dAuyZmYRz+btLQ7tpYOqpO535s31I+YvQLiXW0bS23lHCBl5CTyV7COZ90BZ2tQp2N37/65nE+jplU7U4NDvA45/+uHCCeFiMR6jegepNi3YUrl9pb6ti/O2+mD3s/YP9pQ/7TokunOG9h5IXVjtdela4jKyLJer3o70PDMNFZtiebQ/8QGT/m5NGp/1wrHMyeGDCYLc5qaEexjD9QzZQyM9xOfiMK/78RBqo7FX0ihL5uMfKAQ2FFD2IQsd8FsYgIS7kzSVZuS0l/8HyBYrsgCt0mBq2A54PvPTCK/UcMdrzj2SpM5yifdEJ/PAGWtD6kwEWa9o9siYu8dBb7Zibw4mnBAEAAQA= laohoo@unknown]</span><br><span class="line">INFO    | injectedQemuChannel!</span><br><span class="line">INFO    | Informing listeners of injection.</span><br><span class="line">INFO    | Rootcanal has  been activated.</span><br><span class="line">WARNING | *** No gRPC protection active, consider launching with the -grpc-use-jwt flag.***</span><br><span class="line">INFO    | Started GRPC server at 127.0.0.1:8554, security: Local, auth: none</span><br><span class="line">INFO    | Advertising <span class="keyword">in</span>: /run/user/1000/avd/running/pid_17579.ini</span><br><span class="line">INFO    | setDisplayConfigs w 320 h 640 dpiX 160 dpiY 160</span><br><span class="line">INFO    | Wait <span class="keyword">for</span> emulator (pid 17579) 20 seconds to shutdown gracefully before <span class="built_in">kill</span>;you can <span class="built_in">set</span> environment variable ANDROID_EMULATOR_WAIT_TIME_BEFORE_KILL(<span class="keyword">in</span> seconds) to change the default value (20 seconds)</span><br><span class="line"></span><br><span class="line">INFO    | Info: Sandboxing disabled by user. ((null):<span class="number">0</span>, (null))</span><br><span class="line"></span><br><span class="line">INFO    | Closing down rootcanal.</span><br></pre></td></tr></table></figure><h1 id="创建-Flutter-项目"><a href="#创建-Flutter-项目" class="headerlink" title="创建 Flutter 项目"></a>创建 <code>Flutter</code> 项目</h1><p>创建<code>Flutter</code>项目的命令格式: <code>flutter create &lt;项目名称&gt;</code></p><blockquote><p><code>项目名称</code> 由多个单词组成时, 单词之间用下划线<code>_</code>分隔, 不能使用短横线 <code>-</code></p></blockquote><p>创建项目的命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Sources/flutter_repos$ flutter create my_store_app</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Creating project my_store_app...</span><br><span class="line">Running <span class="string">&quot;flutter pub get&quot;</span> <span class="keyword">in</span> my_store_app...                     1,992ms</span><br><span class="line">Wrote 127 files.</span><br><span class="line"></span><br><span class="line">All <span class="keyword">done</span>!</span><br><span class="line">In order to run your application, <span class="built_in">type</span>:</span><br><span class="line"></span><br><span class="line">  $ <span class="built_in">cd</span> my_store_app</span><br><span class="line">  $ flutter run</span><br><span class="line"></span><br><span class="line">Your application code is <span class="keyword">in</span> my_store_app/lib/main.dart.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h1><p>进入新创建的项目文件夹, 运行程序:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> my_store_app</span><br><span class="line">flutter run</span><br></pre></td></tr></table></figure><p>命令执行过程如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Sources/flutter_repos/my_store_app$ flutter run</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Using hardware rendering with device Android SDK built <span class="keyword">for</span> x86 64. If you notice graphics artifacts, consider enabling software rendering</span><br><span class="line">with <span class="string">&quot;--enable-software-rendering&quot;</span>.</span><br><span class="line">Launching lib/main.dart on Android SDK built <span class="keyword">for</span> x86 64 <span class="keyword">in</span> debug mode...</span><br><span class="line">Checking the license <span class="keyword">for</span> package Android SDK Tools <span class="keyword">in</span> /home/laohoo/AppData/android_sdk/licenses</span><br><span class="line">License <span class="keyword">for</span> package Android SDK Tools accepted.</span><br><span class="line">Preparing <span class="string">&quot;Install Android SDK Tools (revision: 26.1.1)&quot;</span>.</span><br><span class="line"><span class="string">&quot;Install Android SDK Tools (revision: 26.1.1)&quot;</span> ready.</span><br><span class="line">Installing Android SDK Tools <span class="keyword">in</span> /home/laohoo/AppData/android_sdk/tools</span><br><span class="line"><span class="string">&quot;Install Android SDK Tools (revision: 26.1.1)&quot;</span> complete.</span><br><span class="line"><span class="string">&quot;Install Android SDK Tools (revision: 26.1.1)&quot;</span> finished.</span><br><span class="line">Checking the license <span class="keyword">for</span> package Android SDK Build-Tools 30.0.3 <span class="keyword">in</span> /home/laohoo/AppData/android_sdk/licenses</span><br><span class="line">License <span class="keyword">for</span> package Android SDK Build-Tools 30.0.3 accepted.</span><br><span class="line">Preparing <span class="string">&quot;Install Android SDK Build-Tools 30.0.3 (revision: 30.0.3)&quot;</span>.</span><br><span class="line"><span class="string">&quot;Install Android SDK Build-Tools 30.0.3 (revision: 30.0.3)&quot;</span> ready.</span><br><span class="line">Installing Android SDK Build-Tools 30.0.3 <span class="keyword">in</span> /home/laohoo/AppData/android_sdk/build-tools/30.0.3</span><br><span class="line"><span class="string">&quot;Install Android SDK Build-Tools 30.0.3 (revision: 30.0.3)&quot;</span> complete.</span><br><span class="line"><span class="string">&quot;Install Android SDK Build-Tools 30.0.3 (revision: 30.0.3)&quot;</span> finished.</span><br><span class="line">Checking the license <span class="keyword">for</span> package Android SDK Platform 31 <span class="keyword">in</span> /home/laohoo/AppData/android_sdk/licenses</span><br><span class="line">License <span class="keyword">for</span> package Android SDK Platform 31 accepted.</span><br><span class="line">Preparing <span class="string">&quot;Install Android SDK Platform 31 (revision: 1)&quot;</span>.</span><br><span class="line"><span class="string">&quot;Install Android SDK Platform 31 (revision: 1)&quot;</span> ready.</span><br><span class="line">Installing Android SDK Platform 31 <span class="keyword">in</span> /home/laohoo/AppData/android_sdk/platforms/android-31</span><br><span class="line"><span class="string">&quot;Install Android SDK Platform 31 (revision: 1)&quot;</span> complete.</span><br><span class="line"><span class="string">&quot;Install Android SDK Platform 31 (revision: 1)&quot;</span> finished.</span><br></pre></td></tr></table></figure><blockquote><p>此处安装的 <code>Android SDK</code> 组件版本不正确, 在第一次运行程序的时候, 会自动下载正确的版本</p></blockquote><h1 id="设置-Gradle-国内镜像"><a href="#设置-Gradle-国内镜像" class="headerlink" title="设置 Gradle 国内镜像"></a>设置 <code>Gradle</code> 国内镜像</h1><h2 id="Gradle-导致的运行问题"><a href="#Gradle-导致的运行问题" class="headerlink" title="Gradle 导致的运行问题"></a><code>Gradle</code> 导致的运行问题</h2><p><code>flutter</code> 默认使用 <code>Gradle</code> 管理项目, 第一次运行时, 除了检查 <code>Android SDK</code> 组件并下载正确的版本外, 还会安装和 <code>Flutter SDK</code> 匹配的 <code>Gradle</code>, <code>Flutter SDK 3.3.4</code> 使用的是 <code>gradle-7.4</code>。</p><p><code>Gradle</code> 添加成功后才会下载当前项目所需要的其他包和组件, 由于 <code>Gradle</code> 默认使用的源是国外的服务器,　所以网络状况不好时通常出现类似以下的错误信息:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Sources/flutter_repos/my_store_app$ flutter run</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Using hardware rendering with device Android SDK built <span class="keyword">for</span> x86 64. If you notice graphics artifacts, consider enabling software rendering</span><br><span class="line">with <span class="string">&quot;--enable-software-rendering&quot;</span>.</span><br><span class="line">Launching lib/main.dart on Android SDK built <span class="keyword">for</span> x86 64 <span class="keyword">in</span> debug mode...</span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">Execution failed <span class="keyword">for</span> task <span class="string">&#x27;:app:compileDebugKotlin&#x27;</span>.</span><br><span class="line">&gt; Could not resolve all dependencies <span class="keyword">for</span> configuration <span class="string">&#x27;:app:kotlinCompilerClasspath&#x27;</span>.</span><br><span class="line">   &gt; Could not load module metadata from /home/laohoo/.gradle/caches/modules-2/metadata-2.97/descriptors/org.jetbrains.kotlin/kotlin-script-runtime/1.6.10/a8be1fe3b3911d3d3425fe720cf42835/descriptor.bin</span><br><span class="line"></span><br><span class="line">* Try:</span><br><span class="line">&gt; Run with --stacktrace option to get the stack trace.</span><br><span class="line">&gt; Run with --info or --debug option to get more <span class="built_in">log</span> output.</span><br><span class="line">&gt; Run with --scan to get full insights.</span><br><span class="line"></span><br><span class="line">* Get more <span class="built_in">help</span> at https://help.gradle.org</span><br><span class="line"></span><br><span class="line">BUILD FAILED <span class="keyword">in</span> 1s</span><br><span class="line">Running Gradle task <span class="string">&#x27;assembleDebug&#x27;</span>...                           2,548ms</span><br><span class="line">Exception: Gradle task assembleDebug failed with <span class="built_in">exit</span> code 1</span><br></pre></td></tr></table></figure><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>在 <code>$HOME/.gradle</code> 文件夹下新建名为 <code>init.gradle</code> 的文件, 文件内容编辑如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">allprojects&#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        def ALIYUN_REPOSITORY_URL = &#x27;https://maven.aliyun.com/repository/public/&#x27;</span><br><span class="line">        def ALIYUN_JCENTER_URL = &#x27;https://maven.aliyun.com/repository/jcenter/&#x27;</span><br><span class="line">        def ALIYUN_GOOGLE_URL = &#x27;https://maven.aliyun.com/repository/google/&#x27;</span><br><span class="line">        def ALIYUN_GRADLE_PLUGIN_URL = &#x27;https://maven.aliyun.com/repository/gradle-plugin/&#x27;</span><br><span class="line">        all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">            if(repo instanceof MavenArtifactRepository)&#123;</span><br><span class="line">                def url = repo.url.toString()</span><br><span class="line">                if (url.startsWith(&#x27;https://repo1.maven.org/maven2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_REPOSITORY_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://jcenter.bintray.com/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_JCENTER_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://dl.google.com/dl/android/maven2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_GOOGLE_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://plugins.gradle.org/m2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_GRADLE_PLUGIN_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123; url ALIYUN_REPOSITORY_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_JCENTER_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_GOOGLE_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_GRADLE_PLUGIN_URL &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> buildscript&#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        def ALIYUN_REPOSITORY_URL = &#x27;https://maven.aliyun.com/repository/public/&#x27;</span><br><span class="line">        def ALIYUN_JCENTER_URL = &#x27;https://maven.aliyun.com/repository/jcenter/&#x27;</span><br><span class="line">        def ALIYUN_GOOGLE_URL = &#x27;https://maven.aliyun.com/repository/google/&#x27;</span><br><span class="line">        def ALIYUN_GRADLE_PLUGIN_URL = &#x27;https://maven.aliyun.com/repository/gradle-plugin/&#x27;</span><br><span class="line">        all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">            if(repo instanceof MavenArtifactRepository)&#123;</span><br><span class="line">                def url = repo.url.toString()</span><br><span class="line">                if (url.startsWith(&#x27;https://repo1.maven.org/maven2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_REPOSITORY_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://jcenter.bintray.com/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_JCENTER_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://dl.google.com/dl/android/maven2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_GOOGLE_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://plugins.gradle.org/m2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_GRADLE_PLUGIN_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123; url ALIYUN_REPOSITORY_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_JCENTER_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_GOOGLE_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_GRADLE_PLUGIN_URL &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在第一次运行 <code>Flutter</code> 项目, 下载了 <code>Gradle</code> 之后, 就会创建 <code>$HOME/.gradle</code> 文件夹, 该文件夹是隐藏文件夹。</p></blockquote><p>再次运行项目, 命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">laohoo@laohoo-Inspiron-7559:~/Sources/flutter_repos/my_store_app$ flutter run</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Using hardware rendering with device Android SDK built <span class="keyword">for</span> x86 64. If you notice graphics artifacts, consider enabling software rendering with <span class="string">&quot;--enable-software-rendering&quot;</span>.</span><br><span class="line">Launching lib/main.dart on Android SDK built <span class="keyword">for</span> x86 64 <span class="keyword">in</span> debug mode...</span><br><span class="line">Running Gradle task <span class="string">&#x27;assembleDebug&#x27;</span>...                             93.9s</span><br><span class="line">✓  Built build/app/outputs/flutter-apk/app-debug.apk.</span><br><span class="line">Installing build/app/outputs/flutter-apk/app.apk...              1,034ms</span><br><span class="line">Syncing files to device Android SDK built <span class="keyword">for</span> x86 64...            211ms</span><br><span class="line"></span><br><span class="line">Flutter run key commands.</span><br><span class="line">r Hot reload. 🔥🔥🔥</span><br><span class="line">R Hot restart.</span><br><span class="line">h List all available interactive commands.</span><br><span class="line">d Detach (terminate <span class="string">&quot;flutter run&quot;</span> but leave application running).</span><br><span class="line">c Clear the screen</span><br><span class="line">q Quit (terminate the application on the device).</span><br><span class="line"></span><br><span class="line">💪 Running with sound null safety 💪</span><br><span class="line"></span><br><span class="line">An Observatory debugger and profiler on Android SDK built <span class="keyword">for</span> x86 64 is available at: http://127.0.0.1:42339/XnPsnajGgW8=/</span><br><span class="line">The Flutter DevTools debugger and profiler on Android SDK built <span class="keyword">for</span> x86 64 is available at: http://127.0.0.1:9101?uri=http://127.0.0.1:42339/XnPsnajGgW8=/</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;&#x3D; END &#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
            <tag> command-line tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Windows 中同时安装多个 JDK</title>
      <link href="/2022/09/25/windows-install-java-jdk/"/>
      <url>/2022/09/25/windows-install-java-jdk/</url>
      
        <content type="html"><![CDATA[<p>最近进行开发的时候, 遇到了一些不同 <code>JDK</code> 版本的需求: <code>Spring Boot 2</code> 的开发框架 <code>eladmin-plus</code> 只能使用 <code>JDK 8</code>; 新版本的 <code>Flutter SDK</code> 配置 <code>Android Toolchain</code> 时最低要求 <code>JDK 11</code>; 而最新版的 <code>Spring Boot</code> 最低的 <code>JDK</code> 版本是 <code>JDK 17</code>。</p><p>想在同一台电脑完成上面的开发, 比较好的作法当然是在一台电脑上安装多个版本的 <code>JDK</code>, 根据需要随时进行切换。</p><h1 id="安装版和解压版-JDK"><a href="#安装版和解压版-JDK" class="headerlink" title="安装版和解压版 JDK"></a>安装版和解压版 <code>JDK</code></h1><p>安装版的 <code>JDK</code> 会添加一些环境变量到电脑中, 如果这些环境变量不进行处理, 会对切换后的其他版本<code>JDK</code> 造成影响, 所以在 <code>Windows</code> 中同地安装多个版本的<code> JDK</code>时, 建议使用<code>解压版</code>。</p><p>现在 <code>Oracle</code> 已经不提供解压版的<code>JDK</code>了, 所以要自己进行制作。</p><h2 id="制作解压版的-Oracle-JDK"><a href="#制作解压版的-Oracle-JDK" class="headerlink" title="制作解压版的 Oracle JDK"></a>制作解压版的 <code>Oracle JDK</code></h2><ol><li><p>下载安装各版本<code>JDK</code>(例如 <code>JDK 8</code>, <code>JDK11</code>, <code>JDK17</code>等) 的<code>安装程序</code></p></li><li><p>运行<code>安装程序</code>, 参考<code>下图</code>的步骤, 复制 <code>JDK</code> 到另一个位置</p></li></ol><img src="/2022/09/25/windows-install-java-jdk/installjdk.PNG" class="" title="installjdk"><ol start="3"><li><p>复制出来的就是我们需要的解压版<code>JDK</code>, 复制成功后, <code>取消</code>当前<code>JDK</code>的继续安装。</p></li><li><p>重复以上步骤获取其他版本的 <code>JDK</code>文件</p></li></ol><blockquote><p>可以把其他电脑已经安装好的<code>JDK文件夹</code>复制出来使用即可</p></blockquote><h2 id="Open-JDK-另一种选择"><a href="#Open-JDK-另一种选择" class="headerlink" title="Open JDK - 另一种选择"></a><code>Open JDK</code> - 另一种选择</h2><p><code>Open JDK</code> 大部分都是解压版, 如果可以接受 <code>Open JDK</code> 的话, 则直接下载回来解压就可以使用了。 比如<code>Microsoft</code> 维护的 <code>OpenJDK</code>:<br><a href="https://learn.microsoft.com/zh-cn/java/openjdk/download">https://learn.microsoft.com/zh-cn/java/openjdk/download</a></p><p>如果电脑有安装 <code>Android Studio</code>, 会自带有一个 <code>OpenJDK</code>, 也可以把这个 <code>JDK</code> 复制出来使用。</p><p>我在当前电脑准备了四个解压版本的<code>JDK</code>, 将其放在 <code>d:\AppData</code> 文件夹下, 解压版的软件在重装操作系统后也可以直接使用, 所以放在<code>D盘</code>的文件夹比较好, 如下图:</p><img src="/2022/09/25/windows-install-java-jdk/appdata.png" class="" title="installjdk"><ul><li><p><code>jdk1.8.0_333</code>: 使用<code>安装程序</code>按照上面制作方法复制出来的 <code>Oracle JDK 8</code>, 将复制出来的文件夹改名;</p></li><li><p><code>openjdk1.8.0_242</code>: 旧版<code>Android Studio 3.5</code> 自带的<code>OpenJDK</code>, 将其安装文件夹的 <code>jre</code> 文件夹复制出来并改名;</p></li><li><p><code>openjdk11.0.12</code>:  <code>Android Studio 2020.3.1</code> 自带的<code>OpenJDK</code>, 将其安装文件夹的 <code>jre</code> 文件夹复制出来并改名;</p></li><li><p><code>openjdk17.0.2 </code>: 直接从 <code>Microsoft</code> 下载并解压并改名的 <code>OpenJDK</code></p></li></ul><blockquote><p>之所以有这么多个, 只是为了把获取解压版 <code>JDK</code> 的方法都试一次</p></blockquote><h1 id="系统环境变量设置"><a href="#系统环境变量设置" class="headerlink" title="系统环境变量设置"></a>系统环境变量设置</h1><p>编辑系统环境变量 <code>path</code>, 添加以下两个值:</p><ol><li><p><code>%JAVA_HOME%\bin</code></p></li><li><p><code>%JAVA_HOME%\jre\bin</code></p></li></ol><p>如下图所示:</p><img src="/2022/09/25/windows-install-java-jdk/002.png" class="" title="installjdk"><h1 id="使用或切换不同版本的-JDK"><a href="#使用或切换不同版本的-JDK" class="headerlink" title="使用或切换不同版本的 JDK"></a>使用或切换不同版本的 <code>JDK</code></h1><p>以上已经准备好的四个<code>JDK</code> 的路径分别为:</p><p><code>D:\AppData\jdk1.8.0_333</code></p><p><code>D:\AppData\openjdk1.8.0_242</code></p><p><code>D:\AppData\openjdk11.0.12</code></p><p><code>D:\AppData\openjdk17.0.2</code></p><p>只需要将相应的路径添加到系统环境变量 <code>JAVA_HOME</code> 中即可使用该版本的 <code>JDK</code>。</p><p>为更方便进行切换, 可以使用<code>命令</code>的方式来添加或修改环境变量的值, 命令格式: <code>setx &quot;环境变量名&quot; &quot;环境变量值&quot;</code></p><p>使用<code>管理员权限</code>打开 <code>CMD窗口</code> 或 <code>PowerShell窗口</code>，执行以下命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setx <span class="string">&quot;JAVA_HOME&quot;</span> <span class="string">&quot;D:\AppData\openjdk17.0.2&quot;</span> /m</span><br></pre></td></tr></table></figure><blockquote><p>命令行后的参数 <code>/m </code>表示添加为 <code>系统</code> 环境变量, 没有该参数量为<code>用户</code>环境变量</p></blockquote><blockquote><p>只需要将 <code>D:\AppData\openjdk17.0.2</code> 替换为其他路径并重复执行以上命令即可实现 <code>JDK</code> 版本的切换</p></blockquote><blockquote><p>切换版本后, 要在<code>新打开的命令窗口</code>中才能查看到切换后 <code>java</code> 版本</p></blockquote><p>命令执行结果如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\hujy&gt; setx <span class="string">&quot;JAVA_HOME&quot;</span> <span class="string">&quot;D:\AppData\openjdk17.0.2&quot;</span> /m</span><br><span class="line"></span><br><span class="line">成功: 指定的值已得到保存。</span><br></pre></td></tr></table></figure><p>已经添加成功的 <code>JAVA_HOME</code> 环境变量</p><img src="/2022/09/25/windows-install-java-jdk/003.png" class="" title="installjdk"><p>查看 <code>Java</code> 版本信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\hujy&gt; java -version</span><br><span class="line">openjdk version <span class="string">&quot;17.0.2&quot;</span> 2022-01-18</span><br><span class="line">OpenJDK Runtime Environment (build 17.0.2+8-86)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 17.0.2+8-86, mixed mode, sharing)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> jdk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Visual Studio Code 中批量删除注释和空行</title>
      <link href="/2022/09/23/remove-the-comments-in-the-visual-studio-code/"/>
      <url>/2022/09/23/remove-the-comments-in-the-visual-studio-code/</url>
      
        <content type="html"><![CDATA[<p>使用 <code>Visual Studio Code</code> 中的<code>替换</code>功能和<code>正则表达式</code> 匹配可以快速删除大量<code>注释</code>或 <code>空行</code>。</p><h1 id="在替换对话框中使用正则表达式模式"><a href="#在替换对话框中使用正则表达式模式" class="headerlink" title="在替换对话框中使用正则表达式模式"></a>在替换对话框中使用正则表达式模式</h1><p>具体的操作步骤如下:</p><ul><li><p>在 <code>Visual Studio Code</code> 打开要批量删除注释的文件, 按 <code>Ctrl + H</code> 打开替换框。</p></li><li><p>按 <code>Alt+R</code> 选择 <code>Use Regular Expression(Alt+R)</code>即<code>正则表达式模式</code>, 或是点击如图按钮切換到<code>正则表达式模式</code>。</p></li></ul><img src="/2022/09/23/remove-the-comments-in-the-visual-studio-code/20190425175809625.png" class="" title="replace"><ul><li><code>查找内容</code>输入<code>正则表达式</code>, 替换内容为空, 选择全部替换。</li></ul><h1 id="常用的正则表达式"><a href="#常用的正则表达式" class="headerlink" title="常用的正则表达式"></a>常用的正则表达式</h1><ul><li>单行注释</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//[\s\S]*?\n</span><br></pre></td></tr></table></figure><img src="/2022/09/23/remove-the-comments-in-the-visual-studio-code/2019042517592980.png" class="" title="replace"><ul><li>块注释(多行注释)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/\*(.|\r\n|\n)*?\*/</span><br></pre></td></tr></table></figure><img src="/2022/09/23/remove-the-comments-in-the-visual-studio-code/20190425180049564.png" class="" title="replace"><ul><li>所有注释</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\/\*[\s\S]*\*\/|\/\/.*</span><br></pre></td></tr></table></figure><img src="/2022/09/23/remove-the-comments-in-the-visual-studio-code/20190425180114111.png" class="" title="replace"><ul><li>html 注释</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--(.*?)--&gt;</span><br></pre></td></tr></table></figure><img src="/2022/09/23/remove-the-comments-in-the-visual-studio-code/20190425180156561.png" class="" title="replace"><ul><li>html 注释(有换行)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--([\s\S|\r]*?)--&gt;</span><br></pre></td></tr></table></figure><img src="/2022/09/23/remove-the-comments-in-the-visual-studio-code/20190425180239532.png" class="" title="replace"><ul><li>空行</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\s*(?=\r?$)\n</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 注释 </tag>
            
            <tag> 空格 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Hexo 中隐藏文章</title>
      <link href="/2022/08/31/hexo-hide-posts/"/>
      <url>/2022/08/31/hexo-hide-posts/</url>
      
        <content type="html"><![CDATA[<p>隐藏博客中某些特定的文章应该算是一个比较常见的需求，毕竟谁都有些不希望让别人看到的东西。当然啦，你可能会说，「不想被看到就不要放到博客上来嘛」。话是没错，不过有时候人就是这么别扭，想让某些文章被看到，却又不想被所有人看到，又或者是某些文章只想和自己熟悉的人一起分享。</p><p><code>Hexo</code> 插件 <code>hexo-hide-posts</code> 可以实现这个需求（网上也有一些关于 <code>Hexo</code> 隐藏文章的教程，不过一般都要求修改主题文件，还是这个插件更通用一些）。它的功能如下：</p><ul><li><p>在博客的所有文章列表中隐藏指定的文章（包括首页、存档页、分类标签、Feed 等）</p></li><li><p>被隐藏的文章依然可以通过文章链接直接访问（比如 <a href="https://hexo.example/%7Bslug%7D/%EF%BC%89">https://hexo.example/{slug}/）</a></p></li><li><p>除非知道链接，任何人都无法找到这些被隐藏的文章。</p></li></ul><h1 id="安装-hexo-hide-posts"><a href="#安装-hexo-hide-posts" class="headerlink" title="安装 hexo-hide-posts"></a>安装 <code>hexo-hide-posts</code></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add hexo-hide-posts</span><br><span class="line">yarn add v1.22.5</span><br><span class="line">warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not</span><br><span class="line">to mix package managers <span class="keyword">in</span> order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this</span><br><span class="line">warning, remove package-lock.json.</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 3 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">├─ hexo-generator-index-pin-top@0.2.2</span><br><span class="line">└─ hexo-hide-posts@0.2.0</span><br><span class="line">info All dependencies</span><br><span class="line">├─ hexo-generator-index-pin-top@0.2.2</span><br><span class="line">├─ hexo-hide-posts@0.2.0</span><br><span class="line">└─ object-assign@4.1.1</span><br><span class="line">Done <span class="keyword">in</span> 19.27s.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p> 在站点目录下的<code>_config.yml</code>中如下配置:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-hide-posts</span></span><br><span class="line"><span class="attr">hide_posts:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Change the filter name to fit your need</span></span><br><span class="line">  <span class="attr">filter:</span> <span class="string">hidden</span></span><br><span class="line">  <span class="comment"># Generators which you want to expose all posts (include hidden ones) to.</span></span><br><span class="line">  <span class="comment"># Common generators: index, tag, category, archive, sitemap, feed, etc.</span></span><br><span class="line">  <span class="attr">public_generators:</span> []</span><br><span class="line">  <span class="comment"># Add &quot;noindex&quot; meta tag to prevent hidden posts from being indexed by search engines</span></span><br><span class="line">  <span class="attr">noindex:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h1 id="使用文章隐藏功能"><a href="#使用文章隐藏功能" class="headerlink" title="使用文章隐藏功能"></a>使用文章隐藏功能</h1><p>安装插件后，在想要隐藏的文章的 <code>front-matter</code>（就是 <code>Markdown</code> 顶上的那个参数块）里添加一行 <code>hidden: true</code> 即可。</p><p>例如编辑文章: <code>source/_posts/lorem-ipsum.md</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: &#x27;Lorem Ipsum&#x27;</span><br><span class="line">date: &#x27;2019/8/10 11:45:14&#x27;</span><br><span class="line"><span class="section">hidden: true</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这篇文章不会在任何地方显示，但仍然可以通过类似 <code>https://hexo.test/lorem-ipsum/</code> 的网址访问它。</p>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
            <tag> github pages </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Hexo 博客的 Butterfly 主题中添加文章置顶功能</title>
      <link href="/2022/08/19/hexo-generator-index-pin-top/"/>
      <url>/2022/08/19/hexo-generator-index-pin-top/</url>
      
        <content type="html"><![CDATA[<h1 id="卸载-hexo-generator-index"><a href="#卸载-hexo-generator-index" class="headerlink" title="卸载 hexo-generator-index"></a>卸载 <code>hexo-generator-index</code></h1><p>执行命令: <code>npm uninstall hexo-generator-index</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\hexo-repos\hujiyi.github.io&gt; npm uninstall hexo-generator-index</span><br><span class="line">npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated</span><br><span class="line">npm WARN deprecated source-map-resolve@0.5.3: See https://github.com/lydell/source-map-resolve#deprecated</span><br><span class="line">npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated</span><br><span class="line">npm WARN deprecated source-map-url@0.4.1: See https://github.com/lydell/source-map-url#deprecated</span><br><span class="line">npm WARN <span class="built_in">rm</span> not removing D:\sources\hexo-repos\hujiyi.github.io\node_modules\.bin\stylus.cmd as it wasn<span class="string">&#x27;t installed by D:\sources\hexo-repos\hujiyi.github.io\node_modules\stylus</span></span><br><span class="line"><span class="string">npm WARN rm not removing D:\sources\hexo-repos\hujiyi.github.io\node_modules\.bin\stylus as it wasn&#x27;</span>t installed by D:\sources\hexo-repos\hujiyi.github.io\node_modules\stylus</span><br><span class="line">npm WARN <span class="built_in">rm</span> not removing D:\sources\hexo-repos\hujiyi.github.io\node_modules\.bin\js-yaml.cmd as it wasn<span class="string">&#x27;t installed by D:\sources\hexo-repos\hujiyi.github.io\node_modules\js-yaml</span></span><br><span class="line"><span class="string">npm WARN rm not removing D:\sources\hexo-repos\hujiyi.github.io\node_modules\.bin\js-yaml as it wasn&#x27;</span>t installed by D:\sources\hexo-repos\hujiyi.github.io\node_modules\js-yaml</span><br><span class="line"></span><br><span class="line">&gt; ejs@2.7.4 postinstall D:\sources\hexo-repos\hujiyi.github.io\node_modules\ejs</span><br><span class="line">&gt; node ./postinstall.js</span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> installing EJS: built with the Jake JavaScript build tool (https://jakejs.com/)</span><br><span class="line"></span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@~2.3.2 (node_modules\chokidar\node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@2.3.2: wanted &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;darwin&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;any&quot;</span>&#125; (current: &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;win32&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;x64&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">added 29 packages from 12 contributors, removed 24 packages and updated 254 packages <span class="keyword">in</span> 90.165s</span><br><span class="line"></span><br><span class="line">24 packages are looking <span class="keyword">for</span> funding</span><br><span class="line">  run `npm fund` <span class="keyword">for</span> details</span><br></pre></td></tr></table></figure><h1 id="安装-hexo-generator-index-pin-top"><a href="#安装-hexo-generator-index-pin-top" class="headerlink" title="安装 hexo-generator-index-pin-top"></a>安装 <code>hexo-generator-index-pin-top</code></h1><p>执行命令: <code>npm i  hexo-generator-index-pin-top --save</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\hexo-repos\hujiyi.github.io&gt; npm i  hexo-generator-index-pin-top --save</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@2.3.2 (node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@2.3.2: wanted &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;darwin&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;any&quot;</span>&#125; (current: &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;win32&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;x64&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">+ hexo-generator-index-pin-top@0.2.2</span><br><span class="line">added 2 packages from 2 contributors and removed 1 package <span class="keyword">in</span> 2.781s</span><br><span class="line"></span><br><span class="line">24 packages are looking <span class="keyword">for</span> funding</span><br><span class="line">  run `npm fund` <span class="keyword">for</span> details</span><br></pre></td></tr></table></figure><h1 id="文件置顶"><a href="#文件置顶" class="headerlink" title="文件置顶"></a>文件置顶</h1><p>在需要置顶的文章的 <code>Front-matter</code> 中加上 <code>top: true/数字</code> 即可, 数字越大，文章越靠前。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 在 Windows 10 配置 Flutter 开发环境</span><br><span class="line">date: 2021-12-04 19:33:44</span><br><span class="line">top: 10</span><br><span class="line">categories:</span><br><span class="line">- flutter</span><br><span class="line">tags:</span><br><span class="line">- flutter</span><br><span class="line">- android studio</span><br><span class="line">top_img:</span><br><span class="line">cover: https://hujiyi.github.io/2021/02/02/flutter-introduction-part-I/flutter_eman_blog.png</span><br><span class="line">---</span><br></pre></td></tr></table></figure><hr><p>参考资料：<a href="https://blog.csdn.net/weixin_43372529/article/details/114176470">https://blog.csdn.net/weixin_43372529/article/details/114176470</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
            <tag> github pages </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 框架开发实战 - 复习</title>
      <link href="/2022/08/10/create-an-app-in-django-review/"/>
      <url>/2022/08/10/create-an-app-in-django-review/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 10 Enterprise LTSC [Version 10.0.19044.1586], locale zh-CN</p></li><li><p>Python 3.8.10</p></li><li><p>PyCharm 2021.2 (Professional Edition)</p></li><li><p>Visual Studio Code, 64-bit edition (version 1.67.2)</p></li></ul><hr><h1 id="在-PyCharm-中创建-Django-项目"><a href="#在-PyCharm-中创建-Django-项目" class="headerlink" title="在 PyCharm 中创建 Django 项目"></a>在 <code>PyCharm</code> 中创建 <code>Django</code> 项目</h1><p>在  <code>PyCharm</code> 菜单中选择 <code>File</code> -&gt; <code>New Project</code>, 在弹出的 <code>新项目</code> 对话框中选择 <code>项目类型</code>、<code>保存位置</code> 等信息。</p><h1 id="修改项目的-语言-和-时区-配置"><a href="#修改项目的-语言-和-时区-配置" class="headerlink" title="修改项目的 语言 和 时区 配置"></a>修改项目的 <code>语言</code> 和 <code>时区</code> 配置</h1><p>打开文件 <code>myproject/settings.py</code>, 找到 <code>LANGUAGE_CODE</code>、<code>TIME_ZONE</code> 和 <code>USE_TZ</code> 并进行修改, 如下图所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-Hans&#x27;</span>  <span class="comment"># 语言代码</span></span><br><span class="line"></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/shanghai&#x27;</span>   <span class="comment"># 时区</span></span><br><span class="line"></span><br><span class="line">USE_I18N = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">USE_TZ = <span class="literal">False</span>    <span class="comment"># 是否采用UTC时间</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="在项目内创建应用"><a href="#在项目内创建应用" class="headerlink" title="在项目内创建应用"></a>在项目内创建应用</h1><p>在项目文件夹中按住键盘的 <code>Shift</code>, 点鼠标 <code>右键</code>, 选择 <code>在此处打开PowerShell窗口</code> 或 <code>在此处打开命令窗口</code> (Windows 7)</p><ol><li>激活虚拟环境, 命令： <code> venv\Scripts\activate</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\PycharmProjects\myproject&gt; .\venv\Scripts\activate</span><br><span class="line">(venv) PS D:\PycharmProjects\myproject&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建应用的命令： <code>python  manage.py startapp &lt;应用名称&gt;</code></li></ol><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(venv) PS D:\PycharmProjects\myproject&gt; python manage.py startapp department</span><br><span class="line">(venv) PS D:\PycharmProjects\myproject&gt;</span><br></pre></td></tr></table></figure><h1 id="添加新创建的应用到项目中"><a href="#添加新创建的应用到项目中" class="headerlink" title="添加新创建的应用到项目中"></a>添加新创建的应用到项目中</h1><p>打开 <code>djangoProject/settings.py</code> 文件, 在 <code>INSTALLED_APPS</code> 中添加应用名称, 如下所示:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    &#x27;django.contrib.admin&#x27;,</span><br><span class="line">    &#x27;django.contrib.auth&#x27;,</span><br><span class="line">    &#x27;django.contrib.contenttypes&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions&#x27;,</span><br><span class="line">    &#x27;django.contrib.messages&#x27;,</span><br><span class="line">    &#x27;django.contrib.staticfiles&#x27;,</span><br><span class="line"></span><br><span class="line">    &#x27;department&#x27;,  # 通过 应用名 安装应用, 适用于大多数情况   </span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="定义模型类"><a href="#定义模型类" class="headerlink" title="定义模型类"></a>定义模型类</h1><p>数据库的每个表定义一个模型类,  <code>id</code> 字段会自动生成, 其他字段根据数据表的进行定义, 类似以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Department</span>(models.Model):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    组织架构:用于保存有关联业务的其他公司 或 单位内部的部门信息</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 组织架构选项</span></span><br><span class="line">    type_choices = ((<span class="string">&#x27;firm&#x27;</span>, <span class="string">&#x27;公司&#x27;</span>), (<span class="string">&#x27;department&#x27;</span>, <span class="string">&#x27;部门&#x27;</span>))</span><br><span class="line">    <span class="comment"># max_length: 最大长度; verbose_name: 字段备注名</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">60</span>, verbose_name=<span class="string">&quot;名称&quot;</span>)</span><br><span class="line">    <span class="built_in">type</span> = models.CharField(max_length=<span class="number">20</span>, choices=type_choices,</span><br><span class="line">                            default=<span class="string">&#x27;department&#x27;</span>, verbose_name=<span class="string">&#x27;类型&#x27;</span>)</span><br><span class="line">    <span class="comment"># null=True: 空值时存为null; blank=True: 允许为空;</span></span><br><span class="line">    description = models.CharField(max_length=<span class="number">200</span>, null=<span class="literal">True</span>,</span><br><span class="line">                                   blank=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;描述&#x27;</span>)</span><br><span class="line">    <span class="comment"># ForeignKey: 关联关系; on_delete=models.CASCADE: 级联操作,外键表随主键表更新</span></span><br><span class="line">    parent = models.ForeignKey(<span class="string">&#x27;self&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>,</span><br><span class="line">                               verbose_name=<span class="string">&#x27;上级部门&#x27;</span>, on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = <span class="string">&#x27;组织构架&#x27;</span>  <span class="comment"># 对象的可读名称, 单数</span></span><br><span class="line">        verbose_name_plural = verbose_name  <span class="comment"># 对象的可读名称, 复数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        返回对象的描述信息</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.title</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="定义表单类"><a href="#定义表单类" class="headerlink" title="定义表单类"></a>定义表单类</h1><p>表单表用于添加或编辑数据, 在应用中添加名为 <code>forms.py</code> 的表单类文件, 在已经定义好模型类的基础上, 最简单的表单类定义类似以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Department  <span class="comment"># 导入模型类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DepartmentEditForm</span>(forms.ModelForm):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Department    <span class="comment"># 表单来自于指定的模型类 Department</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>    <span class="comment"># 表单类包含指定模型类的中的所有字段 </span></span><br></pre></td></tr></table></figure><h1 id="添加被视图调用的模板文件"><a href="#添加被视图调用的模板文件" class="headerlink" title="添加被视图调用的模板文件"></a>添加被视图调用的模板文件</h1><p>模板文件夹 <code>templates</code> 中放置用于显示的网页文件, 不包含样式的最简单版本请参考最后一次上课的例子</p><h1 id="添加视图函数（或视图类）"><a href="#添加视图函数（或视图类）" class="headerlink" title="添加视图函数（或视图类）"></a>添加视图函数（或视图类）</h1><p>打开相应的应用文件夹中的 <code>views.py</code> 文件, 添加用于查、改、增、删除的函数, 具体内容可参考:<br><a href="https://hujiyi.github.io/2022/07/04/create-an-app-in-django-004/">https://hujiyi.github.io/2022/07/04/create-an-app-in-django-004/</a></p><h1 id="定义路由"><a href="#定义路由" class="headerlink" title="定义路由"></a>定义路由</h1><h2 id="定义应用的子路由"><a href="#定义应用的子路由" class="headerlink" title="定义应用的子路由"></a>定义应用的子路由</h2><p>在应用文件夹中添加名为 <code>urls.py</code>的路由文件, 类似以下内容:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;create/&#x27;</span>, views.create, name=<span class="string">&#x27;create&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:id&gt;/&#x27;</span>, views.detail, name=<span class="string">&#x27;detail&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;update/&lt;int:id&gt;/&#x27;</span>, views.update, name=<span class="string">&#x27;update&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;delete/&lt;int:did&gt;/&#x27;</span>, views.delete, name=<span class="string">&#x27;delete&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="添加子路由到项目路由中"><a href="#添加子路由到项目路由中" class="headerlink" title="添加子路由到项目路由中"></a>添加子路由到项目路由中</h2><p>打开 <code>djangoProject/urls.py</code> 文件, 编辑内容类似以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include(<span class="string">&#x27;department.urls&#x27;</span>)),  <span class="comment"># 包含新增应用的子路由</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h1><ol><li><p><a href="https://www.bookstack.cn/read/Django-4.0-zh/fe6cf677b8556466.md">Django v4.0 中文文档</a></p></li><li><p><a href="https://www.bookstack.cn/read/django-beginners-guide-zh/README.md">Django入门与实践教程</a></p></li><li><p><a href="https://www.bootstrap.cn/doc/book/2.html">Bootstrap5 中文手册</a></p></li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 框架开发实战 006 - 设备管理应用</title>
      <link href="/2022/08/05/create-an-app-in-django-006/"/>
      <url>/2022/08/05/create-an-app-in-django-006/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 10 Enterprise LTSC [Version 10.0.19044.1586], locale zh-CN</p></li><li><p>Python 3.8.10</p></li><li><p>PyCharm 2021.2 (Professional Edition)</p></li><li><p>Visual Studio Code, 64-bit edition (version 1.67.2)</p></li></ul><hr><h1 id="添加新应用"><a href="#添加新应用" class="headerlink" title="添加新应用"></a>添加新应用</h1><ol><li>激活虚拟环境</li></ol><p>在项目文件夹中 <code>manage.py</code> 文件所在的位置打开 <code>PowerShell窗口</code> 或其他命令行终端, 使用命令激活虚拟环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\venv\Scripts\activate</span><br></pre></td></tr></table></figure><ol start="2"><li>输入命令, 创建名为 <code>equipment</code> 的应用:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\manage.py startapp equipment</span><br></pre></td></tr></table></figure><h1 id="修改项目配置文件"><a href="#修改项目配置文件" class="headerlink" title="修改项目配置文件"></a>修改项目配置文件</h1><p>打开项目的 <code>settings.py</code> 文件, 添加当前应用到  <code>INSTALLED_APPS </code> 列表中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;department&#x27;</span>,  <span class="comment"># 安装自己添加的新应用</span></span><br><span class="line">    <span class="string">&#x27;users&#x27;</span>,  <span class="comment"># 安装新添加的应用</span></span><br><span class="line">    <span class="string">&#x27;equipment&#x27;</span>,  <span class="comment"># 安装新添加的应用</span></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="定义模型类"><a href="#定义模型类" class="headerlink" title="定义模型类"></a>定义模型类</h1><p>打开 <code>equipment/models.py</code>文件, 编辑其内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Equipment</span>(models.Model):</span><br><span class="line">    serial_number = models.CharField(max_length=<span class="number">30</span>, default=<span class="string">&quot;&quot;</span>, verbose_name=<span class="string">&quot;设备编号&quot;</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">30</span>, verbose_name=<span class="string">&quot;设备名称&quot;</span>, help_text=<span class="string">&quot;设备名称&quot;</span>)</span><br><span class="line">    equipment_model = models.CharField(max_length=<span class="number">50</span>, default=<span class="string">&quot;&quot;</span>, verbose_name=<span class="string">&quot;设备型号&quot;</span>)</span><br><span class="line">    desc = models.TextField(blank=<span class="literal">True</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;备注&quot;</span>)</span><br><span class="line">    purchase_date = models.DateField(blank=<span class="literal">True</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;购买日期&quot;</span>)</span><br><span class="line">    owner = models.CharField(max_length=<span class="number">20</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;使用人&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = <span class="string">&quot;设备管理&quot;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.serial_number</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="迁移模型"><a href="#迁移模型" class="headerlink" title="迁移模型"></a>迁移模型</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(venv) PS D:\PycharmProjects\djangoProject&gt; python manage.py makemigrations</span><br><span class="line">Migrations <span class="keyword">for</span> <span class="string">&#x27;equipment&#x27;</span>:</span><br><span class="line">  equipment\migrations\0001_initial.py</span><br><span class="line">    - Create model EquipmentType</span><br><span class="line">    - Create model Equipment</span><br><span class="line">(venv) PS D:\PycharmProjects\djangoProject&gt; python manage.py migrate</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, contenttypes, department, equipment, sessions, <span class="built_in">users</span></span><br><span class="line">Running migrations:</span><br><span class="line">  Applying equipment.0001_initial... OK</span><br></pre></td></tr></table></figure><h1 id="创建用于添加修改数据的表单类"><a href="#创建用于添加修改数据的表单类" class="headerlink" title="创建用于添加修改数据的表单类"></a>创建用于添加修改数据的表单类</h1><ol><li><p>在 <code>equipment</code> 文件夹添加名为 <code>forms.py</code> 的文件</p></li><li><p>打开 <code>equipment/forms.py</code> 文件, 编辑其内容如下：</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Equipment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EquipmentCreateForm</span>(forms.ModelForm):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Equipment  <span class="comment"># 指定表单来自的模型</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>  <span class="comment"># 包含模型类的中所有字段</span></span><br><span class="line">        <span class="comment"># 定义错误信息</span></span><br><span class="line">        error_messages = &#123;</span><br><span class="line">            <span class="string">&quot;serial_number&quot;</span>: &#123;<span class="string">&quot;required&quot;</span>: <span class="string">&quot;设备编号不能为空&quot;</span>&#125;,</span><br><span class="line">            <span class="string">&quot;equipment_model&quot;</span>: &#123;<span class="string">&quot;required&quot;</span>: <span class="string">&quot;请输入设备型号&quot;</span>&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置各个表单控件显示的外观 和 样式</span></span><br><span class="line">        widgets = &#123;</span><br><span class="line">            <span class="string">&#x27;serial_number&#x27;</span>: forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">            <span class="string">&#x27;equipment_model&#x27;</span>: forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">            <span class="string">&#x27;desc&#x27;</span>: forms.Textarea(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>, <span class="string">&#x27;rows&#x27;</span>: <span class="number">3</span>&#125;),</span><br><span class="line">            <span class="string">&#x27;owner&#x27;</span>: forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">            <span class="string">&#x27;purchase_date&#x27;</span>: forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="添加模板文件"><a href="#添加模板文件" class="headerlink" title="添加模板文件"></a>添加模板文件</h1><ol><li><p>在项目的 <code>templates</code> 文件夹添加名为 <code>equipment</code> 的新文件夹</p></li><li><p>在 <code>templates/equipment</code> 文件夹添加以下几个HTML文件待用：<code>index.html</code>, <code>edit.html</code>, <code>delete.html</code>, <code>detail.html</code></p></li></ol><h1 id="添加视图类"><a href="#添加视图类" class="headerlink" title="添加视图类"></a>添加视图类</h1><p>打开 <code>equipment/views.py</code> 文件, 编辑其内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, get_object_or_404</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.views.generic.base <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.mixins <span class="keyword">import</span> LoginRequiredMixin</span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> EquipmentCreateForm</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Equipment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EquipmentListView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        equipments = Equipment.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;equipment/index.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EquipmentCreateView</span>(LoginRequiredMixin, View):</span><br><span class="line">    login_url = <span class="string">&#x27;/login/&#x27;</span>  <span class="comment"># 未登录用户自动跳转的目标url</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        form = EquipmentCreateForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;equipment/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        form = EquipmentCreateForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            cd = form.cleaned_data</span><br><span class="line">            Equipment.objects.create(</span><br><span class="line">                serial_number=cd[<span class="string">&#x27;serial_number&#x27;</span>],</span><br><span class="line">                name=cd[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">                equipment_model=cd[<span class="string">&#x27;equipment_model&#x27;</span>],</span><br><span class="line">                desc=cd[<span class="string">&#x27;desc&#x27;</span>],</span><br><span class="line">                owner=cd[<span class="string">&#x27;owner&#x27;</span>],</span><br><span class="line">                purchase_date=cd[<span class="string">&#x27;purchase_date&#x27;</span>],</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/equipment/&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error_msg = <span class="string">&#x27;新增设备出现异常&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/equipment/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EquipmentUpdateView</span>(LoginRequiredMixin, View):</span><br><span class="line">    login_url = <span class="string">&#x27;/login/&#x27;</span>  <span class="comment"># 未登录用户自动跳转的目标url</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">id</span> = <span class="variable language_">self</span>.kwargs[<span class="string">&#x27;id&#x27;</span>]  <span class="comment"># 接收名为 id 的参数（与urls.py一致）</span></span><br><span class="line">        data = get_object_or_404(Equipment, pk=<span class="built_in">id</span>)</span><br><span class="line">        form = EquipmentCreateForm(initial=&#123;</span><br><span class="line">            <span class="string">&#x27;serial_number&#x27;</span>: data.serial_number,</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: data.name,</span><br><span class="line">            <span class="string">&#x27;equipment_model&#x27;</span>: data.equipment_model,</span><br><span class="line">            <span class="string">&#x27;desc&#x27;</span>: data.desc,</span><br><span class="line">            <span class="string">&#x27;owner&#x27;</span>: data.owner,</span><br><span class="line">            <span class="string">&#x27;purchase_date&#x27;</span>: data.purchase_date,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;equipment/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">id</span> = <span class="variable language_">self</span>.kwargs[<span class="string">&#x27;id&#x27;</span>]  <span class="comment"># 接收名为 id 的参数（与urls.py一致）</span></span><br><span class="line">        data = get_object_or_404(Equipment, pk=<span class="built_in">id</span>)</span><br><span class="line">        form = EquipmentCreateForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            cd = form.cleaned_data</span><br><span class="line">            data.serial_number = cd[<span class="string">&#x27;serial_number&#x27;</span>]</span><br><span class="line">            data.name = cd[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">            data.equipment_model = cd[<span class="string">&#x27;equipment_model&#x27;</span>]</span><br><span class="line">            data.desc = cd[<span class="string">&#x27;desc&#x27;</span>]</span><br><span class="line">            data.owner = cd[<span class="string">&#x27;owner&#x27;</span>]</span><br><span class="line">            data.purchase_date = cd[<span class="string">&#x27;purchase_date&#x27;</span>]</span><br><span class="line">            data.save()</span><br><span class="line">            <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/equipment/&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            form = EquipmentCreateForm(initial=&#123;</span><br><span class="line">                <span class="string">&#x27;serial_number&#x27;</span>: data.serial_number,</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: data.name,</span><br><span class="line">                <span class="string">&#x27;equipment_model&#x27;</span>: data.equipment_model,</span><br><span class="line">                <span class="string">&#x27;desc&#x27;</span>: data.desc,</span><br><span class="line">                <span class="string">&#x27;owner&#x27;</span>: data.owner,</span><br><span class="line">                <span class="string">&#x27;purchase_date&#x27;</span>: data.purchase_date,</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;equipment/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EquipmentDeleteView</span>(LoginRequiredMixin, View):</span><br><span class="line">    login_url = <span class="string">&#x27;/login/&#x27;</span>  <span class="comment"># 未登录用户自动跳转的目标url </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">id</span> = <span class="variable language_">self</span>.kwargs[<span class="string">&#x27;id&#x27;</span>]  <span class="comment"># 接收名为 id 的参数（与urls.py一致）</span></span><br><span class="line">        equipment = get_object_or_404(Equipment, pk=<span class="built_in">id</span>)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;equipment/delete.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">id</span> = <span class="variable language_">self</span>.kwargs[<span class="string">&#x27;id&#x27;</span>]  <span class="comment"># 接收名为 id 的参数（与urls.py一致）</span></span><br><span class="line">        equipment = get_object_or_404(Equipment, pk=<span class="built_in">id</span>)</span><br><span class="line">        equipment.delete()</span><br><span class="line">        <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/equipment/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EquipmentDetailView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">id</span> = <span class="variable language_">self</span>.kwargs[<span class="string">&#x27;id&#x27;</span>]  <span class="comment"># 接收名为 id 的参数（与urls.py一致）</span></span><br><span class="line">        equipment = get_object_or_404(Equipment, pk=<span class="built_in">id</span>)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;equipment/detail.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="包含分页功能的设备列表视图类"><a href="#包含分页功能的设备列表视图类" class="headerlink" title="包含分页功能的设备列表视图类"></a>包含分页功能的设备列表视图类</h2><p>如果需要使用分页功能，可以 <code>EquipmentListView</code> 替换为以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EquipmentListView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        params = <span class="variable language_">self</span>.request.GET.<span class="built_in">dict</span>()       </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            page = params[<span class="string">&#x27;page&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            page = <span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            limit = params[<span class="string">&#x27;limit&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            limit = <span class="number">10</span></span><br><span class="line">        equipment_list = Equipment.objects.<span class="built_in">all</span>()</span><br><span class="line">        paginator = Paginator(equipment_list, limit)  <span class="comment"># 对数据进行分页</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_page = paginator.page(page)  <span class="comment"># 获取 指定页的数据</span></span><br><span class="line">            equipments = current_page.object_list  <span class="comment"># 将当前页数据转为列表</span></span><br><span class="line">        <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">            current_page = paginator.page(<span class="number">1</span>)  <span class="comment"># 页码不是数字时，返回第一页</span></span><br><span class="line">            equipments = current_page.object_list</span><br><span class="line">        <span class="keyword">except</span> EmptyPage:</span><br><span class="line">            current_page = paginator.page(paginator.num_pages)</span><br><span class="line">            equipments = current_page.object_list</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;equipment/index.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure><h1 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h1><h2 id="添加应用内的子路由"><a href="#添加应用内的子路由" class="headerlink" title="添加应用内的子路由"></a>添加应用内的子路由</h2><ol><li><p>在 <code>equipment</code> 文件夹添加名为 <code>urls.py</code> 的文件</p></li><li><p>打开 <code>equipment/urls.py</code> 文件, 编辑其内容如下：</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 第一个参数是路径， 第二个参数是匹配的视图函数，第三个参数(可选) 命名路由</span></span><br><span class="line">    <span class="comment"># 实际路径等于当前 path 和项目urls 中对应 path的拼接</span></span><br><span class="line">    <span class="comment"># 完整路径：department/</span></span><br><span class="line">    <span class="comment"># 项目中所有 路由项的 path 中的name 值 不能相同</span></span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.EquipmentListView.as_view(), name=<span class="string">&#x27;equip_index&#x27;</span>),</span><br><span class="line">    <span class="comment"># 完整路径为：department/create/</span></span><br><span class="line">    path(<span class="string">&#x27;create/&#x27;</span>, views.EquipmentCreateView.as_view(), name=<span class="string">&#x27;equip_create&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:id&gt;/&#x27;</span>, views.EquipmentDetailView.as_view(), name=<span class="string">&#x27;equip_detail&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;update/&lt;int:id&gt;/&#x27;</span>, views.EquipmentUpdateView.as_view(), name=<span class="string">&#x27;equip_update&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;delete/&lt;int:id&gt;/&#x27;</span>, views.EquipmentDeleteView.as_view(), name=<span class="string">&#x27;equip_delete&#x27;</span>),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="添加应用子路由到项目路由中"><a href="#添加应用子路由到项目路由中" class="headerlink" title="添加应用子路由到项目路由中"></a>添加应用子路由到项目路由中</h2><p>打开项目的路由文件 <code>djangoProject/urls.py</code>, 编辑其内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"><span class="keyword">import</span> department.views</span><br><span class="line"><span class="keyword">from</span> users.views <span class="keyword">import</span> LoginView, LogoutView, SignupView  <span class="comment"># 导入视图</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;department/&#x27;</span>, include(<span class="string">&#x27;department.urls&#x27;</span>)),</span><br><span class="line">    path(<span class="string">&#x27;equipment/&#x27;</span>, include(<span class="string">&#x27;equipment.urls&#x27;</span>)),     <span class="comment"># 添加设备管理的子路由</span></span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, department.views.home),</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用户注册、登录相关的路由</span></span><br><span class="line">    path(<span class="string">&#x27;login/&#x27;</span>, LoginView.as_view(), name=<span class="string">&#x27;login&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;logout/&#x27;</span>, LogoutView.as_view(), name=<span class="string">&#x27;logout&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;signup/&#x27;</span>, SignupView.as_view(), name=<span class="string">&#x27;signup&#x27;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="修改网站的导航栏"><a href="#修改网站的导航栏" class="headerlink" title="修改网站的导航栏"></a>修改网站的导航栏</h1><p>打开 <code>templates/nav.html</code> 文件，添加到 <code>equipment</code> 应用的导航菜单, 编辑文件内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导航菜单栏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-expand-sm bg-light mb-4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container d-flex w-100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我的网站<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;navbar-nav&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/department/&quot;</span>&gt;</span>组织构架管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/equipment/&quot;</span>&gt;</span>设备管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% if  request.user.is_authenticated %&#125;</span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">                        当前用户: &#123;&#123; request.user.username &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/logout/&quot;</span>&gt;</span>注销 <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/login/&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/signup/&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="修改模板文件"><a href="#修改模板文件" class="headerlink" title="修改模板文件"></a>修改模板文件</h1><h2 id="编辑设备列表显示页"><a href="#编辑设备列表显示页" class="headerlink" title="编辑设备列表显示页"></a>编辑设备列表显示页</h2><p>打开 <code>templates/equipment/index.html</code> 文件，编辑其内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&#123;#  继承指定的模板文件 layout.html  #&#125;</span><br><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125; 设备管理 &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 内容为替换到 母版页 中对应的位置 #&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    &#123;# container:让内部元素左右留出一定的空间，居中， #&#125;</span><br><span class="line">    &#123;# flex-grow-1：让元素占用弹性布局内所有的剩余空间  #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        &#123;#  my-3:m 表示 margin 外边距, y 表示 y轴、垂直方向的两个边； 数据3表示间距的大小  #&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex my-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span>设备信息<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-success&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;equip_create&#x27; %&#125;&quot;</span>&gt;</span>新增<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-hover&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>设备编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>设备名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>设备型号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>购买日期<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>使用人<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% for item in equipments %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;align-middle&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.serial_number &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;text-decoration-none&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;equip_detail&#x27; item.id %&#125;&quot;</span>&gt;</span></span><br><span class="line">                            &#123;&#123; item.name &#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        &#123;&#123; item.equipment_model &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.purchase_date &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.owner &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;width: 140px;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;equip_update&#x27; item.id %&#125;&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-danger&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;equip_delete&#x27; item.id %&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span><br><span class="line">            &#123;# current_page 为视图中使用的变量名 #&#125;</span><br><span class="line">            &#123;% if current_page.has_previous %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">href</span>=<span class="string">&quot;/equipment/?page=&#123;&#123; current_page.previous_page_number &#125;&#125;&quot;</span>&gt;</span>前一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item disabled&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>前一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            &#123;% for item in paginator.page_range %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">href</span>=<span class="string">&quot;/equipment/?page=&#123;&#123; item &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            &#123;% if current_page.has_next %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">href</span>=<span class="string">&quot;/equipment/?page=&#123;&#123; current_page.next_page_number &#125;&#125;&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item disabled&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><h2 id="编辑新建和修改设备页"><a href="#编辑新建和修改设备页" class="headerlink" title="编辑新建和修改设备页"></a>编辑新建和修改设备页</h2><p>打开 <code>templates/equipment/edit.html</code> 文件，编辑其内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#123;#  继承指定的模板文件 layout.html  #&#125;</span><br><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125; 设备管理 &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 内容为替换到 母版页 中对应的位置 #&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    &#123;# container:让内部元素左右留出一定的空间，居中， #&#125;</span><br><span class="line">    &#123;# flex-grow-1：让元素占用弹性布局内所有的剩余空间  #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1 d-flex flex-column&quot;</span>&gt;</span></span><br><span class="line">        &#123;#  my-3:m 表示 margin 外边距, y 表示 y轴、垂直方向的两个边； 数据3表示间距的大小  #&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex my-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">                &#123;% if form.name.value %&#125;</span><br><span class="line">                    修改设备信息</span><br><span class="line">                &#123;% else %&#125;</span><br><span class="line">                    添加新设备</span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备编号<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; form.serial_number &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备名称<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; form.name &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备型号<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; form.equipment_model &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>购买日期<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; form.purchase_date &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>使用人<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; form.owner &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>备注<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; form.desc &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/equipment/&quot;</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><h2 id="编辑确认设备删除页"><a href="#编辑确认设备删除页" class="headerlink" title="编辑确认设备删除页"></a>编辑确认设备删除页</h2><p>打开 <code>templates/equipment/delete.html</code> 文件，编辑其内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;#  继承指定的模板文件 layout.html  #&#125;</span><br><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125; 设备管理 &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 内容为替换到 母版页 中对应的位置 #&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    &#123;# container:让内部元素左右留出一定的空间，居中， #&#125;</span><br><span class="line">    &#123;# flex-grow-1：让元素占用弹性布局内所有的剩余空间  #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1 d-flex flex-column&quot;</span>&gt;</span></span><br><span class="line">        &#123;#  my-3:m 表示 margin 外边距, y 表示 y轴、垂直方向的两个边； 数据3表示间距的大小  #&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex my-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">                删除当前设备</span><br><span class="line">            <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备编号:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.serial_number &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备名称:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.name &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备型号:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.equipment_model &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>购买日期:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.purchase_date &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>使用人:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.owner &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>备注:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.desc &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/equipment/&quot;</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-danger&quot;</span>&gt;</span>确认删除设备<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><h2 id="编辑设备详细页"><a href="#编辑设备详细页" class="headerlink" title="编辑设备详细页"></a>编辑设备详细页</h2><p>打开 <code>templates/equipment/detail.html</code> 文件，编辑其内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&#123;#  继承指定的模板文件 layout.html  #&#125;</span><br><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125; 设备管理 &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 内容为替换到 母版页 中对应的位置 #&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    &#123;# container:让内部元素左右留出一定的空间，居中， #&#125;</span><br><span class="line">    &#123;# flex-grow-1：让元素占用弹性布局内所有的剩余空间  #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1 d-flex flex-column&quot;</span>&gt;</span></span><br><span class="line">        &#123;#  my-3:m 表示 margin 外边距, y 表示 y轴、垂直方向的两个边； 数据3表示间距的大小  #&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex my-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">                    设备详细信息</span><br><span class="line">            <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备编号<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.serial_number &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备名称<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.name &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>设备型号<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.equipment_model &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>购买日期<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.purchase_date &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>使用人<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.owner &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>备注<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    &#123;&#123; equipment.desc &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/equipment/&quot;</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h1><ol><li><p><a href="https://www.bookstack.cn/read/Django-4.0-zh/fe6cf677b8556466.md">Django v4.0 中文文档</a></p></li><li><p><a href="https://www.bookstack.cn/read/django-beginners-guide-zh/README.md">Django入门与实践教程</a></p></li><li><p><a href="https://www.bootstrap.cn/doc/book/2.html">Bootstrap5 中文手册</a></p></li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 框架开发实战 005 - 用户登录验证</title>
      <link href="/2022/07/05/create-an-app-in-django-005/"/>
      <url>/2022/07/05/create-an-app-in-django-005/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 10 Enterprise LTSC [Version 10.0.19044.1586], locale zh-CN</p></li><li><p>Python 3.8.10</p></li><li><p>PyCharm 2021.2 (Professional Edition)</p></li><li><p>Visual Studio Code, 64-bit edition (version 1.67.2)</p></li></ul><hr><h1 id="修改网站的导航栏"><a href="#修改网站的导航栏" class="headerlink" title="修改网站的导航栏"></a>修改网站的导航栏</h1><p>打开 <code>templates/nav.html</code> 文件, 编辑其内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导航菜单栏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-expand-sm bg-light mb-4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container d-flex w-100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我的网站<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;navbar-nav&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/department/&quot;</span>&gt;</span>组织构架管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">                    &#123;% if  request.user.is_authenticated %&#125;</span><br><span class="line">                        当前用户: &#123;&#123; request.user.username &#125;&#125;</span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/logout/&quot;</span>&gt;</span>注销 <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/login/&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/signup/&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="扩展用户模型"><a href="#扩展用户模型" class="headerlink" title="扩展用户模型"></a>扩展用户模型</h1><p><code>Djano</code> 已经内置有用户管理的模型, 但是其原有字段可能不适合于当前的应用, 所以对用户模型进行扩展。</p><h2 id="添加应用-users"><a href="#添加应用-users" class="headerlink" title="添加应用 users"></a>添加应用 <code>users</code></h2><p>打开 <code>PowerShell窗口</code>, 激活虚拟环境, 创建名为 <code>uers</code> 的应用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">venv\Scripts\activate</span><br><span class="line">python manage.py startapp <span class="built_in">users</span></span><br></pre></td></tr></table></figure><p>打开 <code>users/models.py</code> 文件, <code>添加</code> 以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"><span class="keyword">from</span> department.models <span class="keyword">import</span> Department</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserProfile</span>(<span class="title class_ inherited__">AbstractUser</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户: makemigration提示错误：sers.UserProfile.user_permissions: (fields.E304)，</span></span><br><span class="line"><span class="string">    需要在settings中指定自定义认证模型：AUTH_USER_MODEL = &#x27;users.UserProfile&#x27;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    name = models.CharField(</span><br><span class="line">        max_length=<span class="number">20</span>,</span><br><span class="line">        default=<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        verbose_name=<span class="string">&#x27;姓名&#x27;</span>)</span><br><span class="line">    gender = models.CharField(</span><br><span class="line">        max_length=<span class="number">10</span>,</span><br><span class="line">        choices=((<span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;男&#x27;</span>), (<span class="string">&#x27;female&#x27;</span>, <span class="string">&#x27;女&#x27;</span>)),</span><br><span class="line">        default=<span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">        verbose_name=<span class="string">&#x27;性别&#x27;</span>)</span><br><span class="line">    mobile = models.CharField(</span><br><span class="line">        max_length=<span class="number">11</span>,</span><br><span class="line">        default=<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        verbose_name=<span class="string">&#x27;电话&#x27;</span>)</span><br><span class="line">    department = models.ForeignKey(</span><br><span class="line">        Department,</span><br><span class="line">        blank=<span class="literal">True</span>,</span><br><span class="line">        null=<span class="literal">True</span>,</span><br><span class="line">        verbose_name=<span class="string">&#x27;所属部门&#x27;</span>,</span><br><span class="line">        on_delete=models.CASCADE)</span><br><span class="line">    position = models.CharField(</span><br><span class="line">        max_length=<span class="number">50</span>,</span><br><span class="line">        blank=<span class="literal">True</span>,</span><br><span class="line">        null=<span class="literal">True</span>,</span><br><span class="line">        verbose_name=<span class="string">&#x27;职位&#x27;</span>)</span><br><span class="line">    enrollment_date = models.DateField(</span><br><span class="line">        blank=<span class="literal">True</span>,</span><br><span class="line">        null=<span class="literal">True</span>,</span><br><span class="line">        verbose_name=<span class="string">&#x27;入职日期&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = <span class="string">&#x27;用户信息&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line">        ordering = [<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.name</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><code>AbstractUser</code>: <code>Django</code> 内置的一个完整用户模型，包含字段，作为一个抽象类，以便您可以继承它并添加您自己的配置文件字段和方法。 </p></blockquote><blockquote><p><code>AbstractBaseUser</code>: 仅包含身份验证功能，但不包含实际字段：当您继承子类时，您必须提供它们</p></blockquote><h2 id="修改项目settings-py"><a href="#修改项目settings-py" class="headerlink" title="修改项目settings.py"></a>修改项目settings.py</h2><p>打开 <code>myproject/settings.py</code>, 添加自定义的用户模型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;department&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;users&#x27;</span>,   <span class="comment"># 安装新添加的应用</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">AUTH_USER_MODEL = <span class="string">&#x27;users.UserProfile&#x27;</span>  <span class="comment"># 指定自定义认证模型</span></span><br></pre></td></tr></table></figure><p>如下图所示</p><img src="/2022/07/05/create-an-app-in-django-005/001.png" class="" title="new"><h2 id="迁移模型"><a href="#迁移模型" class="headerlink" title="迁移模型"></a>迁移模型</h2><p>在 <code>manage.py</code> 所在文件夹打开 <code>PowerShell窗口</code>, 激活虚拟环境, 执行以下两个命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line"></span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure><blockquote><p>迁移的时候有可能会出现类似 <code>ValueError: Related model &#39;departments.structure&#39; cannot be resolved</code> 的错误。</p></blockquote><blockquote><p>解决办法：1. 删除 <code>各个应用</code> 的 <code>migrations</code> 文件夹除 <code>__init__.py以外的文件</code>, 重新执行以上两个迁移的命令; </p></blockquote><blockquote><p>如果还不行，则删除数据库, 然后重建同名数据库, 重新执行以上两个迁移的命令; </p></blockquote><blockquote><p>重建数据后, 要重新<code>创建超级用户</code>(如果有需要) 及添加数据</p></blockquote><p>删除 迁移相应的文件</p><img src="/2022/07/05/create-an-app-in-django-005/003.png" class="" title="new"><p>删除数据库文件</p><img src="/2022/07/05/create-an-app-in-django-005/002.png" class="" title="new"><p>命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(venv) PS D:\PycharmProjects\djangoProject&gt; python manage.py makemigrations</span><br><span class="line">No changes detected</span><br><span class="line">(venv) PS D:\PycharmProjects\djangoProject&gt; python manage.py migrate</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, contenttypes, department, sessions</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying contenttypes.0001_initial... OK</span><br><span class="line">  Applying admin.0001_initial... OK</span><br><span class="line">  Applying admin.0002_logentry_remove_auto_add... OK</span><br><span class="line">  Applying admin.0003_logentry_add_action_flag_choices... OK</span><br><span class="line">  Applying contenttypes.0002_remove_content_type_name... OK</span><br><span class="line">  Applying auth.0001_initial... OK</span><br><span class="line">  Applying auth.0002_alter_permission_name_max_length... OK</span><br><span class="line">  Applying auth.0003_alter_user_email_max_length... OK</span><br><span class="line">  Applying auth.0004_alter_user_username_opts... OK</span><br><span class="line">  Applying auth.0005_alter_user_last_login_null... OK</span><br><span class="line">  Applying auth.0006_require_contenttypes_0002... OK</span><br><span class="line">  Applying auth.0007_alter_validators_add_error_messages... OK</span><br><span class="line">  Applying auth.0008_alter_user_username_max_length... OK</span><br><span class="line">  Applying auth.0009_alter_user_last_name_max_length... OK</span><br><span class="line">  Applying auth.0010_alter_group_name_max_length... OK</span><br><span class="line">  Applying auth.0011_update_proxy_permissions... OK</span><br><span class="line">  Applying auth.0012_alter_user_first_name_max_length... OK</span><br><span class="line">  Applying department.0001_initial... OK</span><br><span class="line">  Applying sessions.0001_initial... OK</span><br></pre></td></tr></table></figure><h1 id="基于类的视图"><a href="#基于类的视图" class="headerlink" title="基于类的视图"></a>基于类的视图</h1><h2 id="添加用户相关的视图文件"><a href="#添加用户相关的视图文件" class="headerlink" title="添加用户相关的视图文件"></a>添加用户相关的视图文件</h2><ol><li><p>在 <code>templates</code> 文件夹中新建名为 <code>users</code>(与新添加的应用同名) 的文件夹</p></li><li><p>在 <code>templates/users</code> 文件夹新建用于 <code>用户注册</code> 和 <code>用户登录</code> 的网页文件：<code>signup.html</code> 和 <code>login.html</code> 待用</p></li></ol><h2 id="添加用户-注册、登录-的表单类"><a href="#添加用户-注册、登录-的表单类" class="headerlink" title="添加用户 注册、登录 的表单类"></a>添加用户 注册、登录 的表单类</h2><p>在  <code>users</code> 文件夹新建名为 <code>forms.py</code> 的 <code>Python file</code>, 编辑其内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> validators</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> get_user_model</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> UserProfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get_user_model()实际获取的是settings.AUTH_USER_MODEL指定的User model</span></span><br><span class="line">User = get_user_model()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(forms.Form):</span><br><span class="line">    username = forms.CharField(</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">        widget=forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">        error_messages=&#123;<span class="string">&quot;required&quot;</span>: <span class="string">&quot;请填写用户名&quot;</span>&#125;)</span><br><span class="line">    password = forms.CharField(</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">        widget=forms.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">        error_messages=&#123;<span class="string">&quot;required&quot;</span>: <span class="string">u&quot;请填写密码&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserUpdateForm</span>(forms.ModelForm):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = User</span><br><span class="line">        fields = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;mobile&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;enrollment_date&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;department&#x27;</span>, <span class="string">&#x27;position&#x27;</span>, <span class="string">&#x27;is_active&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreateForm</span>(forms.ModelForm):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建用户表单，进行字段验证</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    username = forms.CharField(</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">        min_length=<span class="number">3</span>,</span><br><span class="line">        widget=forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">        error_messages=&#123;<span class="string">&quot;required&quot;</span>: <span class="string">&quot;请填写用户名&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;min_length&quot;</span>: <span class="string">&quot;密码长度最少6位数&quot;</span>, &#125;)</span><br><span class="line">    email = forms.CharField(</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">        validators=[validators.EmailValidator()],</span><br><span class="line">        widget=forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">        error_messages=&#123;<span class="string">&quot;required&quot;</span>: <span class="string">&quot;请填写邮箱&quot;</span>, &#125;)</span><br><span class="line"></span><br><span class="line">    password = forms.CharField(</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">        min_length=<span class="number">6</span>,</span><br><span class="line">        max_length=<span class="number">20</span>,</span><br><span class="line">        widget=forms.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;),</span><br><span class="line">        error_messages=&#123;<span class="string">&quot;required&quot;</span>: <span class="string">u&quot;密码不能为空&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;min_length&quot;</span>: <span class="string">&quot;密码长度最少6位数&quot;</span>, &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># confirm_password = forms.CharField(</span></span><br><span class="line">    <span class="comment">#     required=True,</span></span><br><span class="line">    <span class="comment">#     min_length=6,</span></span><br><span class="line">    <span class="comment">#     max_length=20,</span></span><br><span class="line">    <span class="comment">#     widget=forms.PasswordInput(attrs=&#123;&#x27;class&#x27;: &#x27;form-control&#x27;&#125;),</span></span><br><span class="line">    <span class="comment">#     error_messages=&#123;&quot;required&quot;: u&quot;确认密码不能为空&quot;,</span></span><br><span class="line">    <span class="comment">#                     &quot;min_length&quot;: &quot;密码长度最少6位数&quot;, &#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = User</span><br><span class="line">        fields = [<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="编辑视图"><a href="#编辑视图" class="headerlink" title="编辑视图"></a>编辑视图</h2><p>打开 <code>users/views.py</code> 文件, 编辑其内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.views.generic.base <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login, logout</span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> LoginForm, UserCreateForm</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> UserProfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于类的视图</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SignupView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    注册新用户</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):   <span class="comment"># 处理 get 请求的函数</span></span><br><span class="line">        signup_form = UserCreateForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;users/signup.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):  <span class="comment"># 处理 post 请求的函数</span></span><br><span class="line">        signup_form = UserCreateForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> signup_form.is_valid():</span><br><span class="line">            cd = signup_form.cleaned_data</span><br><span class="line">            <span class="comment"># 创建用户</span></span><br><span class="line">            new_user = UserProfile.objects.create_user(cd[<span class="string">&#x27;username&#x27;</span>], cd[<span class="string">&#x27;email&#x27;</span>], cd[<span class="string">&#x27;password&#x27;</span>])</span><br><span class="line">            <span class="comment"># 设置 name 和  username 相同</span></span><br><span class="line">            new_user.name = new_user.username</span><br><span class="line">            new_user.save()</span><br><span class="line">            login(request, new_user)   <span class="comment"># 注册成功后直接登录该用户(可选)</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error_msg = <span class="string">&#x27;注册失败&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">&#x27;users/signup.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户登录</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):  <span class="comment"># 处理 GET 请求的函数</span></span><br><span class="line">        login_form = LoginForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;users/login.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):   <span class="comment"># 处理 POST 请求的函数</span></span><br><span class="line">        <span class="comment"># 用于登录成功后返回进入登录界面的前一页</span></span><br><span class="line">        redirect_to = request.GET.get(<span class="string">&#x27;next&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        login_form = LoginForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> login_form.is_valid():</span><br><span class="line">            cd = login_form.cleaned_data</span><br><span class="line">            _username = cd[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">            _password = cd[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">            <span class="comment"># 验证用户登录</span></span><br><span class="line">            user = authenticate(username=_username, password=_password)</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> user.is_active:</span><br><span class="line">                    login(request, user)</span><br><span class="line">                    <span class="keyword">return</span> HttpResponseRedirect(redirect_to)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    error_msg = <span class="string">&#x27;用户未激活&#x27;</span></span><br><span class="line">                    <span class="keyword">return</span> render(request, <span class="string">&#x27;users/login.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                error_msg = <span class="string">&quot;用户名或密码错误！&quot;</span></span><br><span class="line">                <span class="keyword">return</span> render(request, <span class="string">&#x27;users/login.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error_msg = <span class="string">&quot;用户名和密码不能够为空！&quot;</span></span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">&#x27;users/login.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogoutView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    退出登录</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        logout(request)</span><br><span class="line">        <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h2><p>用户 <code>注册</code>、<code>登录</code>、<code>注销</code>这几个操作不想添加有前缀的url, 所以直接将相关的路由添加到项目的 <code>urls.py</code> 文件中。打开 <code>djangoProject/urls.py</code> 文件, 编辑其内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"><span class="keyword">import</span> department.views</span><br><span class="line"><span class="keyword">from</span> users.views <span class="keyword">import</span> LoginView, LogoutView, SignupView  <span class="comment"># 导入视图</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;department/&#x27;</span>, include(<span class="string">&#x27;department.urls&#x27;</span>)),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, department.views.home),</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用户注册、登录相关的路由</span></span><br><span class="line">    path(<span class="string">&#x27;login/&#x27;</span>, LoginView.as_view(), name=<span class="string">&#x27;login&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;logout/&#x27;</span>, LogoutView.as_view(), name=<span class="string">&#x27;logout&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;signup/&#x27;</span>, SignupView.as_view(), name=<span class="string">&#x27;signup&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="注册和登录的模板"><a href="#注册和登录的模板" class="headerlink" title="注册和登录的模板"></a>注册和登录的模板</h2><p>编辑用于用户<code>注册</code>和<code>登录</code>的网页文件</p><h3 id="注册用户的模板"><a href="#注册用户的模板" class="headerlink" title="注册用户的模板"></a>注册用户的模板</h3><p>打开 <code>templates/users/signup.html</code> 文件, 编辑其内容如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;用户注册&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex justify-content-center align-items-center vh-100 bg-secondary&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;text-center p-3&quot;</span>&gt;</span>注册新用户<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-white login_form&quot;</span>&gt;</span></span><br><span class="line">                &#123;% csrf_token %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-danger text-center&quot;</span>&gt;</span> &#123;&#123; error_msg &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row align-items-center g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3 d-flex justify-content-end&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-form-label&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-9&quot;</span>&gt;</span></span><br><span class="line">                        &#123;&#123; signup_form.username &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row align-items-center g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3 d-flex justify-content-end&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-form-label&quot;</span>&gt;</span>电子邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-9&quot;</span>&gt;</span></span><br><span class="line">                        &#123;&#123; signup_form.email &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row align-items-center g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3 d-flex justify-content-end&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-form-label&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-9&quot;</span>&gt;</span></span><br><span class="line">                        &#123;&#123; signup_form.password &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row align-items-center g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary block&quot;</span>&gt;</span>注册新用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-end g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;text-decoration-none mx-3 text-success&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>返回首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;text-decoration-none&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/login/&quot;</span>&gt;</span>使用已有账号登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% block style %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.login_form</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">480px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><p>注册新用户的界面</p><img src="/2022/07/05/create-an-app-in-django-005/005.png" class="" title="new"><h3 id="用户登录的模板"><a href="#用户登录的模板" class="headerlink" title="用户登录的模板"></a>用户登录的模板</h3><p>打开 <code>templates/users/login.html</code>, 编辑其内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;用户登录&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex justify-content-center align-items-center h-100 bg-secondary&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;text-center p-3&quot;</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-white login_form&quot;</span>&gt;</span></span><br><span class="line">                &#123;% csrf_token %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-danger text-center&quot;</span>&gt;</span> &#123;&#123; error_msg &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row align-items-center g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3 d-flex justify-content-end&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-form-label&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-9&quot;</span>&gt;</span></span><br><span class="line">                        &#123;&#123; login_form.username &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row align-items-center g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-3 d-flex justify-content-end&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-form-label&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-9&quot;</span>&gt;</span></span><br><span class="line">                        &#123;&#123; login_form.password &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row align-items-center g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary block&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-end g-3 m-3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;text-decoration-none mx-3 text-success&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>返回首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;text-decoration-none&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/signup/&quot;</span>&gt;</span>没有账号<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% block style %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.login_form</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">480px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>用户登录的界面</p><img src="/2022/07/05/create-an-app-in-django-005/006.png" class="" title="new"><h1 id="启用登陆验证"><a href="#启用登陆验证" class="headerlink" title="启用登陆验证"></a>启用登陆验证</h1><p><code>Django</code> 在做后台系统过程中，我们通常都会为 <code>视图函数</code> 添加 <code>@login_required</code> 装饰器，这个装饰器的主要作用就是在用户访问这个方法时，检查用户是否已经成功登陆，如果没有则<code>重定向</code>到登陆页面。</p><p>打开 <code>department/views.py</code> 文件, 编辑部分内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 省略原有的部分代码</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required  <span class="comment"># 导入登录验证</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required(<span class="params">login_url=<span class="string">&#x27;/login/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    省略部分代码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required(<span class="params">login_url=<span class="string">&#x27;/login/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    省略部分代码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required(<span class="params">login_url=<span class="string">&#x27;/login/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    省略部分代码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>在函数上方添加的 @ 开头的对象为装饰器，作用是给函数增加额外的功能</p></blockquote><blockquote><p> @login_required(login_url&#x3D;’&#x2F;login&#x2F;‘): 必须登录后才能访问的装饰器</p></blockquote><blockquote><p>login_url&#x3D;’&#x2F;login&#x2F;‘: 当未登录用户访问该函数时自动跳转到的登录url</p></blockquote><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h1><ol><li><p><a href="https://www.bookstack.cn/read/Django-4.0-zh/fe6cf677b8556466.md">Django v4.0 中文文档</a></p></li><li><p><a href="https://www.bookstack.cn/read/django-beginners-guide-zh/README.md">Django入门与实践教程</a></p></li><li><p><a href="https://www.bootstrap.cn/doc/book/2.html">Bootstrap5 中文手册</a></p></li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 框架开发实战 004 - 实现组织构架的管理功能</title>
      <link href="/2022/07/04/create-an-app-in-django-004/"/>
      <url>/2022/07/04/create-an-app-in-django-004/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 10 Enterprise LTSC [Version 10.0.19044.1586], locale zh-CN</p></li><li><p>Python 3.8.10</p></li><li><p>PyCharm 2021.2 (Professional Edition)</p></li><li><p>Visual Studio Code, 64-bit edition (version 1.67.2)</p></li></ul><hr><h1 id="自己实现表单添加组织构架"><a href="#自己实现表单添加组织构架" class="headerlink" title="自己实现表单添加组织构架"></a>自己实现表单添加组织构架</h1><p>在项目 <code>templates/department/</code> 文件夹添加用于以下几个新的HTML文件待用: <code>edit.html</code>, <code>detail.html</code>, <code>delete.html</code>, </p><p>打开 <code>department/views.py</code> 文件, 在文件中添加用于 <code>新增</code>、<code>修改</code>、<code>删除</code>、<code>查看详细内容</code>的函数, 代码如下所示:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect, get_object_or_404</span><br><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Department  <span class="comment"># 添加模型类的导入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):    </span><br><span class="line">    departments = Department.objects.<span class="built_in">all</span>()    </span><br><span class="line">    <span class="comment"># 调用并传递数据到指定的模板文件</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/index.html&#x27;</span>, &#123;<span class="string">&#x27;departments&#x27;</span>: departments&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/delete.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detail</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/detail.html&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>添加路由时, 找不到目标函数会报错, 所以这里先添加几个没有具体功能的函数</p></blockquote><h2 id="添加新功能的路由"><a href="#添加新功能的路由" class="headerlink" title="添加新功能的路由"></a>添加新功能的路由</h2><p>打开 <code>department/urls.py</code> 文件, 编辑内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;create/&#x27;</span>, views.create, name=<span class="string">&#x27;create&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:dep_id&gt;/&#x27;</span>, views.detail, name=<span class="string">&#x27;detail&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;update/&lt;int:dep_id&gt;/&#x27;</span>, views.update, name=<span class="string">&#x27;update&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;delete/&lt;int:dep_id&gt;/&#x27;</span>, views.delete, name=<span class="string">&#x27;delete&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><code>&lt;int:dep_id&gt;</code>: 表示该路由接收一个名为 <code>dep_id</code> 的 <code>int</code> 类型的参数</p></blockquote><h2 id="跳转到新页面"><a href="#跳转到新页面" class="headerlink" title="跳转到新页面"></a>跳转到新页面</h2><p>打开 <code>templates/department/index.html</code> 文件, 编辑部分代码实现到 <code>新增</code>、<code>修改</code>等功能的<code>跳转</code>, 代码如以下所示:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;部门管理&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;my-2 d-flex&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span>组织构架<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>          </span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-success&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;create&#x27; %&#125;&quot;</span>&gt;</span>新增<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-hover&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>类别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>所属<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            &#123;% for item in departments %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;text-decoration-none&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;detail&#x27; item.id %&#125;&quot;</span>&gt;</span></span><br><span class="line">                            &#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        &#123;% if item.type == &#x27;department&#x27; %&#125;</span><br><span class="line">                            部门</span><br><span class="line">                        &#123;% else %&#125;</span><br><span class="line">                            公司</span><br><span class="line">                        &#123;% endif %&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.parent.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;120px&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-primary&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;update&#x27; item.id %&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-danger&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;delete&#x27; item.id %&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>修改说明:  在表格右上解添加了一个按钮外观的 <code>新增</code> 超链接; 表格行右边的两个按钮也修改为 <code>超链接</code></p></blockquote><blockquote><p><code>&#123;% url 'create' %&#125;</code>: 此处的 <code>create</code> 表示在 路由表中 <code>urlpatterns</code> 的 <code>name</code> 的值 </p></blockquote><blockquote><p><code>&#123;% url 'update' item.id %&#125;</code>: <code>item.id</code> 为传递到路由的参数</p></blockquote><h2 id="实现新增函数"><a href="#实现新增函数" class="headerlink" title="实现新增函数"></a>实现新增函数</h2><p>打开 <code>department/views.py</code> 文件, 编辑 <code>create</code> 函数的代码如下所示:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        _title = request.POST[<span class="string">&#x27;title&#x27;</span>]  <span class="comment"># 接收表单数据</span></span><br><span class="line">        _<span class="built_in">type</span> = request.POST[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">        _description = request.POST[<span class="string">&#x27;description&#x27;</span>]</span><br><span class="line">        _parentId = request.POST[<span class="string">&#x27;parent&#x27;</span>]</span><br><span class="line">        <span class="comment"># 查找是否已经存在同名部门</span></span><br><span class="line">        dep = Department.objects.<span class="built_in">filter</span>(title=_title)</span><br><span class="line">        <span class="keyword">if</span> dep:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># &#x27;------&#x27; 与表单中对应下拉框的第一个值要相同</span></span><br><span class="line">            <span class="keyword">if</span> _parentId == <span class="string">&#x27;------&#x27;</span>:</span><br><span class="line">                _parent = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 根据id 找出对应的部门</span></span><br><span class="line">                _parent = Department.objects.<span class="built_in">filter</span>(pk=_parentId).first()</span><br><span class="line">            <span class="comment"># 添加 新 记录</span></span><br><span class="line">            Department.objects.create(</span><br><span class="line">                title=_title,</span><br><span class="line">                <span class="built_in">type</span>=_<span class="built_in">type</span>,</span><br><span class="line">                description=_description,</span><br><span class="line">                parent=_parent)</span><br><span class="line">        <span class="keyword">return</span> redirect(index)  <span class="comment"># 重定向</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        departments = Department.objects.<span class="built_in">all</span>()  <span class="comment"># 查询已有的全部部门</span></span><br><span class="line">        <span class="comment"># 显示新增页面(新增和修改使用同一个页面)</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>, &#123;<span class="string">&#x27;departments&#x27;</span>: departments&#125;)</span><br></pre></td></tr></table></figure><h2 id="实现新增界面"><a href="#实现新增界面" class="headerlink" title="实现新增界面"></a>实现新增界面</h2><p>打开 <code>templates/department/edit.html</code> 文件, 编辑代码如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;组织构架&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>新增组织构架<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;row justify-content-md-center&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;parent&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>上级部门<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-select&quot;</span> <span class="attr">name</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span>&gt;</span>------<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    &#123;% for item in departments %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">option</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; item.id &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                                &#123;% <span class="attr">if</span> <span class="attr">item.title</span> == <span class="string">department.parent.title</span> %&#125;</span></span><br><span class="line"><span class="tag">                                <span class="attr">selected</span></span></span><br><span class="line"><span class="tag">                                &#123;% <span class="attr">endif</span> %&#125;</span></span><br><span class="line"><span class="tag">                        &gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">placeholder</span>=<span class="string">&quot;输入名称&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; department.title &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;type&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>类型<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-select&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;department&quot;</span></span></span><br><span class="line"><span class="tag">                            &#123;% <span class="attr">if</span> <span class="attr">department.type</span> == <span class="string">&#x27;deprtment&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;</span></span><br><span class="line"><span class="tag">                    &gt;</span>部门</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;firm&quot;</span></span></span><br><span class="line"><span class="tag">                            &#123;% <span class="attr">if</span> <span class="attr">department.type</span> == <span class="string">&#x27;firm&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;</span></span><br><span class="line"><span class="tag">                    &gt;</span>公司</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;description&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">&quot;3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span></span></span><br><span class="line"><span class="tag">                          <span class="attr">placeholder</span>=<span class="string">&quot;说明&quot;</span>&gt;</span>&#123;&#123; department.description &#125;&#125;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8 d-flex flex-row-reverse&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-success&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>表单中 <code>name</code> 属性的值要与接收数据的函数 <code>request.POST[&#39;title&#39;]</code> 中的名字(例如这里的 <code>title</code>)相同</p></blockquote><h2 id="运行、预览"><a href="#运行、预览" class="headerlink" title="运行、预览"></a>运行、预览</h2><p>启动项目, 点击跳转到 <code>新增</code> 页面, 输入新部门数据</p><img src="/2022/07/04/create-an-app-in-django-004/001.png" class="" title="new"><p>点 <code>保存</code> 按钮后, 添加数据成功, 重定向到部门列表</p><img src="/2022/07/04/create-an-app-in-django-004/002.png" class="" title="list"><h1 id="使用表单类"><a href="#使用表单类" class="headerlink" title="使用表单类"></a>使用表单类</h1><p>自定义的表单没有数据验证功能, 在实现开发时可以使用 <code>Django Forms API</code> 来增强表单的功能</p><p><code>Django</code> 使用两种类型的 <code>form</code>：<code>forms.Form</code> 和 <code>forms.ModelForm</code>。<code>Form</code> 类是通用的表单实现。我们可以使用它来处理与应用程序 <code>model</code> 没有直接关联的数据。<code>ModelForm</code> 是 <code>Form</code> 的子类，它与 <code>model</code> 类相关联。</p><h2 id="添加表单类"><a href="#添加表单类" class="headerlink" title="添加表单类"></a>添加表单类</h2><p>在 <code>users</code> 文件夹新建名为 <code>forms.py</code> 的文件, 编辑其内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Department</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DepartmentUpdateForm</span>(forms.ModelForm):</span><br><span class="line">    parent = forms.ModelChoiceField(</span><br><span class="line">        label=<span class="string">&#x27;上级部门&#x27;</span>,</span><br><span class="line">        required=<span class="literal">False</span>,</span><br><span class="line">        queryset=Department.objects.<span class="built_in">all</span>(),</span><br><span class="line">        widget=forms.Select(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-select&#x27;</span>&#125;)</span><br><span class="line">    )</span><br><span class="line">    title = forms.CharField(</span><br><span class="line">        label=<span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">        max_length=<span class="number">60</span>,</span><br><span class="line">        widget=forms.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">type</span> = forms.ChoiceField(</span><br><span class="line">        label=<span class="string">&#x27;类型&#x27;</span>,</span><br><span class="line">        choices=((<span class="string">&#x27;department&#x27;</span>, <span class="string">&#x27;部门&#x27;</span>), (<span class="string">&#x27;firm&#x27;</span>, <span class="string">&#x27;公司&#x27;</span>)),</span><br><span class="line">        widget=forms.Select(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-select&#x27;</span>&#125;),</span><br><span class="line">    )</span><br><span class="line">    description = forms.CharField(</span><br><span class="line">        label=<span class="string">&#x27;描述&#x27;</span>,</span><br><span class="line">        required=<span class="literal">False</span>,</span><br><span class="line">        max_length=<span class="number">200</span>,</span><br><span class="line">        widget=forms.Textarea(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>, <span class="string">&#x27;rows&#x27;</span>: <span class="number">3</span>&#125;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Department</span><br><span class="line">        fields = [<span class="string">&#x27;parent&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;description&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><code>forms.ModelChoiceField</code>: 用于对 <code>models</code>里 <code>Forekey</code>(外键字段) 进行渲染的下拉框</p></blockquote><blockquote><p><code>forms.CharField</code>: 渲染为输入框, 属性 <code>widget=forms.TextInput</code>表示单行文本框; <code>widget=forms.Textarea()</code> 表示多行文本框</p></blockquote><blockquote><p><code>forms.ChoiceField</code>: 可以渲染为 <code>单选框</code>(widget&#x3D;forms.RadioSelect()), 或 <code>下拉框</code>(widget&#x3D;forms.Select())</p></blockquote><blockquote><p><code>required=False</code>: 是否为必填项</p></blockquote><blockquote><p><code>attrs=&#123;&#39;class&#39;: &#39;form-control&#39;, &#39;rows&#39;: 3&#125;</code>: 用于给渲染出来的表单控件添加属性, <code>&#39;class&#39;: &#39;form-control&#39;</code> 为添加CSS, <code>&#39;rows&#39;: 3</code>为指定文本框的行数</p></blockquote><h2 id="修改新增部门的视图函数"><a href="#修改新增部门的视图函数" class="headerlink" title="修改新增部门的视图函数"></a>修改新增部门的视图函数</h2><p>打开  <code>department/views.py</code>文件, 修改 <code>create</code> 函数如以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        form = DepartmentUpdateForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            <span class="comment"># form.cleaned_data 为表单接收到的数据</span></span><br><span class="line">            cd = form.cleaned_data</span><br><span class="line">            Department.objects.create(</span><br><span class="line">                title=cd[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">                <span class="built_in">type</span>=cd[<span class="string">&#x27;type&#x27;</span>],</span><br><span class="line">                description=cd[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                parent=cd[<span class="string">&#x27;parent&#x27;</span>])</span><br><span class="line">            <span class="keyword">return</span> redirect(index)  <span class="comment"># 重定向</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error_msg = <span class="string">&#x27;新增部门出现异常&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = DepartmentUpdateForm()</span><br><span class="line">        <span class="comment"># departments = Department.objects.all()  # 查询已有的全部部门</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure><h2 id="修改新增界面"><a href="#修改新增界面" class="headerlink" title="修改新增界面"></a>修改新增界面</h2><p>打开 <code>templates/department/edit.html</code> 文件, 修改内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;组织构架&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">            &#123;% if form.title.value  %&#125;</span><br><span class="line">                修改组织构架</span><br><span class="line">           &#123;% else %&#125;</span><br><span class="line">                新增组织构架</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;row justify-content-md-center&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-danger text-center&quot;</span>&gt;</span> &#123;&#123; error_msg &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;parent&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>上级部门<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; form.parent &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; form.title &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;type&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>类型<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; form.type &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;description&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; form.description &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8 d-flex flex-row-reverse&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-success&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="运行、预览-1"><a href="#运行、预览-1" class="headerlink" title="运行、预览"></a>运行、预览</h2><p>再次点击跳转到 <code>新增</code> 页面, 输入新部门数据</p><img src="/2022/07/04/create-an-app-in-django-004/003.png" class="" title="new"><p>点 <code>保存</code> 按钮后, 添加数据成功, 重定向到部门列表</p><img src="/2022/07/04/create-an-app-in-django-004/004.png" class="" title="list"><h2 id="实现修改功能"><a href="#实现修改功能" class="headerlink" title="实现修改功能"></a>实现修改功能</h2><p>打开 <code>department/views.py</code>文件, 修改 <code>update</code> 函数如以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 查找对应id的数据</span></span><br><span class="line">        department = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">        form = DepartmentUpdateForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            cd = form.cleaned_data</span><br><span class="line">            department.title = cd[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">            department.<span class="built_in">type</span> = cd[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">            department.description = cd[<span class="string">&#x27;description&#x27;</span>]</span><br><span class="line">            department.parent = cd[<span class="string">&#x27;parent&#x27;</span>]</span><br><span class="line">            department.save()</span><br><span class="line">        <span class="keyword">return</span> redirect(index)  <span class="comment"># 重定向</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">        form = DepartmentUpdateForm(initial=&#123;</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>: data.title,</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>: data.<span class="built_in">type</span>,</span><br><span class="line">            <span class="string">&#x27;description&#x27;</span>: data.description,</span><br><span class="line">            <span class="string">&#x27;parent&#x27;</span>: data.parent</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure><blockquote><p><code>新增</code> 和 <code>修改</code> 使用同一个模板文件, 模板中的 <code>&lt;form&gt;&lt;/form&gt;</code> 标签不设置 <code>action</code> 属性, 当点击提交按钮时, 数据会回传到 <code>启动该模板</code> 的函数.</p></blockquote><h2 id="删除组织构架"><a href="#删除组织构架" class="headerlink" title="删除组织构架"></a>删除组织构架</h2><p>打开 <code>department/views.py</code>文件, 修改 <code>delete</code> 函数如以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        data = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;department/delete.html&#x27;</span>, &#123;<span class="string">&#x27;department&#x27;</span>: data&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">        data.delete()</span><br><span class="line">        <span class="keyword">return</span> redirect(index)</span><br></pre></td></tr></table></figure><p>打开 <code>templates/department/delete.html</code> 文件, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;组织构架&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>删除记录<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;row justify-content-md-center&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; department.id &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;parent&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>上级部门:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; department.parent &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>名称:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; department.title &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;type&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>类型:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;% if item.type == &#x27;department&#x27; %&#125;</span><br><span class="line">                    部门</span><br><span class="line">                &#123;% else %&#125;</span><br><span class="line">                    公司</span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;description&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>描述:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; department.description &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8 d-flex flex-row-reverse&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-danger&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-success mx-2&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;index&#x27; %&#125;&quot;</span>&gt;</span>放弃<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>进入删除页面</p><img src="/2022/07/04/create-an-app-in-django-004/005.png" class="" title="delete"><h2 id="查看详细内容"><a href="#查看详细内容" class="headerlink" title="查看详细内容"></a>查看详细内容</h2><p>打开 <code>department/views.py</code>文件, 修改 <code>detail</code> 函数如以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">detail</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    data = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/detail.html&#x27;</span>, &#123;<span class="string">&#x27;department&#x27;</span>: data&#125;)</span><br></pre></td></tr></table></figure><p>打开 <code>templates/department/detail.html</code> 文件, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;组织构架&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>详细信息<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row justify-content-md-center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;parent&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>上级部门:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; department.parent &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>名称:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; department.title &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;type&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>类型:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;% if item.type == &#x27;department&#x27; %&#125;</span><br><span class="line">                    部门</span><br><span class="line">                &#123;% else %&#125;</span><br><span class="line">                    公司</span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;description&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>描述:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                &#123;&#123; department.description &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3 col-md-8 d-flex flex-row-reverse&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-primary mx-2&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;update&#x27; department.id %&#125;&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-success mx-2&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;index&#x27; %&#125;&quot;</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><p>在组织架构列表点击 <code>名称</code> 进入详细内容页</p><img src="/2022/07/04/create-an-app-in-django-004/007.png" class="" title="detail"><h1 id="分页功能"><a href="#分页功能" class="headerlink" title="分页功能"></a>分页功能</h1><p>打开 <code>department/views.py</code>文件, 编辑 <code>index</code> 函数的代码如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    分页查询时URL格式：/department/?page=1&amp;limit=10</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    page = request.GET.get(<span class="string">&#x27;page&#x27;</span>)  <span class="comment"># 当前页码, 缺少时为第1页</span></span><br><span class="line">    limit = request.GET.get(<span class="string">&#x27;limit&#x27;</span>)  <span class="comment"># 每页大小</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> limit:</span><br><span class="line">        limit = <span class="number">2</span>   <span class="comment"># 设置没有 limit 参数时每页的大小, 2 是为了方便测试</span></span><br><span class="line">    department_list = Department.objects.<span class="built_in">all</span>()</span><br><span class="line">    paginator = Paginator(department_list, limit)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        current_page = paginator.page(page)</span><br><span class="line">        departments = current_page.object_list</span><br><span class="line">    <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">        current_page = paginator.page(<span class="number">1</span>)</span><br><span class="line">        departments = current_page.object_list</span><br><span class="line">    <span class="keyword">except</span> EmptyPage:</span><br><span class="line">        current_page = paginator.page(paginator.num_pages)</span><br><span class="line">        departments = current_page.object_list</span><br><span class="line">    <span class="comment"># 调用并传递数据到指定的模板文件</span></span><br><span class="line">    <span class="comment"># return render(request, &#x27;department/index.html&#x27;, &#123;&#x27;departments&#x27;: departments&#125;)</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/index.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure><blockquote><p><code>locals()</code>: 返回一个包含 <code>当前作用域</code> 里面的所有变量和它们的值的字典</p></blockquote><p>打开 <code>templates/department/index.html</code> 文件, 在 <code>&lt;/table&gt;</code> 标签后加入 <code>Bootstrap5 分页组件</code>, 代码如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span><br><span class="line">    &#123;# current_page 为视图中使用的变量名 #&#125;</span><br><span class="line">    &#123;% if current_page.has_previous %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">href</span>=<span class="string">&quot;/department/?page=&#123;&#123; current_page.previous_page_number &#125;&#125;&quot;</span>&gt;</span>前一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item disabled&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>前一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &#123;% for item in paginator.page_range %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">href</span>=<span class="string">&quot;/department/?page=&#123;&#123; item &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    &#123;% if current_page.has_next %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">href</span>=<span class="string">&quot;/department/?page=&#123;&#123; current_page.next_page_number &#125;&#125;&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item disabled&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>分页效果预览</p><img src="/2022/07/04/create-an-app-in-django-004/008.png" class="" title="pagination"><h1 id="完整代码参考"><a href="#完整代码参考" class="headerlink" title="完整代码参考"></a>完整代码参考</h1><h2 id="视图文件代码"><a href="#视图文件代码" class="headerlink" title="视图文件代码"></a>视图文件代码</h2><p><code>department/views.py</code>文件的完整代码如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect, get_object_or_404</span><br><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Department  <span class="comment"># 添加模型类的导入</span></span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> DepartmentUpdateForm</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/department/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    分页查询时URL格式：/department/?page=1&amp;limit=10</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    page = request.GET.get(<span class="string">&#x27;page&#x27;</span>)  <span class="comment"># 当前页码, 缺少时为第1页</span></span><br><span class="line">    limit = request.GET.get(<span class="string">&#x27;limit&#x27;</span>)  <span class="comment"># 每页大小</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> limit:</span><br><span class="line">        limit = <span class="number">10</span>  <span class="comment"># 设置没有 limit 参数时每页的大小, 2 是为了方便测试</span></span><br><span class="line">    department_list = Department.objects.<span class="built_in">all</span>()</span><br><span class="line">    paginator = Paginator(department_list, limit)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        current_page = paginator.page(page)</span><br><span class="line">        departments = current_page.object_list</span><br><span class="line">    <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">        current_page = paginator.page(<span class="number">1</span>)</span><br><span class="line">        departments = current_page.object_list</span><br><span class="line">    <span class="keyword">except</span> EmptyPage:</span><br><span class="line">        current_page = paginator.page(paginator.num_pages)</span><br><span class="line">        departments = current_page.object_list</span><br><span class="line">    <span class="comment"># 调用并传递数据到指定的模板文件</span></span><br><span class="line">    <span class="comment"># return render(request, &#x27;department/index.html&#x27;, &#123;&#x27;departments&#x27;: departments&#125;)</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/index.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def create(request):</span></span><br><span class="line"><span class="comment">#     if request.method == &#x27;POST&#x27;:</span></span><br><span class="line"><span class="comment">#         _title = request.POST[&#x27;title&#x27;]  # 接收表单数据</span></span><br><span class="line"><span class="comment">#         _type = request.POST[&#x27;type&#x27;]</span></span><br><span class="line"><span class="comment">#         _description = request.POST[&#x27;description&#x27;]</span></span><br><span class="line"><span class="comment">#         _parentId = request.POST[&#x27;parent&#x27;]</span></span><br><span class="line"><span class="comment">#         # 查找是否已经存在同名部门</span></span><br><span class="line"><span class="comment">#         dep = Department.objects.filter(title=_title)</span></span><br><span class="line"><span class="comment">#         if dep:</span></span><br><span class="line"><span class="comment">#             pass</span></span><br><span class="line"><span class="comment">#         else:</span></span><br><span class="line"><span class="comment">#             # &#x27;------&#x27; 与表单中对应下拉框的第一个值要相同</span></span><br><span class="line"><span class="comment">#             if _parentId == &#x27;------&#x27;:</span></span><br><span class="line"><span class="comment">#                 _parent = None</span></span><br><span class="line"><span class="comment">#             else:</span></span><br><span class="line"><span class="comment">#                 # 根据id 找出对应的部门</span></span><br><span class="line"><span class="comment">#                 _parent = Department.objects.filter(pk=_parentId).first()</span></span><br><span class="line"><span class="comment">#             # 添加 新 记录</span></span><br><span class="line"><span class="comment">#             Department.objects.create(</span></span><br><span class="line"><span class="comment">#                 title=_title,</span></span><br><span class="line"><span class="comment">#                 type=_type,</span></span><br><span class="line"><span class="comment">#                 description=_description,</span></span><br><span class="line"><span class="comment">#                 parent=_parent)</span></span><br><span class="line"><span class="comment">#         return redirect(index)  # 重定向</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         departments = Department.objects.all()  # 查询已有的全部部门</span></span><br><span class="line"><span class="comment">#         # 显示新增页面(新增和修改使用同一个页面)</span></span><br><span class="line"><span class="comment">#         return render(request, &#x27;department/edit.html&#x27;, &#123;&#x27;departments&#x27;: departments&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required(<span class="params">login_url=<span class="string">&#x27;/login/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        form = DepartmentUpdateForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            <span class="comment"># form.cleaned_data 为表单接收到的数据</span></span><br><span class="line">            cd = form.cleaned_data</span><br><span class="line">            Department.objects.create(</span><br><span class="line">                title=cd[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">                <span class="built_in">type</span>=cd[<span class="string">&#x27;type&#x27;</span>],</span><br><span class="line">                description=cd[<span class="string">&#x27;description&#x27;</span>],</span><br><span class="line">                parent=cd[<span class="string">&#x27;parent&#x27;</span>])</span><br><span class="line">            <span class="keyword">return</span> redirect(index)  <span class="comment"># 重定向</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error_msg = <span class="string">&#x27;新增部门出现异常&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = DepartmentUpdateForm()</span><br><span class="line">        <span class="comment"># departments = Department.objects.all()  # 查询已有的全部部门</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required(<span class="params">login_url=<span class="string">&#x27;/login/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 查找对应id的数据</span></span><br><span class="line">        department = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">        form = DepartmentUpdateForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            cd = form.cleaned_data</span><br><span class="line">            department.title = cd[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">            department.<span class="built_in">type</span> = cd[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">            department.description = cd[<span class="string">&#x27;description&#x27;</span>]</span><br><span class="line">            department.parent = cd[<span class="string">&#x27;parent&#x27;</span>]</span><br><span class="line">            department.save()</span><br><span class="line">        <span class="keyword">return</span> redirect(index)  <span class="comment"># 重定向</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">        form = DepartmentUpdateForm(initial=&#123;</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>: data.title,</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>: data.<span class="built_in">type</span>,</span><br><span class="line">            <span class="string">&#x27;description&#x27;</span>: data.description,</span><br><span class="line">            <span class="string">&#x27;parent&#x27;</span>: data.parent</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;department/edit.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required(<span class="params">login_url=<span class="string">&#x27;/login/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        data = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;department/delete.html&#x27;</span>, &#123;<span class="string">&#x27;department&#x27;</span>: data&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">        data.delete()</span><br><span class="line">        <span class="keyword">return</span> redirect(index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detail</span>(<span class="params">request, dep_id</span>):</span><br><span class="line">    data = get_object_or_404(Department, pk=dep_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/detail.html&#x27;</span>, &#123;<span class="string">&#x27;department&#x27;</span>: data&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="模板文件代码"><a href="#模板文件代码" class="headerlink" title="模板文件代码"></a>模板文件代码</h2><p><code>templates/department/index.html</code> 文件的完整代码如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;组织构架&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;my-2 d-flex&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span>组织构架<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>          </span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-success&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;create&#x27; %&#125;&quot;</span>&gt;</span>新增<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-hover&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>类别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>所属<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            &#123;% for item in departments %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;align-middle&quot;</span>&gt;</span>&#123;&#123; item.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;align-middle&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;text-decoration-none&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;detail&#x27; item.id %&#125;&quot;</span>&gt;</span></span><br><span class="line">                            &#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;align-middle&quot;</span>&gt;</span></span><br><span class="line">                        &#123;#   get_type_display: 显示 type 字段的 choices 的名字 #&#125;</span><br><span class="line">                        &#123;&#123; item.get_type_display &#125;&#125;</span><br><span class="line">                        &#123;#                        &#123;% if item.type == &#x27;department&#x27; %&#125;#&#125;</span><br><span class="line">                        &#123;#                            部门#&#125;</span><br><span class="line">                        &#123;#                        &#123;% else %&#125;#&#125;</span><br><span class="line">                        &#123;#                            公司#&#125;</span><br><span class="line">                        &#123;#                        &#123;% endif %&#125;#&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;align-middle&quot;</span>&gt;</span>&#123;&#123; item.parent.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;align-middle&quot;</span> <span class="attr">width</span>=<span class="string">&quot;120px&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-primary&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;update&#x27; item.id %&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-danger&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;delete&#x27; item.id %&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span><br><span class="line">            &#123;# current_page 为视图中使用的变量名 #&#125;</span><br><span class="line">            &#123;% if current_page.has_previous %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">href</span>=<span class="string">&quot;/department/?page=&#123;&#123; current_page.previous_page_number &#125;&#125;&quot;</span>&gt;</span>前一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item disabled&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>前一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            &#123;% for item in paginator.page_range %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">href</span>=<span class="string">&quot;/department/?page=&#123;&#123; item &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            &#123;% if current_page.has_next %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">href</span>=<span class="string">&quot;/department/?page=&#123;&#123; current_page.next_page_number &#125;&#125;&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item disabled&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h1><ol><li><p><a href="https://www.bookstack.cn/read/Django-4.0-zh/fe6cf677b8556466.md">Django v4.0 中文文档</a></p></li><li><p><a href="https://www.bookstack.cn/read/django-beginners-guide-zh/README.md">Django入门与实践教程</a></p></li><li><p><a href="https://www.bootstrap.cn/doc/book/2.html">Bootstrap5 中文手册</a></p></li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 框架开发实战 003 - 使用模板和静态文件</title>
      <link href="/2022/07/03/create-an-app-in-django-003/"/>
      <url>/2022/07/03/create-an-app-in-django-003/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 10 Enterprise LTSC [Version 10.0.19044.1586], locale zh-CN</p></li><li><p>Python 3.8.10</p></li><li><p>PyCharm 2021.2 (Professional Edition)</p></li><li><p>Visual Studio Code, 64-bit edition (version 1.67.2)</p></li></ul><hr><h1 id="使用模板-Template"><a href="#使用模板-Template" class="headerlink" title="使用模板(Template)"></a>使用模板(Template)</h1><p>在 <code>Django</code> 框架中，<code>模板</code> 是可以帮助开发者快速生成呈现给用户页面的工具。用于编写 <code>html</code> 代码，还可以嵌入模板代码转换更方便的完成页面开发，再通过在视图中 <code>渲染</code> 模板，将生成模板的设计实现了 <code>业务逻辑视图 </code>与 <code>显示内容模板</code> 的分离，一个视图可以使用任意一个模板，一个模板可以供多个视图使用。 我们可以轻松地将 <code>Bootstrap 5</code> 或其他前端组件框架添加到项目中, 更快地编写出漂亮的前端界面。</p><blockquote><p><code>当前显示的页面</code> &#x3D; <code>模板</code> + <code>数据</code>,  </p></blockquote><p>模板分为两部分： </p><ul><li><p><code>静态页面</code>：主要包括了CSS，HTML，JS，图片</p></li><li><p><code>动态填充</code>：主要是通过模板语言去动态的产生一些页面上的内容</p></li></ul><h2 id="添加模板文件"><a href="#添加模板文件" class="headerlink" title="添加模板文件"></a>添加模板文件</h2><p>在项目的 <code>templates</code> 文件夹添加名为 <code>index.html</code> HTML文件, 打开 <code>templates/index.html</code> 文件, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>组织构架<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>组织构架<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% for item in departments %&#125;</span><br><span class="line">    &#123;&#123; item.title &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="修改视图文件"><a href="#修改视图文件" class="headerlink" title="修改视图文件"></a>修改视图文件</h2><p>打开 <code>users/views.py</code> 文件, 编辑内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Department  <span class="comment"># 添加模型类的导入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    浏览器URL为 http://127.0.0.1:8000 时, 跳转到  http://127.0.0.1:8000/department/</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/department/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 查询所有数据(可以在之前默认后台中多添加几个组织构架数据用于显示)</span></span><br><span class="line">    departments = Department.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="comment"># 调用并传递数据到指定的模板文件</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index.html&#x27;</span>, &#123;<span class="string">&#x27;departments&#x27;</span>: departments&#125;)</span><br></pre></td></tr></table></figure><h2 id="编辑项目的路由-自动跳转到当前应用"><a href="#编辑项目的路由-自动跳转到当前应用" class="headerlink" title="编辑项目的路由, 自动跳转到当前应用"></a>编辑项目的路由, 自动跳转到当前应用</h2><p>打开 <code>myproject/urls.py</code> 文件, 编辑代码如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include  <span class="comment"># 添加 include 的导入</span></span><br><span class="line"><span class="keyword">import</span> department.views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 没有加路径时进行跳转</span></span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, users.views.home, name=<span class="string">&#x27;home&#x27;</span>),</span><br><span class="line">    <span class="comment"># 添加应用的urls, department.urls: 子应用的urls 文件路径</span></span><br><span class="line">    path(<span class="string">&#x27;department/&#x27;</span>, include(<span class="string">&#x27;department.urls&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="查看模板的显示结果"><a href="#查看模板的显示结果" class="headerlink" title="查看模板的显示结果"></a>查看模板的显示结果</h2><p>在浏览器中打开URL：<code>http://127.0.0.1:8000</code>, 会自动跳转到 <code>http://127.0.0.1:8000/department/</code></p><img src="/2022/07/03/create-an-app-in-django-003/001.png" class="" title="data"><h1 id="使用静态文件"><a href="#使用静态文件" class="headerlink" title="使用静态文件"></a>使用静态文件</h1><p><code>静态文件</code> 是指 <code>CSS</code>，<code>JavaScript</code>，<code>字体</code>，<code>图片</code>或者是用来组成用户界面的任何其他资源。</p><p>实际上，<code>Django</code> 本身是不负责处理这些文件的，但是为了让我们的开发过程更轻松，<code>Django</code> 提供了一些功能来帮助我们管理静态文件。</p><h2 id="添加静态文件夹"><a href="#添加静态文件夹" class="headerlink" title="添加静态文件夹"></a>添加静态文件夹</h2><p>在项目根目录创建名为 <code>static</code> 的文件夹, 下载相应的资源文件后解压, 并将其中的文件复制到 <code>static</code> 文件夹中。</p><p><code>资源文件下载</code>: <a href="https://hujiyi.github.io/2022/07/03/create-an-app-in-django-003/assets.zip">https://hujiyi.github.io/2022/07/03/create-an-app-in-django-003/assets.zip</a></p><p>以上资源文件包含:</p><ul><li><code>Bootstrap 5</code>: 流行的前端开源工具包;</li><li><code>poper.js</code>: <code>Bootstrap5</code> 依赖的 <code>JavaScript</code> 库;</li><li><code>favicon.ico</code>: 网站图标。</li></ul><p>解压后的文件夹结构如下图所示:</p><img src="/2022/07/03/create-an-app-in-django-003/002.png" class="" title="static"><h2 id="在模板中使用静态文件"><a href="#在模板中使用静态文件" class="headerlink" title="在模板中使用静态文件"></a>在模板中使用静态文件</h2><h3 id="添加静态文件夹配置"><a href="#添加静态文件夹配置" class="headerlink" title="添加静态文件夹配置"></a>添加静态文件夹配置</h3><p>打开  <code>myproject/settings.py</code> 文件, 找到 <code>STATIC_URL</code> 变量, 在其下方添加配置:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 静态文件夹</span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    BASE_DIR / &quot;static&quot;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>如下图所示：</p><img src="/2022/07/03/create-an-app-in-django-003/003.png" class="" title="static"><h3 id="使用静态文件-1"><a href="#使用静态文件-1" class="headerlink" title="使用静态文件"></a>使用静态文件</h3><p>打开 <code>templates/index.html</code> 文件, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/favicon.ico&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;/static/bootstrap-5.1.3-dist/css/bootstrap.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>组织构架<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>组织构架<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span><br><span class="line">        &#123;% for item in departments %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span> &#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/poper/popper.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/bootstrap-5.1.3-dist/js/bootstrap.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="结果预览"><a href="#结果预览" class="headerlink" title="结果预览"></a>结果预览</h3><img src="/2022/07/03/create-an-app-in-django-003/004.png" class="" title="static"><h1 id="基于-Bootstrap5-的整体布局"><a href="#基于-Bootstrap5-的整体布局" class="headerlink" title="基于 Bootstrap5 的整体布局"></a>基于 Bootstrap5 的整体布局</h1><h2 id="创建布局模板母版页"><a href="#创建布局模板母版页" class="headerlink" title="创建布局模板母版页"></a>创建布局模板母版页</h2><p>在项目的 <code>templates</code> 文件夹添加名为 <code>layout.html</code> HTML文件, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;favicon.ico&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;bootstrap-5.1.3-dist/css/bootstrap.css&#x27; %&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% block style %&#125;&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex flex-column vh-100&quot;</span>&gt;</span></span><br><span class="line">    &#123;% block content %&#125;</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;poper/popper.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;bootstrap-5.1.3-dist/js/bootstrap.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 用于添加 javascript --&gt;</span></span><br><span class="line">&#123;% block scripts %&#125;&#123;% endblock scripts %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>模板 <code>最前面</code> 使用了 Static Files App 模板标签 <code>&#123;% load static %&#125;</code>, 加载 <code>静态文件</code> 变量</p></blockquote><blockquote><p>模板标签 <code>&#123;% static %&#125;</code> 用于构成资源文件完整URL, <code>&#123;% static 'bootstrap-5.1.3-dist/css/bootstrap.css' %&#125;</code> 将返回 <code>/static/bootstrap-5.1.3-dist/css/bootstrap.css</code>, 完整的路径相当于 <code>http://127.0.0.1:8000/static/bootstrap-5.1.3-dist/css/bootstrap.css</code></p></blockquote><blockquote><p><code>&#123;% static %&#125;</code>模板标签使用 <code>myproject/settings.py</code> 文件中的 <code>STATIC_URL</code> 配置来组成最终的 <code>URL</code></p></blockquote><blockquote><p><code>&#123;% block <名字> %&#125;    &#123;% endblock %&#125;</code>  用于在模板中保留一个空间，一个”子”模板(继承这个母版页的模板)可以在这个空间中插入代码和 HTML; 上面的模板文件中共定义了四个保留空间,  <code>content</code>、<code>title</code>、<code>style</code> 和 <code>scripts</code> 为不同保留空间的名字</p></blockquote><h2 id="添加网站导航栏"><a href="#添加网站导航栏" class="headerlink" title="添加网站导航栏"></a>添加网站导航栏</h2><p>新建HTML文件 <code>templates/nav.html</code>, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导航菜单栏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-expand-sm bg-light mb-4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container d-flex w-100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我的网站<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;flex-grow-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;navbar-nav&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/users/&quot;</span>&gt;</span>组织构架管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>当前用户: <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>注销 <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>参考资料URL: <a href="https://www.bootstrap.cn/doc/read/146.html">https://www.bootstrap.cn/doc/read/146.html</a></p></blockquote><h2 id="添加网站底部内容文件"><a href="#添加网站底部内容文件" class="headerlink" title="添加网站底部内容文件"></a>添加网站底部内容文件</h2><p>新建HTML文件 <code>templates/footer.html</code>, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 网站页脚 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;text-center mt-5 p-3 bg-secondary&quot;</span>&gt;</span> 版权所有<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="继承复用模板"><a href="#继承复用模板" class="headerlink" title="继承复用模板"></a>继承复用模板</h2><p>在项目的  <code>templates</code> 文件夹中新建名为 <code>department</code> 的新文件夹, 将 <code>templates/index.html</code> 移动到 <code>templates/department/</code> 文件夹中。</p><p>打开 <code>移动位置后</code> 的 <code>templates/department/index.html</code> 文件, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;组织构架&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>组织构架<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span><br><span class="line">            &#123;% for item in departments %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span> &#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><blockquote><p>第一行的 <code>&#123;% extends "layout.html" %&#125;</code> 表示要使用 <code>layout.html</code> 作为母版页(<code>继承</code>)</p></blockquote><blockquote><p><code>&#123;% block title %&#125;组织构架&#123;% endblock %&#125;</code> 表示在母版页名字为 <code>title</code> 的保留空间放置内容。<code>&#123;% block content %&#125; &#123;% endblock %&#125;</code>作用相同</p></blockquote><blockquote><p><code>&#123;% include "nav.html" %&#125;</code> 和 <code>&#123;% include "footer.html" %&#125;</code> 表示分别在该位置插入<code>nav.html</code> 和 <code>footer.html</code> 文件中的内容</p></blockquote><h2 id="编辑视图文件"><a href="#编辑视图文件" class="headerlink" title="编辑视图文件"></a>编辑视图文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="comment"># from django.http import HttpResponse</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Department  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):    </span><br><span class="line">    departments = Department.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="comment"># 修改模板文件为: &#x27;departments/index.html&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;department/index.html&#x27;</span>, &#123;<span class="string">&#x27;departments&#x27;</span>: departments&#125;)</span><br></pre></td></tr></table></figure><h2 id="结果预览-1"><a href="#结果预览-1" class="headerlink" title="结果预览"></a>结果预览</h2><img src="/2022/07/03/create-an-app-in-django-003/006.png" class="" title="static"><h2 id="使用表格显示组织构架"><a href="#使用表格显示组织构架" class="headerlink" title="使用表格显示组织构架"></a>使用表格显示组织构架</h2><p>打开 <code>templates/department/index.html</code> 文件, 编辑内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;layout.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;组织构架&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% include &quot;nav.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container flex-grow-1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>组织构架<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-hover&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>类别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>所属<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            &#123;% for item in departments %&#125;            </span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;align-middle&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        &#123;#   get_type_display: 显示 type 字段的 choices 的名字 #&#125;</span><br><span class="line">                        &#123;&#123; item.get_type_display &#125;&#125;</span><br><span class="line">                        &#123;#    &#123;% if item.type == &#x27;department&#x27; %&#125; #&#125;</span><br><span class="line">                        &#123;#       部门 #&#125;</span><br><span class="line">                        &#123;#    &#123;% else %&#125; #&#125;</span><br><span class="line">                        &#123;#       公司 #&#125;</span><br><span class="line">                        &#123;#     &#123;% endif %&#125; #&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; item.parent.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;120px&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-primary&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-outline-danger&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="结果预览-2"><a href="#结果预览-2" class="headerlink" title="结果预览"></a>结果预览</h2><img src="/2022/07/03/create-an-app-in-django-003/005.png" class="" title="static"><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h1><ol><li><p><a href="https://www.bookstack.cn/read/Django-4.0-zh/fe6cf677b8556466.md">Django v4.0 中文文档</a></p></li><li><p><a href="https://www.bookstack.cn/read/django-beginners-guide-zh/README.md">Django入门与实践教程</a></p></li><li><p><a href="https://www.bootstrap.cn/doc/book/2.html">Bootstrap5 中文手册</a></p></li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 框架开发实战 002 - 使用内置的后台管理功能</title>
      <link href="/2022/07/03/create-an-app-in-django-002/"/>
      <url>/2022/07/03/create-an-app-in-django-002/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 10 Enterprise LTSC [Version 10.0.19044.1586], locale zh-CN</p></li><li><p>Python 3.8.10</p></li><li><p>PyCharm 2021.2 (Professional Edition)</p></li><li><p>Visual Studio Code, 64-bit edition (version 1.67.2)</p></li></ul><hr><h1 id="在项目内创建应用"><a href="#在项目内创建应用" class="headerlink" title="在项目内创建应用"></a>在项目内创建应用</h1><p>在项目文件夹中按住键盘的 <code>Shift</code>, 点鼠标 <code>右键</code>, 选择 <code>在此处打开PowerShell窗口</code></p><p>创建应用的命令： <code>python  manage.py startapp &lt;应用名称&gt;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(venv) PS D:\PycharmProjects\myproject&gt; python .\manage.py startapp department</span><br><span class="line">(venv) PS D:\PycharmProjects\myproject&gt;</span><br></pre></td></tr></table></figure><p>添加 <code>users</code> 应用后的项目结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- myproject</span><br><span class="line">   |-- manage.py</span><br><span class="line">   |-- myproject</span><br><span class="line">   |   |-- __init__.py</span><br><span class="line">   |   |-- __pycache__</span><br><span class="line">   |   |-- asgi.py</span><br><span class="line">   |   |-- settings.py</span><br><span class="line">   |   |-- urls.py</span><br><span class="line">   |   `-- wsgi.py</span><br><span class="line">   |-- templates</span><br><span class="line">   |-- department             新创建的应用名称</span><br><span class="line">   |   |-- __init__.py        包初始化文件</span><br><span class="line">   |   |-- admin.py           django内置的应用程序Django Admin的配置文件</span><br><span class="line">   |   |-- apps.py            应用程序本身的配置文件</span><br><span class="line">   |   |-- migrations         数据迁移文件夹</span><br><span class="line">   |   |-- models.py          数据库模型类文件</span><br><span class="line">   |   |-- tests.py           单元测试文件</span><br><span class="line">   |   `-- views.py           视图文件</span><br><span class="line">   `-- venv</span><br></pre></td></tr></table></figure><h1 id="配置项目用于-启用-新创建的应用"><a href="#配置项目用于-启用-新创建的应用" class="headerlink" title="配置项目用于 启用 新创建的应用"></a>配置项目用于 <code>启用</code> 新创建的应用</h1><p>打开 <code>myproject/settings.py</code> 文件, 找到 <code>INSTALLED_APPS</code> 变量, 将新应用添加到 <code>INSTALLED_APPS</code> 变量的应用列表中(以下方法 <code>二选一</code>):</p><ol><li>使用 <code>应用名称</code> 安装应用到项目中</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    &#x27;django.contrib.admin&#x27;,</span><br><span class="line">    &#x27;django.contrib.auth&#x27;,</span><br><span class="line">    &#x27;django.contrib.contenttypes&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions&#x27;,</span><br><span class="line">    &#x27;django.contrib.messages&#x27;,</span><br><span class="line">    &#x27;django.contrib.staticfiles&#x27;,</span><br><span class="line"></span><br><span class="line">    &#x27;department&#x27;,  # 通过 应用名 安装应用, 适用于大多数情况   </span><br><span class="line">]</span><br></pre></td></tr></table></figure><ol start="2"><li>使用 <code>应用的配置文件</code> 安装应用到项目中</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    &#x27;django.contrib.admin&#x27;,</span><br><span class="line">    &#x27;django.contrib.auth&#x27;,</span><br><span class="line">    &#x27;django.contrib.contenttypes&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions&#x27;,</span><br><span class="line">    &#x27;django.contrib.messages&#x27;,</span><br><span class="line">    &#x27;django.contrib.staticfiles&#x27;,</span><br><span class="line">   </span><br><span class="line">    &#x27;department.apps.UsersConfig&#x27;,  # 通过应用的配置文件安装应用, 适用于 新应用有自定义的配置信息</span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>每个 <code>应用(app)</code> 也有自己的 <code>配置信息</code>，放在 <code>apps.py</code> 里的。在大多数情况下，把 <code>app名</code> 直接加入到 <code>INSTALLED_APPS</code> 就足够了。只有当你需要给 <code>app自定义配置</code> 信息时，需要把加入 <code>应用(app)</code> 对应的 <code>AppConfig子类</code> 路径直接加入到 <code>INSTALLED_APPS</code></p></blockquote><blockquote><p>添加到 <code>INSTALLED_APPS</code> 变量列表中的应用才能实现 <code>数据迁移</code></p></blockquote><h1 id="为新应用添加一个视图"><a href="#为新应用添加一个视图" class="headerlink" title="为新应用添加一个视图"></a>为新应用添加一个视图</h1><p>打开 <code>department/views.py</code> 文件, 编辑内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;Hello, World!&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="管理新应用的路由-url"><a href="#管理新应用的路由-url" class="headerlink" title="管理新应用的路由(url)"></a>管理新应用的路由(url)</h2><p>在 <code>department</code> 文件夹添加名为 <code>urls.py</code> 的  <code>Python File</code>, 编辑内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="注册新应用的路由到项目中"><a href="#注册新应用的路由到项目中" class="headerlink" title="注册新应用的路由到项目中"></a>注册新应用的路由到项目中</h2><p>打开 <code>myproject/urls.py</code> 文件, 编辑内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include  <span class="comment"># 添加 include 的导入</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加应用的urls, department.urls: 子应用的 urls.py 文件路径</span></span><br><span class="line">    path(<span class="string">&#x27;department/&#x27;</span>, include(<span class="string">&#x27;department.urls&#x27;</span>)),</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="显示视图的运行结果"><a href="#显示视图的运行结果" class="headerlink" title="显示视图的运行结果"></a>显示视图的运行结果</h2><p>在浏览器的地址栏输入URL: <a href="http://127.0.0.1:8000/department/">http://127.0.0.1:8000/department/</a></p><img src="/2022/07/03/create-an-app-in-django-002/001.png" class="" title="show"><h1 id="使用模型-Model"><a href="#使用模型-Model" class="headerlink" title="使用模型(Model)"></a>使用模型(<code>Model</code>)</h1><p><code>Django</code> 通过内置的 <code>ORM</code> 实现对数据库的操作, 每个模型类对应于数据库中的一个表</p><h2 id="定义-组织结构-模型类"><a href="#定义-组织结构-模型类" class="headerlink" title="定义 组织结构 模型类"></a>定义 <code>组织结构</code> 模型类</h2><p>打开 <code>department/models.py</code> 文件, 编辑内容如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Department</span>(models.Model):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    组织架构:用于保存有关联业务的其他公司 或 单位内部的部门信息</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 组织架构选项</span></span><br><span class="line">    type_choices = ((<span class="string">&#x27;firm&#x27;</span>, <span class="string">&#x27;公司&#x27;</span>), (<span class="string">&#x27;department&#x27;</span>, <span class="string">&#x27;部门&#x27;</span>))</span><br><span class="line">    <span class="comment"># max_length: 最大长度; verbose_name: 字段备注名</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">60</span>, verbose_name=<span class="string">&quot;名称&quot;</span>)</span><br><span class="line">    <span class="built_in">type</span> = models.CharField(max_length=<span class="number">20</span>, choices=type_choices,</span><br><span class="line">                            default=<span class="string">&#x27;department&#x27;</span>, verbose_name=<span class="string">&#x27;类型&#x27;</span>)</span><br><span class="line">    <span class="comment"># null=True: 空值时存为null; blank=True: 允许为空;</span></span><br><span class="line">    description = models.CharField(max_length=<span class="number">200</span>, null=<span class="literal">True</span>,</span><br><span class="line">                                   blank=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;描述&#x27;</span>)</span><br><span class="line">    <span class="comment"># ForeignKey: 关联关系; on_delete=models.CASCADE: 级联操作,外键表随主键表更新</span></span><br><span class="line">    parent = models.ForeignKey(<span class="string">&#x27;self&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>,</span><br><span class="line">                               verbose_name=<span class="string">&#x27;上级部门&#x27;</span>, on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = <span class="string">&#x27;组织构架&#x27;</span>  <span class="comment"># 对象的可读名称, 单数</span></span><br><span class="line">        verbose_name_plural = verbose_name  <span class="comment"># 对象的可读名称, 复数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        返回对象的描述信息</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.title</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>所有模型都是<code>django.db.models.Model</code>类的子类。每个类将被转换为 <code>数据库表</code>。每个字段由 <code>django.db.models.Field</code>子类（内置在<code>Django core</code>）的实例表示, 它们并将被转换为<code>数据库的列</code></p></blockquote><blockquote><p>字段 <code>CharField</code>, <code>DateTimeField</code>等，都是 <code>django.db.models.Field</code> 的子类，包含在<code>Django core</code> 里面, 随时可以使用</p></blockquote><blockquote><p><code>CharField</code> 必须设定一个 <code>max_length</code></p></blockquote><blockquote><p><code>ForeignKey</code> 引用它关联的模型(数据库外键), 在新版 <code>Django</code> 中, <code>ForeignKey</code> 必须包含 <code>on_delete</code> 属性</p></blockquote><blockquote><p>不包含 <code>blank=True</code> 属性的为 <code>必填字段</code> </p></blockquote><h2 id="迁移模型"><a href="#迁移模型" class="headerlink" title="迁移模型"></a>迁移模型</h2><p>迁移模型是告诉 <code>Django</code> 通过模型类来创建对应的<code>数据库表</code>, 以便可以使用数据库来存储数据</p><p>到 <code>manage.py</code> 文件所在的文件夹 <code>打开PowerShell窗口</code>, 激活虚拟环境, 执行命令：<code>python manage.py makemigrations</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(venv) PS D:\PycharmProjects\myproject&gt; python .\manage.py makemigrations</span><br><span class="line">Migrations <span class="keyword">for</span> <span class="string">&#x27;department&#x27;</span>:</span><br><span class="line">  department\migrations\0001_initial.py</span><br><span class="line">    - Create model Structure</span><br></pre></td></tr></table></figure><p>命令执行完毕后, 会生成文件 <code>department\migrations\0001_initial.py</code>, 它代表了应用程序模型的当前状态</p><h2 id="将生成的迁移文件应用到数据库"><a href="#将生成的迁移文件应用到数据库" class="headerlink" title="将生成的迁移文件应用到数据库"></a>将生成的迁移文件应用到数据库</h2><p>继续执行命令: <code>python manage.py migrate</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(venv) PS D:\PycharmProjects\myproject&gt; python .\manage.py migrate</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, contenttypes, sessions, department</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying contenttypes.0001_initial... OK</span><br><span class="line">  Applying auth.0001_initial... OK</span><br><span class="line">  Applying admin.0001_initial... OK</span><br><span class="line">  Applying admin.0002_logentry_remove_auto_add... OK</span><br><span class="line">  Applying admin.0003_logentry_add_action_flag_choices... OK</span><br><span class="line">  Applying contenttypes.0002_remove_content_type_name... OK</span><br><span class="line">  Applying auth.0002_alter_permission_name_max_length... OK</span><br><span class="line">  Applying auth.0003_alter_user_email_max_length... OK</span><br><span class="line">  Applying auth.0004_alter_user_username_opts... OK</span><br><span class="line">  Applying auth.0005_alter_user_last_login_null... OK</span><br><span class="line">  Applying auth.0006_require_contenttypes_0002... OK</span><br><span class="line">  Applying auth.0007_alter_validators_add_error_messages... OK</span><br><span class="line">  Applying auth.0008_alter_user_username_max_length... OK</span><br><span class="line">  Applying auth.0009_alter_user_last_name_max_length... OK</span><br><span class="line">  Applying auth.0010_alter_group_name_max_length... OK</span><br><span class="line">  Applying auth.0011_update_proxy_permissions... OK</span><br><span class="line">  Applying auth.0012_alter_user_first_name_max_length... OK</span><br><span class="line">  Applying sessions.0001_initial... OK</span><br><span class="line">  Applying department.0001_initial... OK</span><br></pre></td></tr></table></figure><blockquote><p>执行迁移数据库操作的时候, 会处理 <code>INSTALLED_APPS</code> 变量中的所有应用的 <code>模型类</code>, 所以除了上面的自下定义模型, 生成的数据库表也包含了项目自带的其他数据表。而 <code>没有添加</code> 到 <code>INSTALLED_APPS</code> 变量中的应用, 将 <code>不会</code> 被处理。</p></blockquote><h2 id="查看迁移后生成的数据库"><a href="#查看迁移后生成的数据库" class="headerlink" title="查看迁移后生成的数据库"></a>查看迁移后生成的数据库</h2><p>打开 MySQL 数据库客户端, 选择当前项目使用的数据库, 查看生成的数据表, 如下图所示:</p><img src="/2022/07/03/create-an-app-in-django-002/002.png" class="" title="show table"><h2 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h2><p>当模型类修改后，则数据库与模型类不再匹配，此时需要重新执行以下两个命令, 生成修改后的迁移文件以及应用到数据库即可。</p><p><code>python manage.py makemigrations</code></p><p><code>python manage.py migrate</code></p><blockquote><p>如果模型类的修改比较大, 并且数据库中对应的表已经保存的数据, 以上两个命令执行后可能会出现异常, 可以直接在<code>MySQL</code>数据库的 <code>客户端</code> 中删除数据库, 然后重建 <code>同名数据库</code>, 再执行以上两个命令</p></blockquote><h1 id="使用内置的后台管理功能"><a href="#使用内置的后台管理功能" class="headerlink" title="使用内置的后台管理功能"></a>使用内置的后台管理功能</h1><p><code>Django</code> 已经配置了 <code>Django Admin</code>, 添加 <code>超级管理员</code> 用户并配置 <code>Django Admin</code>, 就可以用来维护应用程序了</p><h2 id="创建超级用户"><a href="#创建超级用户" class="headerlink" title="创建超级用户"></a>创建超级用户</h2><p>执行命令： <code>python manage.py createsuperuser</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(venv) PS D:\PycharmProjects\myproject&gt; python .\manage.py createsuperuser</span><br><span class="line">用户名 (leave blank to use <span class="string">&#x27;laohoo&#x27;</span>): admin</span><br><span class="line">电子邮件地址: admin@163.com</span><br><span class="line">Password:</span><br><span class="line">Password (again):</span><br><span class="line">Superuser created successfully.</span><br></pre></td></tr></table></figure><blockquote><p>按命令执行后的提示分别输入<code>用户名</code>, <code>电子邮箱</code>, <code>密码</code> 和 <code>确认密码</code>。 其中 <code>密码</code> 有复杂度的要求</p></blockquote><h2 id="管理员登录"><a href="#管理员登录" class="headerlink" title="管理员登录"></a>管理员登录</h2><p>在浏览器中打开URL：<a href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a></p><img src="/2022/07/03/create-an-app-in-django-002/003.png" class="" title="login"><p>输入<code>用户名</code>和<code>密码</code>登录到<code>管理界面</code></p><img src="/2022/07/03/create-an-app-in-django-002/004.png" class="" title="admin"><h2 id="添加模型到管理界面"><a href="#添加模型到管理界面" class="headerlink" title="添加模型到管理界面"></a>添加模型到管理界面</h2><p>打开 <code>department/admin.py</code> 文件，并添加以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Department</span><br><span class="line"></span><br><span class="line">admin.site.register(Department)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>刷新网页</p><img src="/2022/07/03/create-an-app-in-django-002/005.png" class="" title="admin"><h2 id="添加新的组织架构-部门"><a href="#添加新的组织架构-部门" class="headerlink" title="添加新的组织架构(部门)"></a>添加新的组织架构(部门)</h2><img src="/2022/07/03/create-an-app-in-django-002/006.png" class="" title="add"><p>添加成功</p><img src="/2022/07/03/create-an-app-in-django-002/007.png" class="" title="success"><h2 id="定制后台管理界面"><a href="#定制后台管理界面" class="headerlink" title="定制后台管理界面"></a>定制后台管理界面</h2><p><code>Django</code> 允许对后台管理界面显示的模型数据进行定制</p><ol><li>打开 <code>department/admin.py</code>文件, 修改如下：</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Department</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DepartmentAdmin</span>(admin.ModelAdmin):</span><br><span class="line">    <span class="comment"># 显示的字段名列表</span></span><br><span class="line">    list_display = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;description&#x27;</span>,)</span><br><span class="line">    <span class="comment"># 可过滤的字段名列表</span></span><br><span class="line">    list_filter = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,)</span><br><span class="line">    <span class="comment"># 可搜索的字段名列表</span></span><br><span class="line">    search_fields = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;description&#x27;</span>,)</span><br><span class="line">    <span class="comment"># 启用排序功能的字段</span></span><br><span class="line">    ordering = [<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">admin.site.register(Department, DepartmentAdmin)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>保存文件后，刷新网页，即可看到定制后的管理界面显示效果</li></ol><img src="/2022/07/03/create-an-app-in-django-002/008.png" class="" title="success"><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h1><ol><li><p><a href="https://www.bookstack.cn/read/Django-4.0-zh/fe6cf677b8556466.md">Django v4.0 中文文档</a></p></li><li><p><a href="https://www.bookstack.cn/read/django-beginners-guide-zh/README.md">Django入门与实践教程</a></p></li><li><p><a href="https://www.bootstrap.cn/doc/book/2.html">Bootstrap5 中文手册</a></p></li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 框架开发实战 001 - 创建项目</title>
      <link href="/2022/07/03/create-an-app-in-django-001/"/>
      <url>/2022/07/03/create-an-app-in-django-001/</url>
      
        <content type="html"><![CDATA[<h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 10 Enterprise LTSC [Version 10.0.19044.1586], locale zh-CN</p></li><li><p>Python 3.8.10</p></li><li><p>PyCharm 2021.2 (Professional Edition)</p></li><li><p>Visual Studio Code, 64-bit edition (version 1.67.2)</p></li></ul><hr><h1 id="pip-使用国内镜像源"><a href="#pip-使用国内镜像源" class="headerlink" title="pip 使用国内镜像源"></a><code>pip</code> 使用国内镜像源</h1><p><code>Python</code> 安装第三方包时, 默认的服务器在国外, 安装速度可能会很慢, 可以设置国内的镜像服务器为安装源</p><p>1、执行以下两个命令，设置 <code>全局</code> 使用 <code>国内源</code>（中科大）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip config <span class="built_in">set</span> global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple</span><br><span class="line"></span><br><span class="line">pip config <span class="built_in">set</span> global.trusted-host https://mirrors.ustc.edu.cn/pypi/web/simple</span><br></pre></td></tr></table></figure><p>2、输出（查看）现有的pip源：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip config list</span><br></pre></td></tr></table></figure><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>查看当前电脑已安装 <code>Django</code> 版本的命令: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m django --version</span><br></pre></td></tr></table></figure><p>安装 <code>最新版本</code> 的 <code>Django</code> : </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django</span><br></pre></td></tr></table></figure><p>安装 <code>指定版本</code> 的 <code>Django</code> : </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django==版本号</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django== 2.2.3</span><br></pre></td></tr></table></figure><p><code>卸载</code> 已安装的 <code>Django</code> : </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip uninstall django </span><br></pre></td></tr></table></figure><h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><h2 id="使用命令行创建项目"><a href="#使用命令行创建项目" class="headerlink" title="使用命令行创建项目"></a>使用命令行创建项目</h2><p>命令格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject &lt;项目名称&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>例如:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject mysite</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><code>django-admin</code> 是 <code>Django</code> 提供的 <code>命令行管理工具</code>, 这个工具会在安装 <code>Django</code> 的时候自动安装</p></blockquote><h2 id="在-PyCharm-中创建-Django-项目"><a href="#在-PyCharm-中创建-Django-项目" class="headerlink" title="在 PyCharm 中创建 Django 项目"></a>在 <code>PyCharm</code> 中创建 <code>Django</code> 项目</h2><p>在  <code>PyCharm</code> 菜单中选择 <code>File</code> -&gt; <code>New Project</code>, 在弹出的 <code>新项目</code> 对话框中选择 <code>项目类型</code>、<code>保存位置</code> 等信息, 如下图所示：</p><img src="/2022/07/03/create-an-app-in-django-001/001.png" class="" title="new project"><blockquote><p><code>提示</code>： 在 <code>PyCharm</code> 中创建 <code>Django</code> 项目, 会默认使用 <code>最新</code> 的版本(不会使用电脑中已经安装的旧版 <code>Django</code>), 所以需要创建 <code>指定版本</code> 的 <code>Django</code> 项目时, 建议使用 <code>命令行</code> 的方式创建项目</p></blockquote><h1 id="项目结构说明"><a href="#项目结构说明" class="headerlink" title="项目结构说明"></a>项目结构说明</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- myproject                  项目的容器, 默认与项目名称相同</span><br><span class="line">  |-- manage.py              命令行工具</span><br><span class="line">  |-- myproject              项目文件夹</span><br><span class="line">  |   |-- __init__.py        包的初始化文件</span><br><span class="line">  |   |-- asgi.py            异步的 WSGI 网关</span><br><span class="line">  |   |-- settings.py        项目配置文件</span><br><span class="line">  |   |-- urls.py            项目的路径和路由配置文件</span><br><span class="line">  |   `-- wsgi.py            简单网关接口</span><br><span class="line">  |-- templates              模板文件夹目录</span><br><span class="line">  `-- venv                   虚拟环境目录</span><br></pre></td></tr></table></figure><h1 id="项目的配置"><a href="#项目的配置" class="headerlink" title="项目的配置"></a>项目的配置</h1><h2 id="修改默认-语言-和-时区"><a href="#修改默认-语言-和-时区" class="headerlink" title="修改默认 语言 和 时区"></a>修改默认 <code>语言</code> 和 <code>时区</code></h2><p>打开文件 <code>myproject/settings.py</code>, 找到 <code>LANGUAGE_CODE</code>、<code>TIME_ZONE</code> 和 <code>USE_TZ</code> 并进行修改, 如下图所示：</p><img src="/2022/07/03/create-an-app-in-django-001/002.png" class="" title="time"><h2 id="在项目中使用-MySQL-数据库"><a href="#在项目中使用-MySQL-数据库" class="headerlink" title="在项目中使用 MySQL 数据库"></a>在项目中使用 <code>MySQL</code> 数据库</h2><blockquote><p>在新创建的 <code>Django</code> 项目中, 已经默认配置使用 <code>SQLite</code> 数据库, <code>SQLite</code> 数据库的驱动已经被 <code>Python</code> 集成, 不需要额外安装驱动。可以开发阶段使用该数据库, 部署到生产服务器时再修改为使用其他数据库</p></blockquote><h3 id="安装-MySQL-数据库驱动"><a href="#安装-MySQL-数据库驱动" class="headerlink" title="安装 MySQL 数据库驱动"></a>安装 <code>MySQL</code> 数据库驱动</h3><p>在  <code>PyCharm</code> 菜单中选择 <code>File</code> -&gt; <code>Settings</code>, 在弹出的 <code>Settings</code> 对话框 <code>左侧窗格</code> 中选择 <code>Project: myproject</code>(冒号右侧为项目名称) -&gt; <code>Python Interpreter</code>, 右侧选择 <code>+</code>, 如下图所示：</p><img src="/2022/07/03/create-an-app-in-django-001/003.png" class="" title="settings"><p>在弹出的包管理对话框中输入 <code>MySQL</code> 数据库驱动程序的名称 <code>mysqlclient</code>, 选择并安装包, 如下图所示：</p><img src="/2022/07/03/create-an-app-in-django-001/004.png" class="" title="install package"><p>安装成功后并闭对话框</p><img src="/2022/07/03/create-an-app-in-django-001/005.png" class="" title="install package"><h3 id="使用-MySQL-数据库"><a href="#使用-MySQL-数据库" class="headerlink" title="使用 MySQL 数据库"></a>使用 <code>MySQL</code> 数据库</h3><p>打开文件 <code>myproject/settings.py</code>,  找到 <code>DATABASES</code> 配置项目, 将其注释, 并添加新的数据库配置, 如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,   <span class="comment"># 数据库驱动</span></span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;my_data_labs&#x27;</span>,                 <span class="comment"># 数据库名称</span></span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;localhost&#x27;</span>,                    <span class="comment"># 数据库服务器地址</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,                         <span class="comment"># 数据库登录账号</span></span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,                   <span class="comment"># 数据库登录密码</span></span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span>                          <span class="comment"># 端口号</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2022/07/03/create-an-app-in-django-001/006.png" class="" title="database"><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>打开 <code>MySQL</code> 数据库 <code>客户端</code>, 创建上一步骤 <code>配置文件</code> 中指定的数据库 <code>my_data_labs</code>, 如下图所示:</p><img src="/2022/07/03/create-an-app-in-django-001/007.png" class="" title="create database"><p>如果 <code>没有创建 </code>数据库, 运行时会出现类似以下找不到数据库(<code>Unknown database &#39;my_data_labs&#39;</code>)的的 <code>错误信息</code>:</p><img src="/2022/07/03/create-an-app-in-django-001/008.png" class="" title="error"><h1 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h1><h2 id="在命令行中运行项目"><a href="#在命令行中运行项目" class="headerlink" title="在命令行中运行项目"></a>在命令行中运行项目</h2><p>在 <code>PyCharm</code> 中创建的项目默认启用 <code>虚拟环境</code>, 所以使用命令行方式运行项目时, 要先 <code>激活虚拟环境</code>。</p><p>在项目文件夹中按住键盘的 <code>Shift</code>, 点鼠标 <code>右键</code>, 选择 <code>在此处打开PowerShell窗口</code></p><ol><li>激活虚拟环境, 命令： <code> .\venv\Scripts\activate</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\PycharmProjects\myproject&gt; .\venv\Scripts\activate</span><br><span class="line">(venv) PS D:\PycharmProjects\myproject&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>运行项目, 命令： <code>python .\manage.py runserver</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(venv) PS D:\PycharmProjects\myproject&gt; python .\manage.py runserver</span><br><span class="line">Watching <span class="keyword">for</span> file changes with StatReloader</span><br><span class="line">Performing system checks...</span><br><span class="line"></span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line"></span><br><span class="line">You have 18 unapplied migration(s). Your project may not work properly <span class="keyword">until</span> you apply the migrations <span class="keyword">for</span> app(s): admin, auth, contenttypes, sessions.</span><br><span class="line">Run <span class="string">&#x27;python manage.py migrate&#x27;</span> to apply them.</span><br><span class="line">July 03, 2022 - 11:52:32</span><br><span class="line">Django version 4.0.5, using settings <span class="string">&#x27;myproject.settings&#x27;</span></span><br><span class="line">Starting development server at http://127.0.0.1:8000/</span><br><span class="line">Quit the server with CTRL-BREAK.</span><br></pre></td></tr></table></figure><h2 id="在-PyCharm-中运行项目"><a href="#在-PyCharm-中运行项目" class="headerlink" title="在 PyCharm 中运行项目"></a>在 <code>PyCharm</code> 中运行项目</h2><p>在 <code>PyCharm</code> 的菜单中选择 <code>Run</code> -&gt; <code>Run &#39;myproject&#39;</code>,  或点击工具栏中的 <code>运行</code> 按钮:</p><img src="/2022/07/03/create-an-app-in-django-001/010.png" class="" title="runserver"><h2 id="查看运行结果"><a href="#查看运行结果" class="headerlink" title="查看运行结果"></a>查看运行结果</h2><p>打开浏览器, 输入网址: <code>http://127.0.0.1:8000/</code></p><img src="/2022/07/03/create-an-app-in-django-001/009.png" class="" title="runserver"><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h1><ol><li><p><a href="https://www.bookstack.cn/read/Django-4.0-zh/fe6cf677b8556466.md">Django v4.0 中文文档</a></p></li><li><p><a href="https://www.bookstack.cn/read/django-beginners-guide-zh/README.md">Django入门与实践教程</a></p></li><li><p><a href="https://www.bootstrap.cn/doc/book/2.html">Bootstrap5 中文手册</a></p></li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Flutter 中使用 Freezed</title>
      <link href="/2022/05/04/use-freezed-with-flutter/"/>
      <url>/2022/05/04/use-freezed-with-flutter/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/rrousselGit/freezed">https://github.com/rrousselGit/freezed</a></p><p><a href="https://www.developer.school/tutorials/how-to-use-freezed-with-flutter">https://www.developer.school/tutorials/how-to-use-freezed-with-flutter</a></p><p><a href="https://runble1.com/flutter-freezed-tutorial/">https://runble1.com/flutter-freezed-tutorial/</a></p><p><code>Freezed</code> 是一个不可变类的代码生成器, 用于<code>数据类</code>&#x2F;<code>联合</code>&#x2F;<code>模式匹配</code>&#x2F;<code>克隆</code>的<code>代码生成器</code>。不可变类的代码生成具有简单的语法&#x2F;API，而不会影响功能。</p><p>在 <code>Dart/Flutter</code> 中定义模型(<code>model</code>)的时候, 经常要附加以下的工作：</p><ul><li>定义一个构造函数+属性</li><li>覆盖 <code>toString</code>、运算符 &#x3D;&#x3D;、<code>hashCode</code></li><li>实现一个 <code>copyWith</code> 方法来克隆对象</li><li>处理<code>反序列化</code></li></ul><p>除此之外，<code>Dart</code> 还缺少<code>联合类型</code>和<code>模式匹配</code>等功能。实现所有这些可能需要数百行代码，这很容易出错并且模型的可读性显着。</p><p><code>Freezed</code> 尝试通过实现以上的大部分内容来解决这个问题，让开发者可以专注于模型的定义。</p><h1 id="不可变类-immutable-class"><a href="#不可变类-immutable-class" class="headerlink" title="不可变类(immutable class)"></a>不可变类(immutable class)</h1>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
            <tag> freezed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Flutter中使用 go_router 配置路由</title>
      <link href="/2022/04/09/flutter-navigator-using-go-router/"/>
      <url>/2022/04/09/flutter-navigator-using-go-router/</url>
      
        <content type="html"><![CDATA[<p><code>go_router</code> 基于 <code>Navigation 2</code> 的 <code>Flutter</code> 声明式路由, 通过使用声明式路由来降低复杂性, 适用于各种不同的目标平台(mobile、Web、desktop), 是由 <code>Flutter </code>生态系统委员会选出的表现出最高质量水平的软件包(<code>Flutter Favorites</code>)。</p><h1 id="开发环境："><a href="#开发环境：" class="headerlink" title="开发环境："></a>开发环境：</h1><ul><li><p>Microsoft Windows 10 Enterprise LTSC [Version 10.0.19044.1586], locale zh-CN</p></li><li><p>Flutter 2.10.3 • Channel Stable, Dart 2.16.1 </p></li><li><p>Visual Studio Code, 64-bit edition (version 1.66.1)</p></li><li><p>OpenJDK Runtime Environment (build 11.0.11+9-b60-7590822)</p></li><li><p>Android SDK version 30.0.3, Platform android-31, build-tools 30.0.3</p></li></ul><h1 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h1><p>执行命令，创建新项目：<code>flutter create my_go_router_app</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS D:\flutter_repos&gt; flutter create my_go_router_app</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Creating project my_go_router_app...</span><br><span class="line">Running <span class="string">&quot;flutter pub get&quot;</span> <span class="keyword">in</span> my_go_router_app...                 1,770ms</span><br><span class="line">Wrote 96 files.</span><br><span class="line"></span><br><span class="line">All <span class="keyword">done</span>!</span><br><span class="line">In order to run your application, <span class="built_in">type</span>:</span><br><span class="line"></span><br><span class="line">  $ <span class="built_in">cd</span> my_go_router_app</span><br><span class="line">  $ flutter run</span><br><span class="line"></span><br><span class="line">Your application code is <span class="keyword">in</span> my_go_router_app\lib\main.dart.</span><br></pre></td></tr></table></figure><p>打开新创建的项目：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\flutter_repos&gt; <span class="built_in">cd</span> .\my_go_router_app\</span><br><span class="line">PS D:\flutter_repos\my_go_router_app&gt; code .</span><br></pre></td></tr></table></figure><h1 id="添加新文件"><a href="#添加新文件" class="headerlink" title="添加新文件"></a>添加新文件</h1><p>新建文件 <code>lib/views/index_page.dart</code>, 编辑其内容如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> IndexPage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: <span class="keyword">const</span> Text(<span class="string">&#x27;Go Router&#x27;</span>)),</span><br><span class="line">      body: Column(</span><br><span class="line">        children: [</span><br><span class="line">          ListTile(</span><br><span class="line">            leading: <span class="keyword">const</span> Icon(Icons.settings_outlined),</span><br><span class="line">            title: <span class="keyword">const</span> Text(<span class="string">&#x27;设置&#x27;</span>),</span><br><span class="line">            onTap: () &#123;&#125;,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>新建文件 <code>lib/views/movie_detail_page.dart</code>, 编辑其内容如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieDetailPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MovieDetailPage(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.id&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> id;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: <span class="keyword">const</span> Text(<span class="string">&#x27;Movie Detail&#x27;</span>)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Text(<span class="string">&#x27;当前电影ID: <span class="subst">$id</span>&#x27;</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>新建文件 <code>lib/views/settings_page.dart</code>, 编辑其内容如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SettingPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> SettingPage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: <span class="keyword">const</span> Text(<span class="string">&#x27;Settings&#x27;</span>)),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新建文件 <code>lib/views/search_page.dart</code>, 编辑其内容如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> SearchPage(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.query&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> query;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: <span class="keyword">const</span> Text(<span class="string">&#x27;Search&#x27;</span>)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Text(<span class="string">&#x27;查找的内容为: <span class="subst">$query</span>&#x27;</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="添加-go-router-依赖"><a href="#添加-go-router-依赖" class="headerlink" title="添加 go_router 依赖"></a>添加 <code>go_router</code> 依赖</h1><p><code>go_router</code> 最新版本: <a href="https://pub.flutter-io.cn/packages/go_router">https://pub.flutter-io.cn/packages/go_router</a></p><p>打开文件<code>pubspec.yaml</code>,  在 <code>dependencies</code> 中添加 <code>go_router</code> 包：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">flutter:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">cupertino_icons:</span> <span class="string">^1.0.2</span></span><br><span class="line">  <span class="attr">go_router:</span> <span class="string">^3.0.7</span>  <span class="comment"># 添加这一行</span></span><br></pre></td></tr></table></figure><h1 id="创建路由表"><a href="#创建路由表" class="headerlink" title="创建路由表"></a>创建路由表</h1><p>新建文件 <code>lib/utils/app_routes.dart</code>, 编辑其内容如下:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:go_router/go_router.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../views/index_page.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../views/movie_detail_page.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../views/search_page.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../views/settings_page.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppRoutes</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于路径路由(声明式路由)的常量, 路径不包含参数</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> homePath = <span class="string">&#x27;/&#x27;</span>; <span class="comment">// 根路由</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> settingPath = <span class="string">&#x27;/settings&#x27;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> movieDetailPath = <span class="string">&#x27;/movie_detail&#x27;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> searchPath = <span class="string">&#x27;/search&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于 命名路由的常量</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> homeNamed = <span class="string">&#x27;home_page&#x27;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> settingsNamed = <span class="string">&#x27;setting_page&#x27;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> movieDetailNamed = <span class="string">&#x27;movie_detail_page&#x27;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> searchNamed = <span class="string">&#x27;search_page&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> GoRouter router = GoRouter(</span><br><span class="line">    initialLocation: homePath, <span class="comment">// 默认路由, 不指定这一荐时，默认路由为 &#x27;/&#x27;</span></span><br><span class="line">    routes: [</span><br><span class="line">      GoRoute(</span><br><span class="line">        <span class="comment">// 不传递参数的路由项</span></span><br><span class="line">        name: homeNamed, <span class="comment">// 命名路由</span></span><br><span class="line">        path: homePath, <span class="comment">// 路径路由</span></span><br><span class="line">        builder: (context, state) =&gt; <span class="keyword">const</span> IndexPage(),</span><br><span class="line">      ),</span><br><span class="line">      GoRoute(</span><br><span class="line">        name: settingsNamed,</span><br><span class="line">        path: settingPath,</span><br><span class="line">        builder: (context, state) =&gt; <span class="keyword">const</span> SettingPage(),</span><br><span class="line">      ),</span><br><span class="line">      GoRoute(</span><br><span class="line">        <span class="comment">// 传递参数方式1, 参数格式类似URL：/search?query=flutter</span></span><br><span class="line">        name: searchNamed,</span><br><span class="line">        path: searchPath, <span class="comment">// 问号格式的参数，在路径中不需要包含参数信息</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// GoRouter.of(context).pushNamed(AppRoutes.searchNamed, queryParams: &#123;&#x27;query&#x27;: &#x27;abcd&#x27;&#125;);</span></span><br><span class="line">        <span class="comment">// GoRouter.of(context).push(&#x27;$&#123;AppRoutes.searchPath&#125;?query=flutter&#x27;);</span></span><br><span class="line">        <span class="comment">// GoRouter.of(context).go(&#x27;/search?query=flutter&#x27;);</span></span><br><span class="line">        builder: (context, state) &#123;</span><br><span class="line">          <span class="comment">// state.queryParams 接收用问号隔开的参数</span></span><br><span class="line">          <span class="keyword">final</span> query = state.queryParams[<span class="string">&#x27;query&#x27;</span>];</span><br><span class="line">          <span class="keyword">return</span> SearchPage(query: query!);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      GoRoute(</span><br><span class="line">        <span class="comment">// 传递参数方式2, 参数格式：/movie_detail/123</span></span><br><span class="line">        name: movieDetailNamed,</span><br><span class="line">        path: <span class="string">&#x27;<span class="subst">$movieDetailPath</span>/:id&#x27;</span>, <span class="comment">// 位置格式的参数，参数要包含在路径中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// GoRouter.of(context).pushNamed(AppRoutes.searchNamed, params: &#123;&#x27;query&#x27;: &#x27;abcd&#x27;&#125;);</span></span><br><span class="line">        <span class="comment">// GoRouter.of(context).push(&#x27;$&#123;AppRoutes.movieDetailPath&#125;/654321&#x27;);</span></span><br><span class="line">        <span class="comment">// GoRouter.of(context).go(&#x27;/movie_detail/654321&#x27;);</span></span><br><span class="line">        builder: (context, state) &#123;</span><br><span class="line">          <span class="comment">// state.params 接收 `/` 隔开的参数(按位置)</span></span><br><span class="line">          <span class="keyword">final</span> id = state.params[<span class="string">&#x27;id&#x27;</span>]!;</span><br><span class="line">          <span class="keyword">return</span> MovieDetailPage(id: id);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    ],</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="路由初始化"><a href="#路由初始化" class="headerlink" title="路由初始化"></a>路由初始化</h1><p>打开 <code>main.dart</code> 文件, 编辑内容如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;utils/app_routes.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(<span class="keyword">const</span> MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyApp(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This widget is the root of your application.</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp.router(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      routeInformationParser: AppRoutes.router.routeInformationParser,</span><br><span class="line">      routerDelegate: AppRoutes.router.routerDelegate,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="使用路由"><a href="#使用路由" class="headerlink" title="使用路由"></a>使用路由</h1><p>打开文件 <code>lib/views/index_page.dart</code>, 编辑其内容如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:go_router/go_router.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:my_go_router_app/utils/app_routes.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> IndexPage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: <span class="keyword">const</span> Text(<span class="string">&#x27;Go Router&#x27;</span>)),</span><br><span class="line">      body: Column(</span><br><span class="line">        children: [</span><br><span class="line">          ListTile(</span><br><span class="line">            leading: <span class="keyword">const</span> Icon(Icons.settings_outlined),</span><br><span class="line">            title: <span class="keyword">const</span> Text(<span class="string">&#x27;设置&#x27;</span>),</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">              GoRouter.of(context).push(AppRoutes.settingPath);</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">          ListTile(</span><br><span class="line">            leading: <span class="keyword">const</span> Icon(Icons.find_in_page_outlined),</span><br><span class="line">            title: <span class="keyword">const</span> Text(<span class="string">&#x27;搜索_path&#x27;</span>),</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">              GoRouter.of(context).push(</span><br><span class="line">                <span class="comment">// 实际路径：/search?query=flutter</span></span><br><span class="line">                <span class="string">&#x27;<span class="subst">$&#123;AppRoutes.searchPath&#125;</span>?query=flutter&#x27;</span>,</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">          ListTile(</span><br><span class="line">            leading: <span class="keyword">const</span> Icon(Icons.find_in_page_outlined),</span><br><span class="line">            title: <span class="keyword">const</span> Text(<span class="string">&#x27;搜索_named&#x27;</span>),</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">              GoRouter.of(context).pushNamed(</span><br><span class="line">                AppRoutes.searchNamed,</span><br><span class="line">                <span class="comment">// queryParams 传递问号隔开的参数</span></span><br><span class="line">                queryParams: &#123;<span class="string">&#x27;query&#x27;</span>: <span class="string">&#x27;abcd&#x27;</span>&#125;,</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">          ListTile(</span><br><span class="line">            leading: <span class="keyword">const</span> Icon(Icons.details_outlined),</span><br><span class="line">            title: <span class="keyword">const</span> Text(<span class="string">&#x27;电影详情_path&#x27;</span>),</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">              <span class="comment">// 路径传递参数</span></span><br><span class="line">              GoRouter.of(context).push(</span><br><span class="line">                <span class="comment">// 实际路径： /movie_detail/654321</span></span><br><span class="line">                <span class="string">&#x27;<span class="subst">$&#123;AppRoutes.movieDetailPath&#125;</span>/654321&#x27;</span>,</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">          ListTile(</span><br><span class="line">            leading: <span class="keyword">const</span> Icon(Icons.details_outlined),</span><br><span class="line">            title: <span class="keyword">const</span> Text(<span class="string">&#x27;电影详情_named&#x27;</span>),</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">              <span class="comment">// 命令路由传递参数</span></span><br><span class="line">              GoRouter.of(context).pushNamed(</span><br><span class="line">                AppRoutes.movieDetailNamed,</span><br><span class="line">                <span class="comment">// params 传递 `/` 隔开的参数</span></span><br><span class="line">                params: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>&#125;,</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="路由导航"><a href="#路由导航" class="headerlink" title="路由导航"></a>路由导航</h1><h2 id="无参数的路径路由"><a href="#无参数的路径路由" class="headerlink" title="无参数的路径路由"></a>无参数的路径路由</h2><p>要在页面之间导航，可以使用 <code>GoRouter.go</code> 或  <code>GoRouter.push</code> 方法：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// navigate using the GoRouter</span></span><br><span class="line">onTap: () =&gt; GoRouter.of(context).go(<span class="string">&#x27;/page2&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// navigate using the GoRouter</span></span><br><span class="line">onTap: () =&gt; GoRouter.of(context).push(<span class="string">&#x27;/page2&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>go_router</code> 还提供了一个使用 <code>Dart扩展方法</code> 的简化导航手段。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// navigate using the GoRouter more easily</span></span><br><span class="line">onTap: () =&gt; context.go(<span class="string">&#x27;/page2&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// navigate using the GoRouter more easily</span></span><br><span class="line">onTap: () =&gt; context.push(<span class="string">&#x27;/page2&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p><code>GoRouter.go</code> 方法跳转后不能返回; <code>GoRouter.push</code> 方法会把当前路由压入堆栈，可以通过 <code>GoRouter.of(context).pop()</code> 返回前一页。</p></blockquote><h2 id="无参数的命名路由"><a href="#无参数的命名路由" class="headerlink" title="无参数的命名路由"></a>无参数的命名路由</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GoRouter.of(context).goNamed(<span class="string">&#x27;settings_page&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GoRouter.of(context).pushNamed(<span class="string">&#x27;settings_page&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="通过路由传递参数的方式1"><a href="#通过路由传递参数的方式1" class="headerlink" title="通过路由传递参数的方式1"></a>通过路由传递参数的方式1</h2><p><code>参数传递方式1</code>, 参数格式类似URL：<code>/search?query=flutter</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GoRoute(       </span><br><span class="line">  name: <span class="string">&#x27;search_page&#x27;</span>,</span><br><span class="line">  path: <span class="string">&#x27;/search&#x27;</span>, <span class="comment">// 问号格式的参数，在路径中不需要包含参数信息</span></span><br><span class="line">  builder: (context, state) &#123;</span><br><span class="line">      <span class="comment">// state.queryParams 接收用问号隔开的参数          </span></span><br><span class="line">    <span class="keyword">final</span> query = state.queryParams[<span class="string">&#x27;query&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> SearchPage(query: query!);</span><br><span class="line">  &#125;,</span><br><span class="line">),</span><br></pre></td></tr></table></figure><blockquote><p><code>state.queryParams</code> 接收用问号隔开的参数</p></blockquote><p><code>参数传递方式1</code> 的路由跳转的几种写法：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GoRouter.of(context).pushNamed(<span class="string">&#x27;search_page&#x27;</span>, queryParams: &#123;<span class="string">&#x27;query&#x27;</span>: <span class="string">&#x27;abcd&#x27;</span>&#125;);</span><br><span class="line">GoRouter.of(context).push(<span class="string">&#x27;/search?query=mobile&#x27;</span>);</span><br><span class="line">GoRouter.of(context).goNamed(<span class="string">&#x27;search_page&#x27;</span>, queryParams: &#123;<span class="string">&#x27;query&#x27;</span>: <span class="string">&#x27;android&#x27;</span>&#125;);</span><br><span class="line">GoRouter.of(context).go(<span class="string">&#x27;/search?query=flutter&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="通过路由传递参数的方式2"><a href="#通过路由传递参数的方式2" class="headerlink" title="通过路由传递参数的方式2"></a>通过路由传递参数的方式2</h2><p><code>参数传递方式2</code>, 参数格式类似：<code>/movie_detail/654342</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GoRoute(</span><br><span class="line">  <span class="comment">// 传递参数方式2, 参数格式：/movie_detail/123</span></span><br><span class="line">  name: <span class="string">&#x27;movie_detail_page&#x27;</span>,</span><br><span class="line">  path: <span class="string">&#x27;movie_detail/:id&#x27;</span>, <span class="comment">// 位置格式的参数，参数要包含在路径中</span></span><br><span class="line"></span><br><span class="line">  builder: (context, state) &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">final</span> id = state.params[<span class="string">&#x27;id&#x27;</span>]!;</span><br><span class="line">    <span class="keyword">return</span> MovieDetailPage(id: id);</span><br><span class="line">  &#125;,</span><br><span class="line">),</span><br></pre></td></tr></table></figure><blockquote><p> <code>state.params</code> 接收 <code>/</code> 隔开的参数(按位置)</p></blockquote><p><code>参数传递方式2</code> 的路由跳转的几种写法：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GoRouter.of(context).pushNamed(<span class="string">&#x27;movie_detail_page&#x27;</span>, Params: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">654342</span>&#125;);</span><br><span class="line">GoRouter.of(context).push(<span class="string">&#x27;movie_detail/234321&#x27;</span>);</span><br><span class="line">GoRouter.of(context).goNamed(<span class="string">&#x27;movie_detail_page&#x27;</span>, Params: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">794341</span>&#125;);</span><br><span class="line">GoRouter.of(context).go(<span class="string">&#x27;/movie_detail/854785&#x27;</span>);</span><br></pre></td></tr></table></figure><h1 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h1><p>默认情况下，<code>go_router</code> 带有 <code>MaterialApp</code> 和 <code>CupertinoApp</code> 一个默认错误页面，如果不想使用自带的默认错误处理页面。可以通过设置 <code>GoRouter</code> 的 <code>errorBuilder</code> 参数来替换默认的错误页面。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">final</span> _router = GoRouter(</span><br><span class="line">    ...</span><br><span class="line">    errorBuilder: (context, state) =&gt; ErrorPage(state.error),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
            <tag> go_router </tag>
            
            <tag> 路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Android SDK 命令行工具搭建 Flutter 开发环境</title>
      <link href="/2022/03/18/build-flutter-dev-environment-with-cmdline-tools/"/>
      <url>/2022/03/18/build-flutter-dev-environment-with-cmdline-tools/</url>
      
        <content type="html"><![CDATA[<h1 id="准备的软件："><a href="#准备的软件：" class="headerlink" title="准备的软件："></a>准备的软件：</h1><ul><li><p><code>Flutter SDK</code> (stable channel), 下载地址：<a href="https://docs.flutter.dev/development/tools/sdk/releases">https://docs.flutter.dev/development/tools/sdk/releases</a></p></li><li><p><code>OpenJDK 11</code> (可以使用其他的 <code>JDK</code>, 最低版本要求是 <code>11</code>, 可以使用更高版本的 <code>JDK</code> )</p></li><li><p><code>Android SDK Command-line Tools(latest)</code> 下载地址：<a href="https://developer.android.google.cn/studio?hl=zh-cn#command-tools">https://developer.android.google.cn/studio?hl=zh-cn#command-tools</a></p></li><li><p><code>Visual Studio Code</code> 下载地址：<a href="https://code.visualstudio.com/Download">https://code.visualstudio.com/Download</a></p></li><li><p><code>雷电模拟器</code>、 <code>夜神模拟器</code> 或 <code>Android Studio</code> 自带的模拟器任选一个（也可以使用其他可以连接到开发工具的模拟器）,<code>雷电模拟器</code> 安装好即可使用; <code>夜神模拟器</code> 需要做一个额外的配置。</p></li></ul><blockquote><p>最新版的 <code>Android Studio</code> 安装文件夹下的 <code>jre</code> 文件夹是自带的 <code>OpenJDK 11.0.10</code>, 我从另外一台安装有 <code>Android Studio</code> 的电脑上复制了这个文件夹并改名为 <code>openJDK</code> 备用</p></blockquote><p>说明：理论上搭建 <code>Flutter</code> 开发环境只要有 <code>Android SDK</code> 就可以了, 可以不安装 <code>Android Studio</code>。 于是找了个旧电脑来试了一下。当然了, 在开发完整功能的 <code>Flutter</code> 应用程序时, 如果需要编写涉及 <code>Android</code> 的混合代码, 还是配合使用 <code>Android Studio</code> 更方便。</p><h1 id="配置-Flutter-SDK-使用国内镜像"><a href="#配置-Flutter-SDK-使用国内镜像" class="headerlink" title="配置 Flutter SDK 使用国内镜像"></a>配置 Flutter SDK 使用国内镜像</h1><p>由于某些不可描述的原因，<code>Flutter SDK</code> 的资源网站访问受到影响，可以通过设置 <code>PUB_HOSTED_URL</code> 和 <code>FLUTTER_STORAGE_BASE_URL</code> 两个环境变量设置为使用国内镜像， 以下两个站点二选一：</p><h2 id="使用清华大学镜像："><a href="#使用清华大学镜像：" class="headerlink" title="使用清华大学镜像："></a>使用清华大学镜像：</h2><p>使用管理员权限打开 <code>CMD窗口</code> 或 <code>PowerShell窗口</code>，执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setx <span class="string">&quot;PUB_HOSTED_URL&quot;</span> <span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/dart-pub&quot;</span> </span><br><span class="line">setx <span class="string">&quot;FLUTTER_STORAGE_BASE_URL&quot;</span> <span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/flutter&quot;</span></span><br></pre></td></tr></table></figure><h2 id="使用Flutter官方为中国开发者搭建了临时镜像："><a href="#使用Flutter官方为中国开发者搭建了临时镜像：" class="headerlink" title="使用Flutter官方为中国开发者搭建了临时镜像："></a>使用Flutter官方为中国开发者搭建了临时镜像：</h2><p>使用管理员权限打开 <code>CMD窗口</code> 或 <code>PowerShell窗口</code>，执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setx <span class="string">&quot;PUB_HOSTED_URL&quot;</span> <span class="string">&quot;https://pub.flutter-io.cn&quot;</span></span><br><span class="line">setx <span class="string">&quot;FLUTTER_STORAGE_BASE_URL&quot;</span> <span class="string">&quot;https://storage.flutter-io.cn&quot;</span></span><br></pre></td></tr></table></figure><h1 id="配置-Flutter-SDK"><a href="#配置-Flutter-SDK" class="headerlink" title="配置 Flutter SDK"></a>配置 <code>Flutter SDK</code></h1><ol><li><p>打开文件夹 <code>D:\AppData</code> (没有则新建一个, 或指定其他合适的文件夹) </p></li><li><p>将下载好的 <code>Flutter SDK</code> 压缩文件复制到该文件夹中，使用 <code>解压到当前位置</code> 解压文件, <code>Flutter SDK</code> 的路径为：<code>D:\AppData\flutter</code></p></li><li><p>修改环境变量 <code>path</code>， 添加一个值: <code>D:\AppData\flutter\bin</code>  (如果使用命令方式修改环境变量，与下一步的 <code>配置JDK</code> 一起修改)</p></li></ol><h1 id="配置-JDK"><a href="#配置-JDK" class="headerlink" title="配置 JDK"></a>配置 <code>JDK</code></h1><ol><li><p>打开 <code>D:\AppData</code> 文件夹</p></li><li><p>将 <code>openJDK</code> 复制该文件中, <code>JDK</code> 的路径为：<code>D:\AppData\openJDK</code></p></li><li><p>添加环境变量 <code>JAVA_HOME</code>: 使用 <code>管理员权限</code> 打开 <code>CMD窗口</code> 或 <code>PowerShell窗口</code>，执行以下命令：</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setx <span class="string">&quot;JAVA_HOME&quot;</span> <span class="string">&quot;D:\AppData\openJDK&quot;</span> /m</span><br></pre></td></tr></table></figure><ol start="4"><li>修改环境变量 <code>path</code>, 添加两个值：<code>%JAVA_HOME%\bin</code> 和 <code>%JAVA_HOME%\jre\bin</code>, 使用管理员权限打开<code> CMD窗口</code> 或 <code>PowerShell窗口</code>，执行以下命令：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setx PATH <span class="string">&quot;%PATH%;%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin;D:\AppData\flutter\bin&quot;</span> /m</span><br></pre></td></tr></table></figure><h1 id="使用-Android-SDK-Command-line-Tools-latest-安装-Android-SDK"><a href="#使用-Android-SDK-Command-line-Tools-latest-安装-Android-SDK" class="headerlink" title="使用 Android SDK Command-line Tools(latest) 安装 Android SDK"></a>使用 <code>Android SDK Command-line Tools(latest)</code> 安装 <code>Android SDK</code></h1><ol><li>将下载好的 <code>commandlinetools-win-8092744_latest.zip</code> (当前最新版) 文件解压缩, <code>修改</code>解压后的<code>文件夹名称</code>及<code>相关路径</code>为以下格式： <code>D:\AppData\Android\Sdk\cmdline-tools\latest</code>, 确保 <code>latest</code> 文件夹内为 <code>bin</code> 、<code>lib</code> 文件夹, 如下图所示:</li></ol><img src="/2022/03/18/build-flutter-dev-environment-with-cmdline-tools/commandlinetools.png" class="" title="commandlinetools"><blockquote><p>特别提醒: 文件夹路径不对, 会导致后续步骤不能正确执行, <code>D:\AppData\Android\Sdk\</code> 为 <code>Android SDK</code> 路径, 可根据自己的需要进行修改调整; <code>cmdline-tools\latest</code> 为<code>Android SDK</code>内部文件夹结构, 不能变动。</p></blockquote><ol start="2"><li>添加<code>ANDROID_HOME</code> 环境变量</li></ol><p>将 <code>Android SDK</code> 的路径添加到环境变量中, 使用 <code>管理员权限</code> 运行 <code>CMD窗口</code> 或 <code>PowerShell窗口</code>, 执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setx <span class="string">&quot;ANDROID_HOME&quot;</span> <span class="string">&quot;D:\AppData\Android\Sdk&quot;</span>  /m</span><br></pre></td></tr></table></figure><blockquote><p>将 <code>D:\AppData\Android\Sdk</code> 替换为自己电脑实际的 <code>Android SDK</code> 路径</p></blockquote><ol start="3"><li><p>在 <code>D:\AppData\Android\Sdk\cmdline-tools\latest\bin</code>  文件夹打开 <code>Powershell</code> 或 <code>CMD</code> 窗口</p></li><li><p>查看 <code>已安装的包</code> 和 <code>有效的包</code>,  命令格式： <code>sdkmanager.bat --list</code>, <code>Powershell窗口</code> 执行情况如下所示：</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><span class="line">PS D:\AppData\Android\Sdk\cmdline-tools\latest\bin&gt; .\sdkmanager.bat --list</span><br><span class="line">[=======================================] 100% Computing updates...</span><br><span class="line">Available Packages:</span><br><span class="line">  Path                                                                                     | Version      | Description</span><br><span class="line">  -------                                                                                  | -------      | -------</span><br><span class="line">  add-ons;addon-google_apis-google-15                                                      | 3            | Google APIs</span><br><span class="line">  add-ons;addon-google_apis-google-16                                                      | 4            | Google APIs</span><br><span class="line">  add-ons;addon-google_apis-google-17                                                      | 4            | Google APIs</span><br><span class="line">  add-ons;addon-google_apis-google-18                                                      | 4            | Google APIs</span><br><span class="line">  add-ons;addon-google_apis-google-19                                                      | 20           | Google APIs</span><br><span class="line">  add-ons;addon-google_apis-google-21                                                      | 1            | Google APIs</span><br><span class="line">  add-ons;addon-google_apis-google-22                                                      | 1            | Google APIs</span><br><span class="line">  add-ons;addon-google_apis-google-23                                                      | 1            | Google APIs</span><br><span class="line">  add-ons;addon-google_apis-google-24                                                      | 1            | Google APIs</span><br><span class="line">  build-tools;19.1.0                                                                       | 19.1.0       | Android SDK Build-Tools 19.1</span><br><span class="line">  build-tools;20.0.0                                                                       | 20.0.0       | Android SDK Build-Tools 20</span><br><span class="line">  build-tools;21.1.2                                                                       | 21.1.2       | Android SDK Build-Tools 21.1.2</span><br><span class="line">  build-tools;22.0.1                                                                       | 22.0.1       | Android SDK Build-Tools 22.0.1</span><br><span class="line">  build-tools;23.0.1                                                                       | 23.0.1       | Android SDK Build-Tools 23.0.1</span><br><span class="line">  build-tools;23.0.2                                                                       | 23.0.2       | Android SDK Build-Tools 23.0.2</span><br><span class="line">  build-tools;23.0.3                                                                       | 23.0.3       | Android SDK Build-Tools 23.0.3</span><br><span class="line">  build-tools;24.0.0                                                                       | 24.0.0       | Android SDK Build-Tools 24</span><br><span class="line">  build-tools;24.0.1                                                                       | 24.0.1       | Android SDK Build-Tools 24.0.1</span><br><span class="line">  build-tools;24.0.2                                                                       | 24.0.2       | Android SDK Build-Tools 24.0.2</span><br><span class="line">  build-tools;24.0.3                                                                       | 24.0.3       | Android SDK Build-Tools 24.0.3</span><br><span class="line">  build-tools;25.0.0                                                                       | 25.0.0       | Android SDK Build-Tools 25</span><br><span class="line">  build-tools;25.0.1                                                                       | 25.0.1       | Android SDK Build-Tools 25.0.1</span><br><span class="line">  build-tools;25.0.2                                                                       | 25.0.2       | Android SDK Build-Tools 25.0.2</span><br><span class="line">  build-tools;25.0.3                                                                       | 25.0.3       | Android SDK Build-Tools 25.0.3</span><br><span class="line">  build-tools;26.0.0                                                                       | 26.0.0       | Android SDK Build-Tools 26</span><br><span class="line">  build-tools;26.0.1                                                                       | 26.0.1       | Android SDK Build-Tools 26.0.1</span><br><span class="line">  build-tools;26.0.2                                                                       | 26.0.2       | Android SDK Build-Tools 26.0.2</span><br><span class="line">  build-tools;26.0.3                                                                       | 26.0.3       | Android SDK Build-Tools 26.0.3</span><br><span class="line">  build-tools;27.0.0                                                                       | 27.0.0       | Android SDK Build-Tools 27</span><br><span class="line">  build-tools;27.0.1                                                                       | 27.0.1       | Android SDK Build-Tools 27.0.1</span><br><span class="line">  build-tools;27.0.2                                                                       | 27.0.2       | Android SDK Build-Tools 27.0.2</span><br><span class="line">  build-tools;27.0.3                                                                       | 27.0.3       | Android SDK Build-Tools 27.0.3</span><br><span class="line">  build-tools;28.0.0                                                                       | 28.0.0       | Android SDK Build-Tools 28</span><br><span class="line">  build-tools;28.0.1                                                                       | 28.0.1       | Android SDK Build-Tools 28.0.1</span><br><span class="line">  build-tools;28.0.2                                                                       | 28.0.2       | Android SDK Build-Tools 28.0.2</span><br><span class="line">  build-tools;28.0.3                                                                       | 28.0.3       | Android SDK Build-Tools 28.0.3</span><br><span class="line">  build-tools;29.0.0                                                                       | 29.0.0       | Android SDK Build-Tools 29</span><br><span class="line">  build-tools;29.0.1                                                                       | 29.0.1       | Android SDK Build-Tools 29.0.1</span><br><span class="line">  build-tools;29.0.2                                                                       | 29.0.2       | Android SDK Build-Tools 29.0.2</span><br><span class="line">  build-tools;29.0.3                                                                       | 29.0.3       | Android SDK Build-Tools 29.0.3</span><br><span class="line">  build-tools;30.0.0                                                                       | 30.0.0       | Android SDK Build-Tools 30</span><br><span class="line">  build-tools;30.0.1                                                                       | 30.0.1       | Android SDK Build-Tools 30.0.1</span><br><span class="line">  build-tools;30.0.2                                                                       | 30.0.2       | Android SDK Build-Tools 30.0.2</span><br><span class="line">  build-tools;30.0.3                                                                       | 30.0.3       | Android SDK Build-Tools 30.0.3</span><br><span class="line">  build-tools;31.0.0                                                                       | 31.0.0       | Android SDK Build-Tools 31</span><br><span class="line">  build-tools;32.0.0                                                                       | 32.0.0       | Android SDK Build-Tools 32</span><br><span class="line">  build-tools;32.1.0-rc1                                                                   | 32.1.0 rc1   | Android SDK Build-Tools 32.1-rc1</span><br><span class="line">  build-tools;33.0.0-rc2                                                                   | 33.0.0 rc2   | Android SDK Build-Tools 33-rc2</span><br><span class="line">  cmake;3.10.2.4988404                                                                     | 3.10.2       | CMake 3.10.2.4988404</span><br><span class="line">  cmake;3.18.1                                                                             | 3.18.1       | CMake 3.18.1</span><br><span class="line">  cmake;3.6.4111459                                                                        | 3.6.4111459  | CMake 3.6.4111459</span><br><span class="line">  cmdline-tools;1.0                                                                        | 1.0          | Android SDK Command-line Tools</span><br><span class="line">  cmdline-tools;2.1                                                                        | 2.1          | Android SDK Command-line Tools</span><br><span class="line">  cmdline-tools;3.0                                                                        | 3.0          | Android SDK Command-line Tools</span><br><span class="line">  cmdline-tools;4.0                                                                        | 4.0          | Android SDK Command-line Tools</span><br><span class="line">  cmdline-tools;5.0                                                                        | 5.0          | Android SDK Command-line Tools</span><br><span class="line">  cmdline-tools;6.0                                                                        | 6.0          | Android SDK Command-line Tools</span><br><span class="line">  cmdline-tools;latest                                                                     | 6.0          | Android SDK Command-line Tools (latest)</span><br><span class="line">  emulator                                                                                 | 31.2.8       | Android Emulator</span><br><span class="line">  extras;android;m2repository                                                              | 47.0.0       | Android Support Repository</span><br><span class="line">  extras;google;Android_Emulator_Hypervisor_Driver                                         | 1.8.0        | Android Emulator Hypervisor Driver <span class="keyword">for</span> AMD Processors (installer)</span><br><span class="line">  extras;google;auto                                                                       | 1.1          | Android Auto Desktop Head Unit Emulator</span><br><span class="line">  extras;google;google_play_services                                                       | 49           | Google Play services</span><br><span class="line">  extras;google;instantapps                                                                | 1.9.0        | Google Play Instant Development SDK</span><br><span class="line">  extras;google;m2repository                                                               | 58           | Google Repository</span><br><span class="line">  extras;google;market_apk_expansion                                                       | 1            | Google Play APK Expansion library</span><br><span class="line">  extras;google;market_licensing                                                           | 1            | Google Play Licensing Library</span><br><span class="line">  extras;google;simulators                                                                 | 1            | Android Auto API Simulators</span><br><span class="line">  extras;google;usb_driver                                                                 | 13           | Google USB Driver</span><br><span class="line">  extras;google;webdriver                                                                  | 2            | Google Web Driver</span><br><span class="line">  extras;intel;Hardware_Accelerated_Execution_Manager                                      | 7.6.5        | Intel x86 Emulator Accelerator (HAXM installer)</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.0        | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.0</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.0-alpha4 | 1            | com.android.support.constraint:constraint-layout-solver:1.0.0-alpha4</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.0-alpha8 | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.0-alpha8</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.0-beta1  | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.0-beta1</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.0-beta2  | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.0-beta2</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.0-beta3  | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.0-beta3</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.0-beta4  | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.0-beta4</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.0-beta5  | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.0-beta5</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.1        | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.1</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.2        | 1            | Solver <span class="keyword">for</span> ConstraintLayout 1.0.2</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.0               | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.0</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.0-alpha4        | 1            | com.android.support.constraint:constraint-layout:1.0.0-alpha4</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.0-alpha8        | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.0-alpha8</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.0-beta1         | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.0-beta1</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.0-beta2         | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.0-beta2</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.0-beta3         | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.0-beta3</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.0-beta4         | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.0-beta4</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.0-beta5         | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.0-beta5</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.1               | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.1</span><br><span class="line">  extras;m2repository;com;android;support;constraint;constraint-layout;1.0.2               | 1            | ConstraintLayout <span class="keyword">for</span> Android 1.0.2</span><br><span class="line">  ndk-bundle                                                                               | 22.1.7171670 | NDK</span><br><span class="line">  ndk;16.1.4479499                                                                         | 16.1.4479499 | NDK (Side by side) 16.1.4479499</span><br><span class="line">  ndk;17.2.4988734                                                                         | 17.2.4988734 | NDK (Side by side) 17.2.4988734</span><br><span class="line">  ndk;18.1.5063045                                                                         | 18.1.5063045 | NDK (Side by side) 18.1.5063045</span><br><span class="line">  ndk;19.2.5345600                                                                         | 19.2.5345600 | NDK (Side by side) 19.2.5345600</span><br><span class="line">  ndk;20.0.5594570                                                                         | 20.0.5594570 | NDK (Side by side) 20.0.5594570</span><br><span class="line">  ndk;20.1.5948944                                                                         | 20.1.5948944 | NDK (Side by side) 20.1.5948944</span><br><span class="line">  ndk;21.0.6113669                                                                         | 21.0.6113669 | NDK (Side by side) 21.0.6113669</span><br><span class="line">  ndk;21.1.6352462                                                                         | 21.1.6352462 | NDK (Side by side) 21.1.6352462</span><br><span class="line">  ndk;21.2.6472646                                                                         | 21.2.6472646 | NDK (Side by side) 21.2.6472646</span><br><span class="line">  ndk;21.3.6528147                                                                         | 21.3.6528147 | NDK (Side by side) 21.3.6528147</span><br><span class="line">  ndk;21.4.7075529                                                                         | 21.4.7075529 | NDK (Side by side) 21.4.7075529</span><br><span class="line">  ndk;22.0.7026061                                                                         | 22.0.7026061 | NDK (Side by side) 22.0.7026061</span><br><span class="line">  ndk;22.1.7171670                                                                         | 22.1.7171670 | NDK (Side by side) 22.1.7171670</span><br><span class="line">  ndk;23.0.7599858                                                                         | 23.0.7599858 | NDK (Side by side) 23.0.7599858</span><br><span class="line">  ndk;23.1.7779620                                                                         | 23.1.7779620 | NDK (Side by side) 23.1.7779620</span><br><span class="line">  ndk;24.0.8215888                                                                         | 24.0.8215888 | NDK (Side by side) 24.0.8215888</span><br><span class="line">  patcher;v4                                                                               | 1            | SDK Patch Applier v4</span><br><span class="line">  platform-tools                                                                           | 33.0.1       | Android SDK Platform-Tools</span><br><span class="line">  platforms;android-10                                                                     | 2            | Android SDK Platform 10</span><br><span class="line">  platforms;android-11                                                                     | 2            | Android SDK Platform 11</span><br><span class="line">  platforms;android-12                                                                     | 3            | Android SDK Platform 12</span><br><span class="line">  platforms;android-13                                                                     | 1            | Android SDK Platform 13</span><br><span class="line">  platforms;android-14                                                                     | 4            | Android SDK Platform 14</span><br><span class="line">  platforms;android-15                                                                     | 5            | Android SDK Platform 15</span><br><span class="line">  platforms;android-16                                                                     | 5            | Android SDK Platform 16</span><br><span class="line">  platforms;android-17                                                                     | 3            | Android SDK Platform 17</span><br><span class="line">  platforms;android-18                                                                     | 3            | Android SDK Platform 18</span><br><span class="line">  platforms;android-19                                                                     | 4            | Android SDK Platform 19</span><br><span class="line">  platforms;android-20                                                                     | 2            | Android SDK Platform 20</span><br><span class="line">  platforms;android-21                                                                     | 2            | Android SDK Platform 21</span><br><span class="line">  platforms;android-22                                                                     | 2            | Android SDK Platform 22</span><br><span class="line">  platforms;android-23                                                                     | 3            | Android SDK Platform 23</span><br><span class="line">  platforms;android-24                                                                     | 2            | Android SDK Platform 24</span><br><span class="line">  platforms;android-25                                                                     | 3            | Android SDK Platform 25</span><br><span class="line">  platforms;android-26                                                                     | 2            | Android SDK Platform 26</span><br><span class="line">  platforms;android-27                                                                     | 3            | Android SDK Platform 27</span><br><span class="line">  platforms;android-28                                                                     | 6            | Android SDK Platform 28</span><br><span class="line">  platforms;android-29                                                                     | 5            | Android SDK Platform 29</span><br><span class="line">  platforms;android-30                                                                     | 3            | Android SDK Platform 30</span><br><span class="line">  platforms;android-31                                                                     | 1            | Android SDK Platform 31</span><br><span class="line">  platforms;android-32                                                                     | 1            | Android SDK Platform 32</span><br><span class="line">  platforms;android-7                                                                      | 3            | Android SDK Platform 7</span><br><span class="line">  platforms;android-8                                                                      | 3            | Android SDK Platform 8</span><br><span class="line">  platforms;android-9                                                                      | 2            | Android SDK Platform 9</span><br><span class="line">  platforms;android-Tiramisu                                                               | 2            | Android SDK Platform Tiramisu</span><br><span class="line">  skiaparser;1                                                                             | 6            | Layout Inspector image server <span class="keyword">for</span> API 29-30</span><br><span class="line">  skiaparser;2                                                                             | 3            | Layout Inspector image server <span class="keyword">for</span> API S</span><br><span class="line">  sources;android-15                                                                       | 2            | Sources <span class="keyword">for</span> Android 15</span><br><span class="line">  sources;android-16                                                                       | 2            | Sources <span class="keyword">for</span> Android 16</span><br><span class="line">  sources;android-17                                                                       | 1            | Sources <span class="keyword">for</span> Android 17</span><br><span class="line">  sources;android-18                                                                       | 1            | Sources <span class="keyword">for</span> Android 18</span><br><span class="line">  sources;android-19                                                                       | 2            | Sources <span class="keyword">for</span> Android 19</span><br><span class="line">  sources;android-20                                                                       | 1            | Sources <span class="keyword">for</span> Android 20</span><br><span class="line">  sources;android-21                                                                       | 1            | Sources <span class="keyword">for</span> Android 21</span><br><span class="line">  sources;android-22                                                                       | 1            | Sources <span class="keyword">for</span> Android 22</span><br><span class="line">  sources;android-23                                                                       | 1            | Sources <span class="keyword">for</span> Android 23</span><br><span class="line">  sources;android-24                                                                       | 1            | Sources <span class="keyword">for</span> Android 24</span><br><span class="line">  sources;android-25                                                                       | 1            | Sources <span class="keyword">for</span> Android 25</span><br><span class="line">  sources;android-26                                                                       | 1            | Sources <span class="keyword">for</span> Android 26</span><br><span class="line">  sources;android-27                                                                       | 1            | Sources <span class="keyword">for</span> Android 27</span><br><span class="line">  sources;android-28                                                                       | 1            | Sources <span class="keyword">for</span> Android 28</span><br><span class="line">  sources;android-29                                                                       | 1            | Sources <span class="keyword">for</span> Android 29</span><br><span class="line">  sources;android-30                                                                       | 1            | Sources <span class="keyword">for</span> Android 30</span><br><span class="line">  sources;android-31                                                                       | 1            | Sources <span class="keyword">for</span> Android 31</span><br><span class="line">  system-images;android-10;default;armeabi-v7a                                             | 5            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-10;default;x86                                                     | 5            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-10;google_apis;armeabi-v7a                                         | 6            | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-10;google_apis;x86                                                 | 6            | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-14;default;armeabi-v7a                                             | 2            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-15;default;armeabi-v7a                                             | 5            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-15;default;x86                                                     | 7            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-15;google_apis;armeabi-v7a                                         | 6            | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-15;google_apis;x86                                                 | 7            | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-16;default;armeabi-v7a                                             | 6            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-16;default;mips                                                    | 1            | MIPS System Image</span><br><span class="line">  system-images;android-16;default;x86                                                     | 7            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-16;google_apis;armeabi-v7a                                         | 6            | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-16;google_apis;x86                                                 | 7            | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-17;default;armeabi-v7a                                             | 6            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-17;default;mips                                                    | 1            | MIPS System Image</span><br><span class="line">  system-images;android-17;default;x86                                                     | 7            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-17;google_apis;armeabi-v7a                                         | 6            | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-17;google_apis;x86                                                 | 7            | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-18;default;armeabi-v7a                                             | 5            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-18;default;x86                                                     | 4            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-18;google_apis;armeabi-v7a                                         | 6            | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-18;google_apis;x86                                                 | 6            | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-19;default;armeabi-v7a                                             | 5            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-19;default;x86                                                     | 6            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-19;google_apis;armeabi-v7a                                         | 40           | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-19;google_apis;x86                                                 | 40           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-21;android-tv;armeabi-v7a                                          | 3            | Android TV ARM EABI v7a System Image</span><br><span class="line">  system-images;android-21;android-tv;x86                                                  | 3            | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-21;default;armeabi-v7a                                             | 4            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-21;default;x86                                                     | 5            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-21;default;x86_64                                                  | 5            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-21;google_apis;armeabi-v7a                                         | 32           | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-21;google_apis;x86                                                 | 32           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-21;google_apis;x86_64                                              | 32           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-22;android-tv;x86                                                  | 3            | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-22;default;armeabi-v7a                                             | 2            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-22;default;x86                                                     | 6            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-22;default;x86_64                                                  | 6            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-22;google_apis;armeabi-v7a                                         | 26           | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-22;google_apis;x86                                                 | 26           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-22;google_apis;x86_64                                              | 26           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-23;android-tv;armeabi-v7a                                          | 12           | Android TV ARM EABI v7a System Image</span><br><span class="line">  system-images;android-23;android-tv;x86                                                  | 21           | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-23;default;armeabi-v7a                                             | 6            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-23;default;x86                                                     | 10           | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-23;default;x86_64                                                  | 10           | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-23;google_apis;armeabi-v7a                                         | 33           | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-23;google_apis;x86                                                 | 33           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-23;google_apis;x86_64                                              | 33           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-24;android-tv;x86                                                  | 22           | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-24;default;arm64-v8a                                               | 7            | ARM 64 v8a System Image</span><br><span class="line">  system-images;android-24;default;armeabi-v7a                                             | 7            | ARM EABI v7a System Image</span><br><span class="line">  system-images;android-24;default;x86                                                     | 8            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-24;default;x86_64                                                  | 8            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-24;google_apis;arm64-v8a                                           | 27           | Google APIs ARM 64 v8a System Image</span><br><span class="line">  system-images;android-24;google_apis;x86                                                 | 27           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-24;google_apis;x86_64                                              | 27           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-24;google_apis_playstore;x86                                       | 19           | Google Play Intel x86 Atom System Image</span><br><span class="line">  system-images;android-25;android-tv;x86                                                  | 16           | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-25;android-wear-cn;armeabi-v7a                                     | 4            | China version of Android Wear ARM EABI v7a System Image</span><br><span class="line">  system-images;android-25;android-wear-cn;x86                                             | 4            | China version of Android Wear Intel x86 Atom System Image</span><br><span class="line">  system-images;android-25;android-wear;armeabi-v7a                                        | 3            | Android Wear ARM EABI v7a System Image</span><br><span class="line">  system-images;android-25;android-wear;x86                                                | 3            | Android Wear Intel x86 Atom System Image</span><br><span class="line">  system-images;android-25;default;x86                                                     | 1            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-25;default;x86_64                                                  | 1            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-25;google_apis;arm64-v8a                                           | 18           | Google APIs ARM 64 v8a System Image</span><br><span class="line">  system-images;android-25;google_apis;armeabi-v7a                                         | 18           | Google APIs ARM EABI v7a System Image</span><br><span class="line">  system-images;android-25;google_apis;x86                                                 | 18           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-25;google_apis;x86_64                                              | 18           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-25;google_apis_playstore;x86                                       | 9            | Google Play Intel x86 Atom System Image</span><br><span class="line">  system-images;android-26;android-tv;x86                                                  | 14           | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-26;android-wear-cn;x86                                             | 4            | China version of Android Wear Intel x86 Atom System Image</span><br><span class="line">  system-images;android-26;android-wear;x86                                                | 4            | Android Wear Intel x86 Atom System Image</span><br><span class="line">  system-images;android-26;default;x86                                                     | 1            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-26;default;x86_64                                                  | 1            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-26;google_apis;x86                                                 | 16           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-26;google_apis;x86_64                                              | 16           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-26;google_apis_playstore;x86                                       | 7            | Google Play Intel x86 Atom System Image</span><br><span class="line">  system-images;android-27;android-tv;x86                                                  | 9            | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-27;default;x86                                                     | 1            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-27;default;x86_64                                                  | 1            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-27;google_apis;x86                                                 | 11           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-27;google_apis_playstore;x86                                       | 3            | Google Play Intel x86 Atom System Image</span><br><span class="line">  system-images;android-28;android-tv;x86                                                  | 10           | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-28;android-wear-cn;x86                                             | 9            | China version of Wear OS Intel x86 Atom System Image</span><br><span class="line">  system-images;android-28;android-wear;x86                                                | 9            | Wear OS Intel x86 Atom System Image</span><br><span class="line">  system-images;android-28;default;arm64-v8a                                               | 1            | ARM 64 v8a System Image</span><br><span class="line">  system-images;android-28;default;x86                                                     | 4            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-28;default;x86_64                                                  | 4            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-28;google_apis;arm64-v8a                                           | 1            | Google APIs ARM 64 v8a System Image</span><br><span class="line">  system-images;android-28;google_apis;x86                                                 | 12           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-28;google_apis;x86_64                                              | 11           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-28;google_apis_playstore;arm64-v8a                                 | 1            | Google ARM64-V8a Play ARM 64 v8a System Image</span><br><span class="line">  system-images;android-28;google_apis_playstore;x86                                       | 9            | Google Play Intel x86 Atom System Image</span><br><span class="line">  system-images;android-28;google_apis_playstore;x86_64                                    | 8            | Google Play Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-29;android-tv;x86                                                  | 3            | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-29;default;arm64-v8a                                               | 8            | ARM 64 v8a System Image</span><br><span class="line">  system-images;android-29;default;x86                                                     | 8            | Intel x86 Atom System Image</span><br><span class="line">  system-images;android-29;default;x86_64                                                  | 8            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-29;google_apis;arm64-v8a                                           | 12           | Google APIs ARM 64 v8a System Image</span><br><span class="line">  system-images;android-29;google_apis;x86                                                 | 12           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-29;google_apis;x86_64                                              | 12           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-29;google_apis_playstore;x86                                       | 8            | Google Play Intel x86 Atom System Image</span><br><span class="line">  system-images;android-29;google_apis_playstore;x86_64                                    | 8            | Google Play Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-30;android-tv;x86                                                  | 3            | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-30;android-wear-cn;x86                                             | 10           | China version of Wear OS 3 - Preview Intel x86 Atom System Image</span><br><span class="line">  system-images;android-30;android-wear;arm64-v8a                                          | 10           | Wear OS 3 - Preview ARM 64 v8a System Image</span><br><span class="line">  system-images;android-30;android-wear;x86                                                | 10           | Wear OS 3 - Preview Intel x86 Atom System Image</span><br><span class="line">  system-images;android-30;default;arm64-v8a                                               | 1            | ARM 64 v8a System Image</span><br><span class="line">  system-images;android-30;default;x86_64                                                  | 10           | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-30;google-tv;x86                                                   | 3            | Google TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-30;google_apis;arm64-v8a                                           | 11           | Google APIs ARM 64 v8a System Image</span><br><span class="line">  system-images;android-30;google_apis;x86                                                 | 10           | Google APIs Intel x86 Atom System Image</span><br><span class="line">  system-images;android-30;google_apis;x86_64                                              | 11           | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-30;google_apis_playstore;x86                                       | 9            | Google Play Intel x86 Atom System Image</span><br><span class="line">  system-images;android-30;google_apis_playstore;x86_64                                    | 10           | Google Play Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-31;android-tv;x86                                                  | 3            | Android TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-31;default;arm64-v8a                                               | 3            | ARM 64 v8a System Image</span><br><span class="line">  system-images;android-31;default;x86_64                                                  | 3            | Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-31;google-tv;x86                                                   | 3            | Google TV Intel x86 Atom System Image</span><br><span class="line">  system-images;android-31;google_apis;arm64-v8a                                           | 9            | Google APIs ARM 64 v8a System Image</span><br><span class="line">  system-images;android-31;google_apis;x86_64                                              | 9            | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-31;google_apis_playstore;x86_64                                    | 9            | Google Play Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-32;google_apis;arm64-v8a                                           | 3            | Google APIs ARM 64 v8a System Image</span><br><span class="line">  system-images;android-32;google_apis;x86_64                                              | 3            | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-32;google_apis_playstore;x86_64                                    | 3            | Google Play Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-Tiramisu;google_apis;arm64-v8a                                     | 2            | Google APIs ARM 64 v8a System Image</span><br><span class="line">  system-images;android-Tiramisu;google_apis;x86_64                                        | 2            | Google APIs Intel x86 Atom_64 System Image</span><br><span class="line">  system-images;android-Tiramisu;google_apis_playstore;x86_64                              | 2            | Google Play Intel x86 Atom_64 System Image</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>安装 <code>Android SDK</code> 软件包</li></ol><p>安装命令: <code>sdkmanager &lt;packages&gt;</code></p><p>这里至少需要安装三个组件： <code>platform-tools</code>、 <code>build-tools</code>、 <code>platforms</code> </p><p>命令：<code>./sdkmanager &quot;platform-tools&quot; &quot;build-tools;30.0.3&quot; &quot;platforms;android-34&quot; </code></p><blockquote><p>说明: 不同版本的 <code>Flutter SDK</code> 要求的这三个组件的版本会有所不同, 如果不知道具体的版本需求, 可以按以上版本进行安装, 等项目运行时, <code>Flutter</code> 会自动下载正确的版本。</p></blockquote><blockquote><p><code>Flutter 3.16.x</code> 需要  <code>Android SDK Platform 33</code>,命令可以更改为： <code>./sdkmanager &quot;platform-tools&quot; &quot;build-tools;30.0.3&quot; &quot;platforms;android-33&quot; </code></p></blockquote><p><code>Powershell窗口</code> 执行情况如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PS D:\AppData\Android\Sdk\cmdline-tools\latest\bin&gt; .\sdkmanager.bat <span class="string">&quot;platform-tools&quot;</span> <span class="string">&quot;build-tools;30.0.3&quot;</span> <span class="string">&quot;platforms;android-34&quot;</span></span><br><span class="line">License android-sdk-license:            ] 10% Computing updates...</span><br><span class="line">---------------------------------------</span><br><span class="line">Terms and Conditions</span><br><span class="line"></span><br><span class="line">This is the Android Software Development Kit License Agreement</span><br><span class="line"></span><br><span class="line">1. Introduction</span><br><span class="line"></span><br><span class="line">1.1 The Android Software Development Kit (referred to <span class="keyword">in</span> the License Agreement as the <span class="string">&quot;SDK&quot;</span> and specifically including the Android system files, packaged APIs, and Google APIs add-ons) is licensed to you subject to the terms of the License Agreement. The License Agreement forms a legally binding contract between you and Google <span class="keyword">in</span> relation to your use of the SDK.</span><br><span class="line"></span><br><span class="line">&lt;中间是很长的协议条文, 省略&gt;</span><br><span class="line"></span><br><span class="line">January 16, 2019</span><br><span class="line">---------------------------------------</span><br><span class="line">Accept? (y/N): y</span><br><span class="line">[=======================================] 100% Unzipping... android-11/renderscr</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="检测-Flutter-环境"><a href="#检测-Flutter-环境" class="headerlink" title="检测 Flutter 环境"></a>检测 Flutter 环境</h1><ol><li>执行命令：<code>flutter doctor -v</code>, 执行效果如下：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos&gt; flutter doctor -v</span><br><span class="line">[√] Flutter (Channel stable, 3.7.0, on Microsoft Windows [Version 10.0.17763.316], locale zh-CN)</span><br><span class="line">    • Flutter version 3.7.0 at C:\Users\Laohoo\AppData\Local\Android\flutter</span><br><span class="line">    • Upstream repository https://github.com/flutter/flutter.git</span><br><span class="line">    • Framework revision 7e9793dee1 (2 weeks ago), 2022-03-02 11:23:12 -0600</span><br><span class="line">    • Engine revision bd539267b4</span><br><span class="line">    • Dart version 2.19</span><br><span class="line">    • DevTools version 2.9.2</span><br><span class="line"></span><br><span class="line">[!] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 29.0.2)</span><br><span class="line">    • Android SDK at C:\Users\Laohoo\AppData\Local\Android\Sdk</span><br><span class="line">    • Platform android-33, build-tools 30.0.3</span><br><span class="line">    • ANDROID_HOME = C:\Users\Laohoo\AppData\Local\Android\Sdk</span><br><span class="line">    • Java binary at: C:\Users\Laohoo\AppData\Local\Android\openJDK\bin\java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 11.0.11+9-b60-7590822)</span><br><span class="line">    ! Some Android licenses not accepted.  To resolve this, run: flutter doctor --android-licenses</span><br><span class="line"></span><br><span class="line">[X] Chrome - develop <span class="keyword">for</span> the web (Cannot find Chrome executable at .\Google\Chrome\Application\chrome.exe)</span><br><span class="line">    ! Cannot find Chrome. Try setting CHROME_EXECUTABLE to a Chrome executable.</span><br><span class="line"></span><br><span class="line">[X] Visual Studio - develop <span class="keyword">for</span> Windows</span><br><span class="line">    X Visual Studio not installed; this is necessary <span class="keyword">for</span> Windows development.</span><br><span class="line">      Download at https://visualstudio.microsoft.com/downloads/.</span><br><span class="line">      Please install the <span class="string">&quot;Desktop development with C++&quot;</span> workload, including all of its default components</span><br><span class="line"></span><br><span class="line">[!] Android Studio (not installed)</span><br><span class="line">    • Android Studio not found; download from https://developer.android.com/studio/index.html</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/windows#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line"></span><br><span class="line">[√] VS Code, 64-bit edition (version 1.65.2)</span><br><span class="line">    • VS Code at C:\Program Files\Microsoft VS Code</span><br><span class="line">    • Flutter extension version 3.36.0</span><br><span class="line"></span><br><span class="line">[√] Connected device (2 available)</span><br><span class="line">    • Windows (desktop) • windows • windows-x64    • Microsoft Windows [Version 10.0.17763.316]</span><br><span class="line">    • Edge (web)        • edge    • web-javascript • Microsoft Edge 99.0.1150.46</span><br><span class="line"></span><br><span class="line">[!] HTTP Host Availability</span><br><span class="line">    X HTTP host https://maven.google.com/ is not reachable. Reason: An error occurred <span class="keyword">while</span> checking the HTTP host:</span><br><span class="line">      信号灯超时时间已到</span><br><span class="line"></span><br><span class="line">    X HTTP host https://cloud.google.com/ is not reachable. Reason: An error occurred <span class="keyword">while</span> checking the HTTP host:</span><br><span class="line">      信号灯超时时间已到</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! Doctor found issues <span class="keyword">in</span> 5 categories.</span><br></pre></td></tr></table></figure><ol start="2"><li>接受 Android 许可证</li></ol><p>执行命令：<code>flutter doctor --android-licenses</code>, 所有问题回答: <code>y</code></p><ol start="3"><li>再次检测 flutter 环境</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos&gt; flutter doctor -v</span><br><span class="line">[√] Flutter (Channel stable, 2.10.3, on Microsoft Windows [Version 10.0.17763.316], locale zh-CN)</span><br><span class="line">    • Flutter version 2.10.3 at C:\Users\Laohoo\AppData\Local\Android\flutter</span><br><span class="line">    • Upstream repository https://github.com/flutter/flutter.git</span><br><span class="line">    • Framework revision 7e9793dee1 (2 weeks ago), 2022-03-02 11:23:12 -0600</span><br><span class="line">    • Engine revision bd539267b4</span><br><span class="line">    • Dart version 2.16.1</span><br><span class="line">    • DevTools version 2.9.2</span><br><span class="line"></span><br><span class="line">[√] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 29.0.2)</span><br><span class="line">    • Android SDK at C:\Users\Laohoo\AppData\Local\Android\Sdk</span><br><span class="line">    • Platform android-30, build-tools 29.0.2</span><br><span class="line">    • ANDROID_HOME = C:\Users\Laohoo\AppData\Local\Android\Sdk</span><br><span class="line">    • Java binary at: C:\Users\Laohoo\AppData\Local\Android\openJDK\bin\java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 11.0.11+9-b60-7590822)</span><br><span class="line">    • All Android licenses accepted.</span><br><span class="line"></span><br><span class="line">[X] Chrome - develop <span class="keyword">for</span> the web (Cannot find Chrome executable at .\Google\Chrome\Application\chrome.exe)</span><br><span class="line">    ! Cannot find Chrome. Try setting CHROME_EXECUTABLE to a Chrome executable.</span><br><span class="line"></span><br><span class="line">[X] Visual Studio - develop <span class="keyword">for</span> Windows</span><br><span class="line">    X Visual Studio not installed; this is necessary <span class="keyword">for</span> Windows development.</span><br><span class="line">      Download at https://visualstudio.microsoft.com/downloads/.</span><br><span class="line">      Please install the <span class="string">&quot;Desktop development with C++&quot;</span> workload, including all of its default components</span><br><span class="line"></span><br><span class="line">[!] Android Studio (not installed)</span><br><span class="line">    • Android Studio not found; download from https://developer.android.com/studio/index.html</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/windows#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line"></span><br><span class="line">[√] VS Code, 64-bit edition (version 1.65.2)</span><br><span class="line">    • VS Code at C:\Program Files\Microsoft VS Code</span><br><span class="line">    • Flutter extension version 3.36.0</span><br><span class="line"></span><br><span class="line">[√] Connected device (2 available)</span><br><span class="line">    • Windows (desktop) • windows • windows-x64    • Microsoft Windows [Version 10.0.17763.316]</span><br><span class="line">    • Edge (web)        • edge    • web-javascript • Microsoft Edge 99.0.1150.46</span><br><span class="line"></span><br><span class="line">[☠] HTTP Host Availability (the doctor check crashed)</span><br><span class="line">    X Due to an error, the doctor check did not complete. If the error message below is not helpful, please <span class="built_in">let</span> us know</span><br><span class="line">      about this issue at https://github.com/flutter/flutter/issues.</span><br><span class="line">    X HandshakeException: Connection terminated during handshake</span><br><span class="line">    •</span><br><span class="line"></span><br><span class="line">! Doctor found issues <span class="keyword">in</span> 4 categories.</span><br></pre></td></tr></table></figure><p><code>Android toolchain</code>(Android 工具链) 检测正常, 安装完成。</p><blockquote><p><code>visual Studio Code</code> 安装步骤省略; </p></blockquote><blockquote><p><code>雷电模拟器</code>(不需要特别配置, 推荐)下载地址：<a href="https://www.ldmnq.com/">https://www.ldmnq.com/</a></p></blockquote><blockquote><p><code>夜神模拟器</code> 安装配置步骤请参考：<a href="https://hujiyi.github.io/2021/12/04/flutter-development-environment-configuration/">https://hujiyi.github.io/2021/12/04/flutter-development-environment-configuration/</a></p></blockquote><blockquote><p><code>雷电模拟器</code>、 <code>夜神模拟器</code> 或是 <code>Android Studio</code> 自带的模拟器, 只需要选择其中任意一个就可以。</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
            <tag> command-line tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用通道更换证件照的底色</title>
      <link href="/2022/02/27/using-channel-replace-the-background/"/>
      <url>/2022/02/27/using-channel-replace-the-background/</url>
      
        <content type="html"><![CDATA[<p>(目前只记录大概步骤，有空认真做一次再重新写)</p><p>很多年前偶尔用过一两次 <code>Photoshop</code>, 不过久了那些操作又忘记了, 所以这里记录一下, 感觉这次操作的效果没有以前的好, 可是以前那个教程的网站已经挂了，也只能将就了。</p><ol><li><p>打开照片</p></li><li><p>在通道中选择反差最大的一个通道, 复制通道</p></li><li><p>调整色阶, 加大反差效果</p></li><li><p>添加图层</p></li><li><p>菜单： 图像 -&gt; 应用图像;  通道: 选择之前步骤复制好的副本; 混合: 正片叠底.</p></li><li><p>添加蒙板</p></li><li><p>点击新图层 填充颜色</p></li><li><p>点击蒙板, 用黑、白颜色 画笔 处理边缘</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> photoshop </category>
          
      </categories>
      
      
        <tags>
            
            <tag> photoshop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记：使用 Cocos Creator 3.4.0 开发空战游戏 08(完)——粒子和血条</title>
      <link href="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/"/>
      <url>/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/</url>
      
        <content type="html"><![CDATA[<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><ol><li>Cocos Dashboard 1.0.20</li><li>Cocos Creator 3.4.0</li><li>Visual Studio Code 1.63</li><li>Microsoft Edge 97.0.1072.69</li></ol><h1 id="游戏配套素材资源下载："><a href="#游戏配套素材资源下载：" class="headerlink" title="游戏配套素材资源下载："></a>游戏配套素材资源下载：</h1><p><a href="https://hujiyi.github.io/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/res.zip">游戏开发配套素材资源</a></p><h1 id="导入特效资源"><a href="#导入特效资源" class="headerlink" title="导入特效资源"></a>导入特效资源</h1><ol><li>下载并解压游戏配套资源,  <code>res/particle package/</code> 文件夹包含已经制作好的一些特效资源</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- audio</span><br><span class="line">|-- effect</span><br><span class="line">|-- particle package</span><br><span class="line">|   |-- ball.zip           --- 场景装饰：星球     </span><br><span class="line">|   |-- cloudStars.zip     --- 场景装饰：背景云层特效     </span><br><span class="line">|   |-- explode.zip        --- 玩家飞机爆炸粒子特效     </span><br><span class="line">|   |-- explodeSmall.zip   --- 敌人飞机爆炸粒子特效     </span><br><span class="line">|   |-- stone.zip          --- 场景装饰：石头     </span><br><span class="line">|   `-- tailFlame.zip      --- 玩家飞机喷气特效     </span><br><span class="line">`-- texture </span><br></pre></td></tr></table></figure><ol start="2"><li>导入资源, 在 <code>资源管理器</code> 点击选中 <code>assets</code> 文件夹,  <code>右键</code> -&gt; <code>导入资源包</code>, 分三次导入<code>explode.zip</code>、 <code>explodeSmall.zip</code>、 <code>tailFlame.zip</code> 三个资源包。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/001.png" class="" title="AudioManager"><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/002.png" class="" title="AudioManager"><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/003.png" class="" title="AudioManager"><blockquote><p>导入后如果报错, 删除 <code>资源管理器</code> 中对应资源的文件夹 <code>tailFlame</code>、<code>explode</code>(导入的资源包与原有资源重复),  删除 <code>项目文件夹</code> 下的 <code>Libary</code> 文件夹, <code>重启</code> 编辑器, <code>刷新</code> 资源。</p></blockquote><h1 id="玩家飞机喷射的尾焰"><a href="#玩家飞机喷射的尾焰" class="headerlink" title="玩家飞机喷射的尾焰"></a>玩家飞机喷射的尾焰</h1><ol><li>在 <code>资源管理器</code> 拖动预制 <code>assets/res/effect/tailFlame/tailFlame</code> 到 <code>层级管理器</code> 的 <code>playerPlane</code> 节点，沿 Z轴 向下拖动的玩家飞机尾部。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/004.png" class="" title="tailFlame"><ol start="2"><li>在 <code>层级管理器</code> 点击选中 <code>playerPlane/tailFlame/flame01</code> 节点, 修改 <code>Scale(缩放)</code> 属性的值为 <code>X:8, Y:8, Z:8</code>, 放大 <code>8倍</code>。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/005.png" class="" title="tailFlame"><ol start="3"><li>在 <code>层级管理器</code> 点击选中 <code>playerPlane/tailFlame/flarecore04</code> 节点, 修改 <code>Scale(缩放)</code> 属性的值为 <code>X:8, Y:8, Z:8</code>, 放大 <code>8倍</code>;  再沿 <code>Z轴</code> 方向适当拖动, 调整火焰形状(这一步可以省略)。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/006.png" class="" title="tailFlame"><h1 id="玩家飞机爆炸特效"><a href="#玩家飞机爆炸特效" class="headerlink" title="玩家飞机爆炸特效"></a>玩家飞机爆炸特效</h1><ol><li><p>在 <code>资源管理器</code> 拖动预制 <code>assets/res/effect/explode/explode</code> 到 <code>层级管理器</code> 的 <code>playerPlane</code> 节点。</p></li><li><p>将 <code>层级管理器</code> 中 <code>playerPlane/explode</code> 的 <code>所有子节点</code> 的 <code>Scale(缩放)</code> 属性的值都改为 <code>X:4, Y:4, Z:4</code>, 放大 <code>4倍</code>。</p></li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/007.png" class="" title="tailFlame"><ol start="3"><li>编辑 <code>PlayerPlane</code> 脚本, 控制玩家飞机死亡时播放爆炸效果</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span>, <span class="title class_">AudioSource</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;PlayerPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PlayerPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">explode</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机爆炸效果</span></span><br><span class="line"></span><br><span class="line">    public lifeValue = <span class="number">5</span>;  <span class="comment">//玩家飞机生命</span></span><br><span class="line">    public isDie = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    private _currLife = <span class="number">0</span>;</span><br><span class="line">    private <span class="attr">_audioSource</span>: <span class="title class_">AudioSource</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_audioSource</span> = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">AudioSource</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currLife</span> = <span class="variable language_">this</span>.<span class="property">lifeValue</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isDie</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">explode</span>.<span class="property">active</span> = <span class="literal">false</span>;  <span class="comment">// 初始化玩家飞机爆炸效果</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取分组</span></span><br><span class="line">        <span class="keyword">const</span> collisionGroup = event.<span class="property">otherCollider</span>.<span class="title function_">getGroup</span>();</span><br><span class="line">        <span class="comment">// 遇到敌方飞机或敌方子弹，玩家飞机掉血</span></span><br><span class="line">        <span class="keyword">if</span> (collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_PLANE</span></span><br><span class="line">            || collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>) &#123;</span><br><span class="line">            <span class="comment">// 现在玩家飞机发生碰撞只在控制台输出文件</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currLife</span>--;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;player plane reduce blood:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_currLife</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currLife</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isDie</span> = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">explode</span>.<span class="property">active</span> = <span class="literal">true</span>;  <span class="comment">// 播放玩家飞机爆炸效果</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_audioSource</span>.<span class="title function_">play</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>将 <code>层级管理器</code> 点击选中 <code>playerPlane/explode</code> 节点，在属性检查器中将 <code>explode</code> 名字前面的 <code>✓</code> 去掉, 否则玩家飞机一开始就会显示爆炸特效。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/008.png" class="" title="tailFlame"><ol start="5"><li>将 <code>层级管理器</code> 点击选中 <code>playerPlane</code> 节点, 将 <code>playerPlane/explode</code> 节点拖动到 <code>属性检查器</code> 中对应的位置, 如下图所示:</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/009.png" class="" title="tailFlame"><h1 id="敌人飞机爆炸特效"><a href="#敌人飞机爆炸特效" class="headerlink" title="敌人飞机爆炸特效"></a>敌人飞机爆炸特效</h1><ol><li>在 <code>资源管理器</code> 双击打开 <code>assets/res/effect/explode/explodeSmall</code> 预制, 将其 <code>所有子节点</code> 的 <code>Scale(缩放)</code> 属性的值都改为 <code>X:6, Y:6, Z:6</code>, 放大 <code>6倍</code>, <code>保存</code> 预制。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/010.png" class="" title="tailFlame"><ol start="2"><li>敌人飞机爆炸直接在代码中进行控制, 编辑 <code>GameManager</code> 脚本。</li></ol><ul><li><p>添加爆炸预览的属性 <code>enemyExplode</code> 定义</p></li><li><p>添加播放爆炸效果的方法 <code>createEnemyEffect</code></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">public <span class="attr">enemyExplode</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机爆炸预览</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 播放敌机爆炸效果</span></span><br><span class="line">public <span class="title function_">createEnemyEffect</span>(<span class="params">pos: Vec3</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> effect = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemyExplode</span>);</span><br><span class="line">    effect.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;createEnemyEffect: &#x27;</span>, effect);</span><br><span class="line">    effect.<span class="title function_">setPosition</span>(pos);       </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>编辑 <code>enemyPlane</code> 脚本, 敌机销毁时播放爆炸特效</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 敌机被销毁的位置(超出屏幕下边沿后的Z轴坐标值)</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTOFBOUNCE</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;EnemyPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">EnemyPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public createBulletTime = <span class="number">0.5</span>;  <span class="comment">// 敌机子弹发射周期</span></span><br><span class="line"></span><br><span class="line">    private _enemySpeed = <span class="number">0</span>;</span><br><span class="line">    private _needBullet = <span class="literal">false</span>;  <span class="comment">// 敌机是否发射子弹</span></span><br><span class="line">    private _currCreateBulletTime = <span class="number">0</span>;  <span class="comment">// 敌机当前子弹发射周期</span></span><br><span class="line">    private <span class="attr">_gameManager</span>: <span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取分组</span></span><br><span class="line">        <span class="keyword">const</span> collisionGroup = event.<span class="property">otherCollider</span>.<span class="title function_">getGroup</span>();</span><br><span class="line">        <span class="comment">// 遇到玩家飞机或子弹，敌人飞机销毁</span></span><br><span class="line">        <span class="keyword">if</span> (collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_PLANE</span></span><br><span class="line">            || collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_BULLET</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;trigger enemy destroy&#x27;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">playAudioEffect</span>(<span class="string">&#x27;enemy&#x27;</span>);  <span class="comment">// 播放声音</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="comment">// 敌机爆炸</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">createEnemyEffect</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">addScore</span>();  <span class="comment">// 分数增加</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;</span><br><span class="line">        <span class="comment">// 敌机向下飞 pos.z 值要增加</span></span><br><span class="line">        <span class="keyword">let</span> movePos = pos.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_enemySpeed</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 增加用于判断是否要发射子弹</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_needBullet</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> += deltaTime;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> &gt; <span class="variable language_">this</span>.<span class="property">createBulletTime</span>) &#123;</span><br><span class="line">                <span class="comment">// 敌机发射子弹，需要在 GameManager 添加相应函数</span></span><br><span class="line">                <span class="comment">// this.node.position 是发射子弹时敌机的位置</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">createEnemyBullet</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, movePos);</span><br><span class="line">        <span class="keyword">if</span> (movePos &gt; <span class="variable constant_">OUTOFBOUNCE</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">gameManager: GameManager, speed: number, needBullet: boolean = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameManager</span> = gameManager;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_enemySpeed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_needBullet</span> = needBullet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>资源管理器</code> 的 <code>script</code> 文件夹添加脚本 <code>Explode</code>, 使用定时器 <code>1秒</code> 后销毁爆炸效果</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;Explode&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Explode</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 1秒后回收敌机爆炸效果</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">scheduleOnce</span>(<span class="variable language_">this</span>.<span class="property">_putBack</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_putBack</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="5"><li>在 <code>资源管理器</code> 双击打开 <code>assets/res/effect/explode/explodeSmall</code> 预制,  在 <code>属性检查器</code> 中点击 <code>添加组件</code> -&gt; <code>自定义脚本</code> -&gt; <code>Explode</code>, 绑定脚本。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/011.png" class="" title="tailFlame"><ol start="6"><li>在 <code>层级管理器</code> 点击选中 <code>gameManager</code> 节点, 添加 <code>explodeSmall</code> 预制到对应的属性。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/012.png" class="" title="tailFlame"><ol start="7"><li><code>保存</code> 场景, 运行预览。</li></ol><h1 id="玩家飞机血条"><a href="#玩家飞机血条" class="headerlink" title="玩家飞机血条"></a>玩家飞机血条</h1><ol><li>在 <code>层级管理器</code> 点击选中 <code>playerPlane</code> 节点, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>空节点</code>, 命名为 <code>blood</code>; 点击选中 <code>blood</code>节点, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>3D对象</code> -&gt; <code>Quad(四方形)</code>, 命名为 <code>bg</code>, 在 <code>属性检查器</code> 中将 <code>Rotation</code> 的值修改为 <code>X:-90, Y:0, Z:0</code>, 沿 <code>X轴</code> 旋转, <code>Scale</code> 属性的值修改为 <code>x:1, Y:0.2, Z:1</code>, 变成长条形状。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/013.png" class="" title="blood"><ol start="2"><li>再次点击选中 <code>blood</code>节点, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>3D对象</code> -&gt; <code>Quad(四方形)</code>, 命名为 <code>face</code>。在 <code>属性检查器</code> 中将 <code>Position</code> 的值修改为<code>X:0, Y:0.1, Z:0</code>, 让血条比背景 <code>高出</code> 一点点; <code>Rotation</code> 的值修改为 <code>X:-90, Y:0, Z:0</code>, 沿 <code>X轴</code> 旋转; <code>Scale</code> 属性的值修改为 <code>x:1, Y:0.2, Z:1</code>, 变成长条形状。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/014.png" class="" title="blood"><ol start="3"><li>在 <code>层级管理器</code> 点击选中 <code>playerPlane/blood</code> 节点, 沿 <code>Z轴</code> 向下拖动到飞机尾部, 修改 <code>Scale(缩放)</code> 属性的值为 <code>X:8, Y:1, Z: 3</code>, 缩放为 <code>长条形状</code>。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/015.png" class="" title="blood"><ol start="4"><li>在 <code>资源管理器</code> 的 <code>assets/res/texture/</code> 文件夹下 <code>创建</code> 两个材质, 分别命名为 <code>fightBoxBlood02a</code> 和 <code>fightBoxBlood02b</code>, <code>Effect</code> 属性的值更改为 <code>builtin-unlit</code>, <code>USETEXTURE</code> 打勾, <code>MainTexture</code> 分别拖入图片 <code>fightBoxBlood02a</code> 和 <code>fightBoxBlood02b</code>, <code>保存</code> 材质。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/016.png" class="" title="blood"><ol start="5"><li>分别将材质 <code>fightBoxBlood02a</code> 和 <code>fightBoxBlood02b</code> 添加到 <code>playerPlane/blood</code> 节点的子节点 <code>bg</code> 和 <code>face</code> 中。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/017.png" class="" title="blood"><ol start="6"><li><p>在 <code>层级管理器</code> 点击选中 <code>playerPlane/blood</code> 节点, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>空节点</code>, 命名为 <code>face</code>, 将之前血条前景的 <code>face</code> 拖到这个 <code>新建</code> 的 <code>空节点</code> 下。</p></li><li><p>在 <code>层级管理器</code> 点击选中 <code>playerPlane/blood/face/face</code> 节点, 沿 <code>X轴向右拖动</code> 到血条的一半位置。(<code>Position X: 0.5</code>)</p></li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/018.png" class="" title="blood"><ol start="8"><li>在 <code>层级管理器</code> 点击选中前一步骤的父节点 <code>playerPlane/blood/face</code>, 沿 <code>X轴向左拖动</code> 到与背景重叠。(<code>Position X: -0.5</code>)</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/019.png" class="" title="blood"><blockquote><p>使用步骤 7、8 是因为直接减少血条前景对象是 3D 对象是由两边向中间同时减少的，所以通过以上步骤实现血条由右向左减少。</p></blockquote><ol start="9"><li><p>在 <code>层级管理器</code> 点击选中 <code>playerPlane/blood</code> 节点, 在其 <code>属性检查器</code> 把名字 <code>blood</code> 左边的 <code>✓</code> 去掉, 默认不显示血条。</p></li><li><p>在 <code>层级管理器</code> 点击选中 <code>playerPlane</code> 节点, 将 <code>血条根节点</code>和 <code>血条</code> 添加到对应的属性中。</p></li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/020.png" class="" title="blood"><p>编辑玩家飞机脚本 <code>PlayerPlane</code>, 控制血条的显示</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span>, <span class="title class_">AudioSource</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;PlayerPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PlayerPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">explode</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;    <span class="comment">// 玩家飞机爆炸效果</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bloodFace</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;  <span class="comment">// 玩家血条</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">blood</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;      <span class="comment">// 血量根节点</span></span><br><span class="line"></span><br><span class="line">    public lifeValue = <span class="number">5</span>;  <span class="comment">//玩家飞机生命</span></span><br><span class="line">    public isDie = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    private _currLife = <span class="number">0</span>;</span><br><span class="line">    private <span class="attr">_audioSource</span>: <span class="title class_">AudioSource</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_audioSource</span> = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">AudioSource</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currLife</span> = <span class="variable language_">this</span>.<span class="property">lifeValue</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isDie</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">explode</span>.<span class="property">active</span> = <span class="literal">false</span>;  <span class="comment">// 初始化玩家飞机爆炸效果</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bloodFace</span>.<span class="title function_">setScale</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);  <span class="comment">// 血条初始化</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取分组</span></span><br><span class="line">        <span class="keyword">const</span> collisionGroup = event.<span class="property">otherCollider</span>.<span class="title function_">getGroup</span>();</span><br><span class="line">        <span class="comment">// 遇到敌方飞机或敌方子弹，玩家飞机掉血</span></span><br><span class="line">        <span class="keyword">if</span> (collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_PLANE</span></span><br><span class="line">            || collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">_currLife</span> ===<span class="variable language_">this</span>.<span class="property">lifeValue</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">blood</span>.<span class="property">active</span> = <span class="literal">true</span>;  <span class="comment">// 第一次被攻击后才显示玩家飞机血条</span></span><br><span class="line">                &#125;</span><br><span class="line">           </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currLife</span>--;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">bloodFace</span>.<span class="title function_">setScale</span>(<span class="variable language_">this</span>.<span class="property">_currLife</span> / <span class="variable language_">this</span>.<span class="property">lifeValue</span>, <span class="number">1</span>, <span class="number">1</span>);  <span class="comment">// 血条减少</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;player plane reduce blood:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_currLife</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currLife</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isDie</span> = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">explode</span>.<span class="property">active</span> = <span class="literal">true</span>;  <span class="comment">// 播放玩家飞机爆炸效果</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">blood</span>.<span class="property">active</span> = <span class="literal">false</span>;   <span class="comment">// 不显示血条</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_audioSource</span>.<span class="title function_">play</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="11"><li>保存场景, 运行预览。</li></ol><img src="/2022/02/05/develop-an-airplane-game-in-cocos-creator-08/021.png" class="" title="blood"><p>&#x3D;&#x3D;&#x3D;全部完成&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> cocos creator </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cocos creator </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记：使用 Cocos Creator 3.4.0 开发空战游戏 07——游戏音效</title>
      <link href="/2022/02/04/develop-an-airplane-game-in-cocos-creator-07/"/>
      <url>/2022/02/04/develop-an-airplane-game-in-cocos-creator-07/</url>
      
        <content type="html"><![CDATA[<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><ol><li>Cocos Dashboard 1.0.20</li><li>Cocos Creator 3.4.0</li><li>Visual Studio Code 1.63</li><li>Microsoft Edge 97.0.1072.69</li></ol><h1 id="音频"><a href="#音频" class="headerlink" title="音频"></a>音频</h1><ol><li>在 <code>层级管理器</code> 创建名为 <code>audio</code> 的 <code>空节点</code>, 然后在 <code>audio</code> 节点上再创建一个 <code>空节点</code>，命名为 <code>bgm</code>(backgroundmusic), 点击选中 <code>bgm</code> 节点, 在 <code>属性检查器</code> 点击 <code>添加组件</code> 按钮, 选择  <code>Audio</code> -&gt; <code>AudioSource</code>, 将 <code>资源管理器</code> 中的  <code>assets/res/audio/music/bgm</code> 拖动到 <code>bgm</code> 节点的 <code>Clip</code> 属性中, 选中 <code>Loop</code> 和 <code>PlayOnAwake</code> 两个属性,  <code>Volume</code> 属性的值改为 <code>0.8</code>。</li></ol><img src="/2022/02/04/develop-an-airplane-game-in-cocos-creator-07/001.png" class="" title="BGM"><ol start="2"><li>在 <code>层级管理器</code> 点击选中 <code>plane01</code> 节点, 在其 <code>属性检查器</code> 点击 <code>添加组件</code> 按钮, 选择  <code>Audio</code> -&gt; <code>AudioSource</code>, 将 <code>资源管理器</code> 中的  <code>assets/res/audio/sound/player</code> 拖动到其 <code>Clip</code> 属性中, <code>取消</code> 选中 <code>Loop</code> 和 <code>PlayOnAwake</code> 两个属性。</li></ol><img src="/2022/02/04/develop-an-airplane-game-in-cocos-creator-07/002.png" class="" title="player"><ol start="3"><li><p>在 <code>资源管理器</code> 点击选中 <code>assets/script/framework</code> 文件夹，<code>右键</code> -&gt; <code>创建</code> -&gt; <code>脚本(TypeScript)</code>, 命名为 <code>AudioManager</code>, 脚本文件暂时不用编辑内容。</p></li><li><p>在 <code>层级管理器</code> 点击选中 <code>audio</code> 节点, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>空节点</code>, 命名为 <code>effect</code>, 在其 <code>属性检查器</code> 点击 <code>添加组件</code> 按钮, 选择  <code>Audio</code> -&gt; <code>AudioSource</code>; 再点击一次 <code>添加组件</code> 按钮, 选择  <code>自定义脚本</code> -&gt; <code>AudioManager</code>。</p></li></ol><img src="/2022/02/04/develop-an-airplane-game-in-cocos-creator-07/003.png" class="" title="AudioManager"><ol start="5"><li>编辑脚本 <code>AudioManager</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">AudioClip</span>, <span class="title class_">AudioSource</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">IAudioMap</span> &#123;</span><br><span class="line">    [<span class="attr">name</span>: string]: <span class="title class_">AudioClip</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;AudioManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AudioManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>([<span class="title class_">AudioClip</span>])</span><br><span class="line">    public <span class="attr">audioList</span>: <span class="title class_">AudioClip</span>[] = [];</span><br><span class="line"></span><br><span class="line">    private <span class="attr">_dict</span>: <span class="title class_">IAudioMap</span> = &#123;&#125;;</span><br><span class="line">    private <span class="attr">_audioSource</span>: <span class="title class_">AudioSource</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">audioList</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> element = <span class="variable language_">this</span>.<span class="property">audioList</span>[i];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_dict</span>[element.<span class="property">name</span>] = element;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;sound: &#x27;</span>, <span class="variable language_">this</span>.<span class="property">_dict</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_audioSource</span> = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">AudioSource</span>)!;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public <span class="title function_">play</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> audioClip = <span class="variable language_">this</span>.<span class="property">_dict</span>[name];</span><br><span class="line">        <span class="keyword">if</span> (audioClip !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;play audio:&#x27;</span>, audioClip.<span class="property">name</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_audioSource</span>.<span class="title function_">playOneShot</span>(audioClip);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>编辑 <code>GameManager</code> 脚本, 添加对 <code>AudioManager</code> 进行管理的代码:</li></ol><ul><li><p>添加属性</p></li><li><p>添加方法 playAudioEffect()</p></li><li><p>更新方法: update()</p></li></ul><p>完整代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, instantiate, math, <span class="title class_">Vec3</span>, <span class="title class_">BoxCollider</span>, <span class="title class_">Label</span>, <span class="title class_">Animation</span>, macro &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Bullet</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/Bullet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BulletProp</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/BulletProp&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnemyPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/EnemyPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PlayerPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/PlayerPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AudioManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./AudioManager&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">PlayerPlane</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">PlayerPlane</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹2</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet03</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹3</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet04</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹4</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet05</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹5</span></span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public shootTime = <span class="number">0.3</span>; <span class="comment">// 射击周期（间隔时间）</span></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">1</span>;  <span class="comment">// 子弹速度</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bulletRoot</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 子弹管理节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机2</span></span><br><span class="line">    @property</span><br><span class="line">    public createEnemyTime = <span class="number">1</span>;  <span class="comment">// 敌机生成时间</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy01Speed = <span class="number">0.5</span>;  <span class="comment">// 敌机1速度</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy02Speed = <span class="number">0.7</span>;  <span class="comment">// 敌机2速度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子弹类型道具</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropM</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropH</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropS</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @property</span><br><span class="line">    public bulletPropSpeed = <span class="number">0.3</span>;  <span class="comment">// 子弹类型道具速度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ui</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">gamePage</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">gameOverPage</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    public <span class="attr">gameScore</span>: <span class="title class_">Label</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    public <span class="attr">gameOverScore</span>: <span class="title class_">Label</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Animation</span>)</span><br><span class="line">    public <span class="attr">overAnimation</span>: <span class="title class_">Animation</span> = <span class="literal">null</span>;  <span class="comment">// Animation 要手工添加导入</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// audio</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">AudioManager</span>)</span><br><span class="line">    public <span class="attr">audioEffect</span>: <span class="title class_">AudioManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    public isGameStart = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    private _currShootTime = <span class="number">0</span>;</span><br><span class="line">    private _isShooting = <span class="literal">false</span>;</span><br><span class="line">    private _currCreateEnemyTiime = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">    private _combinationInterval = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line">    private _bulletType = <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>;  <span class="comment">// 子弹道具类型</span></span><br><span class="line"></span><br><span class="line">    private <span class="attr">_score</span>: number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isGameStart</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">isDie</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">gameOver</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> += deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isShooting</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_currShootTime</span> &gt; <span class="variable language_">this</span>.<span class="property">shootTime</span>) &#123;</span><br><span class="line">            <span class="comment">// 判断子弹道具的类型</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_bulletType</span> === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_H</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletH</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_bulletType</span> === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_S</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletS</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletM</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 子弹的音效，用除2的余数得到名字后面的数字字符</span></span><br><span class="line">            <span class="keyword">let</span> name = <span class="string">&#x27;bullet&#x27;</span> + (<span class="variable language_">this</span>.<span class="property">_bulletType</span> % <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;player shooting: &#x27;</span>,name);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">playAudioEffect</span>(name);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> += deltaTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断组合方式创建相应的敌机</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">            <span class="comment">// 第二阶段，前两种组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.9</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 第三阶段，三个组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.8</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN3</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination02</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建玩家飞机的子弹</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletM</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet类 （子弹预制根节点添加 Bullet 脚本）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>); <span class="comment">// 设置子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// S型子弹为前方同时发射两颗</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletH</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 左边的子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet1 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet03</span>);</span><br><span class="line">        bullet1.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet1.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="number">2.5</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp1 = bullet1.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp1.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 右边的子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet2 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet03</span>);</span><br><span class="line">        bullet2.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet2.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="number">2.5</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp2 = bullet2.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp2.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// S型子弹为三发</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletS</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 中间子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet1 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet1.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet1.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp1 = bullet1.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp1.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 左边子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet2 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet2.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet2.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="number">4</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp2 = bullet2.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp2.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>, <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">LEFT</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 右边子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet3 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet3.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet3.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="number">4</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp3 = bullet3.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp3.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>, <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">RIGHT</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否处理触摸状态，触摸才发射子弹</span></span><br><span class="line">    public <span class="title function_">isShooting</span>(<span class="params">value: boolean</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">createEnemyPlane</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// math 是 cc 带的数字模块</span></span><br><span class="line">        <span class="keyword">const</span> whichEnemy = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> speed = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (whichEnemy === <span class="title class_">Constant</span>.<span class="property">EnemyType</span>.<span class="property">TYPE1</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy01</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy02</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化预制 </span></span><br><span class="line">        <span class="keyword">const</span> enemy = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        enemy.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>); <span class="comment">// 预制挂载到组件中</span></span><br><span class="line">        <span class="keyword">const</span> enemyComp = enemy.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">        enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, speed, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 敌机随机出现的X轴(左右)坐标范围</span></span><br><span class="line">        <span class="keyword">const</span> randomPos = math.<span class="title function_">randomRangeInt</span>(-<span class="number">25</span>, <span class="number">26</span>);</span><br><span class="line">        enemy.<span class="title function_">setPosition</span>(randomPos, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1：5架飞机一字型同时出现</span></span><br><span class="line">    public <span class="title function_">createCombination01</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy01</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(-<span class="number">20</span> + i * <span class="number">10</span>, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1, 7架飞机V字型出现</span></span><br><span class="line">    public <span class="title function_">createCombination02</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 7 架敌机的初始坐标</span></span><br><span class="line">        <span class="keyword">const</span> combinationPos = [</span><br><span class="line">            -<span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">            -<span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            -<span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, -<span class="number">45</span>,</span><br><span class="line">            <span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            <span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy02</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            <span class="keyword">const</span> startIndex = i * <span class="number">3</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(combinationPos[startIndex],</span><br><span class="line">                combinationPos[startIndex + <span class="number">1</span>],</span><br><span class="line">                combinationPos[startIndex + <span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机发射子弹</span></span><br><span class="line">    public <span class="title function_">createEnemyBullet</span>(<span class="params">targetPos: Vec3</span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(targetPos.<span class="property">x</span>, targetPos.<span class="property">y</span>, targetPos.<span class="property">z</span> + <span class="number">6</span>);</span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// 敌机的子弹速度 要比敌机大一些</span></span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取子弹的碰撞器组件</span></span><br><span class="line">        <span class="keyword">const</span> colliderComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">BoxCollider</span>);</span><br><span class="line">        <span class="comment">// 设置敌机子弹的碰撞矩阵</span></span><br><span class="line">        colliderComp.<span class="title function_">setGroup</span>(<span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>);</span><br><span class="line">        <span class="comment">// 设置碰撞掩码 与 玩家飞机 碰撞</span></span><br><span class="line">        colliderComp.<span class="title function_">setMask</span>(<span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_PLANE</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更换玩家子弹类型    </span></span><br><span class="line">    public <span class="title function_">changeBulletType</span>(<span class="params">type: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletType</span> = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建子弹道具  </span></span><br><span class="line">    public <span class="title function_">createBulletProp</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> randomProp = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create bullet prop:&#x27;</span>, randomProp);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (randomProp === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_H</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropH</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomProp === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_S</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropS</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropM</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化子弹道具预览</span></span><br><span class="line">        <span class="keyword">const</span> prop = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        prop.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// const prop = PoolManager.instance().getNode(prefab, this.node);</span></span><br><span class="line"></span><br><span class="line">        prop.<span class="title function_">setPosition</span>(<span class="number">15</span>, <span class="number">0</span>, -<span class="number">50</span>);  <span class="comment">// 道具的起始位置</span></span><br><span class="line">        <span class="keyword">const</span> propComp = prop.<span class="title function_">getComponent</span>(<span class="title class_">BulletProp</span>);</span><br><span class="line">        propComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, -<span class="variable language_">this</span>.<span class="property">bulletPropSpeed</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public <span class="title function_">returnMain</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span> = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletType</span> = <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">15</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_score</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">gameReStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">gameStart</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间        </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span> = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletType</span> = <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">15</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">gameStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isGameStart</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="title function_">init</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_score</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameScore</span>.<span class="property">string</span> = <span class="variable language_">this</span>.<span class="property">_score</span>.<span class="title function_">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">gameOver</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isGameStart</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamePage</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameOverPage</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameOverScore</span>.<span class="property">string</span> = <span class="variable language_">this</span>.<span class="property">_score</span>.<span class="title function_">toString</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">overAnimation</span>.<span class="title function_">play</span>();  <span class="comment">// 播放游戏结束的动画</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameScore</span>.<span class="property">string</span> = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        <span class="comment">// this.playerPlane.init();</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">unschedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>);  <span class="comment">// 取消定时器</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_destoryAll</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">addScore</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_score</span>++;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameScore</span>.<span class="property">string</span> = <span class="variable language_">this</span>.<span class="property">_score</span>.<span class="title function_">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">playAudioEffect</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">audioEffect</span>.<span class="title function_">play</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_destoryAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> children = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>;</span><br><span class="line">        <span class="keyword">let</span> length = children.<span class="property">length</span>;</span><br><span class="line">        <span class="comment">// 销毁对象时要从后往前，不能从前往后</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = length - <span class="number">1</span>; index &gt;= <span class="number">0</span>; index--) &#123;</span><br><span class="line">            <span class="keyword">const</span> child = children[index];</span><br><span class="line">            child.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        children = <span class="variable language_">this</span>.<span class="property">bulletRoot</span>.<span class="property">children</span>;</span><br><span class="line">        length = children.<span class="property">length</span>;</span><br><span class="line">        <span class="comment">// 销毁对象时要从后往前，不能从前往后</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = length - <span class="number">1</span>; index &gt;= <span class="number">0</span>; index--) &#123;</span><br><span class="line">            <span class="keyword">const</span> child = children[index];</span><br><span class="line">            child.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 用于按下的时候即发射第一颗子弹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="variable language_">this</span>.<span class="property">shootTime</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定时器函数</span></span><br><span class="line">    private <span class="title function_">_changePlaneModel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// this.schedule()四个参数：回调， 间隔时间，重复次数， 延迟时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>, <span class="number">10</span>, macro.<span class="property">REPEAT_FOREVER</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变组合状态</span></span><br><span class="line">    private <span class="title function_">_modeChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span>++;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createBulletProp</span>();  <span class="comment">// 创建子弹道具</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="7"><li>编辑 <code>EnemyPlane</code> 脚本， 添加敌人飞机 <code>销毁</code> 的音效</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 敌机被销毁的位置(超出屏幕下边沿后的Z轴坐标值)</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTOFBOUNCE</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;EnemyPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">EnemyPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public createBulletTime = <span class="number">0.5</span>;  <span class="comment">// 敌机子弹发射周期</span></span><br><span class="line"></span><br><span class="line">    private _enemySpeed = <span class="number">0</span>;</span><br><span class="line">    private _needBullet = <span class="literal">false</span>;  <span class="comment">// 敌机是否发射子弹</span></span><br><span class="line">    private _currCreateBulletTime = <span class="number">0</span>;  <span class="comment">// 敌机当前子弹发射周期</span></span><br><span class="line">    private <span class="attr">_gameManager</span>: <span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取分组</span></span><br><span class="line">        <span class="keyword">const</span> collisionGroup = event.<span class="property">otherCollider</span>.<span class="title function_">getGroup</span>();</span><br><span class="line">        <span class="comment">// 遇到玩家飞机或子弹，敌人飞机销毁</span></span><br><span class="line">        <span class="keyword">if</span> (collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_PLANE</span></span><br><span class="line">            || collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_BULLET</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;trigger enemy destroy&#x27;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">playAudioEffect</span>(<span class="string">&#x27;enemy&#x27;</span>);  <span class="comment">// 播放声音</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">addScore</span>();  <span class="comment">// 分数增加           </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;</span><br><span class="line">        <span class="comment">// 敌机向下飞 pos.z 值要增加</span></span><br><span class="line">        <span class="keyword">let</span> movePos = pos.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_enemySpeed</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 增加用于判断是否要发射子弹</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_needBullet</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> += deltaTime;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> &gt; <span class="variable language_">this</span>.<span class="property">createBulletTime</span>) &#123;</span><br><span class="line">                <span class="comment">// 敌机发射子弹，需要在 GameManager 添加相应函数</span></span><br><span class="line">                <span class="comment">// this.node.position 是发射子弹时敌机的位置</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">createEnemyBullet</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, movePos);</span><br><span class="line">        <span class="keyword">if</span> (movePos &gt; <span class="variable constant_">OUTOFBOUNCE</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">gameManager: GameManager, speed: number, needBullet: boolean = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameManager</span> = gameManager;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_enemySpeed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_needBullet</span> = needBullet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="8"><li>编辑 <code>PlayerPlane</code> 脚本， 添加玩家飞机的音效</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span>, <span class="title class_">AudioSource</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;PlayerPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PlayerPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    public lifeValue = <span class="number">5</span>;  <span class="comment">//玩家飞机生命</span></span><br><span class="line">    public isDie = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    private _currLife = <span class="number">0</span>;</span><br><span class="line">    private <span class="attr">_audioSource</span>: <span class="title class_">AudioSource</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_audioSource</span> = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">AudioSource</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currLife</span> = <span class="variable language_">this</span>.<span class="property">lifeValue</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isDie</span> = <span class="literal">false</span>;       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取分组</span></span><br><span class="line">        <span class="keyword">const</span> collisionGroup = event.<span class="property">otherCollider</span>.<span class="title function_">getGroup</span>();</span><br><span class="line">        <span class="comment">// 遇到敌方飞机或敌方子弹，玩家飞机掉血</span></span><br><span class="line">        <span class="keyword">if</span> (collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_PLANE</span></span><br><span class="line">            || collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>) &#123;</span><br><span class="line">            <span class="comment">// 现在玩家飞机发生碰撞只在控制台输出文件</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currLife</span>--;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;player plane reduce blood:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_currLife</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currLife</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isDie</span> = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_audioSource</span>.<span class="title function_">play</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="9"><li>编辑 <code>UIManager</code> 脚本，添加按钮音效</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Touch</span>, <span class="title class_">EventTouch</span>, <span class="title class_">Input</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;UIManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UIManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public playerPlaneSpeed = <span class="number">1</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加游戏控制脚本</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line">    public <span class="attr">gameManager</span>: <span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">gameStart</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">game</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">gameOver</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_START</span>, <span class="variable language_">this</span>.<span class="property">_touchStart</span>, <span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_MOVE</span>, <span class="variable language_">this</span>.<span class="property">_touchMove</span>, <span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_END</span>, <span class="variable language_">this</span>.<span class="property">_touchEnd</span>, <span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameStart</span>.<span class="property">active</span> = <span class="literal">true</span>;   <span class="comment">// 显示开始界面</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新开始按钮对应代码</span></span><br><span class="line">    public <span class="title function_">reStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameOver</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">game</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">audioEffect</span>.<span class="title function_">play</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">gameReStart</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回主页按钮代码</span></span><br><span class="line">    public <span class="title function_">returnMain</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameOver</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameStart</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">audioEffect</span>.<span class="title function_">play</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">returnMain</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_touchMove</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">isGameStart</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// touch.getDelta() 获取当前触点值与上一次触点值的差值</span></span><br><span class="line">        <span class="keyword">let</span> delta = touch.<span class="title function_">getDelta</span>();</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>;  <span class="comment">// 获取当前节点的位置</span></span><br><span class="line">        <span class="comment">// 在速度前乘以 0.01 是用于调整移动的速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="title function_">setPosition</span>(</span><br><span class="line">            pos.<span class="property">x</span> + <span class="number">0.01</span> * <span class="variable language_">this</span>.<span class="property">playerPlaneSpeed</span> * delta.<span class="property">x</span>,</span><br><span class="line">            pos.<span class="property">y</span>,</span><br><span class="line">            pos.<span class="property">z</span> - <span class="number">0.01</span> * <span class="variable language_">this</span>.<span class="property">playerPlaneSpeed</span> * delta.<span class="property">y</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始触摸屏幕的回调方法</span></span><br><span class="line">    private <span class="title function_">_touchStart</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">isGameStart</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">isShooting</span>(<span class="literal">true</span>); <span class="comment">// 触摸屏幕时玩家飞机开始射击</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameStart</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">game</span>.<span class="property">active</span> = <span class="literal">true</span>; </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">audioEffect</span>.<span class="title function_">play</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">gameStart</span>();</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_touchEnd</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">isGameStart</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 停止触摸时玩家飞机结束射击</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">isShooting</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="10"><li>在 <code>层级管理器</code> 点击选中 <code>audio/effect</code> 节点, 其 <code>AudioList</code> 属性的值改为 <code>4</code>, 点击名字左边的 <code>三角符号</code>, 依次将 <code>bullet1</code>、<code>bullet2</code>、<code>button</code>、<code>enemy</code> 四个音效拖进去。</li></ol><img src="/2022/02/04/develop-an-airplane-game-in-cocos-creator-07/004.png" class="" title="AudioManager"><ol start="11"><li>在 <code>层级管理器</code> 中将 <code>audio/effect</code> 节点关联到 <code>gameManager</code> 节点的属性 <code>AudioEfect</code>  。</li></ol><img src="/2022/02/04/develop-an-airplane-game-in-cocos-creator-07/005.png" class="" title="AudioManager"><ol start="12"><li>保存场景, 运行预览。</li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> cocos creator </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cocos creator </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记：使用 Cocos Creator 3.4.0 开发空战游戏 06——游戏界面</title>
      <link href="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/"/>
      <url>/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/</url>
      
        <content type="html"><![CDATA[<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><ol><li>Cocos Dashboard 1.0.20</li><li>Cocos Creator 3.4.0</li><li>Visual Studio Code 1.63</li><li>Microsoft Edge 97.0.1072.69</li></ol><h1 id="界面宽度和高度"><a href="#界面宽度和高度" class="headerlink" title="界面宽度和高度"></a>界面宽度和高度</h1><ol><li>当前游戏只有一个场景: 主场景。界面则分为三个部分：主界面(gameStart), 游戏界面(game)和结算界面(gameOver)。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/000.png" class="" title="VSCode"><ol start="2"><li>在 <code>主菜单</code> 选择 <code>项目</code> -&gt; <code>项目设置</code>, 在弹出的 <code>项目设置</code> 窗口 <code>左侧</code> 选中 <code>项目数据</code>, <code>右侧</code> 窗格中的 <code>设计宽度</code> 改为 <code>640</code>, <code>设计高度</code> 改为 <code>960</code>, 关闭窗口。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/001.png" class="" title="VSCode"><h1 id="游戏主界面-开始界面"><a href="#游戏主界面-开始界面" class="headerlink" title="游戏主界面(开始界面)"></a>游戏主界面(开始界面)</h1><ol><li>在 <code>资源管理器</code> 中点击选中图片 <code>assets/res/texture/logo</code>, 在 <code>属性检查器</code> 中将图片 <code>logo.png</code> 的属性 <code>Type</code>(图片类型) 更改为 <code>sprite-frame</code>, 保存更改。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/002.png" class="" title="VSCode"><ol start="2"><li><p>点击 <code>场景编辑器</code> 上方 <code>3D</code> 按钮，切换为 <code>2D</code> 模式。</p></li><li><p>在 <code>层级管理器</code> 点击选中 <code>Canvas</code> 节点，<code>右键</code> -&gt; <code>创建</code> -&gt; <code>空节点</code>, 命名为 <code>gameStart</code>。</p></li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/003.png" class="" title="gameStart"><ol start="4"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameStart</code> 节点，在 <code>属性检查器</code> 中点击 <code>添加组件</code> -&gt; <code>UI</code> -&gt; <code>Widget</code>。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/004.png" class="" title="gameStart"><ol start="5"><li><code>Canvas/gameStart/Widget</code> 的属性 <code>Horizontal Alignment</code> 设为 <code>Horizontal Stretch</code>, <code>Left</code> 的值设为 <code>0</code>, <code>Right</code> 的值设为 <code>0</code>; 属性 <code>Vertical Alignment</code> 设为 <code>Vertical Stretch</code>, <code>Top</code> 的值设为 <code>0</code>, <code>Bottom</code> 的值设为 <code>0</code>。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/005.png" class="" title="gameStart"><ol start="6"><li>将 <code>资源管理器</code> 中 <code>图片类型</code> 已经更改为 <code>sprite-frame</code> 的图片 <code>assets/res/texture/logo</code> 拖动到 <code>层级管理器</code> 下的 <code>Canvas/gameStart</code> 节点。将 <code>logo</code> 节点沿 <code>Y轴</code> 向上拖动到界面上方(例如此处<code>Position, Y:225</code>)</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/006.png" class="" title="gameStart"><ol start="7"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameStart</code> 节点, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>2D对象</code> -&gt; <code>Label(文本)</code>, 命名为 <code>tip</code>, 在其 <code>属性检查器</code> 中将 <code>String</code> 属性的值改为 <code>滑动开始游戏</code>, <code>FontSize</code> 属性的值改为 <code>40</code>。并沿 <code>Y轴</code> 向下拖动到合适的位置, 保存场景。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/007.png" class="" title="gameStart"><h1 id="游戏界面"><a href="#游戏界面" class="headerlink" title="游戏界面"></a>游戏界面</h1><ol><li><p>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameStart</code> 节点, <code>Ctrl+D</code> 复制节点后命名为 <code>game</code>。</p></li><li><p>删除 <code>game</code> 节点原有的 <code>logo</code> 和 <code>tip</code> 节点。</p></li><li><p>在 <code>资源管理器</code> 中点击选中图片 <code>assets/res/texture/fightBoxScore</code>, 在 <code>属性检查器</code> 中将图片 <code>fightBoxScore.png</code> 的属性 <code>Type</code> 更改为 <code>sprite-frame</code>, 保存更改。 </p></li><li><p>将更改后的 <code>assets/res/texture/fightBoxScore</code> 拖到 <code>game</code> 节点, 再将它拖到显示区域的左方角。</p></li><li><p>在 <code>层级管理器</code> 点击选中 <code>Canvas/game/fightBoxScore</code> 节点，在 <code>属性检查器</code> 中点击 <code>添加组件</code> -&gt; <code>UI</code> -&gt; <code>Widget</code>, <code>Horizontal Alignment</code> 设为 <code>Lef</code>, <code>Left</code> 的值设为 <code>20px</code>; <code>Vertical Alignment</code> 设为 <code>Top</code>, <code>Top</code> 的值设为 <code>20px</code>。</p></li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/008.png" class="" title="game"><ol start="6"><li><p>在 <code>资源管理器</code> 中点击选中图片 <code>assets/res/texture/fightIconGold</code>, 在 <code>属性检查器</code> 中将图片 <code>fightIconGold.png</code> 的属性 <code>Type</code> 更改为 <code>sprite-frame</code>, 保存更改。 </p></li><li><p>将更改后的 <code>assets/res/texture/fightIconGold</code> 拖到 <code>game/fightBoxScore</code> 节点, 然后将其沿 <code>X轴</code> 向左拖动到 <code>fightBoxScore</code> 图片左边的圆形区域内。</p></li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/009.png" class="" title="game"><ol start="8"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas/game/fightBoxScore</code> 节点, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>2D对象</code> -&gt; <code>Label(文本)</code>, 命名为 <code>score</code>, 将 <code>HorizontalAlign</code> 属性设为 <code>Left</code>, <code>String</code> 属性的值设为 <code>0</code>, <code>FontSize</code> 属性的值设为 <code>30</code>, <code>Overflow</code> 属性的值设为 <code>CLAMP</code>。 将 <code>cc.UITransform</code> 下的 <code>ContentSize</code> 属性的 <code>W</code> 值改为 <code>150</code>, 最后将这个 <code>score</code> 节点拖动到屏幕合适的位置。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/010.png" class="" title="game"><h1 id="游戏结算界面"><a href="#游戏结算界面" class="headerlink" title="游戏结算界面"></a>游戏结算界面</h1><ol><li><p>在 <code>层级管理器</code> 点击选中 <code>game</code> 节点, <code>Ctrl+D</code> 复制节点后命名为 <code>gameOver</code>。</p></li><li><p>删除 <code>gameOver</code> 节点原有的 <code>fightBoxScore</code> 节点。</p></li><li><p>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver</code> 节点，<code>右键</code> -&gt; <code>创建</code> -&gt; <code>UI组件</code> -&gt; <code>Button(按钮)</code>, 命名为 <code>reStart</code>, <code>SizeMode</code> 属性的值改为 <code>RAW</code>, <code>Transition</code> 属性的值改为 <code>SCALE</code>。</p></li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/011.png" class="" title="gameOver"><ol start="4"><li>将 <code>资源管理器</code> 中的图片 <code>assets/res/texture/fightBtn01</code> 转为 <code>sprite-frame</code> 后，拖到 <code>reStart</code> 节点的 <code>SpriteFrame</code> 属性中。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/012.png" class="" title="gameOver"><ol start="5"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver/reStart/Label</code> 节点, <code>String</code> 属性的值改为 <code>再来一局</code>, <code>FontSize</code> 属性的值改为 <code>50</code>, <code>LineHeight</code> 属性的值改为 <code>60</code>, <code>OverFlow</code> 属性的值改为 <code>None</code>, <code>Color</code> 改为 <code>白色</code>。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/013.png" class="" title="gameOver"><ol start="6"><li><p>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver/reStart</code> 节点, <code>Ctrl+D</code> 复制节点后命名为 <code>returnMain</code>。</p></li><li><p>将 <code>资源管理器</code> 中的图片 <code>assets/res/texture/fightBtn02</code> 转为 <code>sprite-frame</code> 后，拖到 <code>returnMain</code> 节点的 <code>SpriteFrame</code> 属性中。</p></li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/014.png" class="" title="gameOver"><ol start="8"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver/returnMain/Label</code> 节点, <code>String</code> 属性的值改为 <code>返回主页</code>, <code>FontSize</code> 属性的值改为 <code>40</code>。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/015.png" class="" title="gameOver"><ol start="9"><li>分别移动 <code>reStart</code> 节点和 <code>returnMain</code> 节点到合适的位置, 如下图所示:</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/016.png" class="" title="gameOver"><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/017.png" class="" title="gameOver"><ol start="10"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver</code> 节点，<code>右键</code> -&gt; <code>创建</code> -&gt; <code>2D对象</code> -&gt; <code>Label(文本)</code>, 命名为 <code>scoreTitle</code>, <code>String</code> 属性的值改为 <code>本局得分</code>, <code>FontSize</code> 属性的值改为 <code>40</code>, 向上移动本节点到合适的位置。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/018.png" class="" title="gameOver"><ol start="11"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver/scoreTitle</code> 节点，<code>右键</code> -&gt; <code>创建</code> -&gt; <code>2D对象</code> -&gt; <code>Label(文本)</code>, 命名为 <code>score</code>, <code>String</code> 属性的值改为 <code>999999</code>, <code>FontSize</code> 属性的值改为 <code>80</code>, <code>LineHeight</code> 属性的值改为 <code>90</code>。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/019.png" class="" title="gameOver"><ol start="12"><li>将 <code>资源管理器</code> 中的图片 <code>assets/res/effect/uiAni/fightBoxSettlement</code> 转为 <code>sprite-frame</code> 后，拖到 <code>Canvas/gameOver</code> 节点, 调整层级排到 <code>Canvas/gameOver/scoreTitle</code> 节点的前面。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/020.png" class="" title="gameOver"><ol start="13"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver/fightBoxSettlement</code> 节点，点击窗口下方的 <code>动画编辑器</code> 选项卡, 然后点击 <code>新建动画剪辑资源</code> 按钮， 在弹出的 <code>创建资源</code> 对话框中输入文件名 <code>fightBoxSettlement.anim</code>, 选择保存位置和图片相同, 点 <code>保存</code> 按钮。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/021.png" class="" title="gameOver"><ol start="14"><li><p>在 <code>动画编辑器</code> 选项卡中点击 <code>进入动画编辑模式</code> 按钮, 点击 <code>属性列表</code> 右侧的 <code>+</code> 按钮，选 <code>position</code>, 点击 <code>position</code> 右侧的 <code>菱形</code> 图标, 然后拖动 <code>时间轴</code> 到 <code>0-30</code> 位置, 在 <code>场景编辑器</code> 中拖动 <code>fightBoxSettlement</code> 图片向上移动， 形成一个向上移动的动画效果。</p></li><li><p>在 <code>动画编辑器</code> 选项卡中点击 <code>进入动画编辑</code> 按钮, 点击 <code>属性列表</code> 右侧的 <code>+</code> 按钮，选 <code>cc.Sprite</code> -&gt; <code>color</code>, <code>cc.Sprite.color</code> 在 <code>0-00</code> 位置处的  <code>alpha</code> 值为 <code>0</code>, 在 <code>0-30</code> 位置处的  <code>alpha</code> 值为 <code>255</code>,  <code>alpha</code> 的值在 <code>Color</code> 属性中设置, 可以在 <code>0-00</code>和 <code>0-30</code> 之间多增加几个关键帧并设置不同的 <code>alpah</code> 值实现闪烁效果(例如交替显示和隐藏)。</p></li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/022.png" class="" title="gameOver"><ol start="16"><li>双击 <code>资源管理器</code> 中的 <code>assets/scene/airPlane.scene</code> 返回场景，将 <code>gameStart</code>、 <code>game</code> 和 <code>gameOver</code> 三个节点隐藏(在 <code>属性检查器</code> 中将三个名字前面的 <code>✓</code> 去掉), 保存场景。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/023.png" class="" title="gameOver"><h1 id="面板控制逻辑"><a href="#面板控制逻辑" class="headerlink" title="面板控制逻辑"></a>面板控制逻辑</h1><ol><li>编辑玩家飞机脚本 <code>PlayerPlane</code>, 添加 <code>玩家生命</code> 和 <code>游戏结束</code> 控制, 代码如下所示：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;PlayerPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PlayerPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    public lifeValue = <span class="number">5</span>;  <span class="comment">//玩家飞机生命</span></span><br><span class="line">    public isDie = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    private _currLife = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currLife</span> = <span class="variable language_">this</span>.<span class="property">lifeValue</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isDie</span> = <span class="literal">false</span>;       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取分组</span></span><br><span class="line">        <span class="keyword">const</span> collisionGroup = event.<span class="property">otherCollider</span>.<span class="title function_">getGroup</span>();</span><br><span class="line">        <span class="comment">// 遇到敌方飞机或敌方子弹，玩家飞机掉血</span></span><br><span class="line">        <span class="keyword">if</span> (collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_PLANE</span></span><br><span class="line">            || collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>) &#123;</span><br><span class="line">            <span class="comment">// 现在玩家飞机发生碰撞只在控制台输出文件</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currLife</span>--;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;player plane reduce blood:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_currLife</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currLife</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isDie</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>编辑 <code>gameManager</code> 脚本, 添加用于界面控制的代码, <code>Animation</code> 需要手动添加引用</li></ol><p>首先:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br></pre></td></tr></table></figure><p>改为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_">property</span>(<span class="title class_">SelfPlane</span>)</span><br><span class="line">public <span class="attr">playerPlane</span>: <span class="title class_">SelfPlane</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br></pre></td></tr></table></figure><p>然后 <code>this.playerPlane</code> 改为 <code>this.playerPlane.node</code></p><p>编辑后的 <code>gameManager</code> 脚本代码如下:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, instantiate, math, <span class="title class_">Vec3</span>, <span class="title class_">BoxCollider</span>, <span class="title class_">Label</span>, <span class="title class_">Animation</span>, macro &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Bullet</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/Bullet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BulletProp</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/BulletProp&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnemyPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/EnemyPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PlayerPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/PlayerPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">PlayerPlane</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">PlayerPlane</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹2</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet03</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹3</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet04</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹4</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet05</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹5</span></span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public shootTime = <span class="number">0.3</span>; <span class="comment">// 射击周期（间隔时间）</span></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">1</span>;  <span class="comment">// 子弹速度</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bulletRoot</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 子弹管理节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机2</span></span><br><span class="line">    @property</span><br><span class="line">    public createEnemyTime = <span class="number">1</span>;  <span class="comment">// 敌机生成时间</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy01Speed = <span class="number">0.5</span>;  <span class="comment">// 敌机1速度</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy02Speed = <span class="number">0.7</span>;  <span class="comment">// 敌机2速度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子弹类型道具</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropM</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropH</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropS</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @property</span><br><span class="line">    public bulletPropSpeed = <span class="number">0.3</span>;  <span class="comment">// 子弹类型道具速度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ui</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">gamePage</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">gameOverPage</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    public <span class="attr">gameScore</span>: <span class="title class_">Label</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    public <span class="attr">gameOverScore</span>: <span class="title class_">Label</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Animation</span>)</span><br><span class="line">    public <span class="attr">overAnimation</span>: <span class="title class_">Animation</span> = <span class="literal">null</span>;  <span class="comment">// Animation 要手工添加导入</span></span><br><span class="line"></span><br><span class="line">    public isGameStart = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    private _currShootTime = <span class="number">0</span>;</span><br><span class="line">    private _isShooting = <span class="literal">false</span>;</span><br><span class="line">    private _currCreateEnemyTiime = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">    private _combinationInterval = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line">    private _bulletType = <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>;  <span class="comment">// 子弹道具类型</span></span><br><span class="line"></span><br><span class="line">    private <span class="attr">_score</span>: number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isGameStart</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">isDie</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">gameOver</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> += deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isShooting</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_currShootTime</span> &gt; <span class="variable language_">this</span>.<span class="property">shootTime</span>) &#123;</span><br><span class="line">            <span class="comment">// 判断子弹道具的类型</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_bulletType</span> === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_H</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletH</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_bulletType</span> === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_S</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletS</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletM</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> += deltaTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断组合方式创建相应的敌机</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">            <span class="comment">// 第二阶段，前两种组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.9</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 第三阶段，三个组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.8</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN3</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination02</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建玩家飞机的子弹</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletM</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet类 （子弹预制根节点添加 Bullet 脚本）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>); <span class="comment">// 设置子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// S型子弹为前方同时发射两颗</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletH</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 左边的子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet1 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet03</span>);</span><br><span class="line">        bullet1.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet1.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="number">2.5</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp1 = bullet1.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp1.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 右边的子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet2 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet03</span>);</span><br><span class="line">        bullet2.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet2.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="number">2.5</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp2 = bullet2.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp2.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// S型子弹为三发</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletS</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 中间子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet1 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet1.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet1.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp1 = bullet1.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp1.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 左边子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet2 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet2.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet2.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="number">4</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp2 = bullet2.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp2.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>, <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">LEFT</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 右边子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet3 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet3.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet3.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="number">4</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp3 = bullet3.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp3.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>, <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">RIGHT</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否处理触摸状态，触摸才发射子弹</span></span><br><span class="line">    public <span class="title function_">isShooting</span>(<span class="params">value: boolean</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">createEnemyPlane</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// math 是 cc 带的数字模块</span></span><br><span class="line">        <span class="keyword">const</span> whichEnemy = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> speed = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (whichEnemy === <span class="title class_">Constant</span>.<span class="property">EnemyType</span>.<span class="property">TYPE1</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy01</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy02</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化预制 </span></span><br><span class="line">        <span class="keyword">const</span> enemy = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        enemy.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>); <span class="comment">// 预制挂载到组件中</span></span><br><span class="line">        <span class="keyword">const</span> enemyComp = enemy.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">        enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, speed, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 敌机随机出现的X轴(左右)坐标范围</span></span><br><span class="line">        <span class="keyword">const</span> randomPos = math.<span class="title function_">randomRangeInt</span>(-<span class="number">25</span>, <span class="number">26</span>);</span><br><span class="line">        enemy.<span class="title function_">setPosition</span>(randomPos, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1：5架飞机一字型同时出现</span></span><br><span class="line">    public <span class="title function_">createCombination01</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy01</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(-<span class="number">20</span> + i * <span class="number">10</span>, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1, 7架飞机V字型出现</span></span><br><span class="line">    public <span class="title function_">createCombination02</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 7 架敌机的初始坐标</span></span><br><span class="line">        <span class="keyword">const</span> combinationPos = [</span><br><span class="line">            -<span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">            -<span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            -<span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, -<span class="number">45</span>,</span><br><span class="line">            <span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            <span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy02</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            <span class="keyword">const</span> startIndex = i * <span class="number">3</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(combinationPos[startIndex],</span><br><span class="line">                combinationPos[startIndex + <span class="number">1</span>],</span><br><span class="line">                combinationPos[startIndex + <span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机发射子弹</span></span><br><span class="line">    public <span class="title function_">createEnemyBullet</span>(<span class="params">targetPos: Vec3</span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(targetPos.<span class="property">x</span>, targetPos.<span class="property">y</span>, targetPos.<span class="property">z</span> + <span class="number">6</span>);</span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// 敌机的子弹速度 要比敌机大一些</span></span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取子弹的碰撞器组件</span></span><br><span class="line">        <span class="keyword">const</span> colliderComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">BoxCollider</span>);</span><br><span class="line">        <span class="comment">// 设置敌机子弹的碰撞矩阵</span></span><br><span class="line">        colliderComp.<span class="title function_">setGroup</span>(<span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>);</span><br><span class="line">        <span class="comment">// 设置碰撞掩码 与 玩家飞机 碰撞</span></span><br><span class="line">        colliderComp.<span class="title function_">setMask</span>(<span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_PLANE</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更换玩家子弹类型    </span></span><br><span class="line">    public <span class="title function_">changeBulletType</span>(<span class="params">type: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletType</span> = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建子弹道具  </span></span><br><span class="line">    public <span class="title function_">createBulletProp</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> randomProp = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create bullet prop:&#x27;</span>, randomProp);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (randomProp === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_H</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropH</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomProp === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_S</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropS</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropM</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化子弹道具预览</span></span><br><span class="line">        <span class="keyword">const</span> prop = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        prop.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// const prop = PoolManager.instance().getNode(prefab, this.node);</span></span><br><span class="line"></span><br><span class="line">        prop.<span class="title function_">setPosition</span>(<span class="number">15</span>, <span class="number">0</span>, -<span class="number">50</span>);  <span class="comment">// 道具的起始位置</span></span><br><span class="line">        <span class="keyword">const</span> propComp = prop.<span class="title function_">getComponent</span>(<span class="title class_">BulletProp</span>);</span><br><span class="line">        propComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, -<span class="variable language_">this</span>.<span class="property">bulletPropSpeed</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public <span class="title function_">returnMain</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span> = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletType</span> = <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">15</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_score</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">gameReStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">gameStart</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间        </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span> = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletType</span> = <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">15</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">gameStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isGameStart</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="title function_">init</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_score</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameScore</span>.<span class="property">string</span> = <span class="variable language_">this</span>.<span class="property">_score</span>.<span class="title function_">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">gameOver</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isGameStart</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamePage</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameOverPage</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameOverScore</span>.<span class="property">string</span> = <span class="variable language_">this</span>.<span class="property">_score</span>.<span class="title function_">toString</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">overAnimation</span>.<span class="title function_">play</span>();  <span class="comment">// 播放游戏结束的动画</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameScore</span>.<span class="property">string</span> = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        <span class="comment">// this.playerPlane.init();</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">unschedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>);  <span class="comment">// 取消定时器</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_destoryAll</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">addScore</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_score</span>++;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameScore</span>.<span class="property">string</span> = <span class="variable language_">this</span>.<span class="property">_score</span>.<span class="title function_">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_destoryAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> children = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">children</span>;</span><br><span class="line">        <span class="keyword">let</span> length = children.<span class="property">length</span>;</span><br><span class="line">        <span class="comment">// 销毁对象时要从后往前，不能从前往后</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = length - <span class="number">1</span>; index &gt;= <span class="number">0</span>; index--) &#123;</span><br><span class="line">            <span class="keyword">const</span> child = children[index];</span><br><span class="line">            child.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        children = <span class="variable language_">this</span>.<span class="property">bulletRoot</span>.<span class="property">children</span>;</span><br><span class="line">        length = children.<span class="property">length</span>;</span><br><span class="line">        <span class="comment">// 销毁对象时要从后往前，不能从前往后</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = length - <span class="number">1</span>; index &gt;= <span class="number">0</span>; index--) &#123;</span><br><span class="line">            <span class="keyword">const</span> child = children[index];</span><br><span class="line">            child.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 用于按下的时候即发射第一颗子弹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="variable language_">this</span>.<span class="property">shootTime</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定时器函数</span></span><br><span class="line">    private <span class="title function_">_changePlaneModel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// this.schedule()四个参数：回调， 间隔时间，重复次数， 延迟时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>, <span class="number">10</span>, macro.<span class="property">REPEAT_FOREVER</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变组合状态</span></span><br><span class="line">    private <span class="title function_">_modeChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span>++;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createBulletProp</span>();  <span class="comment">// 创建子弹道具</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>编辑 <code>assets/script/ui/UIManager</code> 脚本, 添加 <code>三个界面</code> 节点 和 <code>两个按钮</code> 的方法, 以及修改原来的其他方法添加控制代码</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Touch</span>, <span class="title class_">EventTouch</span>, <span class="title class_">Input</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;UIManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UIManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public playerPlaneSpeed = <span class="number">1</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加游戏控制脚本</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line">    public <span class="attr">gameManager</span>: <span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">gameStart</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">game</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">gameOver</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_START</span>, <span class="variable language_">this</span>.<span class="property">_touchStart</span>, <span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_MOVE</span>, <span class="variable language_">this</span>.<span class="property">_touchMove</span>, <span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_END</span>, <span class="variable language_">this</span>.<span class="property">_touchEnd</span>, <span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameStart</span>.<span class="property">active</span> = <span class="literal">true</span>;   <span class="comment">// 显示开始界面</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新开始按钮对应代码</span></span><br><span class="line">    public <span class="title function_">reStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameOver</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">game</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">gameReStart</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回主页按钮代码</span></span><br><span class="line">    public <span class="title function_">returnMain</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameOver</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameStart</span>.<span class="property">active</span> = <span class="literal">true</span>;       </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">returnMain</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_touchMove</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">isGameStart</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// touch.getDelta() 获取当前触点值与上一次触点值的差值</span></span><br><span class="line">        <span class="keyword">let</span> delta = touch.<span class="title function_">getDelta</span>();</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>;  <span class="comment">// 获取当前节点的位置</span></span><br><span class="line">        <span class="comment">// 在速度前乘以 0.01 是用于调整移动的速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="title function_">setPosition</span>(</span><br><span class="line">            pos.<span class="property">x</span> + <span class="number">0.01</span> * <span class="variable language_">this</span>.<span class="property">playerPlaneSpeed</span> * delta.<span class="property">x</span>,</span><br><span class="line">            pos.<span class="property">y</span>,</span><br><span class="line">            pos.<span class="property">z</span> - <span class="number">0.01</span> * <span class="variable language_">this</span>.<span class="property">playerPlaneSpeed</span> * delta.<span class="property">y</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始触摸屏幕的回调方法</span></span><br><span class="line">    private <span class="title function_">_touchStart</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">isGameStart</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">isShooting</span>(<span class="literal">true</span>); <span class="comment">// 触摸屏幕时玩家飞机开始射击</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameStart</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">game</span>.<span class="property">active</span> = <span class="literal">true</span>;           </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">gameStart</span>();</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_touchEnd</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="property">isGameStart</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 停止触摸时玩家飞机结束射击</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">isShooting</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li><p>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver</code> 节点，在其 <code>属性检查器</code> 中名字前 <code>打勾</code> 设为显示。</p></li><li><p>在 <code>层级管理器</code> 点击选中 <code>Canvas/gameOver/reStart</code> 节点，<code>ClickEvents</code> 属性的值改为 <code>1</code>, 点击 <code>ClickEvents</code> 左边的 <code>三角形</code> 符号展开， 把 <code>Canvas</code> 节点拖动到 <code>cc.Node</code> 处，右边第一个下拉项选择  <code>UIMain</code>, 第二个下拉项选择 <code>reStart</code>, 实现按钮与脚本中方法的绑定。</p></li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/024.png" class="" title="gameOver"><ol start="6"><li>同样的方法完成 <code>returnMain</code> 按钮与对应方法的绑定。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/025.png" class="" title="gameOver"><ol start="7"><li>给 <code>gameOver</code> 节点添加组件 <code>Event</code> -&gt; <code>BlockInputEvents</code>, 阻止结束后还能控制玩家飞机。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/026.png" class="" title="gameOver"><ol start="8"><li><p>再次将 <code>Canvas/gameOver</code> 节点设为不显示, 保存场景。</p></li><li><p>在 <code>层级管理器</code> 点击选中 <code>Canvas</code> 节点,  绑定三个界面到相应属性中。</p></li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/027.png" class="" title="gameOver"><ol start="10"><li>在 <code>层级管理器</code> 点击选中 <code>gameManager</code> 节点, 绑定对象到相应节点( <code>PlayerPlane</code> 因为在代码中修改了类型, 也要重新绑定)。</li></ol><img src="/2022/02/03/develop-an-airplane-game-in-cocos-creator-06/028.png" class="" title="gameOver"><ol start="11"><li>保存场景, 运行预览。</li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> cocos creator </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cocos creator </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记：使用 Cocos Creator 3.4.0 开发空战游戏 05——玩家飞机获取道具更换子弹</title>
      <link href="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/"/>
      <url>/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/</url>
      
        <content type="html"><![CDATA[<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><ol><li>Cocos Dashboard 1.0.20</li><li>Cocos Creator 3.4.0</li><li>Visual Studio Code 1.63</li><li>Microsoft Edge 97.0.1072.69</li></ol><hr><h1 id="提供给玩家飞机的子弹道具"><a href="#提供给玩家飞机的子弹道具" class="headerlink" title="提供给玩家飞机的子弹道具"></a>提供给玩家飞机的子弹道具</h1><p>玩家飞家可以发射的子弹类型分为三种：</p><ul><li>M型：直线发射 <code>1发</code> 白色小子弹(默认)</li><li>H型：直线发射 <code>2发</code> 红色小子弹</li><li>S型：扇形发射 <code>3发</code> 月牙型子弹，夹角为45度(或根据实际情况调整)</li></ul><p>更换子弹的道具类型和出现方式：</p><ul><li>道具每10秒出现一个，类型为 HSM 其中一种</li><li>收集到与当前不一样的道具时切换子弹类型</li><li>使用S型道具时玩家飞机比敌人飞机速度慢</li></ul><h1 id="创建子弹切换道具材质"><a href="#创建子弹切换道具材质" class="headerlink" title="创建子弹切换道具材质"></a>创建子弹切换道具材质</h1><ol><li>在 <code>资源管理器</code> 的 <code>assets/res/model/fightIconBullet/</code> 文件夹创建 <code>材质</code>, 命名为 <code>bulletS</code>。材质 <code>Effect</code> 属性的值设为 <code>builltin-unlit</code>, <code>Technique</code> 属性的值设为 <code>03-alpha-blend</code>， <code>USE-TEXTURE</code> 打勾, 将图片 <code>assets/res/model/fightIconBullet/fightIconBullet01</code> 拖动到 <code>MainTexture</code>， 在 <code>属性检查器</code> 右上角点击 <code>✓</code> 图标的按钮 <code>保存</code> 材质。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/001.png" class="" title="bulletS"><ol start="2"><li><p>在 <code>资源管理器</code> 中选中 <code>bulletS</code> 材质， 按两次 <code>Ctrl+D</code> 快速复制材质，并分别重命名为 <code>bulletH</code> 和 <code>bulletM</code>。</p></li><li><p>将材质 <code>bulletH</code> 的图片分别修改为 <code>fightIconBullet02</code>, 保存材质。</p></li><li><p>将材质 <code>bulletM</code> 的图片分别修改为 <code>fightIconBullet03</code>, 保存材质。</p></li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/002.png" class="" title="bulletM"><h1 id="添加子弹切换道具"><a href="#添加子弹切换道具" class="headerlink" title="添加子弹切换道具"></a>添加子弹切换道具</h1><ol><li>在 <code>主菜单</code> 上选择 <code>项目</code> -&gt; <code>项目设置</code>, 在弹出对话框的左侧列表选择 <code>物理</code>,  在其 <code>碰撞矩阵</code> 添加分组 <code>BULLET_PROP</code>， 设置掩码： <code>PLAYER_PLANE - BULLET_PROP</code>。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/003.png" class="" title="BULLET_PROP"><ol start="2"><li><p>在 <code>资源管理器</code> 的 <code>assets/script/bullet/</code> 文件夹 <code>右键</code> -&gt; <code>创建</code> -&gt; <code>脚本(TypeScript)</code>, 命名为 <code>BulletProp</code>(暂时不用编辑脚本)。</p></li><li><p>在 <code>层级管理器</code> 中添加 <code>空节点</code>，命名为 <code>bulletM</code>; 点击选中 <code>bulletM</code> 节点,  <code>右键</code> -&gt; <code>创建</code> -&gt; <code>3D对象</code> -&gt; <code>Quad四方形</code>, 命名为 <code>body</code>; </p></li><li><p>将 <code>资源管理器</code> 中的材质 <code>bulletM</code> 拖动到 <code>body</code> 的 <code>Materials</code> 属性; 将 <code>bulletM</code> 节点 <code>body</code> 属性 <code>Rotation</code> 的值修改为 <code>X:-90, Y:0, Z:0</code>, 使其旋转为图案向上; 将 <code>Scale</code> 的值修改为 <code>X:10, Y:6, Z:1</code>, 将它放大。</p></li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/004.png" class="" title="bulletM"><ol start="5"><li><p>在 <code>层级管理器</code> 中点击选中 <code>bulletM</code> 节点, 在 <code>属性检查器</code> 中点击 <code>添加组件</code> -&gt; <code>Physics</code> -&gt; <code>BoxCollider</code>, 将属性 <code>Size</code> 的值修改为 <code>x:7, Y:1, Z:3</code>, <code>isTrigger</code> 属性 <code>打勾</code>。</p></li><li><p>继续在 <code>bulletM</code> 节点的 <code>属性检查器</code> 中点击 <code>添加组件</code> -&gt; <code>Physics</code> -&gt; <code>RigidBody</code>, <code>cc.RigidBody</code> 的 <code>Group</code> 属性值选为 <code>BULLET_PROP</code> (如果没有这一项，则重选一次 <code>bulletM</code> 节点刷新 <code>属性检查器</code> 面板即可), <code>Type</code> 属性的值改为 <code>KINEMATIC</code>, 保存场景。</p></li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/005.png" class="" title="bulletM"><ol start="7"><li>在 <code>层级管理器</code> 中点击选中 <code>bulletM</code> 节点，<code>添加组件</code> -&gt; <code>自定义脚本</code> -&gt; <code>BulletProp</code>。保存场景。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/006.png" class="" title="bulletM"><ol start="8"><li>在 <code>层级管理器</code> 中点击选中 <code>bulletM</code> 节点, 拖动到 <code>资源管理器</code> 的 <code>assets/res/model/fightIconBullet/</code> 文件夹，添加为 <code>预制</code>。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/007.png" class="" title="bulletM"><ol start="9"><li><p>重复以上步骤 <code>3-8</code> ，使用材质 <code>bulletH</code> 和 <code>bulletS</code> 制作 <code>另外两个</code> 道具的 <code>预制</code>。</p></li><li><p>完成 <code>三个子弹道具</code> 预制的制作, 在 <code>层级管理器</code> 中删除 <code>bulletM</code>、 <code>bulletH</code> 和 <code>bulletS</code> 三个节点。</p></li></ol><h1 id="编辑子弹道具脚本"><a href="#编辑子弹道具脚本" class="headerlink" title="编辑子弹道具脚本"></a>编辑子弹道具脚本</h1><ol><li>修改 <code>Constant</code>, 添加 <code>子弹道具类型</code>, 并添加一个 <code>碰撞类型</code>。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Constant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">EnemyType</span> = &#123;</span><br><span class="line">        <span class="title class_">TYPE1</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="title class_">TYPE2</span>: <span class="number">2</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机组合类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">Combination</span> = &#123;</span><br><span class="line">        <span class="title class_">PLAN1</span>: <span class="number">1</span>,  <span class="comment">// 组合1, 每次随机1架敌机, 发射子弹</span></span><br><span class="line">        <span class="title class_">PLAN2</span>: <span class="number">2</span>,  <span class="comment">// 组合2, 每次5架敌机，一 字型, 不发射子弹</span></span><br><span class="line">        <span class="title class_">PLAN3</span>: <span class="number">3</span>,  <span class="comment">// 组合3, 每次7架敌机，V 字型, 不发射子弹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 碰撞组合类型, 要和碰撞矩阵的顺序一致</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">CollistionType</span> = &#123;</span><br><span class="line">        <span class="comment">// 使用左移符号设置为二进制值, 右边数字与碰撞矩阵序号一致</span></span><br><span class="line">        <span class="attr">PLAYER_PLANE</span>: <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">        <span class="attr">ENEMY_PLANE</span>: <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">        <span class="attr">PLAYER_BULLET</span>: <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line">        <span class="attr">ENEMY_BULLET</span>: <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子弹道具类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">BulletPropType</span> = &#123;</span><br><span class="line">        <span class="attr">BULLET_M</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">BULLET_H</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">BULLET_S</span>: <span class="number">3</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>GameManager</code>, 增加用于更换玩家子弹类型的公共属性, 私有变量和方法, (以下代码只包含添加及修改的部分)</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 子弹类型道具</span></span><br><span class="line">@<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">public <span class="attr">bulletPropM</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">@<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">public <span class="attr">bulletPropH</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">@<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">public <span class="attr">bulletPropS</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">@property</span><br><span class="line">public bulletPropSpeed = <span class="number">0.3</span>;  <span class="comment">// 子弹类型道具速度</span></span><br><span class="line"></span><br><span class="line">private _bulletType = <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>;  <span class="comment">// 子弹道具类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 更换玩家子弹类型    </span></span><br><span class="line">public <span class="title function_">changeBulletType</span>(<span class="params">type: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_bulletType</span> = type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建子弹道具  </span></span><br><span class="line">public <span class="title function_">createBulletProp</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> randomProp = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create bullet prop:&#x27;</span>, randomProp);</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (randomProp === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_H</span>) &#123;</span><br><span class="line">        prefab = <span class="variable language_">this</span>.<span class="property">bulletPropH</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomProp === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_S</span>) &#123;</span><br><span class="line">        prefab = <span class="variable language_">this</span>.<span class="property">bulletPropS</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        prefab = <span class="variable language_">this</span>.<span class="property">bulletPropM</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实例化子弹道具预览</span></span><br><span class="line">    <span class="keyword">const</span> prop = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">    prop.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// const prop = PoolManager.instance().getNode(prefab, this.node);</span></span><br><span class="line"></span><br><span class="line">    prop.<span class="title function_">setPosition</span>(<span class="number">15</span>, <span class="number">0</span>, -<span class="number">50</span>);  <span class="comment">// 道具的起始位置</span></span><br><span class="line">    <span class="keyword">const</span> propComp = prop.<span class="title function_">getComponent</span>(<span class="title class_">BulletProp</span>);</span><br><span class="line">    propComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, -<span class="variable language_">this</span>.<span class="property">bulletPropSpeed</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变组合状态</span></span><br><span class="line">private <span class="title function_">_modeChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_combinationInterval</span>++;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">createBulletProp</span>();  <span class="comment">// 增加这一行用于创建子弹道具</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>编辑子弹道具脚本 <code>BulletProp</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;BulletProp&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BulletProp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    private _propSpeed = <span class="number">0.3</span>;  <span class="comment">// 道具移动速度</span></span><br><span class="line">    <span class="comment">// 用于控制道具 S 型在屏幕上移动，从左往右正值，从右往右负值</span></span><br><span class="line">    private _propXSpeed = <span class="number">0.3</span>;</span><br><span class="line">    private <span class="attr">_gameManager</span>: <span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos.<span class="property">x</span> &gt;= <span class="number">15</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_propXSpeed</span> = <span class="variable language_">this</span>.<span class="property">_propSpeed</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pos.<span class="property">x</span> &lt;= -<span class="number">15</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_propXSpeed</span> = -<span class="variable language_">this</span>.<span class="property">_propSpeed</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(</span><br><span class="line">            pos.<span class="property">x</span> + <span class="variable language_">this</span>.<span class="property">_propXSpeed</span>,</span><br><span class="line">            pos.<span class="property">y</span>,</span><br><span class="line">            pos.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">_propSpeed</span>);</span><br><span class="line"></span><br><span class="line">        pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>; <span class="comment">// 移动后重新获取道具位置</span></span><br><span class="line">        <span class="keyword">if</span> (pos.<span class="property">z</span> &gt; <span class="number">50</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">gameManager: GameManager, speed: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameManager</span> = gameManager;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_propSpeed</span> = speed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取道具的名字</span></span><br><span class="line">        <span class="keyword">const</span> name = event.<span class="property">selfCollider</span>.<span class="property">node</span>.<span class="property">name</span>;        </span><br><span class="line">        <span class="keyword">if</span> (name === <span class="string">&#x27;bulletH&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">changeBulletType</span>(<span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_H</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;bullet type changed&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="string">&#x27;bulletS&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">changeBulletType</span>(<span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_S</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;bullet type changed&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">changeBulletType</span>(<span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();  <span class="comment">// 销毁道具      </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>层级管理器</code> 中点击选中 <code>gameManager</code> 节点, 将三个 <code>子弹道具预制</code> 挂载到对应的属性。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/008.png" class="" title="bulletM"><ol start="5"><li>保存场景，运行、预览效果(10秒后出现第一个子弹类型道具)。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/009.png" class="" title="bulletM"><h1 id="玩家飞机切换子弹类型"><a href="#玩家飞机切换子弹类型" class="headerlink" title="玩家飞机切换子弹类型"></a>玩家飞机切换子弹类型</h1><ol><li>打开 <code>GameManager</code> 脚本， 将 <code>createPlayerBullet</code> 重命名为 <code>createPlayerBulletM</code>, 可以在 VS Code 选中 <code>createPlayerBullet</code>, <code>右键</code> -&gt; <code>重命名符号</code>, 在弹出的重命名框中输入新名字 <code>createPlayerBulletM</code>, 则原来所有引用 <code>createPlayerBullet</code> 的地方都会改为 <code>createPlayerBulletM</code> (不要手动修改)。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/010.png" class="" title="rename"><ol start="2"><li><p>在 <code>GameManager</code> 脚本中将 <code>createPlayerBulletM</code> 方法复制为 <code>createPlayerBulletH</code> 和 <code>createPlayerBulletS</code>。</p></li><li><p>修改 <code>createPlayerBulletH</code> 方法:</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// H型子弹为前方同时发射两颗</span></span><br><span class="line">public <span class="title function_">createPlayerBulletH</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 左边的子弹</span></span><br><span class="line">    <span class="keyword">const</span> bullet1 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet03</span>);</span><br><span class="line">    bullet1.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">    <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">    bullet1.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="number">2.5</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">    <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">    <span class="keyword">const</span> bulletComp1 = bullet1.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">    <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">    bulletComp1.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 右边的子弹</span></span><br><span class="line">    <span class="keyword">const</span> bullet2 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet03</span>);</span><br><span class="line">    bullet2.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">    <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">    bullet2.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="number">2.5</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">    <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">    <span class="keyword">const</span> bulletComp2 = bullet2.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">    <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">    bulletComp2.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>修改 <code>createPlayerBulletS</code> 方法:</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// S型子弹为三发扇形</span></span><br><span class="line">public <span class="title function_">createPlayerBulletS</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">    <span class="comment">// 中间子弹</span></span><br><span class="line">    <span class="keyword">const</span> bullet1 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">    bullet1.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">    <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">    bullet1.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">    <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">    <span class="keyword">const</span> bulletComp1 = bullet1.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">    <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">    bulletComp1.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 左边子弹</span></span><br><span class="line">    <span class="keyword">const</span> bullet2 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">    bullet2.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">    <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">    bullet2.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="number">4</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">    <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">    <span class="keyword">const</span> bulletComp2 = bullet2.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">    <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">    bulletComp2.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 右边子弹</span></span><br><span class="line">    <span class="keyword">const</span> bullet3 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">    bullet3.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">    <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">    bullet3.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="number">4</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">    <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">    <span class="keyword">const</span> bulletComp3 = bullet3.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">    <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">    bulletComp3.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>编辑 <code>Constant</code> 脚本，添加不同类型子弹的运动方向:</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Constant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">EnemyType</span> = &#123;</span><br><span class="line">        <span class="title class_">TYPE1</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="title class_">TYPE2</span>: <span class="number">2</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机组合类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">Combination</span> = &#123;</span><br><span class="line">        <span class="title class_">PLAN1</span>: <span class="number">1</span>,  <span class="comment">// 组合1, 每次随机1架敌机, 发射子弹</span></span><br><span class="line">        <span class="title class_">PLAN2</span>: <span class="number">2</span>,  <span class="comment">// 组合2, 每次5架敌机，一 字型, 不发射子弹</span></span><br><span class="line">        <span class="title class_">PLAN3</span>: <span class="number">3</span>,  <span class="comment">// 组合3, 每次7架敌机，V 字型, 不发射子弹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 碰撞组合类型, 要和碰撞矩阵的顺序一致</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">CollistionType</span> = &#123;</span><br><span class="line">        <span class="comment">// 使用左移符号设置为二进制值, 右边数字与碰撞矩阵序号一致</span></span><br><span class="line">        <span class="attr">PLAYER_PLANE</span>: <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">        <span class="attr">ENEMY_PLANE</span>: <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">        <span class="attr">PLAYER_BULLET</span>: <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line">        <span class="attr">ENEMY_BULLET</span>: <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子弹道具类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">BulletPropType</span> = &#123;</span><br><span class="line">        <span class="attr">BULLET_M</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">BULLET_H</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">BULLET_S</span>: <span class="number">3</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子弹运动方向</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">Direction</span> = &#123;</span><br><span class="line">        <span class="attr">LEFT</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">MIDDLE</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">RIGHT</span>: <span class="number">3</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>编辑 <code>Bullet</code> 脚本，更改不同类型子弹的运动轨迹:</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;Bullet&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Bullet</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    private _bulletSpeed = <span class="number">0</span>;  <span class="comment">//子弹速度改为私有变量</span></span><br><span class="line">    private _isEnemyBullet = <span class="literal">false</span>;  <span class="comment">// 判断是否为敌机子弹</span></span><br><span class="line">    private _direction = <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">MIDDLE</span>;  <span class="comment">// 子弹运行方向</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;  <span class="comment">// 获取子弹的位置</span></span><br><span class="line">        <span class="keyword">let</span> moveLength = <span class="number">0</span>; <span class="comment">// 计算每一帧子弹要移动的位置</span></span><br><span class="line">        <span class="comment">// 计算每一帧子弹要移动的位置, 玩家和敌机子弹方向不同</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isEnemyBullet</span>) &#123;</span><br><span class="line">            moveLength = pos.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, moveLength);</span><br><span class="line">            <span class="keyword">if</span> (moveLength &gt; <span class="number">50</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`enemy bullet destory`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            moveLength = pos.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断子弹运动方向, 只有扇形子弹才需要左右方向</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_direction</span> === <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">LEFT</span>) &#123;</span><br><span class="line">                <span class="comment">// 乘以 0.2 用于缩小扇形的角度</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span> * <span class="number">0.2</span>,</span><br><span class="line">                    pos.<span class="property">y</span>,</span><br><span class="line">                    moveLength);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_direction</span> === <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">RIGHT</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span> * <span class="number">0.2</span>,</span><br><span class="line">                    pos.<span class="property">y</span>,</span><br><span class="line">                    moveLength);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, moveLength);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (moveLength &lt; -<span class="number">50</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`player bullet destory`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从 GameManager 脚本接收子弹速度和是否为敌机子弹</span></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">speed: number,</span></span><br><span class="line"><span class="params">        isEnemyBullet: boolean = <span class="literal">false</span>,</span></span><br><span class="line"><span class="params">        direction: number = Constant.Direction.MIDDLE</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isEnemyBullet</span> = isEnemyBullet;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_direction</span> = direction;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;trigger bullet destroy&#x27;</span>);</span><br><span class="line">        <span class="comment">// 子弹碰到玩家飞机都销毁</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="7"><li>编辑 <code>GameManager</code> 脚本, 更改 <code>createPlayerBulletS()</code> 和 <code>update(deltaTime: number)</code> 方法,  控制子弹发射的方向。<code>GameManager</code> 脚本 完整代码如下:</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, instantiate, math, <span class="title class_">Vec3</span>, <span class="title class_">BoxCollider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Bullet</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/Bullet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BulletProp</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/BulletProp&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnemyPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/EnemyPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹2</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet03</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹3</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet04</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹4</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet05</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹5</span></span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public shootTime = <span class="number">0.3</span>; <span class="comment">// 射击周期（间隔时间）</span></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">1</span>;  <span class="comment">// 子弹速度</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bulletRoot</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 子弹管理节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机2</span></span><br><span class="line">    @property</span><br><span class="line">    public createEnemyTime = <span class="number">1</span>;  <span class="comment">// 敌机生成时间</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy01Speed = <span class="number">0.5</span>;  <span class="comment">// 敌机1速度</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy02Speed = <span class="number">0.7</span>;  <span class="comment">// 敌机2速度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子弹类型道具</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropM</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropH</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bulletPropS</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">    @property</span><br><span class="line">    public bulletPropSpeed = <span class="number">0.3</span>;  <span class="comment">// 子弹类型道具速度</span></span><br><span class="line"></span><br><span class="line">    private _currShootTime = <span class="number">0</span>;</span><br><span class="line">    private _isShooting = <span class="literal">false</span>;</span><br><span class="line">    private _currCreateEnemyTiime = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">    private _combinationInterval = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line">    private _bulletType = <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_M</span>;  <span class="comment">// 子弹道具类型</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> += deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isShooting</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_currShootTime</span> &gt; <span class="variable language_">this</span>.<span class="property">shootTime</span>) &#123;</span><br><span class="line">            <span class="comment">// 判断子弹道具的类型</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_bulletType</span> === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_H</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletH</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_bulletType</span> === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_S</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletS</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createPlayerBulletM</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> += deltaTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断组合方式创建相应的敌机</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">            <span class="comment">// 第二阶段，前两种组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.9</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 第三阶段，三个组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.8</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN3</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination02</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建玩家飞机的子弹</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletM</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet类 （子弹预制根节点添加 Bullet 脚本）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>); <span class="comment">// 设置子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// S型子弹为前方同时发射两颗</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletH</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 左边的子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet1 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet03</span>);</span><br><span class="line">        bullet1.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet1.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="number">2.5</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp1 = bullet1.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp1.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 右边的子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet2 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet03</span>);</span><br><span class="line">        bullet2.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet2.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="number">2.5</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp2 = bullet2.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp2.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// S型子弹为三发</span></span><br><span class="line">    public <span class="title function_">createPlayerBulletS</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 中间子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet1 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet1.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet1.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp1 = bullet1.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp1.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 左边子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet2 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet2.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet2.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> - <span class="number">4</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp2 = bullet2.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp2.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>, <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">LEFT</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 右边子弹</span></span><br><span class="line">        <span class="keyword">const</span> bullet3 = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet05</span>);</span><br><span class="line">        bullet3.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中        </span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet3.<span class="title function_">setPosition</span>(pos.<span class="property">x</span> + <span class="number">4</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet 组件 （脚本类）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp3 = bullet3.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// bulletComp.bulletSpeed = this.bulletSpeed; // 设置子弹速度</span></span><br><span class="line">        bulletComp3.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>, <span class="title class_">Constant</span>.<span class="property">Direction</span>.<span class="property">RIGHT</span>);   <span class="comment">// 玩家飞机的子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否处理触摸状态，触摸才发射子弹</span></span><br><span class="line">    public <span class="title function_">isShooting</span>(<span class="params">value: boolean</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">createEnemyPlane</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// math 是 cc 带的数字模块</span></span><br><span class="line">        <span class="keyword">const</span> whichEnemy = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> speed = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (whichEnemy === <span class="title class_">Constant</span>.<span class="property">EnemyType</span>.<span class="property">TYPE1</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy01</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy02</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化预制 </span></span><br><span class="line">        <span class="keyword">const</span> enemy = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        enemy.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>); <span class="comment">// 预制挂载到组件中</span></span><br><span class="line">        <span class="keyword">const</span> enemyComp = enemy.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">        enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, speed, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 敌机随机出现的X轴(左右)坐标范围</span></span><br><span class="line">        <span class="keyword">const</span> randomPos = math.<span class="title function_">randomRangeInt</span>(-<span class="number">25</span>, <span class="number">26</span>);</span><br><span class="line">        enemy.<span class="title function_">setPosition</span>(randomPos, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1：5架飞机一字型同时出现</span></span><br><span class="line">    public <span class="title function_">createCombination01</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy01</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(-<span class="number">20</span> + i * <span class="number">10</span>, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1, 7架飞机V字型出现</span></span><br><span class="line">    public <span class="title function_">createCombination02</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 7 架敌机的初始坐标</span></span><br><span class="line">        <span class="keyword">const</span> combinationPos = [</span><br><span class="line">            -<span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">            -<span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            -<span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, -<span class="number">45</span>,</span><br><span class="line">            <span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            <span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy02</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            <span class="keyword">const</span> startIndex = i * <span class="number">3</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(combinationPos[startIndex],</span><br><span class="line">                combinationPos[startIndex + <span class="number">1</span>],</span><br><span class="line">                combinationPos[startIndex + <span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机发射子弹</span></span><br><span class="line">    public <span class="title function_">createEnemyBullet</span>(<span class="params">targetPos: Vec3</span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(targetPos.<span class="property">x</span>, targetPos.<span class="property">y</span>, targetPos.<span class="property">z</span> + <span class="number">6</span>);</span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// 敌机的子弹速度 要比敌机大一些</span></span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取子弹的碰撞器组件</span></span><br><span class="line">        <span class="keyword">const</span> colliderComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">BoxCollider</span>);</span><br><span class="line">        <span class="comment">// 设置敌机子弹的碰撞矩阵</span></span><br><span class="line">        colliderComp.<span class="title function_">setGroup</span>(<span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>);</span><br><span class="line">        <span class="comment">// 设置碰撞掩码 与 玩家飞机 碰撞</span></span><br><span class="line">        colliderComp.<span class="title function_">setMask</span>(<span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_PLANE</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计分</span></span><br><span class="line">    public <span class="title function_">addScore</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更换玩家子弹类型    </span></span><br><span class="line">    public <span class="title function_">changeBulletType</span>(<span class="params">type: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletType</span> = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建子弹道具  </span></span><br><span class="line">    public <span class="title function_">createBulletProp</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> randomProp = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create bullet prop:&#x27;</span>, randomProp);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (randomProp === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_H</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropH</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomProp === <span class="title class_">Constant</span>.<span class="property">BulletPropType</span>.<span class="property">BULLET_S</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropS</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">bulletPropM</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化子弹道具预览</span></span><br><span class="line">        <span class="keyword">const</span> prop = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        prop.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// const prop = PoolManager.instance().getNode(prefab, this.node);</span></span><br><span class="line"></span><br><span class="line">        prop.<span class="title function_">setPosition</span>(<span class="number">15</span>, <span class="number">0</span>, -<span class="number">50</span>);  <span class="comment">// 道具的起始位置</span></span><br><span class="line">        <span class="keyword">const</span> propComp = prop.<span class="title function_">getComponent</span>(<span class="title class_">BulletProp</span>);</span><br><span class="line">        propComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, -<span class="variable language_">this</span>.<span class="property">bulletPropSpeed</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 用于按下的时候即发射第一颗子弹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="variable language_">this</span>.<span class="property">shootTime</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定时器函数</span></span><br><span class="line">    private <span class="title function_">_changePlaneModel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// this.schedule()四个参数：回调， 间隔时间，重复次数， 延迟时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>, <span class="number">10</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变组合状态</span></span><br><span class="line">    private <span class="title function_">_modeChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span>++;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createBulletProp</span>();  <span class="comment">// 创建子弹道具</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="8"><li>保存场景，运行预览。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/011.png" class="" title="VSCode"><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-05/012.png" class="" title="VSCode"><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> cocos creator </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cocos creator </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记：使用 Cocos Creator 3.4.0 开发空战游戏 04——飞机与子弹的碰撞</title>
      <link href="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/"/>
      <url>/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/</url>
      
        <content type="html"><![CDATA[<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><ol><li>Cocos Dashboard 1.0.20</li><li>Cocos Creator 3.4.0</li><li>Visual Studio Code 1.63</li><li>Microsoft Edge 97.0.1072.69</li></ol><hr><h1 id="添加碰撞分组"><a href="#添加碰撞分组" class="headerlink" title="添加碰撞分组"></a>添加碰撞分组</h1><ol><li>在 <code>主菜单</code> 点击  <code>项目</code> -&gt; <code>项目设置</code>, 打开 <code>项目设置</code> 窗口。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/001.png" class="" title="settings"><ol start="2"><li><p>在 <code>物理</code> 选项最下方的 <code>碰撞矩阵</code> 点 <code>+</code> 添加四个分组：<code>PLAYER_PLANE</code>, <code>ENEMY_PLANE</code>, <code>PLAYER_BULLET</code>, <code>ENEMY_BULLET</code> 。</p></li><li><p>设置分组的掩码：</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PLAYER_PLANE - ENEMY_BULLET</span><br><span class="line">PLAYER_PLANE - ENEMY_PLANE</span><br><span class="line">ENEMY_PLANE - PLAYER_BULLET</span><br></pre></td></tr></table></figure><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/002.png" class="" title="settings"><ol start="4"><li>设置完毕，关闭对话框。</li></ol><h1 id="设置碰撞组件和分组"><a href="#设置碰撞组件和分组" class="headerlink" title="设置碰撞组件和分组"></a>设置碰撞组件和分组</h1><ol><li>在 <code>层级管理器</code> 点击选中 <code>playerPlane</code> 节点, 在其 <code>属性检查器</code> 中点 <code>添加组件</code> -&gt; <code>Physics</code> -&gt; <code>BoxCollider</code>。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/003.png" class="" title="BoxCollider"><ol start="2"><li>将 <code>playerPlane</code> 节点 <code>属性检查器</code> 中的 <code>cc.BoxCollider+</code> 属性 <code>Size</code> 的值改为大一些的整数，例如：<code>Size, X:11, Y:1, Z:10</code>;  或是直接在 <code>场景编辑器</code> 中拉伸飞机 <code>淡绿色边框</code> 的 <code>碰撞包围盒</code> 包围玩家飞机, 刚添加 <code>BoxCollider</code> 的时候 <code>碰撞包围盒</code> 很小, 并且可能和 <code>playerPlane</code> 节点的坐标轴箭头重叠在一起，可以先修改 <code>Size</code> 的值后将其变大再进行拉伸;  将 <code>cc.BoxCollider+</code> 的 <code>isTrigger</code>(触发器) 打勾。。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/004.png" class="" title="BoxCollider"><ol start="3"><li>继续在 <code>playerPlane</code> 节点的 <code>属性检查器</code> 中点 <code>添加组件</code> -&gt; <code>Physics</code> -&gt; <code>RigidBody</code>, 选择分组 <code>Group</code> 的值为 <code>PLAYER_PLANE</code>, <code>Type</code> 属性的值改为 <code>KINEMATIC</code> (运动学刚体)。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/005.png" class="" title="RigidBody"><ol start="4"><li>点击 <code>playerPlane</code> 节点的 <code>属性检查器</code> 右上角的 <code>应用</code> 按钮更新修改到对应的 <code>预制</code> 中。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/006.png" class="" title="player"><ol start="5"><li>分别双击打开 <code>资源管理器</code> 中的敌方飞机预制 <code>plane02</code> 和 <code>plane03</code>, 重做与玩家飞机相似的设置, <code>RigidBody</code> 分组 <code>Group</code> 的值选择为 <code>ENEMY_PLANE</code>, 保存预制 。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/007.png" class="" title="ENEMY_PLANE"><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/008.png" class="" title="ENEMY_PLANE"><ol start="6"><li>在 <code>资源管理器</code> 中双击打开 <code>子弹1</code> - <code>子弹5</code> 的预制 <code>bullet01</code> - <code>bullet05</code>, 重做与玩家飞机相似的设置, <code>RigidBody</code> 分组 <code>Group</code> 的值选择为 <code>PLAYER_BULLET</code> (先设置为玩家子弹) 。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/009.png" class="" title="PLAYER_BULLET"><h1 id="注册玩家飞机触发事件回调"><a href="#注册玩家飞机触发事件回调" class="headerlink" title="注册玩家飞机触发事件回调"></a>注册玩家飞机触发事件回调</h1><ol><li>修改 <code>Constant</code>, 添加 <code>碰撞类型</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Constant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">EnemyType</span> = &#123;</span><br><span class="line">        <span class="title class_">TYPE1</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="title class_">TYPE2</span>: <span class="number">2</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机组合类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">Combination</span> = &#123;</span><br><span class="line">        <span class="title class_">PLAN1</span>: <span class="number">1</span>,  <span class="comment">// 组合1, 每次随机1架敌机, 发射子弹</span></span><br><span class="line">        <span class="title class_">PLAN2</span>: <span class="number">2</span>,  <span class="comment">// 组合2, 每次5架敌机，一 字型, 不发射子弹</span></span><br><span class="line">        <span class="title class_">PLAN3</span>: <span class="number">3</span>,  <span class="comment">// 组合3, 每次7架敌机，V 字型, 不发射子弹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 碰撞组合类型, 要和碰撞矩阵的顺序一致</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">CollistionType</span> = &#123;</span><br><span class="line">        <span class="comment">// 使用左移符号设置为二进制值, 右边数字与碰撞矩阵序号一致</span></span><br><span class="line">        <span class="attr">PLAYER_PLANE</span>: <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">        <span class="attr">ENEMY_PLANE</span>: <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">        <span class="attr">PLAYER_BULLET</span>: <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line">        <span class="attr">ENEMY_BULLET</span>: <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>资源管理器</code> 点击选中 <code>plane</code> 文件夹, 添加名为 <code>PlayerPlane</code> 的脚本, 添加用于检测 <code>玩家飞机</code> 是否碰到 <code>敌人子弹</code> 或 <code>敌机</code> 。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;PlayerPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PlayerPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取分组</span></span><br><span class="line">        <span class="keyword">const</span> collisionGroup = event.<span class="property">otherCollider</span>.<span class="title function_">getGroup</span>();</span><br><span class="line">        <span class="comment">// 遇到敌方飞机或敌方子弹，玩家飞机掉血</span></span><br><span class="line">        <span class="keyword">if</span> (collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_PLANE</span></span><br><span class="line">            || collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>) &#123;</span><br><span class="line">            <span class="comment">// 现在玩家飞机发生碰撞只在控制台输出文件</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;player plane reduce blood&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>层级管理器</code> 点击选中 <code>playerPlane</code> 节点, 在其 <code>属性检查器</code> 中点 <code>添加组件</code> -&gt; <code>自定义脚本</code> -&gt; <code>PlayerPlane</code>, 将玩家飞机脚本绑定到 <code>playerPlane</code> 根节点, 保存场景。</li></ol><img src="/2022/01/31/develop-an-airplane-game-in-cocos-creator-04/010.png" class="" title="PlayerPlane"><ol start="4"><li>修改 <code>敌人飞机</code> 脚本 <code>EnemyPlane</code>, 添加 <code>onEnable()</code> 和 <code>onDisable()</code> 及 <code>回调函数</code> 检测 <code>敌人飞机</code> 是否碰到 <code>玩家子弹</code>。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 敌机被销毁的位置(超出屏幕下边沿后的Z轴坐标值)</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTOFBOUNCE</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;EnemyPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">EnemyPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public createBulletTime = <span class="number">0.5</span>;  <span class="comment">// 敌机子弹发射周期</span></span><br><span class="line"></span><br><span class="line">    private _enemySpeed = <span class="number">0</span>;</span><br><span class="line">    private _needBullet = <span class="literal">false</span>;  <span class="comment">// 敌机是否发射子弹</span></span><br><span class="line">    private _currCreateBulletTime = <span class="number">0</span>;  <span class="comment">// 敌机当前子弹发射周期</span></span><br><span class="line">    private <span class="attr">_gameManager</span>: <span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取分组</span></span><br><span class="line">        <span class="keyword">const</span> collisionGroup = event.<span class="property">otherCollider</span>.<span class="title function_">getGroup</span>();</span><br><span class="line">        <span class="comment">// 遇到玩家飞机或子弹，敌人飞机销毁</span></span><br><span class="line">        <span class="keyword">if</span> (collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_PLANE</span></span><br><span class="line">            || collisionGroup === <span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_BULLET</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;trigger enemy destroy&#x27;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">addScore</span>();  <span class="comment">// 分数增加</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reduce blood&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;</span><br><span class="line">        <span class="comment">// 敌机向下飞 pos.z 值要增加</span></span><br><span class="line">        <span class="keyword">let</span> movePos = pos.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_enemySpeed</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 增加用于判断是否要发射子弹</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_needBullet</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> += deltaTime;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> &gt; <span class="variable language_">this</span>.<span class="property">createBulletTime</span>) &#123;</span><br><span class="line">                <span class="comment">// 敌机发射子弹，需要在 GameManager 添加相应函数</span></span><br><span class="line">                <span class="comment">// this.node.position 是发射子弹时敌机的位置</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">createEnemyBullet</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, movePos);</span><br><span class="line">        <span class="keyword">if</span> (movePos &gt; <span class="variable constant_">OUTOFBOUNCE</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">gameManager: GameManager, speed: number, needBullet: boolean = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameManager</span> = gameManager;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_enemySpeed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_needBullet</span> = needBullet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="5"><li>修改子弹脚本 <code>Bullet</code>, 添加 <code>onEnable()</code> 和 <code>onDisable()</code> 及 <code>回调函数</code> 检测 <code>子弹</code> 是否与 <code>飞机</code> 发生 <code>碰撞</code>。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Collider</span>, <span class="title class_">ITriggerEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;Bullet&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Bullet</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @property</span></span><br><span class="line">    <span class="comment">// public bulletSpeed = 0;</span></span><br><span class="line"></span><br><span class="line">    private _bulletSpeed = <span class="number">0</span>;  <span class="comment">//子弹速度改为私有变量</span></span><br><span class="line">    private _isEnemyBullet = <span class="literal">false</span>;  <span class="comment">// 判断是否为敌机子弹</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;  <span class="comment">// 获取子弹的位置</span></span><br><span class="line">        <span class="keyword">let</span> moveLength = pos.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span>; <span class="comment">// 计算每一帧子弹要移动的位置</span></span><br><span class="line">        <span class="comment">// 计算每一帧子弹要移动的位置, 玩家和敌机子弹方向不同</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isEnemyBullet</span>) &#123;</span><br><span class="line">            moveLength = pos.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, moveLength);</span><br><span class="line">            <span class="keyword">if</span> (moveLength &gt; <span class="number">50</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`enemy bullet destory`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            moveLength = pos.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, moveLength);</span><br><span class="line">            <span class="keyword">if</span> (moveLength &lt; -<span class="number">50</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`player bullet destory`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从 GameManager 脚本接收子弹速度和是否为敌机子弹</span></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">speed: number, isEnemyBullet: boolean = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isEnemyBullet</span> = isEnemyBullet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onEnable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDisable</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取碰撞组件</span></span><br><span class="line">        <span class="keyword">const</span> collider = <span class="variable language_">this</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>);</span><br><span class="line">        <span class="comment">// 停止监听触发事件</span></span><br><span class="line">        collider.<span class="title function_">off</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_onTriggerEnter</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_onTriggerEnter</span>(<span class="params">event: ITriggerEvent</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;trigger bullet destroy&#x27;</span>);        </span><br><span class="line">        <span class="comment">// 子弹碰到任意飞机都销毁</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="6"><li>修改游戏控制脚本 <code>GameManager</code> 的 <code>createEnemyBullet</code> 函数, 给敌机发射的子弹设置 <code>碰撞矩阵分组</code> 和 <code>碰撞掩码</code>, 这两项在之前的 <code>设置窗口</code> 中 <code>没有设置</code>; 添加 <code>计分函数</code>(暂时为空函数) 。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, instantiate, math, <span class="title class_">Vec3</span>, <span class="title class_">BoxCollider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Bullet</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/Bullet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnemyPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/EnemyPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹2</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet03</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹3</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet04</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹4</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet05</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹5</span></span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public shootTime = <span class="number">0.3</span>; <span class="comment">// 射击周期（间隔时间）</span></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">1</span>;  <span class="comment">// 子弹速度</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bulletRoot</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 子弹管理节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机2</span></span><br><span class="line">    @property</span><br><span class="line">    public createEnemyTime = <span class="number">1</span>;  <span class="comment">// 敌机生成时间</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy01Speed = <span class="number">0.5</span>;  <span class="comment">// 敌机1速度</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy02Speed = <span class="number">0.7</span>;  <span class="comment">// 敌机2速度</span></span><br><span class="line"></span><br><span class="line">    private _currShootTime = <span class="number">0</span>;</span><br><span class="line">    private _isShooting = <span class="literal">false</span>;</span><br><span class="line">    private _currCreateEnemyTiime = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">    private _combinationInterval = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> += deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isShooting</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_currShootTime</span> &gt; <span class="variable language_">this</span>.<span class="property">shootTime</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">createPlayerBullet</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> += deltaTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断组合方式创建相应的敌机</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">            <span class="comment">// 第二阶段，前两种组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.9</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 第三阶段，三个组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.8</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN3</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination02</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建玩家飞机的子弹</span></span><br><span class="line">    public <span class="title function_">createPlayerBullet</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet类 （子弹预制根节点添加 Bullet 脚本）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>); <span class="comment">// 设置子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否处理触摸状态，触摸才发射子弹</span></span><br><span class="line">    public <span class="title function_">isShooting</span>(<span class="params">value: boolean</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">createEnemyPlane</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// math 是 cc 带的数字模块</span></span><br><span class="line">        <span class="keyword">const</span> whichEnemy = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> speed = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (whichEnemy === <span class="title class_">Constant</span>.<span class="property">EnemyType</span>.<span class="property">TYPE1</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy01</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy02</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化预制 </span></span><br><span class="line">        <span class="keyword">const</span> enemy = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        enemy.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>); <span class="comment">// 预制挂载到组件中</span></span><br><span class="line">        <span class="keyword">const</span> enemyComp = enemy.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">        enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, speed, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 敌机随机出现的X轴(左右)坐标范围</span></span><br><span class="line">        <span class="keyword">const</span> randomPos = math.<span class="title function_">randomRangeInt</span>(-<span class="number">25</span>, <span class="number">26</span>);</span><br><span class="line">        enemy.<span class="title function_">setPosition</span>(randomPos, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1：5架飞机一字型同时出现</span></span><br><span class="line">    public <span class="title function_">createCombination01</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy01</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(-<span class="number">20</span> + i * <span class="number">10</span>, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1, 7架飞机V字型出现</span></span><br><span class="line">    public <span class="title function_">createCombination02</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 7 架敌机的初始坐标</span></span><br><span class="line">        <span class="keyword">const</span> combinationPos = [</span><br><span class="line">            -<span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">            -<span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            -<span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, -<span class="number">45</span>,</span><br><span class="line">            <span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            <span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy02</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            <span class="keyword">const</span> startIndex = i * <span class="number">3</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(combinationPos[startIndex],</span><br><span class="line">                combinationPos[startIndex + <span class="number">1</span>],</span><br><span class="line">                combinationPos[startIndex + <span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 敌机发射子弹</span></span><br><span class="line">     public <span class="title function_">createEnemyBullet</span>(<span class="params">targetPos: Vec3</span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line">       </span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(targetPos.<span class="property">x</span>, targetPos.<span class="property">y</span>, targetPos.<span class="property">z</span> + <span class="number">6</span>);</span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// 敌机的子弹速度 要比敌机大一些</span></span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="number">1</span>, <span class="literal">true</span>);   </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取子弹的碰撞器组件</span></span><br><span class="line">        <span class="keyword">const</span> colliderComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">BoxCollider</span>);</span><br><span class="line">        <span class="comment">// 设置敌机子弹的碰撞矩阵</span></span><br><span class="line">        colliderComp.<span class="title function_">setGroup</span>(<span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">ENEMY_BULLET</span>);</span><br><span class="line">        <span class="comment">// 设置碰撞掩码 与 玩家飞机 碰撞</span></span><br><span class="line">        colliderComp.<span class="title function_">setMask</span>(<span class="title class_">Constant</span>.<span class="property">CollistionType</span>.<span class="property">PLAYER_PLANE</span>);  </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计分</span></span><br><span class="line">    public <span class="title function_">addScore</span>(<span class="params"></span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 用于按下的时候即发射第一颗子弹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="variable language_">this</span>.<span class="property">shootTime</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定时器函数</span></span><br><span class="line">    private <span class="title function_">_changePlaneModel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// this.schedule()四个参数：回调， 间隔时间，重复次数， 延迟时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>, <span class="number">10</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变组合状态</span></span><br><span class="line">    private <span class="title function_">_modeChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="7"><li>保存场景, 预览。 <code>敌人飞机</code> 或 <code>子弹</code> 碰到 <code>玩家飞机</code> 或 <code>玩家子弹</code> 会消失, <code>玩家飞机</code> 目前还处于 <code>无敌</code> 状态。</li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> cocos creator </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cocos creator </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记：使用 Cocos Creator 3.4.0 开发空战游戏 03——敌机出现</title>
      <link href="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/"/>
      <url>/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/</url>
      
        <content type="html"><![CDATA[<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><ol><li>Cocos Dashboard 1.0.20</li><li>Cocos Creator 3.4.0</li><li>Visual Studio Code 1.63</li><li>Microsoft Edge 97.0.1072.69</li></ol><hr><h1 id="制作敌人飞机"><a href="#制作敌人飞机" class="headerlink" title="制作敌人飞机"></a>制作敌人飞机</h1><ol><li><p>在 <code>资源管理器</code> 的 <code>assets/script/</code> 创建名为 <code>plane</code> 的文件夹, 在 <code>assets/script/plane/</code> 文件夹下创建脚本，命名为 <code>EnemyPlane</code>, 暂时不用编辑脚本内容。</p></li><li><p>在 <code>资源管理器</code> 的 <code>assets/res/model/plane02</code> 文件夹添加 <code>材质</code>，命名为 <code>plane02</code>, 修改 <code>Effect</code> 属性为 <code>bulitin-unlit</code>, 选中 <code>USE TEXTURE</code>, <code>MainTexture</code> 拖入图片 <code>plane02</code>, 保存材质。</p></li></ol><img src="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/001.png" class="" title="plane02"><ol start="3"><li><p>复制上一步的材质到 <code>assets/res/model/plane03</code> 文件夹， 更改材质名为：<code>plane03</code>， 修改其 <code>MainTexture</code> 为图片<code>plane03</code>， 保存材质。</p></li><li><p>在 <code>层级管理器</code> 中创建一个 <code>空节点</code>，命名为 <code>plane02</code>, 将 <code>资源管理器</code> 中的 <code>FBX</code> 模型 <code>plane02</code> 拖到该节点，将模型名称改名为 <code>body</code>, 展开 <code>body</code>， 选中下面的 <code>plane02</code>, 把 <code>Materials</code> 中的材质替换为 <code>plane02</code>。</p></li></ol><img src="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/002.png" class="" title="plane02"><ol start="4"><li>在 <code>层级管理器</code> 点击选中 <code>plane02/body</code> 节点, 修改属性 <code>Rotation</code> 的三个值改为 <code>X:5, Y:5, Z:5</code>， 放大 <code>5倍</code>。</li></ol><img src="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/003.png" class="" title="plane02"><ol start="5"><li>在 <code>层级管理器</code> 点击选中 <code>plane02</code> 节点， 在 <code>属性检查器</code> 选择 <code>添加组件</code> -&gt; <code>自定义脚本</code> -&gt; <code>EnemyPlane</code>, 把敌人飞机的脚本挂载到 <code>plane02</code> 根节点上。</li></ol><img src="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/004.png" class="" title="plane02"><ol start="6"><li><p>将 <code>层级管理器</code> 中的 <code>plane02</code> 节点拖动到 <code>资源管理器</code> 的 <code>assets/res/model/plane02</code> 文件夹，做成 <code>预制</code>。</p></li><li><p>重复上面的步骤，制作 <code>plane03</code> 的 <code>预制</code>。</p></li><li><p>在 <code>层级管理器</code> 中删除 <code>plane02</code> 和 <code>plane03</code> 两个节点</p></li></ol><h1 id="敌机的管理"><a href="#敌机的管理" class="headerlink" title="敌机的管理"></a>敌机的管理</h1><ol><li>在 <code>资源管理器</code> 的 <code>assets/script/framework/</code> 文件夹添加脚本 <code>Constant</code> 用于存放游戏里常用的类型, 比如 <code>飞机类型</code>、<code>子弹类型</code> 以及 <code>飞机组合</code> 等。<code>Constant</code> 类不需要继承自 <code>Component</code>, 编辑代码如以下所示：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Constant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">EnemyType</span> = &#123;</span><br><span class="line">        <span class="title class_">TYPE1</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="title class_">TYPE2</span>: <span class="number">2</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机组合类型</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">Combination</span> = &#123;</span><br><span class="line">        <span class="title class_">PLAN1</span>: <span class="number">1</span>,  <span class="comment">// 组合1, 每次随机1架敌机, 发射子弹</span></span><br><span class="line">        <span class="title class_">PLAN2</span>: <span class="number">2</span>,  <span class="comment">// 组合2, 每次5架敌机，一 字型, 不发射子弹</span></span><br><span class="line">        <span class="title class_">PLAN3</span>: <span class="number">3</span>,  <span class="comment">// 组合3, 每次7架敌机，V 字型, 不发射子弹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>编辑敌机脚本 <code>EnemyPlane</code>, 内容如以下代码所示：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 敌机被销毁的位置(超出屏幕下边沿后的Z轴坐标值)</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTOFBOUNCE</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;EnemyPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">EnemyPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    private _enemySpeed = <span class="number">0</span>;</span><br><span class="line">    private <span class="attr">_gameManager</span>: <span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;</span><br><span class="line">        <span class="comment">// 敌机向下飞 pos.z 值要增加</span></span><br><span class="line">        <span class="keyword">let</span> movePos = pos.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_enemySpeed</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, movePos);</span><br><span class="line">        <span class="keyword">if</span> (movePos &gt; <span class="variable constant_">OUTOFBOUNCE</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">gameManager: GameManager, speed: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameManager</span> = gameManager;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_enemySpeed</span> = speed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>修改 <code>GameManager</code> 脚本, 添加用于管理敌机的属性, 以及控制敌机 <code>第一阶段</code> (前10秒)的出现。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, instantiate, math &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Bullet</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/Bullet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnemyPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/EnemyPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹2</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet03</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹3</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet04</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹4</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet05</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹5</span></span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public shootTime = <span class="number">0.3</span>; <span class="comment">// 射击周期（间隔时间）</span></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">1</span>;  <span class="comment">// 子弹速度</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bulletRoot</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 子弹管理节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机2</span></span><br><span class="line">    @property</span><br><span class="line">    public createEnemyTime = <span class="number">1</span>;  <span class="comment">// 敌机生成时间</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy01Speed = <span class="number">0.5</span>;  <span class="comment">// 敌机1速度</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy02Speed = <span class="number">0.7</span>;  <span class="comment">// 敌机2速度</span></span><br><span class="line"></span><br><span class="line">    private _currShootTime = <span class="number">0</span>;</span><br><span class="line">    private _isShooting = <span class="literal">false</span>;</span><br><span class="line">    private _currCreateEnemyTiime = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">    private _combinationInterval = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> += deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isShooting</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_currShootTime</span> &gt; <span class="variable language_">this</span>.<span class="property">shootTime</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">createPlayerBullet</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> += deltaTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断组合方式创建相应的敌机</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建玩家飞机的子弹</span></span><br><span class="line">    public <span class="title function_">createPlayerBullet</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet类 （子弹预制根节点添加 Bullet 脚本）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        bulletComp.<span class="property">bulletSpeed</span> = <span class="variable language_">this</span>.<span class="property">bulletSpeed</span>; <span class="comment">// 设置子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否处理触摸状态，触摸才发射子弹</span></span><br><span class="line">    public <span class="title function_">isShooting</span>(<span class="params">value: boolean</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">createEnemyPlane</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// math 是 cc 带的数字模块</span></span><br><span class="line">        <span class="keyword">const</span> whichEnemy = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> speed = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (whichEnemy === <span class="title class_">Constant</span>.<span class="property">EnemyType</span>.<span class="property">TYPE1</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy01</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy02</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化预制 </span></span><br><span class="line">        <span class="keyword">const</span> enemy = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        enemy.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>); <span class="comment">// 预制挂载到组件中</span></span><br><span class="line">        <span class="keyword">const</span> enemyComp = enemy.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">        enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, speed);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 敌机随机出现的X轴(左右)坐标范围</span></span><br><span class="line">        <span class="keyword">const</span> randomPos = math.<span class="title function_">randomRangeInt</span>(-<span class="number">25</span>, <span class="number">26</span>);</span><br><span class="line">        enemy.<span class="title function_">setPosition</span>(randomPos, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 用于按下的时候即发射第一颗子弹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="variable language_">this</span>.<span class="property">shootTime</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 定时器函数</span></span><br><span class="line">     private <span class="title function_">_changePlaneModel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// this.schedule()四个参数：回调， 间隔时间，重复次数， 延迟时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>, <span class="number">10</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变组合状态</span></span><br><span class="line">    private <span class="title function_">_modeChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span> ++;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>将 <code>资源管理器</code> 中的两个预制 <code>plane02</code> 和<code>plane03</code> 分别挂载到 <code>层级管理器</code> 中 <code>gameManager</code> 节点对应的位置。</li></ol><img src="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/005.png" class="" title="gameManager"><ol start="5"><li>保存场景, 预览，可以看到单架敌机出现。</li></ol><img src="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/006.png" class="" title="EnemyPlane"><ol start="6"><li>继续编辑 <code>GameManager</code> 脚本, 控制敌机 <code>第二阶段</code> (10-20秒) <code>组合1</code>、<code>组合2</code> 随机出机 和 <code>第三阶段</code> (20秒后)<code>组合1</code>、<code>组合2</code>、<code>组合3</code> 随机出现。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, instantiate, math &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Bullet</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/Bullet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnemyPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/EnemyPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹2</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet03</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹3</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet04</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹4</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet05</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹5</span></span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public shootTime = <span class="number">0.3</span>; <span class="comment">// 射击周期（间隔时间）</span></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">1</span>;  <span class="comment">// 子弹速度</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bulletRoot</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 子弹管理节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机2</span></span><br><span class="line">    @property</span><br><span class="line">    public createEnemyTime = <span class="number">1</span>;  <span class="comment">// 敌机生成时间</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy01Speed = <span class="number">0.5</span>;  <span class="comment">// 敌机1速度</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy02Speed = <span class="number">0.7</span>;  <span class="comment">// 敌机2速度</span></span><br><span class="line"></span><br><span class="line">    private _currShootTime = <span class="number">0</span>;</span><br><span class="line">    private _isShooting = <span class="literal">false</span>;</span><br><span class="line">    private _currCreateEnemyTiime = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">    private _combinationInterval = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> += deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isShooting</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_currShootTime</span> &gt; <span class="variable language_">this</span>.<span class="property">shootTime</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">createPlayerBullet</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> += deltaTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断组合方式创建相应的敌机</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">            <span class="comment">// 第二阶段，前两种组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.9</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 第三阶段，三个组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.8</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN3</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination02</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建玩家飞机的子弹</span></span><br><span class="line">    public <span class="title function_">createPlayerBullet</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet类 （子弹预制根节点添加 Bullet 脚本）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        bulletComp.<span class="property">bulletSpeed</span> = <span class="variable language_">this</span>.<span class="property">bulletSpeed</span>; <span class="comment">// 设置子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否处理触摸状态，触摸才发射子弹</span></span><br><span class="line">    public <span class="title function_">isShooting</span>(<span class="params">value: boolean</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">createEnemyPlane</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// math 是 cc 带的数字模块</span></span><br><span class="line">        <span class="keyword">const</span> whichEnemy = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> speed = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (whichEnemy === <span class="title class_">Constant</span>.<span class="property">EnemyType</span>.<span class="property">TYPE1</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy01</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy02</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化预制 </span></span><br><span class="line">        <span class="keyword">const</span> enemy = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        enemy.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>); <span class="comment">// 预制挂载到组件中</span></span><br><span class="line">        <span class="keyword">const</span> enemyComp = enemy.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">        enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, speed);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 敌机随机出现的X轴(左右)坐标范围</span></span><br><span class="line">        <span class="keyword">const</span> randomPos = math.<span class="title function_">randomRangeInt</span>(-<span class="number">25</span>, <span class="number">26</span>);</span><br><span class="line">        enemy.<span class="title function_">setPosition</span>(randomPos, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1：5架飞机一字型同时出现</span></span><br><span class="line">    public <span class="title function_">createCombination01</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy01</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(-<span class="number">20</span> + i * <span class="number">10</span>, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1, 7架飞机V字型出现</span></span><br><span class="line">    public <span class="title function_">createCombination02</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 7 架敌机的初始坐标</span></span><br><span class="line">        <span class="keyword">const</span> combinationPos = [</span><br><span class="line">            -<span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">            -<span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            -<span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, -<span class="number">45</span>,</span><br><span class="line">            <span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            <span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy02</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            <span class="keyword">const</span> startIndex = i * <span class="number">3</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(combinationPos[startIndex],</span><br><span class="line">                combinationPos[startIndex + <span class="number">1</span>],</span><br><span class="line">                combinationPos[startIndex + <span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 用于按下的时候即发射第一颗子弹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="variable language_">this</span>.<span class="property">shootTime</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定时器函数</span></span><br><span class="line">    private <span class="title function_">_changePlaneModel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// this.schedule()四个参数：回调， 间隔时间，重复次数， 延迟时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>, <span class="number">10</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变组合状态</span></span><br><span class="line">    private <span class="title function_">_modeChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="7"><li>保存场景, 预览，<code>20秒</code> 后可以看到三种组合的敌机出现。</li></ol><img src="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/007.png" class="" title="EnemyPlane"><h1 id="敌机发射子弹"><a href="#敌机发射子弹" class="headerlink" title="敌机发射子弹"></a>敌机发射子弹</h1><ol><li>修改 <code>Bullet</code> 脚本, 增加判断 <code>敌机子弹</code> 的逻辑。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;Bullet&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Bullet</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @property</span></span><br><span class="line">    <span class="comment">// public bulletSpeed = 0;</span></span><br><span class="line"></span><br><span class="line">    private _bulletSpeed = <span class="number">0</span>;  <span class="comment">//子弹速度改为私有变量</span></span><br><span class="line">    private _isEnemyBullet = <span class="literal">false</span>;  <span class="comment">// 判断是否为敌机子弹</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;  <span class="comment">// 获取子弹的位置</span></span><br><span class="line">        <span class="keyword">let</span> moveLength = pos.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span>; <span class="comment">// 计算每一帧子弹要移动的位置</span></span><br><span class="line">        <span class="comment">// 计算每一帧子弹要移动的位置, 玩家和敌机子弹方向不同</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isEnemyBullet</span>) &#123;</span><br><span class="line">            moveLength = pos.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, moveLength);</span><br><span class="line">            <span class="keyword">if</span> (moveLength &gt; <span class="number">50</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`enemy bullet destory`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            moveLength = pos.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, moveLength);</span><br><span class="line">            <span class="keyword">if</span> (moveLength &lt; -<span class="number">50</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`player bullet destory`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从 GameManager 脚本接收子弹速度和是否为敌机子弹</span></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">speed: number, isEnemyBullet: boolean = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_bulletSpeed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isEnemyBullet</span> = isEnemyBullet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>EnemyPlane</code> 脚本，增加 <code>敌机发射子弹</code> 逻辑。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 敌机被销毁的位置(超出屏幕下边沿后的Z轴坐标值)</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTOFBOUNCE</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;EnemyPlane&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">EnemyPlane</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public createBulletTime = <span class="number">0.5</span>;  <span class="comment">// 敌机子弹发射周期</span></span><br><span class="line"></span><br><span class="line">    private _enemySpeed = <span class="number">0</span>;</span><br><span class="line">    private _needBullet = <span class="literal">false</span>;  <span class="comment">// 敌机是否发射子弹</span></span><br><span class="line">    private _currCreateBulletTime = <span class="number">0</span>;  <span class="comment">// 敌机当前子弹发射周期</span></span><br><span class="line">    private <span class="attr">_gameManager</span>: <span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;</span><br><span class="line">        <span class="comment">// 敌机向下飞 pos.z 值要增加</span></span><br><span class="line">        <span class="keyword">let</span> movePos = pos.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_enemySpeed</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 增加用于判断是否要发射子弹</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_needBullet</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> += deltaTime;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> &gt; <span class="variable language_">this</span>.<span class="property">createBulletTime</span>) &#123;</span><br><span class="line">                <span class="comment">// 敌机发射子弹，需要在 GameManager 添加相应函数</span></span><br><span class="line">                <span class="comment">// this.node.position 是发射子弹时敌机的位置</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_gameManager</span>.<span class="title function_">createEnemyBullet</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateBulletTime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, movePos);</span><br><span class="line">        <span class="keyword">if</span> (movePos &gt; <span class="variable constant_">OUTOFBOUNCE</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">show</span>(<span class="params">gameManager: GameManager, speed: number, needBullet: boolean = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameManager</span> = gameManager;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_enemySpeed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_needBullet</span> = needBullet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>修改 <code>GameManager</code> 脚本控制敌机子弹发射, 添加 <code>createEnemyBullet</code> 方法, 修改所有 <code>show</code> 方法, 调整参数个数 。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, instantiate, math, <span class="title class_">Vec3</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Bullet</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/Bullet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnemyPlane</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../plane/EnemyPlane&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Constant</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Constant&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹2</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet03</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹3</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet04</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹4</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet05</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹5</span></span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public shootTime = <span class="number">0.3</span>; <span class="comment">// 射击周期（间隔时间）</span></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">1</span>;  <span class="comment">// 子弹速度</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bulletRoot</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 子弹管理节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">enemy02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;  <span class="comment">// 敌机2</span></span><br><span class="line">    @property</span><br><span class="line">    public createEnemyTime = <span class="number">1</span>;  <span class="comment">// 敌机生成时间</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy01Speed = <span class="number">0.5</span>;  <span class="comment">// 敌机1速度</span></span><br><span class="line">    @property</span><br><span class="line">    public enemy02Speed = <span class="number">0.7</span>;  <span class="comment">// 敌机2速度</span></span><br><span class="line"></span><br><span class="line">    private _currShootTime = <span class="number">0</span>;</span><br><span class="line">    private _isShooting = <span class="literal">false</span>;</span><br><span class="line">    private _currCreateEnemyTiime = <span class="number">0</span>;  <span class="comment">// 当前敌机的生成时间</span></span><br><span class="line">    private _combinationInterval = <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>;   <span class="comment">// 组合的间隔状态</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> += deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isShooting</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_currShootTime</span> &gt; <span class="variable language_">this</span>.<span class="property">shootTime</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">createPlayerBullet</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> += deltaTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断组合方式创建相应的敌机</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_combinationInterval</span> === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">            <span class="comment">// 第二阶段，前两种组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.9</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 第三阶段，三个组合随机出现</span></span><br><span class="line">            <span class="comment">// 这里乘以 0.9 是缩短敌机出现的间隔时间</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> &gt; <span class="variable language_">this</span>.<span class="property">createEnemyTime</span> * <span class="number">0.8</span>) &#123;</span><br><span class="line">                <span class="comment">// 用于随机出现组合1或组合2</span></span><br><span class="line">                <span class="keyword">const</span> randomCombination = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN2</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination01</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (randomCombination === <span class="title class_">Constant</span>.<span class="property">Combination</span>.<span class="property">PLAN3</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createCombination02</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">createEnemyPlane</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">_currCreateEnemyTiime</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建玩家飞机的子弹</span></span><br><span class="line">    public <span class="title function_">createPlayerBullet</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet类 （子弹预制根节点添加 Bullet 脚本）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="variable language_">this</span>.<span class="property">bulletSpeed</span>, <span class="literal">false</span>); <span class="comment">// 设置子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否处理触摸状态，触摸才发射子弹</span></span><br><span class="line">    public <span class="title function_">isShooting</span>(<span class="params">value: boolean</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title function_">createEnemyPlane</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// math 是 cc 带的数字模块</span></span><br><span class="line">        <span class="keyword">const</span> whichEnemy = math.<span class="title function_">randomRangeInt</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">prefab</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> speed = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (whichEnemy === <span class="title class_">Constant</span>.<span class="property">EnemyType</span>.<span class="property">TYPE1</span>) &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy01</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefab = <span class="variable language_">this</span>.<span class="property">enemy02</span>;</span><br><span class="line">            speed = <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化预制 </span></span><br><span class="line">        <span class="keyword">const</span> enemy = <span class="title function_">instantiate</span>(prefab);</span><br><span class="line">        enemy.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">node</span>); <span class="comment">// 预制挂载到组件中</span></span><br><span class="line">        <span class="keyword">const</span> enemyComp = enemy.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">        enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, speed, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 敌机随机出现的X轴(左右)坐标范围</span></span><br><span class="line">        <span class="keyword">const</span> randomPos = math.<span class="title function_">randomRangeInt</span>(-<span class="number">25</span>, <span class="number">26</span>);</span><br><span class="line">        enemy.<span class="title function_">setPosition</span>(randomPos, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1：5架飞机一字型同时出现</span></span><br><span class="line">    public <span class="title function_">createCombination01</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy01</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(-<span class="number">20</span> + i * <span class="number">10</span>, <span class="number">0</span>, -<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy01Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 敌机出现组合1, 7架飞机V字型出现</span></span><br><span class="line">    public <span class="title function_">createCombination02</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> enemyArray = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Node</span>&gt;(<span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 7 架敌机的初始坐标</span></span><br><span class="line">        <span class="keyword">const</span> combinationPos = [</span><br><span class="line">            -<span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">            -<span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            -<span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, -<span class="number">45</span>,</span><br><span class="line">            <span class="number">7</span>, <span class="number">0</span>, -<span class="number">50</span>,</span><br><span class="line">            <span class="number">14</span>, <span class="number">0</span>, -<span class="number">55</span>,</span><br><span class="line">            <span class="number">21</span>, <span class="number">0</span>, -<span class="number">60</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enemyArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            enemyArray[i] = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">enemy02</span>);</span><br><span class="line">            <span class="keyword">const</span> element = enemyArray[i];</span><br><span class="line">            element.<span class="property">parent</span> = <span class="variable language_">this</span>.<span class="property">node</span>;</span><br><span class="line">            <span class="keyword">const</span> startIndex = i * <span class="number">3</span>;</span><br><span class="line">            element.<span class="title function_">setPosition</span>(combinationPos[startIndex],</span><br><span class="line">                combinationPos[startIndex + <span class="number">1</span>],</span><br><span class="line">                combinationPos[startIndex + <span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">const</span> enemyComp = element.<span class="title function_">getComponent</span>(<span class="title class_">EnemyPlane</span>);</span><br><span class="line">            enemyComp.<span class="title function_">show</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">enemy02Speed</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 敌机发射子弹</span></span><br><span class="line">     public <span class="title function_">createEnemyBullet</span>(<span class="params">targetPos: Vec3</span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line">       </span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(targetPos.<span class="property">x</span>, targetPos.<span class="property">y</span>, targetPos.<span class="property">z</span> + <span class="number">6</span>);</span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        <span class="comment">// 敌机的子弹速度 要比敌机大一些</span></span><br><span class="line">        bulletComp.<span class="title function_">show</span>(<span class="number">1</span>, <span class="literal">true</span>);   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 用于按下的时候即发射第一颗子弹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="variable language_">this</span>.<span class="property">shootTime</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_changePlaneModel</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定时器函数</span></span><br><span class="line">    private <span class="title function_">_changePlaneModel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// this.schedule()四个参数：回调， 间隔时间，重复次数， 延迟时间</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">_modeChanged</span>, <span class="number">10</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变组合状态</span></span><br><span class="line">    private <span class="title function_">_modeChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_combinationInterval</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>重新预览, 单架出现的敌机向玩家方向发射子弹</li></ol><img src="/2022/01/29/develop-an-airplane-game-in-cocos-creator-03/008.png" class="" title="EnemyPlane"><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> cocos creator </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cocos creator </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记：使用 Cocos Creator 3.4.0 开发空战游戏 02——玩家飞机</title>
      <link href="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/"/>
      <url>/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/</url>
      
        <content type="html"><![CDATA[<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><ol><li>Cocos Dashboard 1.0.20</li><li>Cocos Creator 3.4.0</li><li>Visual Studio Code 1.63</li><li>Microsoft Edge 97.0.1072.69</li></ol><hr><h1 id="创建玩家飞机"><a href="#创建玩家飞机" class="headerlink" title="创建玩家飞机"></a>创建玩家飞机</h1><ol><li>在 <code>层级管理器</code> 中 创建一个空节点, 命名为 <code>playerPlane</code>, 在 <code>资源管理器</code> 中拖动的 <code>FBX</code> 模型 <code>assets/res/model/plane01/plane01</code> 到 <code>playerPlane</code> 节点中, 并将节点 <code>playerPlane</code> 下的模型名称 <code>plane01</code>(模型根节点) 改名为 <code>body</code>。</li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/001.png" class="" title="payerPlane"><ol start="2"><li>在 <code>资源管理器</code> 中点击选中 <code>assets/res/model/plane01</code> 文件夹, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>材质</code>, 命名为 <code>playerPlane</code>。</li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/002.png" class="" title="payerPlane"><ol start="3"><li>将材质 <code>playerPlane</code> 的属性 <code>Effect</code> 更改为 <code>builtin-unlit</code>; 属性 <code>USE TEXTURE</code> 打勾, 飞机图片 <code>plane01</code> 拖动到 <code>MainTexture</code>, 保存材质。</li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/003.png" class="" title="payerPlane"><ol start="4"><li>在 <code>层级管理器</code> 中, 点击选中 <code>playerPlane/body/plane01</code> 节点, 将上一步创建的材质 <code>playerPlane</code> 拖动到其 <code>属性检查器</code> 中的 <code>Materials</code>[0], 保存场景。</li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/004.png" class="" title="payerPlane"><ol start="5"><li><p>在 <code>层级管理器</code> 中点击选中 <code>playerPlane/body</code> 节点, 修改缩放属性 <code>Scale</code> 的值为：<code>X:8, Y:8, Z:8</code> (放大8倍)。</p></li><li><p>此时飞机与背景板重叠，在 <code>层级管理器</code> 中点击选中 <code>movingSceneBg</code>, 将其 <code>Position</code> 的 <code>Y轴</code> 修改为: <code>-20</code> (背景往下移)。</p></li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/005.png" class="" title="movingBG"><ol start="7"><li>在 <code>层级管理器</code> 中点击选中 <code>playerPlane</code> 节点，将其拖动到 <code>资源管理器</code> 中的 <code>assets/res/model/plane01</code> 文件夹 <code>制作</code> 成 <code>预制</code>, 保存场景。</li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/006.png" class="" title="payerPlane"><h1 id="控制飞机移动"><a href="#控制飞机移动" class="headerlink" title="控制飞机移动"></a>控制飞机移动</h1><ol><li>在 <code>资源管理器</code> 点击选中 <code>assets/script/</code> 文件夹, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>文件夹</code>, 命名为 <code>ui</code>, 在该文件夹中添加脚本 <code>UIManager</code>, 双击打开该脚本进行编辑。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Touch</span>, <span class="title class_">EventTouch</span>, <span class="title class_">Input</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;UIManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UIManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public playerPlaneSpeed = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_MOVE</span>, <span class="variable language_">this</span>.<span class="property">_touchMove</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_touchMove</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="comment">// touch.getDelta() 获取当前触点值与上一次触点值的差值</span></span><br><span class="line">        <span class="keyword">let</span> delta = touch.<span class="title function_">getDelta</span>();</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>;  <span class="comment">// 获取当前节点的位置</span></span><br><span class="line">        <span class="comment">// 在速度前乘以 0.01 是用于调整移动的速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="title function_">setPosition</span>(</span><br><span class="line">            pos.<span class="property">x</span> + <span class="number">0.01</span> * <span class="variable language_">this</span>.<span class="property">playerPlaneSpeed</span> * delta.<span class="property">x</span>,</span><br><span class="line">            pos.<span class="property">y</span>,</span><br><span class="line">            pos.<span class="property">z</span> - <span class="number">0.01</span> * <span class="variable language_">this</span>.<span class="property">playerPlaneSpeed</span> * delta.<span class="property">y</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><p>在 <code>层级管理器</code> 中点击选中场景 <code>airplane</code>, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>UI组件</code> -&gt; <code>Canvas(画布)</code>, 名字默认。</p></li><li><p>在 <code>层级管理器</code> 中点击选中 <code>Canvas</code> 节点, 在 <code>属性检查器</code> 点 <code>添加组件</code> -&gt; <code>自定义脚本</code> -&gt; <code>UIManager</code>, 将上一步编辑好的脚本 <code>UIManager</code> 挂载到 <code>Canvas</code> 根节点。</p></li><li><p>将 <code>层级管理器</code> 中的 <code>playerPlane</code> 节点拖到 <code>Canvas</code> 节点 <code>属性检查器</code> 的 <code>playerPlane</code> 属性中, 修改 <code>playerPlaneSpeed</code> 值为 8，保存场景，预览。</p></li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/007.png" class="" title="payerPlane"><h1 id="玩家飞机子弹"><a href="#玩家飞机子弹" class="headerlink" title="玩家飞机子弹"></a>玩家飞机子弹</h1><ol><li>在 <code>资源管理器</code> 点击选中 <code>assets/res/effect/bullet/</code> 文件夹, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>材质</code>, 命名为 <code>bullet01</code>, 修改 <code>Effect</code> 为 <code>bulitin-unlit</code>, 此处子弹模型包含透明外环效果, 将 <code>Technique</code> 修改为 <code>3-alpha-blend</code> 模式; 选中 <code>USE TEXTURE</code>, 将图片 <code>bullet01</code> 拖动到 <code>属性检查器</code> 中的属性 <code>MainTexture</code>, 在 <code>属性检查器</code> 右上角点 <code>保存</code>。</li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/008.png" class="" title="bullet01"><ol start="2"><li><p>选中已经制作好的子弹材质 <code>bullet01</code>, <code>Ctrl+D</code> 快速复制为 <code>4</code> 个(<code>bullet02</code> - <code>bullet05</code>), 分别将各个新材质的属性 <code>MainTexture</code> 更改为对应的图片, 保存。</p></li><li><p>在 <code>层级管理器</code> 中创建一个名为 <code>bullet01</code> 的空节点， 点击选中 <code>bullet01</code> 节点,  <code>右键</code> -&gt; <code> 创建</code> -&gt; <code>3D对象</code> -&gt; <code>Quad(四方形)</code>, 将其改名为 <code>body</code>。</p></li><li><p>创建好的 <code>Quad(四方形)</code> 垂直于背景， 将其 <code>Rotation</code> 的 <code>X轴</code> 改为 <code>-90</code>, 摆正其位置, 修改其 <code>Materials</code> 为 材质 <code>bullet01</code>; 缩放属性 <code>Scale(缩放)</code> 调整为 <code>5倍</code> 大小，<code>Scale: X:5, Y:5, Z:5 </code>。</p></li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/009.png" class="" title="bullet01"><ol start="5"><li>在 <code>资源管理器</code> 的 <code>script</code> 文件夹中创建 <code>bullet</code> 文件夹, 并创建子弹脚本 <code>Bullet</code> 处理子弹的运行逻辑和子弹的销毁。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTOFRANGE</span> = <span class="number">50</span>; <span class="comment">// 子弹移动的最大范围</span></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;Bullet&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Bullet</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">position</span>;  <span class="comment">// 获取子弹的位置</span></span><br><span class="line">        <span class="keyword">let</span> moveLength = pos.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">bulletSpeed</span>; <span class="comment">// 计算每一帧子弹要移动的位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, moveLength);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (moveLength &gt; <span class="variable constant_">OUTOFRANGE</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`bullet destory`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>在 <code>层级管理器</code> 点击选中 <code>bullet01</code> 节点,  在 <code>属性检查器</code> 中点击 <code>添加组件</code> -&gt; <code>自定义脚本</code> -&gt; <code>Bullet</code>, 将脚本绑定到子弹根节点上; 然后将 <code>层级管理器</code> 中 <code>bullet01</code> 的节点拖动到 <code>资源管理器</code> 的 <code>assets/res/effect/bullet/</code> 文件夹中，变成预制。</li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/010.png" class="" title="bullet01"><ol start="7"><li><p>在 <code>资源管理器</code> 中点击选中 <code>assets/res/effect/bullet/bullet01</code> 预制, <code>Ctrl+D</code> 快速复制为 <code>4</code> 个(<code>bullet02</code> - <code>bullet05</code>)。</p></li><li><p>在 <code>资源管理器</code> 中分别双击 <code>assets/res/effect/bullet/</code> 文件夹中的预制 <code>bullet02</code> - <code>bullet05</code>, 将 <code>body</code> 中的 <code>Materials</code> 替换为对应的 <code>子弹材质</code>, 保存场景。</p></li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/011.png" class="" title="bullet01"><ol start="9"><li>在 <code>层级管理器</code> 中 <code>删除</code> 或 <code>不显示</code> (否则子弹会一直出现在屏幕上)子弹节点 <code>bullet01</code>, 并保存。</li></ol><h1 id="控制子弹发射"><a href="#控制子弹发射" class="headerlink" title="控制子弹发射"></a>控制子弹发射</h1><ol><li>在 <code>资源管理器</code> 创建 <code>assets/script/framework</code> 文件夹, 然后创建名为 <code>GameManager</code> 的脚本。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, instantiate &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Bullet</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../bullet/Bullet&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 玩家飞机</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet01</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹1</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet02</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹2</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet03</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹3</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet04</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹4</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    public <span class="attr">bullet05</span>: <span class="title class_">Prefab</span> = <span class="literal">null</span>; <span class="comment">// 子弹5</span></span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public shootTime = <span class="number">0.3</span>; <span class="comment">// 射击周期（间隔时间）</span></span><br><span class="line">    @property</span><br><span class="line">    public bulletSpeed = <span class="number">1</span>;  <span class="comment">// 子弹速度</span></span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">bulletRoot</span>: <span class="title class_">Node</span> = <span class="literal">null</span>; <span class="comment">// 子弹管理节点</span></span><br><span class="line"></span><br><span class="line">    private _currShootTime = <span class="number">0</span>;</span><br><span class="line">    private _isShooting = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> += deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_isShooting</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_currShootTime</span> &gt; <span class="variable language_">this</span>.<span class="property">shootTime</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">createPlayerBullet</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建玩家飞机的子弹</span></span><br><span class="line">    public <span class="title function_">createPlayerBullet</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 实例材质类型的子弹, 实例出来的对象不在场景中</span></span><br><span class="line">        <span class="keyword">const</span> bullet = <span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">bullet01</span>);</span><br><span class="line">        bullet.<span class="title function_">setParent</span>(<span class="variable language_">this</span>.<span class="property">bulletRoot</span>); <span class="comment">// 子弹挂载到子弹管理节点中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>; <span class="comment">// 获取玩家飞机位置</span></span><br><span class="line">        <span class="comment">// 子弹出现的位置为飞机 Z轴 -7</span></span><br><span class="line">        bullet.<span class="title function_">setPosition</span>(pos.<span class="property">x</span>, pos.<span class="property">y</span>, pos.<span class="property">z</span> - <span class="number">7</span>);</span><br><span class="line">        <span class="comment">// 获取 Bullet类 （子弹预制根节点添加 Bullet 脚本）</span></span><br><span class="line">        <span class="keyword">const</span> bulletComp = bullet.<span class="title function_">getComponent</span>(<span class="title class_">Bullet</span>);</span><br><span class="line">        bulletComp.<span class="property">bulletSpeed</span> = <span class="variable language_">this</span>.<span class="property">bulletSpeed</span>; <span class="comment">// 设置子弹速度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否处理触摸状态，触摸才发射子弹</span></span><br><span class="line">    public <span class="title function_">isShooting</span>(<span class="params">value: boolean</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShooting</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 用于按下的时候即发射第一颗子弹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_currShootTime</span> = <span class="variable language_">this</span>.<span class="property">shootTime</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>UIManager</code> 脚本本以更配合 <code>GameManager</code> 脚本使用</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Touch</span>, <span class="title class_">EventTouch</span>, <span class="title class_">Input</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../framework/GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;UIManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UIManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    public playerPlaneSpeed = <span class="number">1</span>;</span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    public <span class="attr">playerPlane</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加游戏控制脚本</span></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line">    public <span class="attr">gameManager</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_START</span>, <span class="variable language_">this</span>.<span class="property">_touchStart</span>, <span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_MOVE</span>, <span class="variable language_">this</span>.<span class="property">_touchMove</span>, <span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span>.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">TOUCH_END</span>, <span class="variable language_">this</span>.<span class="property">_touchEnd</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_touchMove</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="comment">// touch.getDelta() 获取当前触点值与上一次触点值的差值</span></span><br><span class="line">        <span class="keyword">let</span> delta = touch.<span class="title function_">getDelta</span>();</span><br><span class="line">        <span class="keyword">let</span> pos = <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="property">position</span>;  <span class="comment">// 获取当前节点的位置</span></span><br><span class="line">        <span class="comment">// 在速度前乘以 0.01 是用于调整移动的速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playerPlane</span>.<span class="title function_">setPosition</span>(</span><br><span class="line">            pos.<span class="property">x</span> + <span class="number">0.01</span> * <span class="variable language_">this</span>.<span class="property">playerPlaneSpeed</span> * delta.<span class="property">x</span>,</span><br><span class="line">            pos.<span class="property">y</span>,</span><br><span class="line">            pos.<span class="property">z</span> - <span class="number">0.01</span> * <span class="variable language_">this</span>.<span class="property">playerPlaneSpeed</span> * delta.<span class="property">y</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始触摸屏幕的回调方法</span></span><br><span class="line">    private <span class="title function_">_touchStart</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">isShooting</span>(<span class="literal">true</span>); <span class="comment">// 触摸屏幕时玩家飞机开始射击</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_touchEnd</span>(<span class="params">touch: Touch, event: EventTouch</span>) &#123;</span><br><span class="line">        <span class="comment">// 停止触摸时玩家飞机结束射击</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameManager</span>.<span class="title function_">isShooting</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li><p>在 <code>层级管理器</code> 中点击选中场景 <code>airplane</code>, <code>右键</code>-&gt; <code>空节点</code>，命名为 <code>bulletManager</code>, 创建子弹管理节点。</p></li><li><p>在 <code>层级管理器</code> 中点击选中场景 <code>airplane</code>, <code>右键</code>-&gt; <code>空节点</code>，命名为 <code>gameManager</code>, 在其 <code>属性检查器</code> 中分别添加玩家飞机节点 <code>playerPlane</code>, 子弹预制：<code>bullet01</code> - <code>bullet05</code>, 子弹管理节点<code>BulletRoot</code>: <code>bulletManager</code>。</p></li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/012.png" class="" title="gameManager"><ol start="5"><li>在 <code>层级管理器</code> 点击选中 <code>Canvas</code>节点， 将 <code>gameManager</code> 节点拖动到其 <code>UIManamet</code> 中 <code>GameManager</code> 的属性。</li></ol><img src="/2022/01/24/develop-an-airplane-game-in-cocos-creator-02/013.png" class="" title="Canvas"><ol start="6"><li>保存场景，预览。子弹速度慢，可以将 <code>gameManager</code> 节点 的 <code>shootTime</code> 改为 0.1 ， 缩短子弹发射间隔，提高速度，或是将 <code>bulletSpeed</code> 值改大。</li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> cocos creator </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cocos creator </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记：使用 Cocos Creator 3.4.0 开发空战游戏 01——无限滚动的背景</title>
      <link href="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/"/>
      <url>/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/</url>
      
        <content type="html"><![CDATA[<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><ol><li>Cocos Dashboard 1.0.20</li><li>Cocos Creator 3.4.0</li><li>Visual Studio Code 1.63</li><li>Microsoft Edge 97.0.1072.69</li></ol><h1 id="游戏配套素材资源下载："><a href="#游戏配套素材资源下载：" class="headerlink" title="游戏配套素材资源下载："></a>游戏配套素材资源下载：</h1><p><a href="https://hujiyi.github.io/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/res.zip">游戏开发配套素材资源</a></p><hr><h1 id="项目准备"><a href="#项目准备" class="headerlink" title="项目准备"></a>项目准备</h1><ol><li>启动 <code>Cocos Dashboard</code>, 点 <code>新建</code> 按钮， 项目类型选择 <code>Empty(3D)</code>, 输入 <code>项目名称</code>， 选择项目保存 <code>位置</code>，点 <code>创建并打开</code> 按钮，完成项目的创建。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/001.png" class="" title="project"><ol start="2"><li>下载 <code>游戏开发配套素材资源</code> 并解压缩到 <code>当前文件夹</code>, 将解压后的 <code>res文件夹</code> 拖动到当前项目的 <code>资源管理器</code> 的 <code>assets</code> 文件夹中。如下图所示：</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/002.png" class="" title="res"><h1 id="创建场景"><a href="#创建场景" class="headerlink" title="创建场景"></a>创建场景</h1><ol><li>在 <code>资源管理器</code> 中点击选中 <code>assets/</code> 文件夹， <code>右键</code> -&gt; <code>创建</code> -&gt; <code>文件夹</code>, 将文件夹命名为 <code>scene</code>。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/003.png" class="" title="scene"><ol start="2"><li>在 <code>资源管理器</code> 中点击选中 <code>assets/scene/</code> 文件夹, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>场景</code>, 将场景命名为 <code>airplane</code>。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/004.png" class="" title="scene"><ol start="3"><li>双击打开 <code>airplane</code> 场景</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/005.png" class="" title="airplane"><h1 id="创建背景材质"><a href="#创建背景材质" class="headerlink" title="创建背景材质"></a>创建背景材质</h1><ol><li><p>在 <code>资源管理器</code> 中点击选中 <code>assets/res/</code> 文件夹, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>文件夹</code>, 将文件夹命名为 <code>background</code>。</p></li><li><p>点击选中 <code>background/</code> 文件夹, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>材质</code>, 材质文件命名为 <code>bg</code>。</p></li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/006.png" class="" title="material"><ol start="3"><li>编辑材质 <code>bg</code> 的属性，<code>Effect</code> 的值更改为 <code>builtin-unlit</code>， <code>USE TEXTURE</code> 打勾, 将背景图片 <code>assets/res/texture/bg01.png</code> 拖动到 <code>MainTexture</code>。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/007.png" class="" title="airplane"><ol start="4"><li>在 <code>属性检查器</code> 右上角选 <code>保存</code> (打勾图标), 完成背景材质的创建 。</li></ol><h1 id="创建背景节点"><a href="#创建背景节点" class="headerlink" title="创建背景节点"></a>创建背景节点</h1><ol><li>在 <code>层级管理器</code> 点击选中场景 <code>airPlane</code>， <code>右键</code> -&gt; <code>创建</code> -&gt; <code>空节点</code>, 新节点命名为 <code>movingSceneBg</code>。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/008.png" class="" title="movingSceneBg"><ol start="2"><li>点击选中 <code>movingSceneBg</code> 节点, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>3D对象</code> -&gt; <code>Plane平面</code>, 命名为 <code>bg01</code>。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/009.png" class="" title="bg01"><ol start="3"><li>将上一步创建的材质 <code>bg</code> 拖动到 <code>bg01</code> 的属性 <code>cc.MeshRenderer</code> -&gt; <code>Materials</code> 中,  修改缩放属性 <code>Scale</code> 的值为: <code>X:6, Y:1, Z:9</code> 。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/010.png" class="" title="bg01"><h1 id="调整主相机视角"><a href="#调整主相机视角" class="headerlink" title="调整主相机视角"></a>调整主相机视角</h1><ol><li><p>在 <code>主菜单</code> 选择 <code>Cocos Creator</code> -&gt; <code>偏好设置</code>, 打开 <code>偏好设置</code> 对话框 。</p></li><li><p>在 <code>偏好设置</code> 对话框的右侧列表选择 <code>设置管理器</code>， 在右侧窗格输入设置名称 <code>develop</code>, 点 <code>新增</code> 按钮添加新设备</p></li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/011.png" class="" title="device"><ol start="3"><li>新设备的 <code>宽高</code> 设置为 <code>720 X 1280</code>, 点 <code>修改</code> 保存设备信息, 关闭对话框。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/012.png" class="" title="newdevice"><ol start="4"><li>在 <code>场景编辑器</code> 中更改 <code>渲染输出目标分辨率</code>, 将 <code>目标设备</code> 更改为刚才添加的 <code>develop(720x1280)</code> 。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/013.png" class="" title="develop"><ol start="5"><li>在 <code>层级管理器</code> 中选中相机 <code>Main Camera</code>, 在 <code>场景编辑器</code> 中点击相机向上的坐标轴，并向上拉动以在 <code>场景编辑器</code> 右下角的预览窗口中看到背景图片(下图中 <code>数字6</code> 的位置)。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/014.png" class="" title="Camera"><ol start="6"><li>继续修改相机属性(如上图所示)，让相机能完全显示整个背景图片：</li></ol><ul><li>位置 Position: <code>X:0, Y:30, Z:0</code></li><li>旋转 Rotation: <code>X:-90, Y:0, Z:0</code></li><li>缩放 Scale：<code>X:1, Y:1, Z:1</code></li><li>投影方式 Projection: <code>ORTHO (正交相机)</code></li><li>视距框大小 OrthoHeight: <code>45</code></li></ul><h1 id="背景无限滚动"><a href="#背景无限滚动" class="headerlink" title="背景无限滚动"></a>背景无限滚动</h1><ol><li><p>在 <code>层级管理器</code> 点击选中 <code>movingSceneBg</code> 下的 <code>bg01</code> 背景节点, <code>Ctrl+D</code> 复制背景节点为 <code>bg02</code> 。</p></li><li><p>选中复制好的 <code>bg02</code>， 通过 <code>Z轴</code> 将其拖动到定位值约<code> -90</code> 处，<code>bg01</code> 与 <code>bg02</code> 无明显黑边即可, 保存场景。</p></li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/015.png" class="" title="bg02"><ol start="3"><li><p>在 <code>资源管理器</code> 中点击选中 <code>assets/</code> 文件夹, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>文件夹</code>, 将文件夹命名为 <code>script</code>。</p></li><li><p>在 <code>资源管理器</code> 中点击选中 <code>assets/script/</code> 文件夹, <code>右键</code> -&gt; <code>创建</code> -&gt; <code>脚本(TypeScript)</code>, 脚本命名为<code>MovingSceneBg</code>。</p></li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/016.png" class="" title="movingSceneBg"><ol start="5"><li>在 <code>资源管理器</code> 中双击脚本文件 <code>assets/script/MovingSceneBg</code>，在打开的 <code>VS Code</code> 中编辑脚本文件。 如果无法关联脚本，可以在 <code>主菜单</code> -&gt; <code>偏好设置</code>，手动设置 <code>默认脚本编辑器</code> 。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/017.png" class="" title="VSCode"><ol start="6"><li>编辑脚本文件 <code>MovingSceneBg</code> 内容如以下代码：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">ccclass</span>(<span class="string">&#x27;movingSceneBg&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">movingSceneBg</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">bg01</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_">property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">bg02</span>: <span class="title class_">Node</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移动速度</span></span><br><span class="line">    private _bgSpeed = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// 移动的范围， 90 为背景的长度</span></span><br><span class="line">    private _bgMovingRange = <span class="number">90</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_moveBackground</span>(deltaTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 两个背景的初始化位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bg01</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bg02</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, -<span class="variable language_">this</span>.<span class="property">_bgMovingRange</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">_moveBackground</span>(<span class="params">deltaTime: number</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置每一帧移动后到的本地坐标，此处只需要移动 Z 轴</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bg01</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">bg01</span>.<span class="property">position</span>.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_bgSpeed</span> * deltaTime);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bg02</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">bg02</span>.<span class="property">position</span>.<span class="property">z</span> + <span class="variable language_">this</span>.<span class="property">_bgSpeed</span> * deltaTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 是否超出移动范围</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">bg01</span>.<span class="property">position</span>.<span class="property">z</span> &gt; <span class="variable language_">this</span>.<span class="property">_bgMovingRange</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">bg01</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">bg02</span>.<span class="property">position</span>.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">_bgMovingRange</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">bg02</span>.<span class="property">position</span>.<span class="property">z</span> &gt; <span class="variable language_">this</span>.<span class="property">_bgMovingRange</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">bg02</span>.<span class="title function_">setPosition</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">bg01</span>.<span class="property">position</span>.<span class="property">z</span> - <span class="variable language_">this</span>.<span class="property">_bgMovingRange</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="7"><li>在 <code>层级管理器</code> 选中 <code>movingSceneBg</code> 节点, 在右侧的 <code>属性检查器</code> 点 <code>添加组件</code> 按钮，在弹出的下拉框中选择 <code>自定义脚本</code> -&gt; <code>MovingSceneBg</code>。</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/018.png" class="" title="VSCode"><ol start="8"><li>将 <code>层级管理器</code> 中 <code>movingSceneBg</code> 节点下的背景 <code>bg01</code> 和 <code>bg02</code> 分别拖到右侧 <code>属性检查器</code> 内由 <code>MovingSceneBg</code> 脚本定义的两个属性 <code>Bg01</code> 和<code>Bg02</code> 中, 如下图所示:</li></ol><img src="/2022/01/23/develop-an-airplane-game-in-cocos-creator-01/019.png" class="" title="VSCode"><ol start="9"><li>保存场景， 运行预览, 无限滚动背景完成 。</li></ol><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>使用脚本控制游戏对象的基本操作步骤：</p><blockquote><ol><li>创建空节点并添加对象</li><li>创建材质，并添加到上一步骤创建的节点的对象中</li><li>添加控制节点的脚本</li><li>把脚本挂载到节点</li><li>添加脚本需要的公共属性(如果在脚本中定义有的话)</li></ol></blockquote><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> cocos creator </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cocos creator </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python pip 使用国内镜像源</title>
      <link href="/2021/12/21/pip-config-sources/"/>
      <url>/2021/12/21/pip-config-sources/</url>
      
        <content type="html"><![CDATA[<p>1、执行以下两个命令，设置全局使用国内源（中科大）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip config <span class="built_in">set</span> global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple</span><br><span class="line"></span><br><span class="line">pip config <span class="built_in">set</span> global.trusted-host https://mirrors.ustc.edu.cn/pypi/web/simple</span><br></pre></td></tr></table></figure><p>2、输出（查看）现有的pip源：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip config list</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Flask 编写 RESTful API</title>
      <link href="/2021/12/09/flask-webapi/"/>
      <url>/2021/12/09/flask-webapi/</url>
      
        <content type="html"><![CDATA[<h1 id="HTTP-的常用请求方法如下"><a href="#HTTP-的常用请求方法如下" class="headerlink" title="HTTP 的常用请求方法如下:"></a>HTTP 的常用请求方法如下:</h1><table><thead><tr><th>HTTP 方法</th><th>行为</th><th>示例</th></tr></thead><tbody><tr><td>GET</td><td>获取资源的信息</td><td><a href="http://example.com/api/orders">http://example.com/api/orders</a></td></tr><tr><td>GET</td><td>获取某个特定资源的信息</td><td><a href="http://example.com/api/orders/123">http://example.com/api/orders/123</a></td></tr><tr><td>POST</td><td>创建新资源</td><td><a href="http://example.com/api/orders">http://example.com/api/orders</a></td></tr><tr><td>PUT</td><td>更新资源</td><td><a href="http://example.com/api/orders/123">http://example.com/api/orders/123</a></td></tr><tr><td>PATCH</td><td>对 PUT 方法的补充，用来对已知资源进行局部更新</td><td><a href="http://example.com/api/orders/123">http://example.com/api/orders/123</a></td></tr><tr><td>DELETE</td><td>删除资源</td><td><a href="http://example.com/api/orders/123">http://example.com/api/orders/123</a></td></tr></tbody></table><blockquote><p>REST 设计不需要特定的数据格式。在请求中数据可以以 JSON 形式, 或者有时候作为 url 中查询参数项。</p></blockquote><h1 id="RESTful-API规划"><a href="#RESTful-API规划" class="headerlink" title="RESTful API规划"></a>RESTful API规划</h1><table><thead><tr><th>HTTP 方法</th><th>URL</th><th>动作</th></tr></thead><tbody><tr><td>GET</td><td><a href="http://127.0.0.1:5000/api/v1/books">http://127.0.0.1:5000/api/v1/books</a></td><td>查询图书列表，支持分页查询，分页的参数为JSON格式数据：<code>&#123;&quot;limit&quot;:10, &quot;offset&quot;:0&#125;</code></td></tr><tr><td>POST</td><td><a href="http://127.0.0.1:5000/api/v1/books">http://127.0.0.1:5000/api/v1/books</a></td><td>添加新图书</td></tr><tr><td>GET</td><td><a href="http://127.0.0.1:5000/api/v1/books/[book_id]">http://127.0.0.1:5000/api/v1/books/[book_id]</a></td><td>查询指定 id 的一本图书</td></tr><tr><td>PUT</td><td><a href="http://127.0.0.1:5000/api/v1/books/[book_id]">http://127.0.0.1:5000/api/v1/books/[book_id]</a></td><td>更新指定 id 的图书</td></tr><tr><td>PATCH</td><td><a href="http://127.0.0.1:5000/api/v1/books/[book_id]">http://127.0.0.1:5000/api/v1/books/[book_id]</a></td><td>更新指定 id 的图书, 与 <code>PUT</code> 方法相同</td></tr><tr><td>DELETE</td><td><a href="http://127.0.0.1:5000/api/v1/books/[book_id]">http://127.0.0.1:5000/api/v1/books/[book_id]</a></td><td>删除指定 id 的图书</td></tr></tbody></table><blockquote><p><code>添加</code>、<code>修改</code> 图书时，图书信息为 <code>JSON</code> 数据， 数据格式示例：<code>&#123;&quot;title&quot;:&quot;Python Web&quot;,&quot;author&quot;:&quot;Tony John&quot;,&quot;summary&quot;:&quot;This is a good book&quot;,&quot;published&quot;:&quot;2020&quot;&#125;</code> </p></blockquote><blockquote><p>实际部署时，将 <code>URL</code> 中的 <code>127.0.0.1:5000</code> 替换为相应的 <code>主机名</code> 或 <code>IP地址</code> </p></blockquote><h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><p>创建名为 <code>flask-book-app</code> 的 <code>flask</code> 项目(步骤略)</p><p>项目中需要的包：</p><ol><li><p><code>flask</code>： Python 编写的 Web 应用程序框架</p></li><li><p><code>python-dotenv</code>: 从文件中读取键值对，并将其设置为环境变量</p></li><li><p><code>flask-sqlalchemy</code>： 数据库 ORM</p></li><li><p><code>flask-restful</code>: 快速构建 REST APIs 的 Flask 扩展</p></li><li><p><code>flask-marshmallow</code>：序列化和反序列化模块, 用来将复杂的 orm 对象 与 python 原生数据类型之间相互转换的库</p></li><li><p><code>flask-cors</code>： 跨域请求配置模块</p></li><li><p><code>marshmallow-sqlalchemy</code>: 用于 <code>flask-marshmallow</code> 与 <code>flask-sqlalchemy</code> 的集成</p></li></ol><p>添加配置文件 <code>.flaskenv</code>, 内容如以下代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FLASK_ENV=development</span><br><span class="line">FLASK_APP=bookapp</span><br></pre></td></tr></table></figure><h1 id="使用包组织项目代码"><a href="#使用包组织项目代码" class="headerlink" title="使用包组织项目代码"></a>使用包组织项目代码</h1><p><code>Flask </code>对项目结构没有固定要求，可以将所有代码放在 <code>app.py</code> 文件中, 但是这样会导致代码难以阅读和修改，因此这里使用包来组织整个项目的代码。</p><p>项目的最终结构如以下图所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- bookapp              --- 包名</span><br><span class="line">|   |-- __init__.py      --- 包构造文件，创建程序实例</span><br><span class="line">|   |-- command.py       --- 命令函数</span><br><span class="line">|   |-- models.py        --- 模型类</span><br><span class="line">|   `-- views.py         --- 视图函数，编写 RESTful API 的方法</span><br><span class="line">|-- venv                 --- 虚拟环境文件夹</span><br><span class="line">`-- data.db              --- Sqlite 数据库文件</span><br></pre></td></tr></table></figure><p>添加文件夹  <code>bookapp</code>, 并在该文件夹中添加两个文件： <code>__init__.py</code>, <code>views.py</code></p><p>编辑文件 <code>bookapp\__init__.py</code>, 内容如以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bookapp <span class="keyword">import</span> views</span><br></pre></td></tr></table></figure><p>编辑 <code>bookapp\views.py</code>, 内容如以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bookapp <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello world&#x27;</span></span><br></pre></td></tr></table></figure><p>运行项目, 效果如下图:</p><img src="/2021/12/09/flask-webapi/001.png" class="" title="flask run"><h1 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h1><p>编辑 <code>bookapp\__init__.py</code>, 内容如以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="string">&#x27;sqlite:///&#x27;</span> + \</span><br><span class="line">    os.path.join(os.path.dirname(app.root_path), <span class="string">&#x27;data.db&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保这一行放在最后面</span></span><br><span class="line"><span class="keyword">from</span> bookapp <span class="keyword">import</span> views, models </span><br></pre></td></tr></table></figure><h1 id="添加数据模型类"><a href="#添加数据模型类" class="headerlink" title="添加数据模型类"></a>添加数据模型类</h1><p>在 <code>bookapp</code> 文件夹中添加文件 <code>models.py</code>, 编辑代码如以下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bookapp <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(db.Model):</span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">50</span>))  <span class="comment"># 标题</span></span><br><span class="line">    author = db.Column(db.String(<span class="number">50</span>))  <span class="comment"># 作者</span></span><br><span class="line">    summary = db.Column(db.String(<span class="number">250</span>))  <span class="comment"># 摘要</span></span><br><span class="line">    published = db.Column(db.String(<span class="number">4</span>))  <span class="comment"># 发行年份</span></span><br></pre></td></tr></table></figure><h1 id="添加的命令实现数据库初始化"><a href="#添加的命令实现数据库初始化" class="headerlink" title="添加的命令实现数据库初始化"></a>添加的命令实现数据库初始化</h1><p>在 <code>bookapp</code> 文件夹中添加文件 <code>command.py</code>, 编辑代码如以下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">from</span> bookapp <span class="keyword">import</span> app, db</span><br><span class="line"><span class="keyword">from</span> bookapp.models <span class="keyword">import</span> Book</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forge</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    用于初始化数据库的指令， 在虚拟环境下运行： flask forge</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    db.create_all()</span><br><span class="line">    books = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;A Fire Upon the Deep&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;Vernor Vinge&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;summary&#x27;</span>: <span class="string">&#x27;The coldsleep itself was dreamless.&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;published&#x27;</span>: <span class="string">&#x27;1992&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;The Ones Who Walk Away From Omelas&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;Ursula K. Le Guin&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;summary&#x27;</span>: <span class="string">&#x27;With a clamor of bells that set the swallows soaring, the Festival of Summer came to the city Omelas, bright-towered by the sea.&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;published&#x27;</span>: <span class="string">&#x27;1973&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;Dhalgren&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;Samuel R. Delany&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;summary&#x27;</span>: <span class="string">&#x27;to wound the autumnal city.&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;published&#x27;</span>: <span class="string">&#x27;1975&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;JavaScript Programming&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;Samuel R. Delany&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;summary&#x27;</span>: <span class="string">&#x27;to wound the autumnal city.&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;published&#x27;</span>: <span class="string">&#x27;2015&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;Flask Web Development&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;Ursula K. Le Guin&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;summary&#x27;</span>: <span class="string">&#x27;With a clamor of bells that set the swallows soaring, the Festival of Summer came to the city Omelas, bright-towered by the sea.&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;published&#x27;</span>: <span class="string">&#x27;2018&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> books:</span><br><span class="line">        book = Book(</span><br><span class="line">            title=item[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">            author=item[<span class="string">&#x27;author&#x27;</span>],</span><br><span class="line">            summary=item[<span class="string">&#x27;summary&#x27;</span>],</span><br><span class="line">            published=item[<span class="string">&#x27;published&#x27;</span>]</span><br><span class="line">        )</span><br><span class="line">        db.session.add(book)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    click.echo(<span class="string">&#x27;database initialized.&#x27;</span>)</span><br></pre></td></tr></table></figure><p>编辑 <code>bookapp\__init__.py</code>, 在<code>最后一行</code>添加 <code>command</code> 模块的导入, 如以下代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="string">&#x27;sqlite:///&#x27;</span> + \</span><br><span class="line">    os.path.join(os.path.dirname(app.root_path),<span class="string">&#x27;data.db&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保这一行放在最后面, </span></span><br><span class="line"><span class="keyword">from</span> bookapp <span class="keyword">import</span> views, models, command  <span class="comment"># 这里多了一个 command 模块</span></span><br></pre></td></tr></table></figure><p>在项目的虚拟环境下执行 <code>flask forge</code> 命令初始化数据，并添加数据到数据库中：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(venv) <span class="built_in">PS</span> D:\sources\python_repos\flask<span class="literal">-book-app</span>&gt; flask forge</span><br><span class="line">database initialized.</span><br></pre></td></tr></table></figure><h1 id="编写-API-方法-组织-Flask-RESTful-资源对象"><a href="#编写-API-方法-组织-Flask-RESTful-资源对象" class="headerlink" title="编写 API 方法 ( 组织 Flask-RESTful 资源对象)"></a>编写 API 方法 ( 组织 Flask-RESTful 资源对象)</h1><p>编辑 <code>bookapp\views.py</code>, 内容如以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bookapp <span class="keyword">import</span> app, db, ma, api</span><br><span class="line"><span class="keyword">from</span> bookapp.models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> jsonify, redirect, request</span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> Resource</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSchema</span>(ma.Schema):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        <span class="comment"># 需要序列化的字段, 只有在这里列出的字段名才会转为 json 数据</span></span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;author&#x27;</span>, <span class="string">&#x27;summary&#x27;</span>, <span class="string">&#x27;published&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单个模型数据的序列化</span></span><br><span class="line">book_schema = BookSchema()</span><br><span class="line"><span class="comment"># 多个模型数据的序列化</span></span><br><span class="line">books_schema = BookSchema(many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookListResource</span>(<span class="title class_ inherited__">Resource</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        查询图书，分页参数的请求格式：http://127.0.0.1:5000/api/v1/books?limit=3&amp;offset=3</span></span><br><span class="line"><span class="string">        使用默认参数的访问路径：http://127.0.0.1:5000/api/v1/books        </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 分页的默认值</span></span><br><span class="line">        limit = <span class="number">10</span>     <span class="comment"># 每页大小（返回记录数）</span></span><br><span class="line">        offset = <span class="number">0</span>     <span class="comment"># 跳过记录数       </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">##### 接收 json 格式的参数 开始 , 这个方式不支持 url 地址传递的参数</span></span><br><span class="line">        <span class="comment">#  如果要从URL中接收参数，请导入  from flask_restful.reqparse import RequestParser         </span></span><br><span class="line">        <span class="keyword">try</span>:  <span class="comment"># 加入异常处理，以防接收不到正确参数时程序崩溃</span></span><br><span class="line">            <span class="keyword">if</span>(request.json):</span><br><span class="line">                limit = request.json[<span class="string">&#x27;limit&#x27;</span>]</span><br><span class="line">                offset = request.json[<span class="string">&#x27;offset&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="comment">##### 接收 json 格式的参数 结束 </span></span><br><span class="line"></span><br><span class="line">        query = Book.query.offset(offset).limit(limit)  <span class="comment"># 分页查询</span></span><br><span class="line">        total = Book.query.count()         <span class="comment"># 记录总数</span></span><br><span class="line">        books = books_schema.dump(query)   <span class="comment"># 将查询结果由对象类型转为 python 数据</span></span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;                   <span class="comment"># 以JSON格式数据返回查询结果 </span></span><br><span class="line">            <span class="string">&quot;offset&quot;</span>: offset,</span><br><span class="line">            <span class="string">&quot;limit&quot;</span>: limit,</span><br><span class="line">            <span class="string">&quot;total_count&quot;</span>: total,</span><br><span class="line">            <span class="string">&quot;books&quot;</span>: books</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        添加一本图书, 每本图书四个属性，不能为缺少</span></span><br><span class="line"><span class="string">        访问路径：http://127.0.0.1:5000/api/v1/books</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            new_book = Book(                  <span class="comment"># 创建新图书</span></span><br><span class="line">                title=request.json[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">                author=request.json[<span class="string">&#x27;author&#x27;</span>],</span><br><span class="line">                summary=request.json[<span class="string">&#x27;summary&#x27;</span>],</span><br><span class="line">                published=request.json[<span class="string">&#x27;published&#x27;</span>]</span><br><span class="line">            )</span><br><span class="line">            db.session.add(new_book)    <span class="comment"># 添加图书</span></span><br><span class="line">            db.session.commit()         <span class="comment"># 提交会话</span></span><br><span class="line">            <span class="keyword">return</span> book_schema.dump(new_book)  <span class="comment"># 将查询结果由对象类型转为 python 数据</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># return request.json[&#x27;title&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookResource</span>(<span class="title class_ inherited__">Resource</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, book_id</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        查询指定 id 的图书, 访问路径：http://127.0.0.1:5000/api/v1/books/2</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        book = Book.query.get_or_404(book_id)   <span class="comment"># 查询指定id的图书</span></span><br><span class="line">        <span class="keyword">return</span> book_schema.dump(book)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">patch</span>(<span class="params">self, book_id</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        修改指定 id 的图书</span></span><br><span class="line"><span class="string">        patch 指令是 put 指令的升级，允许局部更新</span></span><br><span class="line"><span class="string">        访问路径：http://127.0.0.1:5000/api/v1/books/2 (同时带上要修改的属性值 )</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            book = Book.query.get_or_404(book_id)  <span class="comment"># 查询指定id的图书</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;title&#x27;</span> <span class="keyword">in</span> request.json:            <span class="comment"># 修改数据</span></span><br><span class="line">                book.title = request.json[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;author&#x27;</span> <span class="keyword">in</span> request.json:</span><br><span class="line">                book.author = request.json[<span class="string">&#x27;author&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;summary&#x27;</span> <span class="keyword">in</span> request.json:</span><br><span class="line">                book.summary = request.json[<span class="string">&#x27;summary&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;published&#x27;</span> <span class="keyword">in</span> request.json:</span><br><span class="line">                book.published = request.json[<span class="string">&#x27;published&#x27;</span>]</span><br><span class="line">            db.session.commit()            <span class="comment"># 提交会话</span></span><br><span class="line">            <span class="keyword">return</span> book_schema.dump(book)  <span class="comment"># 返回修改成功后的图书信息</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, book_id</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        put 指令 和 patch 指令是一样的</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.patch(book_id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, book_id</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string">        删除指定 id 的图书</span></span><br><span class="line"><span class="string">        访问路径：http://127.0.0.1:5000/api/v1/books/2</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        book = Book.query.get_or_404(book_id)  <span class="comment"># 查询指定id的图书</span></span><br><span class="line">        db.session.delete(book)                <span class="comment"># 删除图书</span></span><br><span class="line">        db.session.commit()                    <span class="comment"># 提交会话</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>, <span class="number">204</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># 跳转到 api对应的地址</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/api/v1/books&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="绑定资源与URI"><a href="#绑定资源与URI" class="headerlink" title="绑定资源与URI"></a>绑定资源与URI</h1><p>编辑 <code>bookapp\__init__.py</code>, 加入<code>跨域配置</code> 和 <code>序列化模块</code>, 代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy  <span class="comment"># 导入数据库 ORM 模块</span></span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS  <span class="comment"># 导入跨域配置模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># flask_marshmallow 序列化和反序列化模块，</span></span><br><span class="line"><span class="comment"># 用于将复杂的orm模型对象与python原生数据类型之间相互转换</span></span><br><span class="line"><span class="keyword">from</span> flask_marshmallow <span class="keyword">import</span> Marshmallow</span><br><span class="line"></span><br><span class="line"><span class="comment"># flask_restful 快速构建 REST APIs 的Flask 扩展</span></span><br><span class="line"><span class="comment"># http://www.pythondoc.com/Flask-RESTful/</span></span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> Api</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)    <span class="comment"># 创建Flask实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跨域允许</span></span><br><span class="line">CORS(app, resources=&#123;<span class="string">r&#x27;/*&#x27;</span>: &#123;<span class="string">&#x27;origins&#x27;</span>: <span class="string">&#x27;*&#x27;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置数据库连接</span></span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="string">&#x27;sqlite:///&#x27;</span> + \</span><br><span class="line">    os.path.join(os.path.dirname(app.root_path),<span class="string">&#x27;data.db&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭数据库对象修改的跟踪</span></span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)    <span class="comment"># 初始化扩展 SQLAlchemy， 传入程序实例 app</span></span><br><span class="line">ma = Marshmallow(app)   <span class="comment"># 初始化扩展 Marshmallow， 传入程序实例 app</span></span><br><span class="line">api = Api(app)          <span class="comment"># 初始化扩展 Api， 传入程序实例 app</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bookapp <span class="keyword">import</span> views, models, command  <span class="comment"># 确保这一行放在最后面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bookapp.views <span class="keyword">import</span> BookListResource, BookResource    <span class="comment"># 导入资源类</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 BookListResource 添加 api 资源,</span></span><br><span class="line"><span class="comment"># 对应分页查询 和 添加图书 这两个不需要 id 的操作</span></span><br><span class="line"><span class="comment"># 使用默认参数分页查询数据的地址：http://127.0.0.1:5000/api/v1/books</span></span><br><span class="line"><span class="comment"># 指定参数的分页查询数据的地址和参数示例：http://127.0.0.1:5000/api/v1/books?limit=3&amp;offset=3</span></span><br><span class="line"><span class="comment"># 添加数据的访问路径：http://127.0.0.1:5000/api/v1/books</span></span><br><span class="line">api.add_resource(BookListResource, <span class="string">&#x27;/api/v1/books&#x27;</span>)  <span class="comment"># 添加资源及访问路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 BookResource 添加 api 资源，</span></span><br><span class="line"><span class="comment"># 对应 单个对图书查询， 删除、修改这三个 要指定 id 的操作</span></span><br><span class="line"><span class="comment"># 删除、修改和查询的访问路径：http://127.0.0.1:5000/api/v1/books/2</span></span><br><span class="line">api.add_resource(BookResource, <span class="string">&#x27;/api/v1/books/&lt;int:book_id&gt;&#x27;</span>)  <span class="comment"># 添加资源及访问路径</span></span><br></pre></td></tr></table></figure><h1 id="测试-RESTful-API"><a href="#测试-RESTful-API" class="headerlink" title="测试 RESTful API"></a>测试 RESTful API</h1><h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><p>在虚拟环境下执行命令： flask run 运行项目，运行结果如下所示：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(venv) <span class="built_in">PS</span> D:\sources\python_repos\flask<span class="literal">-book-app</span>&gt; flask run</span><br><span class="line"> * Serving Flask app <span class="string">&#x27;bookapp&#x27;</span> (lazy loading)</span><br><span class="line"> * Environment: development</span><br><span class="line"> * Debug mode: on</span><br><span class="line"> * Restarting with stat</span><br><span class="line"> * Debugger is active!</span><br><span class="line"> * Debugger PIN: <span class="number">129</span><span class="literal">-008-647</span></span><br><span class="line"> * Running on http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">5000</span>/ (Press CTRL+C to quit)</span><br></pre></td></tr></table></figure><h2 id="安装扩展"><a href="#安装扩展" class="headerlink" title="安装扩展"></a>安装扩展</h2><p>在 <code>Visual Studio Code</code> 中使用安装名为 <code>PostCode</code> 的扩展, 如下图所示：</p><img src="/2021/12/09/flask-webapi/003.png" class="" title="flask run"><h2 id="无参数的默认分页查询图书测试"><a href="#无参数的默认分页查询图书测试" class="headerlink" title="无参数的默认分页查询图书测试"></a>无参数的默认分页查询图书测试</h2><img src="/2021/12/09/flask-webapi/004.png" class="" title="fetch all"><h2 id="带参数的分页查询图书测试"><a href="#带参数的分页查询图书测试" class="headerlink" title="带参数的分页查询图书测试"></a>带参数的分页查询图书测试</h2><img src="/2021/12/09/flask-webapi/0042.png" class="" title="fetch all"><h2 id="查询指定-id-的图书测试"><a href="#查询指定-id-的图书测试" class="headerlink" title="查询指定 id 的图书测试"></a>查询指定 id 的图书测试</h2><img src="/2021/12/09/flask-webapi/005.png" class="" title="fetch one"><h2 id="添加新图书测试"><a href="#添加新图书测试" class="headerlink" title="添加新图书测试"></a>添加新图书测试</h2><img src="/2021/12/09/flask-webapi/006.png" class="" title="new book"><h2 id="修改图书测试"><a href="#修改图书测试" class="headerlink" title="修改图书测试"></a>修改图书测试</h2><img src="/2021/12/09/flask-webapi/007.png" class="" title="update book"><h2 id="删除图书测试"><a href="#删除图书测试" class="headerlink" title="删除图书测试"></a>删除图书测试</h2><img src="/2021/12/09/flask-webapi/008.png" class="" title="delete book"><hr>]]></content>
      
      
      <categories>
          
          <category> flask </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> flask </tag>
            
            <tag> webapi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Windows 10/11 配置 Flutter 开发环境</title>
      <link href="/2021/12/04/flutter-development-environment-configuration/"/>
      <url>/2021/12/04/flutter-development-environment-configuration/</url>
      
        <content type="html"><![CDATA[<h1 id="关联文章"><a href="#关联文章" class="headerlink" title="关联文章"></a>关联文章</h1><ol><li><p><a href="https://hujiyi.github.io/2022/09/25/windows-install-java-jdk/">在 Windows 中同时安装多个 JDK</a></p></li><li><p><a href="https://hujiyi.github.io/2022/03/18/build-flutter-dev-environment-with-cmdline-tools/">使用 Android SDK 命令行工具搭建 Flutter 开发环境</a></p></li></ol><h1 id="安装-Flutter-SDK"><a href="#安装-Flutter-SDK" class="headerlink" title="安装 Flutter SDK"></a>安装 <code>Flutter SDK</code></h1><p><code>Flutter</code> 到现在为止, 还处于高速发展的初始阶段, <code>Flutter SDK</code> 的各个大版本之间, 存在一些不兼容的情况, 所以建议选择使用 <code>stable</code> 发行通道的 <code>Flutter SDK</code> 最新版本。</p><h2 id="下载-Flutter-SDK"><a href="#下载-Flutter-SDK" class="headerlink" title="下载 Flutter SDK"></a>下载 <code>Flutter SDK</code></h2><p><code>Flutter SDK</code> 下载地址：</p><ul><li><p><code>Flutter</code> 官方网站：<a href="https://docs.flutter.dev/development/tools/sdk/releases">https://docs.flutter.dev/development/tools/sdk/releases</a></p></li><li><p>清华大学镜像：<a href="https://mirrors.tuna.tsinghua.edu.cn/flutter/flutter_infra_release/releases/stable/windows/">https://mirrors.tuna.tsinghua.edu.cn/flutter/flutter_infra_release/releases/stable/windows/</a></p></li></ul><h2 id="解压-Flutter-SDK"><a href="#解压-Flutter-SDK" class="headerlink" title="解压 Flutter SDK"></a>解压 <code>Flutter SDK</code></h2><p>将压缩包解压, 然后把其中的 <code>flutter</code> 目录整个放在你想放置 <code>Flutter SDK</code> 的路径中（例如 <code>D:\AppData</code>, 解压后路径为: <code>D:\AppData\flutter</code>）, 如下图所示: </p><div style="width: 500px; margin: auto"><img src="/2021/12/04/flutter-development-environment-configuration/001.png" class="" title="extract"></div>(直接将压缩包 `解压到当前位置`)<blockquote><p>请勿将 <code>Flutter</code> 有<code>特殊字符</code>或<code>空格</code>的路径下。</p></blockquote><blockquote><p>请勿将 <code>Flutter</code> 安装在需要<code>高权限</code>的文件夹内，例如 <code>C:\Program Files\</code>, 电脑<code>只有单个硬盘</code>的可以考虑解压到<code>C:\Users\&lt;用户名&gt;\AppData\Local\</code> 文件夹下。</p></blockquote><h2 id="为-Flutter-设定镜像配置"><a href="#为-Flutter-设定镜像配置" class="headerlink" title="为 Flutter 设定镜像配置"></a>为 <code>Flutter</code> 设定镜像配置</h2><p>在国内使用 <code>Flutter</code>, 需要找一个与官方同步的可信的镜像站点, 让 <code>Flutter</code> 命令行工具到该镜像站点下载其所需的资源。为此设置两个环境变量：<code>PUB_HOSTED_URL</code> 和 <code>FLUTTER_STORAGE_BASE_URL</code>, 然后再运行 <code>Flutter</code> 命令行工具。</p><p>可以使用 <code>setx</code> 命令添加 <code>系统环境变量</code>, 命令格式为: <code>setx  &quot;&lt;环境变量名&gt;&quot;  &quot;&lt;环境变量对应的完整路径&gt;&quot;</code> </p><p>使用 <code>管理员权限</code> 运行 <code>CMD窗口</code> 或 <code>PowerShell窗口</code>, 执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setx <span class="string">&quot;PUB_HOSTED_URL&quot;</span> <span class="string">&quot;https://pub.flutter-io.cn&quot;</span>  /m</span><br><span class="line">setx <span class="string">&quot;FLUTTER_STORAGE_BASE_URL&quot;</span> <span class="string">&quot;https://storage.flutter-io.cn&quot;</span>  /m</span><br></pre></td></tr></table></figure><blockquote><p><code>setx</code> 命令用于<code>添加环境变量</code>, 结尾的 <code>/m</code> 选项表示添加为 <code>系统环境变量</code>, 没有该选项则添加为 <code>用户环境变量</code></p></blockquote><img src="/2021/12/04/flutter-development-environment-configuration/002.png" class="" title="path"><p>运行成功后, <code>系统变量</code> 中将添加 <code>PUB_HOSTED_URL</code> 和 <code>FLUTTER_STORAGE_BASE_URL</code> 两个环境变量, 如下图所示:</p><div style="width: 500px; margin: auto"><img src="/2021/12/04/flutter-development-environment-configuration/003.png" class="" title="path"></div><h2 id="更新-path-环境变量"><a href="#更新-path-环境变量" class="headerlink" title="更新 path 环境变量"></a>更新 <code>path</code> 环境变量</h2><p>在 <code>Windows</code> 控制台中运行 <code>Flutter</code> 命令，需要将 <code>Flutter</code> 的运行文件路径加入到 <code>PATH</code> 环境变量。</p><ol><li><p>打开 <code>环境变量</code> 设置窗口</p></li><li><p>选中 <code>用户变量</code> 或 <code>系统变量</code>　的 <code>Path</code> 变量名, 加入 <code>flutter\bin</code> 目录的<code>完整路径</code>(此处完整路径为: <code>D:\AppData\flutter\bin</code>), 如下图所示:</p></li></ol><div style="width: 500px; margin: auto"><img src="/2021/12/04/flutter-development-environment-configuration/004.png" class="" title="path"></div><h2 id="运行开发环境检测程序"><a href="#运行开发环境检测程序" class="headerlink" title="运行开发环境检测程序"></a>运行开发环境检测程序</h2><p>更新 <code>Path</code> 环境变量后, 打开一个<code>新的控制台窗口</code>, 执行 <code>flutter doctor</code>(可以添加参数 <code>-v</code>显示详细信息) 命令检测当前的 <code>Flutter</code> 运行环境, 第一次运行过程如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">PS D:\AppData&gt; flutter doctor -v</span><br><span class="line"></span><br><span class="line">  ╔════════════════════════════════════════════════════════════════════════════╗</span><br><span class="line">  ║                 Welcome to Flutter! - https://flutter.dev                  ║</span><br><span class="line">  ║                                                                            ║</span><br><span class="line">  ║ The Flutter tool uses Google Analytics to anonymously report feature usage ║</span><br><span class="line">  ║ statistics and basic crash reports. This data is used to <span class="built_in">help</span> improve      ║</span><br><span class="line">  ║ Flutter tools over time.                                                   ║</span><br><span class="line">  ║                                                                            ║</span><br><span class="line">  ║ Flutter tool analytics are not sent on the very first run. To <span class="built_in">disable</span>      ║</span><br><span class="line">  ║ reporting, <span class="built_in">type</span> <span class="string">&#x27;flutter config --no-analytics&#x27;</span>. To display the current    ║</span><br><span class="line">  ║ setting, <span class="built_in">type</span> <span class="string">&#x27;flutter config&#x27;</span>. If you opt out of analytics, an opt-out    ║</span><br><span class="line">  ║ event will be sent, and <span class="keyword">then</span> no further information will be sent by the    ║</span><br><span class="line">  ║ Flutter tool.                                                              ║</span><br><span class="line">  ║                                                                            ║</span><br><span class="line">  ║ By downloading the Flutter SDK, you agree to the Google Terms of Service.  ║</span><br><span class="line">  ║ Note: The Google Privacy Policy describes how data is handled <span class="keyword">in</span> this      ║</span><br><span class="line">  ║ service.                                                                   ║</span><br><span class="line">  ║                                                                            ║</span><br><span class="line">  ║ Moreover, Flutter includes the Dart SDK, <span class="built_in">which</span> may send usage metrics and  ║</span><br><span class="line">  ║ crash reports to Google.                                                   ║</span><br><span class="line">  ║                                                                            ║</span><br><span class="line">  ║ Read about data we send with crash reports:                                ║</span><br><span class="line">  ║ https://flutter.dev/docs/reference/crash-reporting                         ║</span><br><span class="line">  ║                                                                            ║</span><br><span class="line">  ║ See Google s privacy policy:                                               ║</span><br><span class="line">  ║ https://policies.google.com/privacy                                        ║</span><br><span class="line">  ╚════════════════════════════════════════════════════════════════════════════╝</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Running <span class="string">&quot;flutter pub get&quot;</span> <span class="keyword">in</span> flutter_tools...</span><br><span class="line">Resolving dependencies <span class="keyword">in</span> flutter\packages\flutter_tools...</span><br><span class="line">* _fe_analyzer_shared 50.0.0 (was 50.0.0) (52.0.0 available)</span><br><span class="line">* analyzer 5.2.0 (was 5.2.0) (5.4.0 available)</span><br><span class="line">* archive 3.3.2 (was 3.3.2) (3.3.6 available)</span><br><span class="line">* args 2.3.1 (was 2.3.1) (2.3.2 available)</span><br><span class="line">* async 2.10.0 (was 2.10.0)</span><br><span class="line">* boolean_selector 2.1.1 (was 2.1.1)</span><br><span class="line">* browser_launcher 1.1.1 (was 1.1.1)</span><br><span class="line">* built_collection 5.1.1 (was 5.1.1)</span><br><span class="line">* built_value 8.4.2 (was 8.4.2) (8.4.3 available)</span><br><span class="line">* checked_yaml 2.0.1 (was 2.0.1) (2.0.2 available)</span><br><span class="line">* clock 1.1.1 (was 1.1.1)</span><br><span class="line">* collection 1.17.0 (was 1.17.0) (1.17.1 available)</span><br><span class="line">* completion 1.0.0 (was 1.0.0) (1.0.1 available)</span><br><span class="line">* convert 3.1.1 (was 3.1.1)</span><br><span class="line">* coverage 1.6.1 (was 1.6.1) (1.6.2 available)</span><br><span class="line">* crypto 3.0.2 (was 3.0.2)</span><br><span class="line">* csslib 0.17.2 (was 0.17.2)</span><br><span class="line">* dds 2.5.0 (was 2.5.0) (2.7.4 available)</span><br><span class="line">* dds_service_extensions 1.3.1 (was 1.3.1) (1.3.2 available)</span><br><span class="line">* devtools_shared 2.18.0 (was 2.18.0) (2.20.1 available)</span><br><span class="line">* dwds 16.0.2 (was 16.0.2) (17.0.0 available)</span><br><span class="line">* fake_async 1.3.1 (was 1.3.1)</span><br><span class="line">* file 6.1.4 (was 6.1.4)</span><br><span class="line">* file_testing 3.0.0 (was 3.0.0)</span><br><span class="line">* fixnum 1.0.1 (was 1.0.1) (1.1.0 available)</span><br><span class="line">* flutter_template_images 4.2.0 (was 4.2.0)</span><br><span class="line">* frontend_server_client 3.1.0 (was 3.1.0) (3.2.0 available)</span><br><span class="line">* glob 2.1.1 (was 2.1.1)</span><br><span class="line">* html 0.15.1 (was 0.15.1)</span><br><span class="line">* http 0.13.5 (was 0.13.5)</span><br><span class="line">* http_multi_server 3.2.1 (was 3.2.1)</span><br><span class="line">* http_parser 4.0.2 (was 4.0.2)</span><br><span class="line">* intl 0.17.0 (was 0.17.0) (0.18.0 available)</span><br><span class="line">* io 1.0.3 (was 1.0.3) (1.0.4 available)</span><br><span class="line">* js 0.6.5 (was 0.6.5) (0.6.7 available)</span><br><span class="line">* json_annotation 4.7.0 (was 4.7.0) (4.8.0 available)</span><br><span class="line">* json_rpc_2 3.0.2 (was 3.0.2)</span><br><span class="line">* logging 1.1.0 (was 1.1.0) (1.1.1 available)</span><br><span class="line">* matcher 0.12.13 (was 0.12.13) (0.12.14 available)</span><br><span class="line">* meta 1.8.0 (was 1.8.0) (1.9.0 available)</span><br><span class="line">* mime 1.0.2 (was 1.0.2) (1.0.4 available)</span><br><span class="line">* multicast_dns 0.3.2+2 (was 0.3.2+2) (0.3.2+3 available)</span><br><span class="line">* mustache_template 2.0.0 (was 2.0.0)</span><br><span class="line">* native_stack_traces 0.5.2 (was 0.5.2) (0.5.5 available)</span><br><span class="line">* node_preamble 2.0.1 (was 2.0.1)</span><br><span class="line">* package_config 2.1.0 (was 2.1.0)</span><br><span class="line">* path 1.8.2 (was 1.8.2) (1.8.3 available)</span><br><span class="line">* petitparser 5.1.0 (was 5.1.0)</span><br><span class="line">* platform 3.1.0 (was 3.1.0)</span><br><span class="line">* pool 1.5.1 (was 1.5.1)</span><br><span class="line">* process 4.2.4 (was 4.2.4)</span><br><span class="line">* pub_semver 2.1.3 (was 2.1.3)</span><br><span class="line">* pubspec_parse 1.2.1 (was 1.2.1)</span><br><span class="line">* shelf 1.4.0 (was 1.4.0)</span><br><span class="line">* shelf_packages_handler 3.0.1 (was 3.0.1)</span><br><span class="line">* shelf_proxy 1.0.2 (was 1.0.2)</span><br><span class="line">* shelf_static 1.1.1 (was 1.1.1)</span><br><span class="line">* shelf_web_socket 1.0.3 (was 1.0.3)</span><br><span class="line">* source_map_stack_trace 2.1.1 (was 2.1.1)</span><br><span class="line">* source_maps 0.10.11 (was 0.10.11)</span><br><span class="line">* source_span 1.9.1 (was 1.9.1)</span><br><span class="line">* sse 4.1.1 (was 4.1.1) (4.1.2 available)</span><br><span class="line">* stack_trace 1.11.0 (was 1.11.0)</span><br><span class="line">* stream_channel 2.1.1 (was 2.1.1)</span><br><span class="line">* string_scanner 1.2.0 (was 1.2.0)</span><br><span class="line">* sync_http 0.3.1 (was 0.3.1)</span><br><span class="line">* term_glyph 1.2.1 (was 1.2.1)</span><br><span class="line">* <span class="built_in">test</span> 1.22.0 (was 1.22.0) (1.22.2 available)</span><br><span class="line">* test_api 0.4.16 (was 0.4.16) (0.4.18 available)</span><br><span class="line">* test_core 0.4.20 (was 0.4.20) (0.4.22 available)</span><br><span class="line">* typed_data 1.3.1 (was 1.3.1)</span><br><span class="line">* usage 4.1.0 (was 4.1.0)</span><br><span class="line">* uuid 3.0.7 (was 3.0.7)</span><br><span class="line">* vm_service 9.4.0 (was 9.4.0) (10.1.2 available)</span><br><span class="line">* vm_snapshot_analysis 0.7.2 (was 0.7.2)</span><br><span class="line">* watcher 1.0.2 (was 1.0.2)</span><br><span class="line">* web_socket_channel 2.2.0 (was 2.2.0) (2.3.0 available)</span><br><span class="line">* webdriver 3.0.1 (was 3.0.1) (3.0.2 available)</span><br><span class="line">* webkit_inspection_protocol 1.2.0 (was 1.2.0)</span><br><span class="line">* xml 6.2.2 (was 6.2.2)</span><br><span class="line">* yaml 3.1.1 (was 3.1.1)</span><br><span class="line">Changed 81 dependencies <span class="keyword">in</span> flutter\packages\flutter_tools!</span><br><span class="line">[✓] Flutter (Channel stable, 3.19.0, on Microsoft Windows [版本 10.0.22631.3155], locale zh-CN)</span><br><span class="line">    • Flutter version 3.19.0 on channel stable at D:\AppData\flutter</span><br><span class="line">    • Upstream repository https://github.com/flutter/flutter.git</span><br><span class="line">    • Framework revision bae5e49bc2 (2 days ago), 2024-02-13 17:46:18 -0800</span><br><span class="line">    • Engine revision 04817c99c9</span><br><span class="line">    • Dart version 3.3.0</span><br><span class="line">    • DevTools version 2.31.1</span><br><span class="line"></span><br><span class="line">[✗] Windows Version (Unable to confirm <span class="keyword">if</span> installed Windows version is 10 or greater)</span><br><span class="line"></span><br><span class="line">[✗] Android toolchain - develop <span class="keyword">for</span> Android devices</span><br><span class="line">    ✗ Unable to locate Android SDK.</span><br><span class="line">      Install Android Studio from: https://developer.android.com/studio/index.html</span><br><span class="line">      On first launch it will assist you <span class="keyword">in</span> installing the Android SDK components.</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/windows#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line">      If the Android SDK has been installed to a custom location, please use</span><br><span class="line">      `flutter config --android-sdk` to update to that location.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[✗] Chrome - develop <span class="keyword">for</span> the web (Cannot find Chrome executable at .\Google\Chrome\Application\chrome.exe)</span><br><span class="line">    ! Cannot find Chrome. Try setting CHROME_EXECUTABLE to a Chrome executable.</span><br><span class="line"></span><br><span class="line">[✗] Visual Studio - develop <span class="keyword">for</span> Windows</span><br><span class="line">    ✗ Visual Studio not installed; this is necessary <span class="keyword">for</span> Windows development.</span><br><span class="line">      Download at https://visualstudio.microsoft.com/downloads/.</span><br><span class="line">      Please install the <span class="string">&quot;Desktop development with C++&quot;</span> workload, including all of its default components</span><br><span class="line"></span><br><span class="line">[!] Android Studio (not installed)</span><br><span class="line">    • Android Studio not found; download from https://developer.android.com/studio/index.html</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/windows#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line"></span><br><span class="line">[✓] VS Code, 64-bit edition (version 1.74.3)</span><br><span class="line">    • VS Code at C:\Program Files\Microsoft VS Code</span><br><span class="line">    • Flutter extension can be installed from:</span><br><span class="line">      🔨 https://marketplace.visualstudio.com/items?itemName=Dart-Code.flutter</span><br><span class="line"></span><br><span class="line">[✓] Connected device (2 available)</span><br><span class="line">    • Windows (desktop) • windows • windows-x64    • Microsoft Windows [版本 10.0.22621.1194]</span><br><span class="line">    • Edge (web)        • edge    • web-javascript • Microsoft Edge 109.0.1518.70</span><br><span class="line"></span><br><span class="line">[✓] HTTP Host Availability</span><br><span class="line">    • All required HTTP hosts are available</span><br><span class="line"></span><br><span class="line">! Doctor found issues <span class="keyword">in</span> 5 categories.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>显示出来的检查结果中：</p><ul><li><p>绿色的 <code>[√]</code> 表示该项通过检测, 没有问题</p></li><li><p>黄色的 <code>[!]</code> 表示该项存在部分问题</p></li><li><p>红色的 <code>[✗]</code> 表示该项找不到或有严重错误</p></li></ul><p>检测结果的具体说明见下图:</p><img src="/2021/12/04/flutter-development-environment-configuration/005.png" class="" title="doctor"><h2 id="创建新项目"><a href="#创建新项目" class="headerlink" title="创建新项目"></a>创建新项目</h2><p>上面显示的运行环境检测结果表明 <code>Flutter SDK</code> 已经安装, 已连接设备中的<code> • Edge (web)        • edge    • web-javascript • Microsoft Edge 109.0.1518.70</code> 表示使用<code>Flutter</code> 创建的程序已经可以通过 <code>Edge浏览器</code> 进行 <code>Web平台</code>的运行调试。</p><ol><li>在电脑添加一个存放 <code>Flutter</code> 项目的文件夹(例如 <code>D:\sources\flutter_repos</code>), 进入该文件夹, 打开一个<code>新的控制台窗口</code>, 执行命令创建新项目: <code>flutter create &lt;项目名称&gt;</code>, 执行过程如下所示:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos&gt; flutter create demo_app</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Creating project demo_app...</span><br><span class="line">Running <span class="string">&quot;flutter pub get&quot;</span> <span class="keyword">in</span> demo_app...</span><br><span class="line">Resolving dependencies <span class="keyword">in</span> demo_app...</span><br><span class="line">+ async 2.10.0</span><br><span class="line">+ boolean_selector 2.1.1</span><br><span class="line">+ characters 1.2.1</span><br><span class="line">+ clock 1.1.1</span><br><span class="line">+ collection 1.17.0 (1.17.1 available)</span><br><span class="line">+ cupertino_icons 1.0.5</span><br><span class="line">+ fake_async 1.3.1</span><br><span class="line">+ flutter 0.0.0 from sdk flutter</span><br><span class="line">+ flutter_lints 2.0.1</span><br><span class="line">+ flutter_test 0.0.0 from sdk flutter</span><br><span class="line">+ js 0.6.5 (0.6.7 available)</span><br><span class="line">+ lints 2.0.1</span><br><span class="line">+ matcher 0.12.13 (0.12.14 available)</span><br><span class="line">+ material_color_utilities 0.2.0</span><br><span class="line">+ meta 1.8.0 (1.9.0 available)</span><br><span class="line">+ path 1.8.2 (1.8.3 available)</span><br><span class="line">+ sky_engine 0.0.99 from sdk flutter</span><br><span class="line">+ source_span 1.9.1</span><br><span class="line">+ stack_trace 1.11.0</span><br><span class="line">+ stream_channel 2.1.1</span><br><span class="line">+ string_scanner 1.2.0</span><br><span class="line">+ term_glyph 1.2.1</span><br><span class="line">+ test_api 0.4.16 (0.4.18 available)</span><br><span class="line">+ vector_math 2.1.4</span><br><span class="line">Changed 24 dependencies <span class="keyword">in</span> demo_app!</span><br><span class="line">Wrote 127 files.</span><br><span class="line"></span><br><span class="line">All <span class="keyword">done</span>!</span><br><span class="line">You can find general documentation <span class="keyword">for</span> Flutter at: https://docs.flutter.dev/</span><br><span class="line">Detailed API documentation is available at: https://api.flutter.dev/</span><br><span class="line">If you prefer video documentation, consider: https://www.youtube.com/c/flutterdev</span><br><span class="line"></span><br><span class="line">In order to run your application, <span class="built_in">type</span>:</span><br><span class="line"></span><br><span class="line">  $ <span class="built_in">cd</span> demo_app</span><br><span class="line">  $ flutter run</span><br><span class="line"></span><br><span class="line">Your application code is <span class="keyword">in</span> demo_app\lib\main.dart.</span><br></pre></td></tr></table></figure><blockquote><p>由<code>多个单词</code>组成的 <code>Flutter</code> 的<code>项目名称</code>使用下划线 <code>_</code> 进行连接, 不能使用短横线 <code>-</code>。</p></blockquote><h2 id="在-Web平台-运行项目"><a href="#在-Web平台-运行项目" class="headerlink" title="在 Web平台 运行项目"></a>在 <code>Web平台</code> 运行项目</h2><ol><li>根据创建项目成功后的提示, 在控制台窗口输入命令:<code>cd demo_app</code>, 进入该项目文件夹, 过程如下所示:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos&gt; <span class="built_in">cd</span> .\demo_app\</span><br><span class="line">PS D:\sources\flutter_repos\demo_app&gt; </span><br></pre></td></tr></table></figure><ol start="2"><li>使用命令运行 <code>Flutter</code> 项目: <code>flutter run</code>,</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos\demo_app&gt; flutter run</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Multiple devices found:</span><br><span class="line">Windows (desktop) • windows • windows-x64    • Microsoft Windows [版本 10.0.22621.1194]</span><br><span class="line">Edge (web)        • edge    • web-javascript • Microsoft Edge 109.0.1518.70</span><br><span class="line">[1]: Windows (windows)</span><br><span class="line">[2]: Edge (edge)</span><br><span class="line">Please choose one (To quit, press <span class="string">&quot;q/Q&quot;</span>):</span><br></pre></td></tr></table></figure><p>此处提示选择运行<code>项目的设备</code>, 输入序号 <code>2</code>, <code>回车</code>。</p><blockquote><p>此处并没有安装 <code>Windows 开发工具链</code>, 输入序号 <code>1</code> 时会出错。</p></blockquote><p>运行成功后, 会自动打开 <code>Edge</code> 浏览器, 运行结果如下图所示:</p><img src="/2021/12/04/flutter-development-environment-configuration/006.png" class="" title="run"><h1 id="配置-Android-toolchain-Android-开发工具链"><a href="#配置-Android-toolchain-Android-开发工具链" class="headerlink" title="配置 Android toolchain ( Android 开发工具链)"></a>配置 <code>Android toolchain</code> ( <code>Android</code> 开发工具链)</h1><p><code>Android toolchain</code> 用于生成 <code>Android</code> 平台的应用程序, 需要安装的软件包括: <code>JDK</code>, <code>Android SDK</code>, <code>Android 模拟器</code> 三部分。如果原来已经安装有 <code>Android</code> 的开发环境(<code>Android Studio</code> 和 <code>模拟器</code>), 只需要添加需要的 <code>Android SDK</code> 组件即可。</p><h2 id="安装-JDK"><a href="#安装-JDK" class="headerlink" title="安装 JDK"></a>安装 <code>JDK</code></h2><p>新版本的 <code>Flutter SDK</code> 进行 <code>Android应用开发</code> 时需要 <code>JDK 11</code> 或 <code>以上版本</code>, 如果还没有安装过 <code>JDK</code>, 或者版本不符, 可以使用 <code>Android Studio 2020.3.1</code>(或<code>更新版本</code>) 自带的 <code>OpenJDK 11</code>, 刚好合适。</p><p>如果同时还在做 <code>Spring Boot</code> 或是相关开发, 有些项目可能需要使用 <code>JDK 1.8</code> , 这种情况可以参考文章: <a href="https://hujiyi.github.io/2022/09/25/windows-install-java-jdk/">在 Windows 中同时安装多个 JDK</a></p><h2 id="安装配置-Android-SDK"><a href="#安装配置-Android-SDK" class="headerlink" title="安装配置 Android SDK"></a>安装配置 <code>Android SDK</code></h2><p>如果电脑原来已经安装有 <code>Android Studio</code>, 可以打开 <code>SDK Manager</code>, 添加 <code>Flutter SDK 3.19.x</code> 需要安装的以下几个 <code>Android SDK</code> 组件:</p><ol><li><p><code>Android SDK Command-line Tools(latest)</code></p></li><li><p><code>Android SDK Build-Tools 30.0.3 (revision: 30.0.3)</code></p></li><li><p><code>Android SDK Platform 34 (revision: 2)</code></p></li></ol><blockquote><p><code>Flutter 3.19.0</code> 或更高版本需要 <code>Android SDK Platform 34 (revision: 2)</code>, <code>Flutter 3.16.x</code> 需要安装 <code>Android SDK Platform 33 (revision: 2)</code></p></blockquote><blockquote><p>不同版本的 <code>Flutter SDK</code> 需要的 <code>Android SDK Build-Tools</code> 和 <code>Android SDK Platform</code> 版本号会有不同</p></blockquote><blockquote><p>确保 <code>Android SDK Command-line Tools(latest)</code> 已经安装, 第一次运行时其他两个组件缺失或版本不正确时, 将会自动安装</p></blockquote><blockquote><p>如果电脑还没有并且不想安装 <code>Android Studio</code>, 也可以参考文章: <a href="https://hujiyi.github.io/2022/03/18/build-flutter-dev-environment-with-cmdline-tools/">使用 Android SDK 命令行工具搭建 Flutter 开发环境</a>, 通过 <code>Android SDK Command-line Tools(latest)</code> 安装单独的 <code>Android SDK</code>。</p></blockquote><blockquote><ul><li>速度最快的 <code>Android SDK</code> 安装办法: 把其他已经能运行 <code>Flutter</code> 项目的电脑中的 <code>Android SDK</code> 文件夹复制到自己的电脑。</li></ul></blockquote><h2 id="添加ANDROID-HOME-环境变量"><a href="#添加ANDROID-HOME-环境变量" class="headerlink" title="添加ANDROID_HOME 环境变量"></a>添加<code>ANDROID_HOME</code> 环境变量</h2><p>将 <code>Android SDK</code> 的路径添加到环境变量中, 使用 <code>管理员权限</code> 运行 <code>CMD窗口</code> 或 <code>PowerShell窗口</code>, 执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setx <span class="string">&quot;ANDROID_HOME&quot;</span> <span class="string">&quot;D:\AppData\Android\Sdk&quot;</span>  /m</span><br></pre></td></tr></table></figure><blockquote><p>将 <code>D:\AppData\Android\Sdk</code> 替换为自己电脑实际的 <code>Android SDK</code> 路径</p></blockquote><h2 id="同意-Android-协议"><a href="#同意-Android-协议" class="headerlink" title="同意 Android 协议"></a>同意 <code>Android</code> 协议</h2><p>确保电脑已经正确安装了 <code>Android SDK</code>, 并添加了 <code>ANDROID_HOME</code> 环境变量, 打开一个<code>新的控制台窗口</code>,　再次运行 <code>flutter doctor -v</code> 命令检测运行环境, 运行结果如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos&gt; flutter doctor -v</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">[✓] Flutter (Channel stable, 3.19.0, on Microsoft Windows [版本 10.0.22631.3155], locale zh-CN)</span><br><span class="line">    • Flutter version 3.19.0 on channel stable at D:\AppData\flutter</span><br><span class="line">    • Upstream repository https://github.com/flutter/flutter.git</span><br><span class="line">    • Framework revision bae5e49bc2 (2 days ago), 2024-02-13 17:46:18 -0800</span><br><span class="line">    • Engine revision 04817c99c9</span><br><span class="line">    • Dart version 3.3.0</span><br><span class="line">    • DevTools version 2.31.1</span><br><span class="line"></span><br><span class="line">[✗] Windows Version (Unable to confirm <span class="keyword">if</span> installed Windows version is 10 or greater)</span><br><span class="line"></span><br><span class="line">[!] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 30.0.3)</span><br><span class="line">    • Android SDK at D:\AppData\Android\Sdk</span><br><span class="line">    • Platform android-34, build-tools 30.0.3</span><br><span class="line">    • ANDROID_HOME = D:\AppData\Android\Sdk</span><br><span class="line">    • Java binary at: D:\AppData\openjdk17.0.2\bin\java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 17.0.2+8-86)</span><br><span class="line">    ! Some Android licenses not accepted. To resolve this, run: flutter doctor --android-licenses</span><br><span class="line"></span><br><span class="line">[✗] Chrome - develop <span class="keyword">for</span> the web (Cannot find Chrome executable at .\Google\Chrome\Application\chrome.exe)</span><br><span class="line">    ! Cannot find Chrome. Try setting CHROME_EXECUTABLE to a Chrome executable.</span><br><span class="line"></span><br><span class="line">[✗] Visual Studio - develop <span class="keyword">for</span> Windows</span><br><span class="line">    ✗ Visual Studio not installed; this is necessary <span class="keyword">for</span> Windows development.</span><br><span class="line">      Download at https://visualstudio.microsoft.com/downloads/.</span><br><span class="line">      Please install the <span class="string">&quot;Desktop development with C++&quot;</span> workload, including all of its default components</span><br><span class="line"></span><br><span class="line">[!] Android Studio (not installed)</span><br><span class="line">    • Android Studio not found; download from https://developer.android.com/studio/index.html</span><br><span class="line">      (or visit https://flutter.dev/docs/get-started/install/windows#android-setup <span class="keyword">for</span> detailed instructions).</span><br><span class="line"></span><br><span class="line">[✓] VS Code, 64-bit edition (version 1.74.3)</span><br><span class="line">    • VS Code at C:\Program Files\Microsoft VS Code</span><br><span class="line">    • Flutter extension can be installed from:</span><br><span class="line">      🔨 https://marketplace.visualstudio.com/items?itemName=Dart-Code.flutter</span><br><span class="line"></span><br><span class="line">[✓] Connected device (2 available)</span><br><span class="line">    • Windows (desktop) • windows • windows-x64    • Microsoft Windows [版本 10.0.22621.1194]</span><br><span class="line">    • Edge (web)        • edge    • web-javascript • Microsoft Edge 109.0.1518.70</span><br><span class="line"></span><br><span class="line">[✓] HTTP Host Availability</span><br><span class="line">    • All required HTTP hosts are available</span><br><span class="line"></span><br><span class="line">! Doctor found issues <span class="keyword">in</span> 5 categories.</span><br></pre></td></tr></table></figure><p>之前显示为红色 <font color=red>[✗]</font> 的 <code>Android toolchain</code> 现在已经变成了黄色的 <code>[!]</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[!] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 30.0.3)</span><br><span class="line">    • Android SDK at D:\AppData\Android\Sdk</span><br><span class="line">    • Platform android-34, build-tools 30.0.3</span><br><span class="line">    • ANDROID_HOME = D:\AppData\Android\Sdk</span><br><span class="line">    • Java binary at: D:\AppData\openjdk17.0.2\bin\java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 17.0.2+8-86)</span><br><span class="line">    ! Some Android licenses not accepted. To resolve this, run: flutter doctor --android-licenses</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>该项最后一行提示, 需要运行命令并同意 <code>Android 的协议</code>, 在控制台窗口输入命令: <code>flutter doctor --android-licenses</code>, 全部提问回答: <code>y</code>, 命令执行过程如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos&gt; flutter doctor --android-licenses</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">[=======================================] 100% Computing updates...</span><br><span class="line">6 of 7 SDK package licenses not accepted.</span><br><span class="line">Review licenses that have not been accepted (y/N)? y</span><br><span class="line"></span><br><span class="line">1/6: License android-googletv-license:</span><br><span class="line"></span><br><span class="line">&lt;总共`6项`协议,内容很长, 要输入`6`次 `y`, 过程省略&gt;</span><br></pre></td></tr></table></figure><p>同意协议后再次检测<code>Flutter</code>运行环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos&gt; flutter doctor -v</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">[✓] Flutter (Channel stable, 3.19.0, on Microsoft Windows [版本 10.0.22631.3155], locale zh-CN)</span><br><span class="line">    • Flutter version 3.19.0 on channel stable at D:\AppData\flutter</span><br><span class="line">    • Upstream repository https://github.com/flutter/flutter.git</span><br><span class="line">    • Framework revision bae5e49bc2 (2 days ago), 2024-02-13 17:46:18 -0800</span><br><span class="line">    • Engine revision 04817c99c9</span><br><span class="line">    • Dart version 3.3.0</span><br><span class="line">    • DevTools version 2.31.1</span><br><span class="line"></span><br><span class="line">[✗] Windows Version (Unable to confirm <span class="keyword">if</span> installed Windows version is 10 or greater)</span><br><span class="line"></span><br><span class="line">[✓] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 30.0.3)</span><br><span class="line">    • Android SDK at D:\AppData\Android\Sdk</span><br><span class="line">    • Platform android-34, build-tools 30.0.3</span><br><span class="line">    • ANDROID_HOME = D:\AppData\Android\Sdk</span><br><span class="line">    • Java binary at: D:\AppData\openjdk17.0.2\bin\java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 17.0.2+8-86)</span><br><span class="line">    • All Android licenses accepted.</span><br></pre></td></tr></table></figure><p>检测结果显示 <code>Android toolchain</code> 已经没有问题。</p><h1 id="使用模拟器"><a href="#使用模拟器" class="headerlink" title="使用模拟器"></a>使用模拟器</h1><p><code>Flutter 项目</code> 运行时使用的 <code>Android 模拟器</code> 与 <code>Android 项目</code> 开发时是一样的, 可以使用 <code>Android Studio</code> 自带的模拟器, 也可以使用其他第三方的模拟器。<code>Android Studio</code> 自带模拟器的安装和使用在此不再做说明。这里选择的第三方模拟器是 <code>雷电模拟器</code> 或 <code>夜神模拟器</code>, 其他的第三方模拟器使用方法类似。</p><blockquote><p>因为不使用 <code>Android Studio</code> 进行 <code>Flutter</code> 项目开发, 启动 <code>Android Studio</code> 自带的模拟器很不方便, 所以选择使用其他第三方的<code>Android 模拟器</code></p></blockquote><blockquote><p>第三方的<code>Android 模拟器</code>运行时需要生成镜像文件, 占用较大的硬盘空间, 安装时请根据电脑选择 <code>合适的安装路径</code></p></blockquote><h2 id="推荐-安装-雷电模拟器"><a href="#推荐-安装-雷电模拟器" class="headerlink" title="(推荐)安装 雷电模拟器"></a>(推荐)安装 <code>雷电模拟器</code></h2><p><code>雷电模拟器</code> 下载地址: <code>https://www.ldmnq.com/</code>, 下载后运行安装程序, 可以根据需要点击 d<code>自定义安装</code>, 更改<code>安装的路径</code>, <code>雷电模拟器</code>安装后即可使用, 不使用额外的设置与配置。</p><h2 id="使用-夜神模拟器"><a href="#使用-夜神模拟器" class="headerlink" title="使用 夜神模拟器"></a>使用 <code>夜神模拟器</code></h2><p><code>夜神模拟器</code>下载地址: <code>https://www.yeshen.com/</code>, 下载后运行安装程序, 可以根据需要点击<code>右下角</code>的<code>自定义安装</code>, 更改<code>安装的路径</code>, 如下图所示:</p><div style="width: 500px; margin: auto"><img src="/2021/12/04/flutter-development-environment-configuration/007.png" class="" title="yeshen"></div><blockquote><p>这里的<code>夜神模拟器</code>安装路径改成了: <code>C:\Program Files\Nox</code></p></blockquote><h2 id="替换-夜神模拟器-的-nox-adb-exe"><a href="#替换-夜神模拟器-的-nox-adb-exe" class="headerlink" title="替换 夜神模拟器 的 nox_adb.exe"></a>替换 <code>夜神模拟器</code> 的 <code>nox_adb.exe</code></h2><p><code>夜神模拟器</code> 通过 <code>nox_adb.exe</code> 与 <code>Android</code> 开发工具进行连接, 连接时, 要求 <code>nox_adb.exe</code> 必须与 <code>Android SDK</code> 的 <code>adb.exe</code> 版本相同。</p><ol><li><p>打开 <code>Android SDK</code> 的 <code>platform-tools</code> 文件夹(此处为 <code>D:\AppData\Android\Sdk\platform-tools</code>)</p></li><li><p>将该文件夹中的 <code>adb.exe</code> 复制一份, 并命名为 <code>nox_adb.exe</code> (此处建议显示<code>文件的扩展名</code>, 以免文件命名错误)</p></li><li><p>将上一步的 <code>nox_adb.exe</code> 复制到 <code>夜神模拟器</code> 安装路径中的<code>bin</code>文件夹(此处为: <code>C:\Program Files\Nox\bin</code>)中, 覆盖掉同名的<code>nox_adb.exe</code> 文件。</p></li></ol><img src="/2021/12/04/flutter-development-environment-configuration/008.png" class="" title="yeshen"><h2 id="连接-夜神模拟器"><a href="#连接-夜神模拟器" class="headerlink" title="连接 夜神模拟器"></a>连接 <code>夜神模拟器</code></h2><ol><li><p>先启动 <code>夜神模拟器</code>, 然后在 <code>夜神模拟器</code> 安装路径中的<code>bin</code>文件夹（<code>C:\Program Files\Nox\bin</code>）打开一个新的<code>控制台窗口</code>。</p></li><li><p>使用命令显示当前可连接设备: <code>nox_adb.exe devices</code>, 执行过程如下:</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Program Files\Nox\bin&gt; .\nox_adb.exe devices</span><br><span class="line">List of devices attached</span><br><span class="line">127.0.0.1:62001 device</span><br></pre></td></tr></table></figure><blockquote><p><code>127.0.0.1:62001</code> 为当前运行中的模拟器的连接地址</p></blockquote><ol start="3"><li>使用命令连接模拟器: <code>nox_adb.exe connect &lt;设备地址&gt;</code>, 执行过程如下所示:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Program Files\Nox\bin&gt; .\nox_adb.exe connect 127.0.0.1:62001</span><br><span class="line">already connected to 127.0.0.1:62001</span><br></pre></td></tr></table></figure><blockquote><p><code>夜神模拟器</code> 和 <code>Widnows 10/11</code> 自带的 <code>Hyper-V</code> 冲突, 不能同时使用。</p></blockquote><blockquote><p><code>夜神模拟器</code> 连接成功后, 同样适用于 <code>Android</code> 项目的开发调试。</p></blockquote><h1 id="在模拟器中运行Flutter项目"><a href="#在模拟器中运行Flutter项目" class="headerlink" title="在模拟器中运行Flutter项目"></a>在模拟器中运行<code>Flutter</code>项目</h1><p>在之前已经创建好的 <code>Flutter</code> 项目文件夹中打开<code>控制台窗口</code>, 执行 <code>flutter run</code> 命令运行项目, 执行过程如下所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos\demo_app&gt; flutter run</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Launching lib\main.dart on SM G955N <span class="keyword">in</span> debug mode...</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Running Gradle task <span class="string">&#x27;assembleDebug&#x27;</span>...                            736.7s</span><br><span class="line">✓  Built build\app\outputs\flutter-apk\app-debug.apk.</span><br><span class="line">Installing build\app\outputs\flutter-apk\app-debug.apk...           4.2s</span><br><span class="line">Syncing files to device SM G955N...                                111ms</span><br><span class="line"></span><br><span class="line">Flutter run key commands.</span><br><span class="line">r Hot reload. 🔥🔥🔥</span><br><span class="line">R Hot restart.</span><br><span class="line">h List all available interactive commands.</span><br><span class="line">d Detach (terminate <span class="string">&quot;flutter run&quot;</span> but leave application running).</span><br><span class="line">c Clear the screen</span><br><span class="line">q Quit (terminate the application on the device).</span><br><span class="line"></span><br><span class="line">💪 Running with sound null safety 💪</span><br><span class="line"></span><br><span class="line">An Observatory debugger and profiler on SM G955N is available at: http://127.0.0.1:51335/UEbv3xKoFAk=/</span><br><span class="line">E/libEGL  ( 3429): called unimplemented OpenGL ES API</span><br><span class="line">The Flutter DevTools debugger and profiler on SM G955N is available at:</span><br><span class="line">http://127.0.0.1:9100?uri=http://127.0.0.1:51335/UEbv3xKoFAk=/</span><br></pre></td></tr></table></figure><blockquote><p>当前已连接设备中包含有 <code>Android设备</code> 时, 该设备会优先运行, 此时不需要进行运行目标设备的选择。</p></blockquote><blockquote><p>第一次在 <code>Android设备</code> 上运行 <code>Flutter</code> 项目时, 可能会需要<code>很长的时间</code>, 如果没有出现<code>错误信息</code>, 请<code>耐心等待</code>。</p></blockquote><p>夜神模拟器显示的运行结果如下图所示:</p><div style="width: 400px; margin: auto"><img src="/2021/12/04/flutter-development-environment-configuration/009.png" class="" title="yeshen"></div><h2 id="第一次运行常见的错误"><a href="#第一次运行常见的错误" class="headerlink" title="第一次运行常见的错误"></a>第一次运行常见的错误</h2><p><code>Flutter</code> 使用 <code>Gradle</code> 构建 <code>Android</code> 项目, 第一次在 <code>Android</code> 模拟器上运行 <code>Flutter</code> 项目时, 需要下载对应版本的 <code>Gradle</code>。由于<code>Gradle</code> 的服务器在国外, 所以经常会出现<code>无法连接</code>服务器, 项目构建失败, 第一次常见的错误可能如下图所示:</p><img src="/2021/12/04/flutter-development-environment-configuration/flutter_run_error.png" class="" title="error"><blockquote><p>错误原因: 可能是因为无法下载构建项目所需要的 <code>Gradle</code> 文件</p></blockquote><blockquote><p>解决办法：</p></blockquote><blockquote><ol><li>打开 <code>C:\Users\&lt;用户名&gt;\.gradle\wrapper\dists</code> 文件夹(<code>&lt;用户名&gt;</code>替换为当前电脑的实际用户名)</li></ol></blockquote><blockquote><ol start="2"><li>查看当前 <code>Flutter</code> 项目需要的 <code>Gradle</code>版本</li></ol></blockquote><blockquote><ol start="3"><li>使用<code>国内镜像</code>下载合适版本的 <code>Gradle</code>, 下载地址：<a href="https://mirrors.cloud.tencent.com/gradle/">https://mirrors.cloud.tencent.com/gradle/</a></li></ol></blockquote><blockquote><ol start="4"><li>将下载到的 <code>.zip</code> 文件夹放到<code>最终文件夹</code>中, 例如: <code>C:\Users\&lt;用户名&gt;\.gradle\wrapper\dists\gradle-7.5-all\6qsw290k5lz422uaf8jf6m7co</code>,  每个不同版本<code>Gradle</code> 文件夹路径中的特殊字符(例如<code>6qsw290k5lz422uaf8jf6m7co</code>)都不一样。</li></ol></blockquote><blockquote><ol start="5"><li>重新启动 <code>Flutter</code> 项目调试</li></ol></blockquote><h2 id="其他错误"><a href="#其他错误" class="headerlink" title="其他错误"></a>其他错误</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Launching lib\main.dart on TAS AL00 <span class="keyword">in</span> debug mode...</span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">Execution failed <span class="keyword">for</span> task <span class="string">&#x27;:gradle:compileGroovy&#x27;</span>.</span><br><span class="line">&gt; Could not resolve all files <span class="keyword">for</span> configuration <span class="string">&#x27;:gradle:compileClasspath&#x27;</span>.</span><br><span class="line">   &gt; Could not resolve com.squareup:javawriter:2.5.0.</span><br><span class="line">     Required by:</span><br><span class="line">         project :gradle &gt; com.android.tools.build:gradle:7.3.0 &gt; com.android.tools.build:builder:7.3.0</span><br><span class="line">      &gt; Could not resolve com.squareup:javawriter:2.5.0.</span><br><span class="line">         &gt; Could not get resource <span class="string">&#x27;https://repo.maven.apache.org/maven2/com/squareup/javawriter/2.5.0/javawriter-2.5.0.pom&#x27;</span>.</span><br><span class="line">            &gt; Could not GET <span class="string">&#x27;https://repo.maven.apache.org/maven2/com/squareup/javawriter/2.5.0/javawriter-2.5.0.pom&#x27;</span>.</span><br><span class="line">               &gt; Connect to repo.maven.apache.org:443 [repo.maven.apache.org/146.75.112.215] failed: Connection timed out: no further information</span><br><span class="line">   &gt; Could not resolve org.ow2.asm:asm:9.1.</span><br><span class="line">     Required by:</span><br><span class="line">         project :gradle &gt; com.android.tools.build:gradle:7.3.0 &gt; com.android.tools.build:gradle-api:7.3.0</span><br><span class="line">      &gt; Could not resolve org.ow2.asm:asm:9.1.</span><br><span class="line">         &gt; Could not get resource <span class="string">&#x27;https://repo.maven.apache.org/maven2/org/ow2/asm/asm/9.1/asm-9.1.pom&#x27;</span>.</span><br><span class="line">            &gt; Could not GET <span class="string">&#x27;https://repo.maven.apache.org/maven2/org/ow2/asm/asm/9.1/asm-9.1.pom&#x27;</span>.</span><br><span class="line">               &gt; Connect to repo.maven.apache.org:443 [repo.maven.apache.org/146.75.112.215] failed: Connection timed out: no further information</span><br><span class="line"></span><br><span class="line">* Try:</span><br><span class="line">&gt; Run with --stacktrace option to get the stack trace.</span><br><span class="line">&gt; Run with --info or --debug option to get more <span class="built_in">log</span> output.</span><br><span class="line">&gt; Run with --scan to get full insights.</span><br><span class="line"></span><br><span class="line">* Get more <span class="built_in">help</span> at https://help.gradle.org</span><br><span class="line"></span><br><span class="line">BUILD FAILED <span class="keyword">in</span> 3m 17s</span><br><span class="line">[!] Gradle threw an error <span class="keyword">while</span> downloading artifacts from the network.</span><br><span class="line">Retrying Gradle Build: <span class="comment">#1, wait time: 100ms</span></span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">Execution failed <span class="keyword">for</span> task <span class="string">&#x27;:gradle:compileGroovy&#x27;</span>.</span><br><span class="line">&gt; Could not resolve all files <span class="keyword">for</span> configuration <span class="string">&#x27;:gradle:compileClasspath&#x27;</span>.</span><br><span class="line">   &gt; Could not resolve com.squareup:javawriter:2.5.0.</span><br><span class="line">     Required by:</span><br><span class="line">         project :gradle &gt; com.android.tools.build:gradle:7.3.0 &gt; com.android.tools.build:builder:7.3.0</span><br><span class="line">      &gt; Could not resolve com.squareup:javawriter:2.5.0.</span><br><span class="line">         &gt; Could not get resource <span class="string">&#x27;https://repo.maven.apache.org/maven2/com/squareup/javawriter/2.5.0/javawriter-2.5.0.pom&#x27;</span>.</span><br><span class="line">            &gt; Could not GET <span class="string">&#x27;https://repo.maven.apache.org/maven2/com/squareup/javawriter/2.5.0/javawriter-2.5.0.pom&#x27;</span>.</span><br><span class="line">               &gt; Connect to repo.maven.apache.org:443 [repo.maven.apache.org/151.101.108.215] failed: Connection timed out: no further information</span><br><span class="line">   &gt; Could not resolve org.ow2.asm:asm:9.1.</span><br><span class="line">     Required by:</span><br><span class="line">         project :gradle &gt; com.android.tools.build:gradle:7.3.0 &gt; com.android.tools.build:gradle-api:7.3.0</span><br><span class="line">      &gt; Could not resolve org.ow2.asm:asm:9.1.</span><br><span class="line">         &gt; Could not get resource <span class="string">&#x27;https://repo.maven.apache.org/maven2/org/ow2/asm/asm/9.1/asm-9.1.pom&#x27;</span>.</span><br><span class="line">            &gt; Could not GET <span class="string">&#x27;https://repo.maven.apache.org/maven2/org/ow2/asm/asm/9.1/asm-9.1.pom&#x27;</span>.</span><br><span class="line">               &gt; Connect to repo.maven.apache.org:443 [repo.maven.apache.org/151.101.108.215] failed: Connection timed out: no further information</span><br><span class="line"></span><br><span class="line">* Try:</span><br><span class="line">&gt; Run with --stacktrace option to get the stack trace.</span><br><span class="line">&gt; Run with --info or --debug option to get more <span class="built_in">log</span> output.</span><br><span class="line">&gt; Run with --scan to get full insights.</span><br><span class="line"></span><br><span class="line">* Get more <span class="built_in">help</span> at https://help.gradle.org</span><br><span class="line"></span><br><span class="line">BUILD FAILED <span class="keyword">in</span> 2m 13s</span><br><span class="line">[!] Gradle threw an error <span class="keyword">while</span> downloading artifacts from the network.</span><br><span class="line">Exception: Gradle task assembleDebug failed with <span class="built_in">exit</span> code 1</span><br><span class="line"></span><br><span class="line">Exited (1).</span><br></pre></td></tr></table></figure><blockquote><p>错误原因: <code>Gradle</code> 因为网络问题无法从<code>服务器</code>下载构建项目所需要的 <code>jar</code> 包</p></blockquote><blockquote><p>解决办法: 有条件的话 <code>更换网络</code>, 或 <code>搭个梯子</code>, 或是配置 <code>Gradle</code> 国内镜像, 并<code>重试</code>直到成功(或者换个其他人少上网的时间重试)</p></blockquote><blockquote><p>可以尝试将其他人已经能成功运行 <code>Flutter</code> 项目的 <code>C:\Users\&lt;用户名&gt;\.gradle</code> 文件夹复制到自己电脑。</p></blockquote><h1 id="配置-Gradle-国内镜像"><a href="#配置-Gradle-国内镜像" class="headerlink" title="配置 Gradle 国内镜像"></a>配置 <code>Gradle</code> 国内镜像</h1><p>在 <code>Android设备</code> 上运行 <code>Flutter</code>项目程序时, 默认使用 <code>Gradle</code> 管理项目依赖, 第一次运行时, 除了检查 <code>Android SDK</code> 组件并下载正确的版本外, 还会安装和 <code>Flutter SDK</code> 匹配的 <code>Gradle</code>, <code>Flutter SDK 3.7.1</code> 使用的 <code>Gradle</code> 版本是 <code>gradle-7.5-all</code>。</p><p><code>Gradle</code> 添加成功后才会下载当前项目所需要的其他包和组件, 由于 <code>Gradle</code> 默认使用的源是国外的服务器,　所以网络状况不好时通常出现类似以下的错误信息:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\flutter_repos\demo_app&gt; flutter run</span><br><span class="line">Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this <span class="built_in">source</span>!</span><br><span class="line">Using hardware rendering with device Android SDK built <span class="keyword">for</span> x86 64. If you notice graphics artifacts, consider enabling software rendering</span><br><span class="line">with <span class="string">&quot;--enable-software-rendering&quot;</span>.</span><br><span class="line">Launching lib/main.dart on Android SDK built <span class="keyword">for</span> x86 64 <span class="keyword">in</span> debug mode...</span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">Execution failed <span class="keyword">for</span> task <span class="string">&#x27;:app:compileDebugKotlin&#x27;</span>.</span><br><span class="line">&gt; Could not resolve all dependencies <span class="keyword">for</span> configuration <span class="string">&#x27;:app:kotlinCompilerClasspath&#x27;</span>.</span><br><span class="line">   &gt; Could not load module metadata from /home/laohoo/.gradle/caches/modules-2/metadata-2.97/descriptors/org.jetbrains.kotlin/kotlin-script-runtime/1.6.10/a8be1fe3b3911d3d3425fe720cf42835/descriptor.bin</span><br><span class="line"></span><br><span class="line">* Try:</span><br><span class="line">&gt; Run with --stacktrace option to get the stack trace.</span><br><span class="line">&gt; Run with --info or --debug option to get more <span class="built_in">log</span> output.</span><br><span class="line">&gt; Run with --scan to get full insights.</span><br><span class="line"></span><br><span class="line">* Get more <span class="built_in">help</span> at https://help.gradle.org</span><br><span class="line"></span><br><span class="line">BUILD FAILED <span class="keyword">in</span> 1s</span><br><span class="line">Running Gradle task <span class="string">&#x27;assembleDebug&#x27;</span>...                           2,548ms</span><br><span class="line">Exception: Gradle task assembleDebug failed with <span class="built_in">exit</span> code 1</span><br></pre></td></tr></table></figure><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>在 <code>C:\Users\&lt;用户名&gt;\.gradle</code> 文件夹(<code>&lt;用户名&gt;</code>替换为当前电脑实际的<code>用户名</code>)下新建名为 <code>init.gradle</code> 的文件, 文件内容编辑如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">allprojects&#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        def ALIYUN_REPOSITORY_URL = &#x27;https://maven.aliyun.com/repository/public/&#x27;</span><br><span class="line">        def ALIYUN_JCENTER_URL = &#x27;https://maven.aliyun.com/repository/jcenter/&#x27;</span><br><span class="line">        def ALIYUN_GOOGLE_URL = &#x27;https://maven.aliyun.com/repository/google/&#x27;</span><br><span class="line">        def ALIYUN_GRADLE_PLUGIN_URL = &#x27;https://maven.aliyun.com/repository/gradle-plugin/&#x27;</span><br><span class="line">        all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">            if(repo instanceof MavenArtifactRepository)&#123;</span><br><span class="line">                def url = repo.url.toString()</span><br><span class="line">                if (url.startsWith(&#x27;https://repo1.maven.org/maven2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_REPOSITORY_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://jcenter.bintray.com/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_JCENTER_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://dl.google.com/dl/android/maven2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_GOOGLE_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://plugins.gradle.org/m2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_GRADLE_PLUGIN_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123; url ALIYUN_REPOSITORY_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_JCENTER_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_GOOGLE_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_GRADLE_PLUGIN_URL &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> buildscript&#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        def ALIYUN_REPOSITORY_URL = &#x27;https://maven.aliyun.com/repository/public/&#x27;</span><br><span class="line">        def ALIYUN_JCENTER_URL = &#x27;https://maven.aliyun.com/repository/jcenter/&#x27;</span><br><span class="line">        def ALIYUN_GOOGLE_URL = &#x27;https://maven.aliyun.com/repository/google/&#x27;</span><br><span class="line">        def ALIYUN_GRADLE_PLUGIN_URL = &#x27;https://maven.aliyun.com/repository/gradle-plugin/&#x27;</span><br><span class="line">        all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">            if(repo instanceof MavenArtifactRepository)&#123;</span><br><span class="line">                def url = repo.url.toString()</span><br><span class="line">                if (url.startsWith(&#x27;https://repo1.maven.org/maven2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_REPOSITORY_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://jcenter.bintray.com/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_JCENTER_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://dl.google.com/dl/android/maven2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_GOOGLE_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#x27;https://plugins.gradle.org/m2/&#x27;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_GRADLE_PLUGIN_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123; url ALIYUN_REPOSITORY_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_JCENTER_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_GOOGLE_URL &#125;</span><br><span class="line">        maven &#123; url ALIYUN_GRADLE_PLUGIN_URL &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在第一次在 <code>Android设备</code> 中运行 <code>Flutter</code> 项目, 下载了 <code>Gradle</code> 之后, 才会创建 <code>C:\Users\&lt;用户名&gt;\.gradle</code> 文件夹, 该文件夹是<code>隐藏文件夹</code>。</p></blockquote><p>再次运行项目, <code>Gradle</code> 就可以通过<code>国内镜像</code>下载项目需要的依赖, 提高下载的速度。</p><p>&#x3D;&#x3D;&#x3D; END &#x3D;&#x3D;&#x3D;</p>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
            <tag> android studio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(十) - 话题详情页及评论</title>
      <link href="/2021/11/22/element-leancloud-project-X/"/>
      <url>/2021/11/22/element-leancloud-project-X/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><p>论坛话题详情页中，首先要显示的是话题有关的内容，比如标题、作者、时间、内容等各种信息</p><p>除此以外，还要提供一个用于发表评论的表单，以及显示当前话题已有的评论内容。</p><p>评论需要使用一个单独的表(Class) 来进行存放，同时，还要记录是对哪个话题进行的评论。</p><h1 id="查询指定-id-的话题，和增加查看次数"><a href="#查询指定-id-的话题，和增加查看次数" class="headerlink" title="查询指定 id 的话题，和增加查看次数"></a>查询指定 id 的话题，和增加查看次数</h1><p>进入详情页后，要先把指定 id 的话题显示出来，同时这个话题的查看次数也在增加，相应的功能可以添加到 <code>TopicService</code> 中。</p><p>打开文件<code>src/api/service/topic_service.js</code>, 修改其内容如以下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;  <span class="comment">// 导入 leancloud 数据存储模块</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">BaseService</span> <span class="keyword">from</span> <span class="string">&#x27;./base_service&#x27;</span>;  <span class="comment">// 导入访问 leancloud 数据存储的基类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TABLE_NAME</span> = <span class="string">&#x27;Topic&#x27;</span>;    <span class="comment">// leancloud 中存储数据的表名(Class)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对leancloud应用中 名为 &quot;Topic&quot; 的 Class 进行数据操作的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TopicService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseService</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">table_name</span>) &#123;</span><br><span class="line">        <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">        <span class="variable language_">super</span>(table_name);</span><br><span class="line">        <span class="comment">// 当前子类的属性 this.TABLE_NAME</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">TABLE_NAME</span> = table_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询指定 id 的论坛话题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; id </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">TopicService</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getTopicById</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">        <span class="comment">// include(&quot;createdBy&quot;, &quot;lastEditor&quot;) 或者 include([&quot;createdBy&quot;, &quot;lastEditor&quot;]) 都可以</span></span><br><span class="line">        query.<span class="title function_">include</span>([<span class="string">&quot;createdBy&quot;</span>, <span class="string">&quot;lastEditor&quot;</span>]);</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">get</span>(id);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status_code&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">            <span class="string">&quot;reslut&quot;</span>: response,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查询数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status_code&quot;</span>: e.<span class="property">code</span>,</span><br><span class="line">            <span class="string">&quot;reslut&quot;</span>: e,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定 id 的话题 查看次数加1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; id </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">TopicService</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">viewsInc</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> topic = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>, id);</span><br><span class="line">        <span class="comment">// 原子操作 来增加或减少一个属性内保存的数字    </span></span><br><span class="line">        topic.<span class="title function_">increment</span>(<span class="string">&#x27;views&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> topic.<span class="title function_">save</span>();</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;修改数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出子类时使用 new 直接进行实例化</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">TopicService</span>(<span class="variable constant_">TABLE_NAME</span>);</span><br></pre></td></tr></table></figure><h1 id="添加用于评论的-CommentService"><a href="#添加用于评论的-CommentService" class="headerlink" title="添加用于评论的 CommentService"></a>添加用于评论的 <code>CommentService</code></h1><p>评论的内容要保存在另外一个表中，这里使用一个<code>CommentService</code> 类来实现对评论内容的管理。</p><p>创建文件 <code>src/api/service/comment_service.js</code>, 内容如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;  <span class="comment">// 导入 leancloud 数据存储模块</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">BaseService</span> <span class="keyword">from</span> <span class="string">&#x27;./base_service&#x27;</span>;  <span class="comment">// 导入访问 leancloud 数据存储的基类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TABLE_NAME</span> = <span class="string">&#x27;Comment&#x27;</span>;    <span class="comment">// leancloud 中存储数据的表名(Class)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对leancloud应用中 名为 &quot;Comment&quot; 的 Class 进行数据操作的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommentService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseService</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">table_name</span>) &#123;</span><br><span class="line">        <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">        <span class="variable language_">super</span>(table_name);</span><br><span class="line">        <span class="comment">// 当前子类的属性 this.TABLE_NAME</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">TABLE_NAME</span> = table_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发表评论</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; topicId 被评论的话题 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; content 评论的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">CommentService</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">newComment</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">topicId, content</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 根据 topicId 找出被评论的话题</span></span><br><span class="line">        <span class="keyword">let</span> topic = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="string">&#x27;Topic&#x27;</span>, topicId);</span><br><span class="line">        <span class="comment">// 创建保存评论内容的 Class</span></span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">Collection</span> = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">extend</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">        <span class="comment">// 创建评论的内容对象</span></span><br><span class="line">        <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="title class_">Collection</span>(&#123;</span><br><span class="line">            <span class="string">&quot;topic&quot;</span>: topic,      <span class="comment">// 评论的话题</span></span><br><span class="line">            <span class="string">&quot;content&quot;</span>: content,  <span class="comment">// 评论的内容</span></span><br><span class="line">            <span class="string">&quot;invisible&quot;</span>: <span class="literal">false</span>,  <span class="comment">// 不可见，如果为 true 就隐藏该评论</span></span><br><span class="line">            <span class="string">&quot;createdBy&quot;</span>: <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">currentUser</span>(),   <span class="comment">// 评论者</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">save</span>();  <span class="comment">// 保存评论数据 </span></span><br><span class="line">        <span class="keyword">if</span> (response) &#123;</span><br><span class="line">            topic.<span class="title function_">increment</span>(<span class="string">&#x27;reply&#x27;</span>, <span class="number">1</span>);    <span class="comment">// 评论数加一</span></span><br><span class="line">            topic.<span class="title function_">set</span>(<span class="string">&#x27;lastRepliedAt&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">// 更新最后评论时间</span></span><br><span class="line">            <span class="keyword">let</span> resp = <span class="keyword">await</span> topic.<span class="title function_">save</span>();  <span class="comment">// 保存</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发了评论的 topic ：&#x27;</span>, resp);</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加评论失败：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询指定 id 的话题的评论内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; topicId 话题 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; limit 每页大小</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; skip 跳过记录数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; sort_field 单个排序字段名(降序加负号) 默认按创建时间升序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">CommentService</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getCommentByTopic</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">topicId, limit = <span class="number">5</span>, skip = <span class="number">0</span>, sort_field = <span class="string">&#x27;createdAt&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">        <span class="keyword">const</span> topic = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="string">&#x27;Topic&#x27;</span>, topicId);  <span class="comment">// 根据 id 获取话题</span></span><br><span class="line">        query.<span class="title function_">include</span>(<span class="string">&#x27;createdBy&#x27;</span>);</span><br><span class="line">        query.<span class="title function_">equalTo</span>(<span class="string">&#x27;topic&#x27;</span>, topic);       <span class="comment">// 关系查询</span></span><br><span class="line">        <span class="comment">// 排序属性： this.isMinus()  是父类中定义的方法，判断排序的字段是否 负号 开头</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isMinus</span>(sort_field)) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(sort_field, sort_field.<span class="title function_">substr</span>(<span class="number">1</span>));</span><br><span class="line">            <span class="comment">// 去掉负号后的字段名降序</span></span><br><span class="line">            query.<span class="title function_">descending</span>(sort_field.<span class="title function_">substr</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            query.<span class="title function_">ascending</span>(sort_field);  <span class="comment">// 升序</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> total = <span class="keyword">await</span> query.<span class="title function_">count</span>();   <span class="comment">// 返回记录总数       </span></span><br><span class="line">        <span class="comment">// 分页查询参数</span></span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">limit</span>(limit).<span class="title function_">skip</span>(skip).<span class="title function_">find</span>();</span><br><span class="line">        <span class="comment">// let response = await query.find();</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getCommentByTopic:&#x27;</span>, total, response);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status_code&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">            <span class="string">&quot;totalCount&quot;</span>: total,</span><br><span class="line">            <span class="string">&quot;reslut&quot;</span>: response,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查询数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status_code&quot;</span>: e.<span class="property">code</span>,</span><br><span class="line">            <span class="string">&quot;totalCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;reslut&quot;</span>: e,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出子类时使用 new 直接进行实例化</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">CommentService</span>(<span class="variable constant_">TABLE_NAME</span>);</span><br></pre></td></tr></table></figure><h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>s打开文件<code>src/views/home/pages/Detail.vue</code>, 编辑文件内容如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span> <span class="attr">align</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:lg</span>=<span class="string">&quot;18&quot;</span> <span class="attr">:md</span>=<span class="string">&quot;20&quot;</span> <span class="attr">:sm</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-card</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>话题：&#123;&#123; topic.title &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 异步数据先显示初始数据，再显示带数据的数据 --&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 会导致三层表达式 a.b.c 渲染时会报错，是因为第一次渲染时还没有值，后来有值渲染成功 --&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 可以不理睬，不想看错误信息也可以加 v-if=&quot;topic.createdBy&quot; 来解决 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;topic.createdBy&quot;</span>&gt;</span></span><br><span class="line">                            &#123;&#123; topic.createdBy.username &#125;&#125; -</span><br><span class="line">                            &#123;&#123; topic.createdAt | datetimeFormat &#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-divider</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-html</span>=<span class="string">&quot;topic.content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-divider</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-size:18px;&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-comments-o fa-lg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                评论</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span>共 &#123;&#123; replyCount &#125;&#125; 条评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comment-user&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-avatar</span> <span class="attr">style</span>=<span class="string">&quot;background-color: red;&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user fa-4x&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-avatar</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;my-2&quot;</span>&gt;</span>&#123;&#123; currentUser &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;评论（支持 Markdown 语法）&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;desc&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">v-model</span>=<span class="string">&quot;content&quot;</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">placeholder</span>=<span class="string">&quot;输入评论内容&quot;</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">:disabled</span>=<span class="string">&quot;!currentUser&quot;</span></span></span><br><span class="line"><span class="tag">                                    &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;!currentUser&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:red;&quot;</span>&gt;</span>登录后发表评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:disabled</span>=<span class="string">&quot;!currentUser&quot;</span>&gt;</span>预览<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">:disabled</span>=<span class="string">&quot;!currentUser&quot;</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">                                            @<span class="attr">click</span>=<span class="string">&quot;newComment&quot;</span></span></span><br><span class="line"><span class="tag">                                        &gt;</span>评论<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in comments&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span>&#123;&#123; item.createdBy.username &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;!item.invisible&quot;</span> <span class="attr">v-html</span>=<span class="string">&quot;item.content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>***该评论内容已被隐藏***<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>&#123;&#123; item.createdAt | datetimeFormat &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-thumbs-o-up&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-thumbs-o-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span>举报<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span>隐藏<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-divider</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container pagination&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">background</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">size-change</span>=<span class="string">&quot;getCommentByTopic($route.params.id)&quot;</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">current-change</span>=<span class="string">&quot;getCommentByTopic($route.params.id)&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">layout</span>=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:total</span>=<span class="string">&quot;replyCount&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:page-sizes</span>=<span class="string">&quot;[5, 10, 20, 30]&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:page-size.sync</span>=<span class="string">&quot;pageSize&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:current-page.sync</span>=<span class="string">&quot;currentPage&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">CommentService</span> <span class="keyword">from</span> <span class="string">&#x27;../../../api/service/comment_service&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">TopicService</span> <span class="keyword">from</span> <span class="string">&#x27;../../../api/service/topic_service&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; marked &#125; <span class="keyword">from</span> <span class="string">&#x27;marked&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> hljs <span class="keyword">from</span> <span class="string">&#x27;highlight.js&#x27;</span>;  <span class="comment">// 需要安装 highlight.js, 例如：npm i highlight.js</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="string">&#x27;highlight.js/styles/github-dark.css&#x27;</span>;  <span class="comment">// 代码高亮样式</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Detail&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">topic</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">comments</span>: [],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">replyCount</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">pageSize</span>: <span class="number">5</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">currentPage</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">currentUser</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dialog</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">currentUser</span> = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;currentUser&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// marked.js 初始化</span></span></span><br><span class="line"><span class="language-javascript">        marked.<span class="title function_">setOptions</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">renderer</span>: <span class="keyword">new</span> marked.<span class="title class_">Renderer</span>(),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">highlight</span>: <span class="keyword">function</span> (<span class="params">code</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> hljs.<span class="title function_">highlightAuto</span>(code).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// return hljs.highlightBlock(code);</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;gfm&quot;</span>: <span class="literal">true</span>,<span class="comment">// 启动Github样式的Markdown</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;breaks&quot;</span>: <span class="literal">true</span>,<span class="comment">//支持Github换行符，必须打开gfm选项</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;tables&quot;</span>: <span class="literal">true</span>,  <span class="comment">//支持Github表格，必须打开gfm选项</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;extensions&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;headerIds&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;headerPrefix&quot;</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;highlight&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;langPrefix&quot;</span>: <span class="string">&quot;language-&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;mangle&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;pedantic&quot;</span>: <span class="literal">false</span>,<span class="comment">// 只解析符合markdown.pl定义的，不修正markdown的错误</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;sanitize&quot;</span>: <span class="literal">false</span>, <span class="comment">// 原始输出，忽略HTML标签</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;sanitizer&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;silent&quot;</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;smartLists&quot;</span>: <span class="literal">false</span>, <span class="comment">//优化列表输出</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;smartypants&quot;</span>: <span class="literal">false</span>,<span class="comment">//使用更为时髦的标点，比如在引用语法中加入破折号。</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;tokenizer&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;walkTokens&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;xhtml&quot;</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> topicId = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">viewInc</span>(topicId);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">getTopicById</span>(topicId);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">getCommentByTopic</span>(topicId);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">getTopicById</span>(<span class="params">topicId</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">getTopicById</span>(topicId);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> === <span class="string">&#x27;ok&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">topic</span> = <span class="variable language_">this</span>.<span class="title function_">toJson</span>(response.<span class="property">reslut</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: <span class="string">&#x27;出现异常，无法获取数据&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">getCommentByTopic</span>(<span class="params">topicId</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">comments</span> = [];</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> skip = (<span class="variable language_">this</span>.<span class="property">currentPage</span> - <span class="number">1</span>) * <span class="variable language_">this</span>.<span class="property">pageSize</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">CommentService</span>.<span class="title function_">getCommentByTopic</span>(topicId, <span class="variable language_">this</span>.<span class="property">pageSize</span>, skip);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> === <span class="string">&#x27;ok&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">comments</span> = response.<span class="property">reslut</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">id</span>: item.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">topicId</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;topic&#x27;</span>).<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">content</span>: <span class="variable language_">this</span>.<span class="title function_">markdown</span>(item.<span class="title function_">get</span>(<span class="string">&#x27;content&#x27;</span>)),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">invisible</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;visible&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">createdAt</span>: item.<span class="property">createdAt</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">updatedAt</span>: item.<span class="property">updatedAt</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">createdBy</span>: item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                            ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                            : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">replyCount</span> = response.<span class="property">totalCount</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: <span class="string">&#x27;出现异常，无法获取评论数据&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">newComment</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> content = <span class="variable language_">this</span>.<span class="property">content</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (content) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> item = <span class="keyword">await</span> <span class="title class_">CommentService</span>.<span class="title function_">newComment</span>(<span class="variable language_">this</span>.<span class="property">topic</span>.<span class="property">id</span>, content);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (item) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">content</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 把新评论添加到当前评论的前面。</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">comments</span>.<span class="title function_">push</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">id</span>: item.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">topicId</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;topic&#x27;</span>).<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">content</span>: <span class="variable language_">this</span>.<span class="title function_">markdown</span>(item.<span class="title function_">get</span>(<span class="string">&#x27;content&#x27;</span>)),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">invisible</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;visible&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">createdAt</span>: item.<span class="property">createdAt</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">updatedAt</span>: item.<span class="property">updatedAt</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">createdBy</span>: item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                            ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                            : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">replyCount</span>++;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: <span class="string">`评论发表成功`</span>,</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: <span class="string">&#x27;出现错误, 无法完成评论&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 查看次数加1</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">viewInc</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">viewsInc</span>(id);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">toLogin</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;aaa&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">currentUser</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">dialog</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取用户中各个字段的值， 可以根据需要添加</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getUser</span>(<span class="params">user</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// console.log(user);</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: user.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: user.<span class="title function_">get</span>(<span class="string">&quot;username&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">email</span>: user.<span class="title function_">get</span>(<span class="string">&quot;email&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将从服务器端取到的数据不能直接使用，转为对象格式的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">toJson</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: item.<span class="property">id</span>,   <span class="comment">// leancloud Class 自带属性，对应 leanclud Class 中的 &quot;ObjectId&quot;, 可以用&quot;.id&quot;直接引用</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;title&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 因为pre标签缺失hljs这个class，加上就好了将拿到的markdown内容，</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 用marked转成html字符串后，replace替换&lt;pre&gt;标签为&lt;pre class=&quot;hljs&quot;&gt;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// content: marked(item.get(&#x27;content&#x27;)).replace(/&lt;pre&gt;/g, &quot;&lt;pre class=&#x27;hljs&#x27;&gt;&quot;),</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">content</span>: <span class="variable language_">this</span>.<span class="title function_">markdown</span>(item.<span class="title function_">get</span>(<span class="string">&#x27;content&#x27;</span>)),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">views</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;views&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">reply</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;reply&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">level</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;level&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">createdAt</span>: item.<span class="property">createdAt</span>,  <span class="comment">// leancloud Class 自带属性,创建时间,不能修改值</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">updatedAt</span>: item.<span class="property">updatedAt</span>,   <span class="comment">// leancloud Class 自带属性,最后修改时间,只能leancloud 自动修改</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * createdBy、lastEditor 指向另一个表的字段, 默认只能得到该字段在关联表中的id 值</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * 要得到完整值， 查询时字段名要包含在 include 中，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * 取值时，要先判断是否为空，如果为空，取值会抛出异常，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 */</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">createdBy</span>: item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                    : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastEditor</span>: item.<span class="title function_">get</span>(<span class="string">&quot;lastEditor&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;lastEditor&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                    : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//  将 markdown 语法写的内容转为 html 显示</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">markdown</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="title function_">marked</span>(val).<span class="title function_">replace</span>(<span class="regexp">/&lt;pre&gt;/g</span>, <span class="string">&quot;&lt;pre class=&#x27;hljs&#x27;&gt;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">filters</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 使用 moment.js 定义日期时间过滤器函数   </span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">datetimeFormat</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//  计算两个时间相差多少天</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> days = <span class="title function_">moment</span>(now).<span class="title function_">diff</span>(<span class="title function_">moment</span>(val), <span class="string">&#x27;days&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (days &lt;= <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 小于三天的返回格式：1小时前</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="title function_">moment</span>(val).<span class="title function_">fromNow</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 三天以上的返回日期时间</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="title function_">moment</span>(val).<span class="title function_">format</span>(<span class="string">&quot;lll&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.title</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.info</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#c2c2c2</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.author</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: darkcyan;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.comment-user</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex-flow</span>: column;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.comment-content</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(九) - 首页显示话题列表</title>
      <link href="/2021/11/21/element-leancloud-project-IX/"/>
      <url>/2021/11/21/element-leancloud-project-IX/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="网站前台的规划与路由"><a href="#网站前台的规划与路由" class="headerlink" title="网站前台的规划与路由"></a>网站前台的规划与路由</h1><p>要显示论坛的话题列表，以及显示话题的详细内容、添加及显示用户的评论，需要添加相应的视图</p><h2 id="添加前台视图文件"><a href="#添加前台视图文件" class="headerlink" title="添加前台视图文件"></a>添加前台视图文件</h2><p>在 <code>src/views/home</code> 文件夹添加一个名为 <code>pages</code> 的文件夹，然后在该文件夹中添加用于显示话题列表的视图文件<code>TopicList.vue</code> 以及 显示话题详情的视图文件 <code>Detail.vue</code>。</p><p><code>src/views/</code> 文件夹的最终组成结构如以下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- account</span><br><span class="line">|   |-- pages</span><br><span class="line">|   |   |-- Login.vue</span><br><span class="line">|   |   |-- PasswordReset.vue</span><br><span class="line">|   |   `-- SignUp.vue</span><br><span class="line">|   `-- Index.vue</span><br><span class="line">|-- dashboard</span><br><span class="line">|   |-- forum</span><br><span class="line">|   |   |-- CommentManager.vue</span><br><span class="line">|   |   `-- TopicManager.vue</span><br><span class="line">|   |-- layout</span><br><span class="line">|   |   |-- Aside.vue</span><br><span class="line">|   |   |-- Header.vue</span><br><span class="line">|   |   `-- MenuTree.vue</span><br><span class="line">|   |-- pages</span><br><span class="line">|   |   `-- MainIndex.vue</span><br><span class="line">|   `-- Index.vue</span><br><span class="line">`-- home</span><br><span class="line">    |-- pages</span><br><span class="line">    |   |-- Detail.vue</span><br><span class="line">    |   `-- ToplicList.vue</span><br><span class="line">    `-- Index.vue</span><br></pre></td></tr></table></figure><h2 id="编辑路由"><a href="#编辑路由" class="headerlink" title="编辑路由"></a>编辑路由</h2><p>打开文件： <code>src/router/index.js</code>， 在原来的 <code>name: &#39;Home&#39;</code> 的路由项添加前面两个视图对应的路由项，最终完成的代码如以下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="comment">// name: &#x27;Home&#x27;,</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/home/Index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ToplicList&#x27;</span>,   <span class="comment">// 论坛话题列表</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/home/pages/ToplicList.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/detail/:id&#x27;</span>,  <span class="comment">// 动态路由, id 用于接收参数</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Detail&#x27;</span>,       <span class="comment">// 话题详情</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/home/pages/Detail.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/account&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/Index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/Login.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/signup&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;SignUp&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/SignUp.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/password_reset&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;PasswordReset&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/PasswordReset.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/dashboard/Index.vue&#x27;</span>),</span><br><span class="line">    <span class="comment">// 添加路由元信息 meta: &#123; requiresAuth: true, &#125; 用于标识进入该路由必须登录 </span></span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">alias</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/pages/MainIndex.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;topic_manager&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;TopicManager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/forum/TopicManager.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;comment_manager&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;CommentManager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/forum/CommentManager.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用路由守卫,具体内容见官方文档：https://router.vuejs.org/zh/guide/advanced/meta.html</span></span><br><span class="line"><span class="comment">// 特别注意事项：确保 router.beforeEach 中只有一个 next() 会被执行</span></span><br><span class="line"><span class="comment">// 如果有多个 next() 被执行，将会出现重复路由的异常</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> login_router = [<span class="string">&#x27;/account&#x27;</span>, <span class="string">&#x27;/login&#x27;</span>];</span><br><span class="line">  <span class="comment">// 如果 跳转的目标 path 是登录页（看上面的路由设置 ）</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span> <span class="keyword">in</span> login_router) &#123;</span><br><span class="line">    <span class="comment">// 保存跳转到登录页之前的地址， 登录成功后跳转回该页</span></span><br><span class="line">    <span class="comment">// 回跳功能在 登录页 &quot;src/views/account/pages/Login.vue&quot; 实现</span></span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;preRoute&quot;</span>, router.<span class="property">currentRoute</span>.<span class="property">fullPath</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查跳转的目标路由是否需要登录(包含 meta: &#123;requiresAuth: true, &#125;,)</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">matched</span>.<span class="title function_">some</span>(<span class="function"><span class="params">record</span> =&gt;</span> record.<span class="property">meta</span>.<span class="property">requiresAuth</span>)) &#123;</span><br><span class="line">    <span class="comment">// 检查用户是否登录 </span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)) &#123;</span><br><span class="line">      <span class="title function_">next</span>(&#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">        <span class="attr">query</span>: &#123; <span class="attr">redirect</span>: to.<span class="property">fullPath</span> &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="网站首页的修改"><a href="#网站首页的修改" class="headerlink" title="网站首页的修改"></a>网站首页的修改</h1><p>打开文件： <code>src/views/home/Index.vue</code>， 将原来 <code>&lt;el-main&gt;</code> 标签中的文字删掉，并替换为 <code>&lt;router-view /&gt;</code> 用于显示匹配的子路由项对应的视图， 最终完成的代码如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">el-header</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 添加返回首页的链接 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Acme World APP<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span> <span class="attr">class</span>=<span class="string">&quot;m-2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">class</span>=<span class="string">&quot;m-2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-main</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 响应并显示匹配子路由的组件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-container</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 让最外层组件占满整个可见的高度 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#b3c0d1</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 交叉轴对齐方式：居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-main</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#e6e6e6</span>;    </span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.logo</span> <span class="selector-tag">a</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-decoration</span>: none;   </span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-left</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="显示论坛话题列表"><a href="#显示论坛话题列表" class="headerlink" title="显示论坛话题列表"></a>显示论坛话题列表</h1><p><code>src/views/home/pages/ToplicList.vue</code> 的代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span> <span class="attr">align</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:lg</span>=<span class="string">&quot;18&quot;</span> <span class="attr">:md</span>=<span class="string">&quot;20&quot;</span> <span class="attr">:sm</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;shadow&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">align</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;topic-title&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center&quot;</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">style</span>=<span class="string">&quot;width:100px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden-md-and-down&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">style</span>=<span class="string">&quot;width:100px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden-md-and-down&quot;</span>&gt;</span>评论<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">style</span>=<span class="string">&quot;width:290px; text-align:center;&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">class</span>=<span class="string">&quot;hidden-sm-and-down&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span>最后评论<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in topics&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">id</span>=<span class="string">&quot;topic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;topic-item&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span> <span class="attr">align</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; top: item.level &gt; 0 &#125;&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;item.level &gt; 0&quot;</span>&gt;</span>[置顶]<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span>[话题]<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;Detail&#x27;, params: &#123; id: item.id &#125; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">                                &gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">style</span>=<span class="string">&quot;width:100px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden-md-and-down&quot;</span>&gt;</span>&#123;&#123; item.views &#125;&#125;<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">style</span>=<span class="string">&quot;width:100px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden-md-and-down&quot;</span>&gt;</span>&#123;&#123; item.reply &#125;&#125;<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">style</span>=<span class="string">&quot;width:290px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden-sm-and-down&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; item.lastEditor.username &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">style</span>=<span class="string">&quot;color:#a0a0a0;font-size:14px;&quot;</span></span></span><br><span class="line"><span class="tag">                                &gt;</span>&#123;&#123; item.lastRepliedAt | datetimeFormat &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container pagination&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">background</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">size-change</span>=<span class="string">&quot;getTopics&quot;</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">current-change</span>=<span class="string">&quot;getTopics&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">layout</span>=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:total</span>=<span class="string">&quot;totalCount&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:page-sizes</span>=<span class="string">&quot;[5, 10, 20, 30]&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:page-size.sync</span>=<span class="string">&quot;pageSize&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:current-page.sync</span>=<span class="string">&quot;currentPage&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">TopicService</span> <span class="keyword">from</span> <span class="string">&#x27;../../../api/service/topic_service&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;TopicList&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">topics</span>: [],          <span class="comment">// 从服务器取回的一页数据 </span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">pageSize</span>: <span class="number">10</span>,        <span class="comment">// 每页大小</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">currentPage</span>: <span class="number">1</span>,      <span class="comment">// 当前页</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">totalCount</span>: <span class="number">0</span>,       <span class="comment">// 总记录数量</span></span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">getTopics</span>();    <span class="comment">// 获取论坛话题</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">getTopics</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">topics</span> = [];  <span class="comment">// 清空数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> skip = (<span class="variable language_">this</span>.<span class="property">currentPage</span> - <span class="number">1</span>) * <span class="variable language_">this</span>.<span class="property">pageSize</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 查询当前页的数据，</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">fetchAll</span>(<span class="variable language_">this</span>.<span class="property">pageSize</span>, skip, [<span class="string">&quot;createdBy&quot;</span>, <span class="string">&quot;lastEditor&quot;</span>], [<span class="string">&#x27;-level&#x27;</span>, <span class="string">&#x27;-lastRepliedAt&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> === <span class="string">&#x27;ok&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">totalCount</span> = response.<span class="property">totalCount</span>;   <span class="comment">// 总记录数</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 返回当前页所有数据的结果 </span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">topics</span> = response.<span class="property">reslut</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">toJson</span>(item) &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取用户中各个字段的值， 可以根据需要添加</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getUser</span>(<span class="params">user</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// console.log(user);</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: user.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: user.<span class="title function_">get</span>(<span class="string">&quot;username&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">email</span>: user.<span class="title function_">get</span>(<span class="string">&quot;email&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将从服务器端取到的数据不能直接使用，转为对象格式的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">toJson</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: item.<span class="property">id</span>,   <span class="comment">// leancloud Class 自带属性，对应 leanclud Class 中的 &quot;ObjectId&quot;, 可以用&quot;.id&quot;直接引用</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;title&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">content</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;content&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">views</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;views&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">reply</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;reply&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">level</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;level&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastRepliedAt</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;lastRepliedAt&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">createdAt</span>: item.<span class="property">createdAt</span>,  <span class="comment">// leancloud Class 自带属性,创建时间,不能修改值</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">updatedAt</span>: item.<span class="property">updatedAt</span>,   <span class="comment">// leancloud Class 自带属性,最后修改时间,只能leancloud 自动修改</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * createdBy、lastEditor 指向另一个表的字段, 默认只能得到该字段在关联表中的id 值</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * 要得到完整值， 查询时字段名要包含在 include 中，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * 取值时，要先判断是否为空，如果为空，取值会抛出异常，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 */</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">createdBy</span>: item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                    : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastEditor</span>: item.<span class="title function_">get</span>(<span class="string">&quot;lastEditor&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;lastEditor&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                    : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * 自定义用于局部区域显示 loading 的函数</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; targetNode  目标区域的选择器，建设使用 id 选择器</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@returns</span> </span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       */</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">showLoading</span>(<span class="params">targetNode, message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="title class_">Loading</span>.<span class="title function_">service</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 锁定屏幕的滚动</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lock</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 显示的文本</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">text</span>: message,</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// document.querySelector 用于以获取到对应 DOM 节点</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">target</span>: <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(targetNode),</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 停止显示 loading</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">endLoading</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span>.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 过滤器</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">filters</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 使用 moment.js 定义日期时间过滤器函数   </span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">datetimeFormat</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//  计算两个时间相差的天数</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> days = <span class="title function_">moment</span>(now).<span class="title function_">diff</span>(<span class="title function_">moment</span>(val), <span class="string">&#x27;days&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (days &lt;= <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 小于三天的返回格式：1小时前</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="title function_">moment</span>(val).<span class="title function_">fromNow</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 三天以上的返回日期时间</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="title function_">moment</span>(val).<span class="title function_">format</span>(<span class="string">&quot;lll&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 标题行的样式 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.topic-title</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#f1f4f8</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-top</span>: <span class="number">2px</span> solid <span class="number">#1985db</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#a0a0a0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 置顶话题的样式 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.top</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 置顶话题超链接的样式 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.top</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#2897c5</span> <span class="meta">!important</span> ;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.topic-item</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#ffffff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#a0a0a0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 隔行显示不同的背景颜色 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.topic-item</span><span class="selector-pseudo">:nth-child</span>(odd) &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#f1f4f8</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.topic-item</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333333</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-left</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 鼠标指向的行背景色 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.topic-item</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#b0d0fd</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.pagination</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-top</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-bottom</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 阴影 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.shadow</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">12px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ebeef5</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#303133</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transition</span>: <span class="number">0.3s</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/22/element-leancloud-project-X/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 X</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(八) - 论坛话题管理的实现</title>
      <link href="/2021/11/21/element-leancloud-project-VIII/"/>
      <url>/2021/11/21/element-leancloud-project-VIII/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="论坛话题的数据存储服务类"><a href="#论坛话题的数据存储服务类" class="headerlink" title="论坛话题的数据存储服务类"></a>论坛话题的数据存储服务类</h1><p>在 <code>src/api/service/</code> 文件夹下新建 <code>topic_service.js</code>, </p><p>打开文件 <code>src/api/service/topic_service.js</code>, 编辑其代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">BaseService</span> <span class="keyword">from</span> <span class="string">&#x27;./base_service&#x27;</span>;  <span class="comment">// 导入访问 leancloud 数据存储的基类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TABLE_NAME</span> = <span class="string">&#x27;Topic&#x27;</span>;    <span class="comment">// leancloud 中存储数据的表名(Class)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对leancloud应用中 名为 &quot;Topic&quot; 的 Class 进行数据操作的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TopicService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseService</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">table_name</span>) &#123;</span><br><span class="line">        <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">        <span class="variable language_">super</span>(table_name);</span><br><span class="line">        <span class="comment">// 当前子类的属性 this.TABLE_NAME</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">TABLE_NAME</span> = table_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出子类时使用 new 直接进行实例化</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">TopicService</span>(<span class="variable constant_">TABLE_NAME</span>);</span><br></pre></td></tr></table></figure><h1 id="添加新话题"><a href="#添加新话题" class="headerlink" title="添加新话题"></a>添加新话题</h1><p>打开文件 <code>src/views/dashboard/forum/TopicManager.vue</code>, 编辑其代码如以下内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>以下是一些对象的内置属性，会在对象保存时自动创建，无需手动指定</p><table><thead><tr><th>内置属性</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>objectId</td><td>String</td><td>该对象唯一的 ID 标识。</td></tr><tr><td>ACL</td><td>AV.ACL</td><td>该对象的权限控制，实际上是一个 JSON 对象，控制台做了展现优化。</td></tr><tr><td>createdAt</td><td>Date</td><td>该对象被创建的时间。</td></tr><tr><td>updatedAt</td><td>Date</td><td>该对象最后一次被修改的时间。</td></tr></tbody></table><h1 id="显示论坛话题列表"><a href="#显示论坛话题列表" class="headerlink" title="显示论坛话题列表"></a>显示论坛话题列表</h1><h1 id="编辑论坛话题"><a href="#编辑论坛话题" class="headerlink" title="编辑论坛话题"></a>编辑论坛话题</h1><h1 id="删除一个话题"><a href="#删除一个话题" class="headerlink" title="删除一个话题"></a>删除一个话题</h1><h1 id="批量删除选中的话题"><a href="#批量删除选中的话题" class="headerlink" title="批量删除选中的话题"></a>批量删除选中的话题</h1><h1 id="数据分页"><a href="#数据分页" class="headerlink" title="数据分页"></a>数据分页</h1><h1 id="话题管理的最终代码"><a href="#话题管理的最终代码" class="headerlink" title="话题管理的最终代码"></a>话题管理的最终代码</h1><p><code>src/views/dashboard/forum/TopicManager.vue</code>最终完成的完整代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;always&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;header&quot;</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container align-center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;header-text&quot;</span>&gt;</span>论坛话题管理<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-divider</span> <span class="attr">direction</span>=<span class="string">&quot;vertical&quot;</span> <span class="attr">class</span>=<span class="string">&quot;header-text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:disabled</span>=<span class="string">&quot;selected.length &lt;= 0&quot;</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">click</span>=<span class="string">&quot;deleteSelected&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span>批量删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;medium&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;dialog = true&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    添加新话题</span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:data</span>=<span class="string">&quot;topics&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-loading</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">selection-change</span>=<span class="string">&quot;mutilSelectionChange&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">stripe</span></span></span><br><span class="line"><span class="tag">                <span class="attr">border</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;selection&quot;</span> <span class="attr">width</span>=<span class="string">&quot;35&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;title&quot;</span> <span class="attr">label</span>=<span class="string">&quot;话题&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;level&quot;</span> <span class="attr">label</span>=<span class="string">&quot;排序值&quot;</span> <span class="attr">width</span>=<span class="string">&quot;70&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;查看/评论&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; scope.row.views &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        /</span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; scope.row.reply &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;作者&quot;</span> <span class="attr">width</span>=<span class="string">&quot;170&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 用户名不存在时，显示会出错，所以要先判断 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;scope.row.createdBy&quot;</span>&gt;</span>&#123;&#123; scope.row.createdBy.username &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; scope.row.createdAt | datetimeFormat &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;最后修改&quot;</span> <span class="attr">width</span>=<span class="string">&quot;170&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 用户名不存在时，显示会出错，所以要先判断 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; scope.row.lastEditor.username &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; scope.row.updatedAt | datetimeFormat &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">size</span>=<span class="string">&quot;medium&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">title</span>=<span class="string">&quot;编辑&quot;</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">click</span>=<span class="string">&quot;editItem(scope.row)&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-pencil-square-o fa-lg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:blue; &quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">size</span>=<span class="string">&quot;medium&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">title</span>=<span class="string">&quot;删除&quot;</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">click</span>=<span class="string">&quot;deleteItem(scope.row)&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-trash-o fa-lg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:red; &quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">background</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">size-change</span>=<span class="string">&quot;getTopics&quot;</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">current-change</span>=<span class="string">&quot;getTopics&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">layout</span>=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:total</span>=<span class="string">&quot;totalCount&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:page-sizes</span>=<span class="string">&quot;[5, 10, 20, 30]&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:page-size.sync</span>=<span class="string">&quot;pageSize&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:current-page.sync</span>=<span class="string">&quot;currentPage&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 添加和修改话题的对话框  开始 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-dialog</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:visible.sync</span>=<span class="string">&quot;dialog&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">width</span>=<span class="string">&quot;80%&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:close-on-click-modal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:fullscreen</span>=<span class="string">&quot;fullscreen&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;fullscreen = true&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;!fullscreen&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-square-o&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 20px;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;最大化&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;fullscreen = false&quot;</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-clone&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 20px;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;还原&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;dialog-title mx-2&quot;</span>&gt;</span>&#123;&#123; formTitle &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;always&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">label-position</span>=<span class="string">&quot;top&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- :gutter=&quot;20&quot; 同一行内，两列之间的间隔 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:md</span>=<span class="string">&quot;24 - formCols&quot;</span> <span class="attr">:sm</span>=<span class="string">&quot;24&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;editedIndex !== -1&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;手工排序值&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">v-model</span>=<span class="string">&quot;editedItem.level&quot;</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">controls-position</span>=<span class="string">&quot;right&quot;</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">:max</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">label</span>=<span class="string">&quot;Level&quot;</span></span></span><br><span class="line"><span class="tag">                                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:md</span>=<span class="string">&quot;formCols&quot;</span> <span class="attr">:sm</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;标题&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">v-model</span>=<span class="string">&quot;editedItem.title&quot;</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">placeholder</span>=<span class="string">&quot;标题&quot;</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">maxlength</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">show-word-limit</span></span></span><br><span class="line"><span class="tag">                                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;话题内容(支持 Markdown 语法)&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">v-model</span>=<span class="string">&quot;editedItem.content&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:rows</span>=<span class="string">&quot;row&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">placeholder</span>=<span class="string">&quot;话题内容&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;dialog = false&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;saveItem&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">TopicService</span> <span class="keyword">from</span> <span class="string">&#x27;../../../api/service/topic_service&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;   <span class="comment">// 日期时间处理</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;TopicManager&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">topics</span>: [],          <span class="comment">// 从服务器取回的一页数据 </span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dialog</span>: <span class="literal">false</span>,       <span class="comment">// 显示添加和修改对话框    </span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">fullscreen</span>: <span class="literal">false</span>,   <span class="comment">// 对话框全屏</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">loading</span>: <span class="literal">false</span>,      <span class="comment">// 是否显示加载动画</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">pageSize</span>: <span class="number">10</span>,        <span class="comment">// 每页大小</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">currentPage</span>: <span class="number">1</span>,      <span class="comment">// 当前页</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">totalCount</span>: <span class="number">0</span>,       <span class="comment">// 总记录数量</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">totalPage</span>: <span class="number">1</span>,        <span class="comment">// 总页数</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">selected</span>: [],        <span class="comment">// 选中的行</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">editedIndex</span>: -<span class="number">1</span>,     <span class="comment">// 添加 或 修改 的标志；-1表示添加，否则为当前编辑项在 categories 中的索引</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加或修改绑定到对话框上的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">editedItem</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: <span class="string">&quot;&quot;</span>,      <span class="comment">// 话题的标题</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">content</span>: <span class="string">&quot;&quot;</span>,    <span class="comment">// 话题的内容</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">level</span>: <span class="number">0</span>,       <span class="comment">// 手动排序值</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">views</span>: <span class="number">0</span>,       <span class="comment">// 查看次数</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">reply</span>: <span class="number">0</span>,       <span class="comment">// 评论数</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 用于添加或修改结束后，还原 editedItem 的初始值       </span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">defaultItem</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: <span class="string">&quot;&quot;</span>,      <span class="comment">// 话题的标题</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">content</span>: <span class="string">&quot;&quot;</span>,    <span class="comment">// 话题的内容</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">level</span>: <span class="number">0</span>,       <span class="comment">// 手动排序值</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">views</span>: <span class="number">0</span>,       <span class="comment">// 查看次数</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">reply</span>: <span class="number">0</span>,       <span class="comment">// 评论数</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">getTopics</span>();    <span class="comment">// 获取论坛话题</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">getTopics</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">topics</span> = [];  <span class="comment">// 清空数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> skip = (<span class="variable language_">this</span>.<span class="property">currentPage</span> - <span class="number">1</span>) * <span class="variable language_">this</span>.<span class="property">pageSize</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 查询当前页的数据，</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">fetchAll</span>(<span class="variable language_">this</span>.<span class="property">pageSize</span>, skip, [<span class="string">&quot;createdBy&quot;</span>, <span class="string">&quot;lastEditor&quot;</span>], [<span class="string">&#x27;-level&#x27;</span>, <span class="string">&#x27;-updatedAt&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> === <span class="string">&#x27;ok&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">totalCount</span> = response.<span class="property">totalCount</span>;   <span class="comment">// 总记录数</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 返回当前页所有数据的结果 </span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">topics</span> = response.<span class="property">reslut</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">toJson</span>(item) &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">saveItem</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this.editedIndex：&#x27;</span>, <span class="variable language_">this</span>.<span class="property">editedIndex</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">editedIndex</span> === -<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                * 这里是添加新话题时保存数据， 以 this.editedItem 为添加到 leancloud 的基础， 并添加三个属性</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                */</span></span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 添加一个创建者的属性</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">editedItem</span>.<span class="property">createdBy</span> = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">currentUser</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 添加一个最后修改者的属性</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">editedItem</span>.<span class="property">lastEditor</span> = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">currentUser</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 添加一个最后回复时间的属性</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">editedItem</span>.<span class="property">lastRepliedAt</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 标题去掉前后空格</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">editedItem</span>.<span class="property">title</span> = <span class="variable language_">this</span>.<span class="property">editedItem</span>.<span class="property">title</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">editedItem</span>.<span class="property">title</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 向服务器添加一条记录</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">create</span>(<span class="variable language_">this</span>.<span class="property">editedItem</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (response) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 新增的记录添加到话题列表的前面</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="property">topics</span>.<span class="title function_">unshift</span>(<span class="variable language_">this</span>.<span class="title function_">toJson</span>(response));</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 将结果按照 level 重新排序</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="property">topics</span>.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">return</span> b.<span class="property">level</span> - a.<span class="property">level</span>;</span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 添加新记录后总数超过一页大小</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">topics</span>.<span class="property">length</span> &gt; <span class="variable language_">this</span>.<span class="property">pageSize</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">topics</span>.<span class="title function_">pop</span>();  <span class="comment">// 移除最后一个</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// 使用 message 通知 </span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">message</span>: <span class="string">`已经成功添加一个话题: <span class="subst">$&#123;<span class="variable language_">this</span>.editedItem.title&#125;</span>`</span>,     <span class="comment">// 消息内容</span></span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="property">dialog</span> = <span class="literal">false</span>;   <span class="comment">// 关闭对话框</span></span></span><br><span class="line"><span class="language-javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">message</span>: <span class="string">&#x27;标题不能为空&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// this.editedIndex 不等于 -1, 表示进行修改操作，其值为被修改项在数组中的索引</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// Object.assign()复制对象，第二个参数中的同名属性的值会覆盖第一个参数中对应的属性</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> item = <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>.<span class="property">topics</span>[<span class="variable language_">this</span>.<span class="property">editedIndex</span>], <span class="variable language_">this</span>.<span class="property">editedItem</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">update</span>(item.<span class="property">id</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: item.<span class="property">title</span>,           <span class="comment">// 修改后的标题                </span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">content</span>: item.<span class="property">content</span>,       <span class="comment">// 修改后的话题内容</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">level</span>: <span class="title class_">Number</span>(item.<span class="property">level</span>),   <span class="comment">// 修改后的level， 要转为数字类型</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lastEditor</span>: <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">currentUser</span>(),  <span class="comment">// 最后修改者为当前用户</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (response) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">topics</span>[<span class="variable language_">this</span>.<span class="property">editedIndex</span>].<span class="property">updatedAt</span> = response.<span class="property">updatedAt</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 将结果按照 level 重新排序</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">topics</span>.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> b.<span class="property">level</span> - a.<span class="property">level</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: <span class="string">&#x27;论坛话题编辑成功&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">dialog</span> = <span class="literal">false</span>;   <span class="comment">// 关闭对话框</span></span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: <span class="string">&#x27;出现错误, 无法完成论坛话题修改&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 显示编辑对话框</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">editItem</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 查找 被 编辑项的索引值</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">editedIndex</span> = <span class="variable language_">this</span>.<span class="property">topics</span>.<span class="title function_">indexOf</span>(item);</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// Object.assign() 用于将源对象复制到目标对象</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 因为直接用等号赋值，这两个变量操作的是同一个内存地址</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">editedItem</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, item);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">dialog</span> = <span class="literal">true</span>;  <span class="comment">// 显示编辑对话框</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 删除单条记录</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">deleteItem</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.$confirm(<span class="string">`确定要删除标题为：&quot;<span class="subst">$&#123;item.title&#125;</span>&quot; 的话题吗？`</span>, <span class="string">&#x27;删除话题&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;).<span class="title function_">then</span>(<span class="title function_">async</span> () =&gt; &#123;  <span class="comment">// .then()  里面的匿名函数前要加  async                 </span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 在服务器端执行删除操作</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">delete</span>(item.<span class="property">id</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (response) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="title function_">getTopics</span>();  <span class="comment">// 重新载入数据 </span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: <span class="string">&#x27;删除成功!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 删除选中的多条记录</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">deleteSelected</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.$confirm(<span class="string">`确定要删除已选中的 <span class="subst">$&#123;<span class="variable language_">this</span>.selected.length&#125;</span> 个话题吗？`</span>, <span class="string">&#x27;批量删除话题&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;).<span class="title function_">then</span>(<span class="title function_">async</span> () =&gt; &#123;     <span class="comment">// .then()  里面的匿名函数前要加  async </span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 在服务器端执行删除操作</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">deleteBatch</span>(<span class="variable language_">this</span>.<span class="property">selected</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (response) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="title function_">getTopics</span>();  <span class="comment">// 重新载入数据 </span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: <span class="string">`成功删除选中的 <span class="subst">$&#123;<span class="variable language_">this</span>.selected.length&#125;</span> 个话题!`</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">selected</span> = [];  <span class="comment">// 清空已选中的对象</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 用于表格多选框取值的函数</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">mutilSelectionChange</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">selected</span> = val;   <span class="comment">// 保存选中的行</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;mutilSelectionChange:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">selected</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取用户中各个字段的值， 可以根据需要添加</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getUser</span>(<span class="params">user</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// console.log(user);</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: user.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: user.<span class="title function_">get</span>(<span class="string">&quot;username&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">email</span>: user.<span class="title function_">get</span>(<span class="string">&quot;email&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将从服务器端取到的数据不能直接使用，转为对象格式的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">toJson</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: item.<span class="property">id</span>,   <span class="comment">// leancloud Class 自带属性，对应 leanclud Class 中的 &quot;ObjectId&quot;, 可以用&quot;.id&quot;直接引用</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;title&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">content</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;content&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">views</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;views&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">reply</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;reply&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">level</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;level&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastRepliedAt</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;lastRepliedAt&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">createdAt</span>: item.<span class="property">createdAt</span>,  <span class="comment">// leancloud Class 自带属性,创建时间,不能修改值</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">updatedAt</span>: item.<span class="property">updatedAt</span>,   <span class="comment">// leancloud Class 自带属性,最后修改时间,只能leancloud 自动修改</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * createdBy、lastEditor 指向另一个表的字段, 默认只能得到该字段在关联表中的id 值</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * 要得到完整值， 查询时字段名要包含在 include 中，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * 取值时，要先判断是否为空，如果为空，取值会抛出异常，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 */</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">createdBy</span>: item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                    : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastEditor</span>: item.<span class="title function_">get</span>(<span class="string">&quot;lastEditor&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;lastEditor&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                    : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 关闭对话框时，要重置相关变量</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">closeDialog</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">dialog</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fullscreen</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// this.$nextTick()将回调延迟到下次 DOM 更新循环之后执行</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">editedItem</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="variable language_">this</span>.<span class="property">defaultItem</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">editedIndex</span> = -<span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 计算属性</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加或修改对话框的标题</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">formTitle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">editedIndex</span> === -<span class="number">1</span> ? <span class="string">&quot;添加新话题&quot;</span> : <span class="string">&quot;话题编辑&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加或修改对话框中 标题 文本框的宽度</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">formCols</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 添加时不用显示 Level，Title 宽度为 24</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 修改时需要显示 Level，Title 宽度为 21</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">editedIndex</span> === -<span class="number">1</span> ? <span class="number">24</span> : <span class="number">21</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 多行文本框的行数</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">row</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 全屏状态时多行文本框 15 行，非全屏时 5行</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">fullscreen</span> ? <span class="number">15</span> : <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 过滤器</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">filters</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">datetimeFormat</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 使用 moment.js 定义日期时间过滤器函数   </span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="title function_">moment</span>(val).<span class="title function_">format</span>(<span class="string">&quot;lll&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 观察属性， 函数名为变量名，当该变量值有变化时，触发函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 监控变量 dialog, 当对话框关闭时，还原对话框相关的初始值 </span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">dialog</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 相当于 if 语句的简化写法</span></span></span><br><span class="line"><span class="language-javascript">            val || <span class="variable language_">this</span>.<span class="title function_">closeDialog</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.align-center</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/21/element-leancloud-project-IX/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 IX</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(七) - LeanCloud 数据存储和路由守卫的使用</title>
      <link href="/2021/11/20/element-leancloud-project-VII/"/>
      <url>/2021/11/20/element-leancloud-project-VII/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="LeanCloud-数据存储"><a href="#LeanCloud-数据存储" class="headerlink" title="LeanCloud 数据存储"></a>LeanCloud 数据存储</h1><h2 id="LeanCloud-数据存储-的两种-Class"><a href="#LeanCloud-数据存储-的两种-Class" class="headerlink" title="LeanCloud 数据存储 的两种 Class"></a>LeanCloud 数据存储 的两种 Class</h2><p>LeanCloud 数据存储的 Class 有两种，一种是创建应用时就自带的，这一种Class的名字以 下划线开头，可以在这些 Class 中添加字段， 但一般不要删除；<br>另一种是用户自己创建的 Class，可以由用户自定义需要的字段， 同时，自定义的每个 Class 还会有四个系统自带的字段：<code>objectId</code>, <code>ACL</code>, <code>createdAt</code>, <code>updatedAt</code>， 说明如下：</p><ul><li><p><code>objectId</code>: 主键字段，实际使用时，可以通过 <code>类名.id</code> 获取值；</p></li><li><p><code>ACL</code>: 访问控制列表, 用于权限管理开发，免费用户不可用；</p></li><li><p><code>createdAt</code>: 记录创建时间，添加记录时自动产生，不能更改；</p></li><li><p><code>updatedAt</code>: 记录更新时间，记录有更新时自动修改，不能由用户进行修改；</p></li></ul><h2 id="在数据存储中创建-Class"><a href="#在数据存储中创建-Class" class="headerlink" title="在数据存储中创建 Class"></a>在数据存储中创建 Class</h2><p>在数据存储中创建 Class 有两个方法：</p><p>方法一：在 <code>LeanCloud</code> 数据存储 的管理界面 <code>手工</code> 添加 <code>Class</code>, 然后再逐个添加字段（也可以从一个 数据存储 中导出 <code>Class</code>, 然后到另一个应用中导入）；</p><p>方法二：直接在程序中创建一个 JSON 格式的数据，通过 <code>LeanStorage 数据存储</code> SDK 保存， <code>LeanCloud</code> 服务器端即可根据<code>JSON</code>数据格式自动添加 <code>Class</code>,　以及添加 <code>Class</code> 中没有的字段。 总的来说，我现在比较喜欢用这一种方法。</p><h1 id="通用的数据存储服务类"><a href="#通用的数据存储服务类" class="headerlink" title="通用的数据存储服务类"></a>通用的数据存储服务类</h1><p>除了创建 <code>LeanCloud</code> 应用时系统自动的 Class 以外，其他用户自行添加的 Class 进行查、改、增、删 时执行的操作都是类似的，所以可以定义一个通用的数据存储服务基类，然后每个 Class 再继承这个基类，就可以实现大部分代码共用了。</p><p>在 <code>src/api/service/</code> 文件夹下添加文件：<code>base_service.js</code>。</p><p>打开文件 <code>src/api/service/base_service.js</code>, 编辑其代码如下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;  <span class="comment">// 导入 leancloud 数据存储模块</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Leancloud 数据存储的基类</span></span><br><span class="line"><span class="comment"> * 所有函数使用 async/await 实现异步操作</span></span><br><span class="line"><span class="comment"> * 虽然有个别函数不需要使用异步，但调用时难以区分，所以就全部都加上异步了</span></span><br><span class="line"><span class="comment"> * 调用时，函数名前面一定要加上 await， 否则得不到正确的结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; table_name </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">table_name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">TABLE_NAME</span> = table_name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     获取所有数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; limit 每页记录数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; skip 跳过记录数    </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; include 关联到其他 Class 的字段名，例如: &#x27;createdBy&#x27;, &#x27;lastEditor&#x27;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; sort_fields 降序排列的排序字段名列表，例如：[&#x27;-level&#x27;, &#x27;-updatedAt&#x27;]， 降序的字段名前面加负号</span></span><br><span class="line"><span class="comment">     * sort_fields 和 include 的默认值都是： []， 只包含一个字段时也要加： []</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchAll</span>(<span class="params">limit = <span class="number">10</span>, skip = <span class="number">0</span>, include = [], sort_fields = []</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">            <span class="keyword">if</span> (include[<span class="number">0</span>]) &#123;</span><br><span class="line">                <span class="comment">// 关联查询其他表</span></span><br><span class="line">                query.<span class="title function_">include</span>(include);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断是否包含排序的字段名</span></span><br><span class="line">            <span class="keyword">if</span> (sort_fields.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sort_fields.<span class="property">length</span>; i++) &#123; </span><br><span class="line">                    <span class="comment">// 多字段排序时， 第一个排序字段 和之后用的方法名不同</span></span><br><span class="line">                    <span class="keyword">if</span> (i === <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isMinus</span>(sort_fields[<span class="number">0</span>])) &#123;                            </span><br><span class="line">                            <span class="comment">// 去掉负号后的字段名降序</span></span><br><span class="line">                            query.<span class="title function_">descending</span>(sort_fields[<span class="number">0</span>].<span class="title function_">substr</span>(<span class="number">1</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            query.<span class="title function_">ascending</span>(sort_fields[<span class="number">0</span>]);  <span class="comment">// 升序</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 第二个及以后的排序字段和第一个字段调用的方法不一样</span></span><br><span class="line">                        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isMinus</span>(sort_fields[i])) &#123;                            </span><br><span class="line">                            <span class="comment">// 去掉负号后的字段名降序</span></span><br><span class="line">                            query.<span class="title function_">addDescending</span>(sort_fields[i].<span class="title function_">substr</span>(<span class="number">1</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            query.<span class="title function_">addAscending</span>(sort_fields[i]);  <span class="comment">// 升序</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> total = <span class="keyword">await</span> query.<span class="title function_">count</span>();   <span class="comment">// 记录总数           </span></span><br><span class="line">            <span class="comment">// 分页查询的结果 </span></span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">limit</span>(limit).<span class="title function_">skip</span>(skip).<span class="title function_">find</span>();</span><br><span class="line">            <span class="comment">// 返回的查询结果由三个部分组成;</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;status_code&quot;</span>: <span class="string">&quot;ok&quot;</span>,  <span class="comment">// 返回结果中的状态码</span></span><br><span class="line">                <span class="string">&quot;totalCount&quot;</span>: total,  <span class="comment">// 记录总数</span></span><br><span class="line">                <span class="string">&quot;reslut&quot;</span>: response,   <span class="comment">// 返回的记录</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查询数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;status_code&quot;</span>: e.<span class="property">code</span>,</span><br><span class="line">                <span class="string">&quot;totalCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">&quot;reslut&quot;</span>: e,</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; data 以对象形式提供的数据 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> 创建成功的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">create</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="title class_">Collection</span> = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">extend</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">            <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="title class_">Collection</span>(data);</span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">save</span>();</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; id 记录的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; data 除 id 以外的其他字段组成的对象类型数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">update</span>(<span class="params">id, data</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> query = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>, id);</span><br><span class="line">            query.<span class="title function_">set</span>(data);  <span class="comment">// 修改数据</span></span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">save</span>();</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;修改数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量修改数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; items 包含待更新值的记录数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">updateBatch</span>(<span class="params">items</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;items:&#x27;</span>, items);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// map遍历数组，由返回值组成一个新数组, 原数组不变</span></span><br><span class="line">            <span class="keyword">let</span> id_list = items.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123; <span class="keyword">return</span> item.<span class="property">id</span> &#125;);</span><br><span class="line">            <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> query</span><br><span class="line">                .<span class="title function_">containedIn</span>(<span class="string">&#x27;objectId&#x27;</span>, id_list)</span><br><span class="line">                .<span class="title function_">find</span>();</span><br><span class="line">            <span class="comment">// map() 遍历数组，不改变原数组</span></span><br><span class="line">            <span class="keyword">let</span> result = response.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> data = items.<span class="title function_">find</span>(<span class="function"><span class="params">it</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;update batch:&#x27;</span>, it);</span><br><span class="line">                    <span class="keyword">return</span> it.<span class="property">id</span> === item.<span class="property">id</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// console.log(&#x27;update batch:&#x27;, data);             </span></span><br><span class="line">                item.<span class="title function_">set</span>(data);</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">saveAll</span>(result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;批量修改数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; id </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> query = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>, id);</span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除，先按 id 查询出所删除的数据，再调用destroyAll() 进行删除</span></span><br><span class="line"><span class="comment">     * 其他批量操作类似</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; items 待删除记录的数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">deleteBatch</span>(<span class="params">items</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 从要删除的记录中取出 id 值，组成一个新数组</span></span><br><span class="line">            <span class="keyword">let</span> id_list = items.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123; <span class="keyword">return</span> item.<span class="property">id</span> &#125;);</span><br><span class="line">            <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">            <span class="comment">// 根据多个 id 组成的数组查询符合条件的记录</span></span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> query</span><br><span class="line">                .<span class="title function_">containedIn</span>(<span class="string">&#x27;objectId&#x27;</span>, id_list)</span><br><span class="line">                .<span class="title function_">destroyAll</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;deleteBatch:&#x27;</span>, response)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;批量删除数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查指定的字段值是否已经存在, 字母区分大小写</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; field 字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; val 字段值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> 字段值已存在，返回 true， 否则返回 false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">existsFieldValue</span>(<span class="params">field = <span class="string">&#x27;title&#x27;</span>, val</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">            <span class="keyword">let</span> count = <span class="keyword">await</span> query.<span class="title function_">equalTo</span>(field, val).<span class="title function_">count</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(count);</span><br><span class="line">            <span class="keyword">return</span> count &gt; <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查询错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前已登录用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> 返回当前已登录用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">currentUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable constant_">LC</span>.<span class="property">User</span>.<span class="title function_">current</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断字符串是不是负号开头, 以便确定是升序还是降序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; val </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> 负号：true; 非负号： false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">isMinus</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val[<span class="number">0</span>] === <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">BaseService</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>LeanCloud 数据存储的基类创建完毕等待应用。</p><h1 id="路由守卫的使用"><a href="#路由守卫的使用" class="headerlink" title="路由守卫的使用"></a>路由守卫的使用</h1><p>后台管理（仪表盘）一般来说，都要求用户成功登录后才能访问，但在之前的代码中，并没有做这样的限制， 所以任何人都可以直接进入后台管理。</p><p>这里使用 <code>vue router</code> 的<code>路由守卫</code>来实现进入后台管理的权限验证</p><p>打开文件 <code>src/router/index.js</code>， 给后台管理的的<code>父路由项</code>添加路由元信息 <code>meta: &#123; requiresAuth: true &#125;,</code> , 同时添加相应的路由守卫。修改其如以下代码:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/home/Index.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/account&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/login&#x27;</span>,   </span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/Index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,  </span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/Login.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/signup&#x27;</span>,  </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;SignUp&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/SignUp.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/password_reset&#x27;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;PasswordReset&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/PasswordReset.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/dashboard/Index.vue&#x27;</span>),</span><br><span class="line">    <span class="comment">// 添加路由元信息 meta: &#123; requiresAuth: true, &#125; 用于标识进入该路由必须登录 </span></span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,       </span><br><span class="line">        <span class="attr">alias</span>: <span class="string">&#x27;index&#x27;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,  </span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/pages/MainIndex.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;topic_manager&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;TopicManager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/forum/TopicManager.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;comment_manager&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;CommentManager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/forum/CommentManager.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用路由守卫,具体内容见官方文档：https://router.vuejs.org/zh/guide/advanced/meta.html</span></span><br><span class="line"><span class="comment">// 特别注意事项：确保 router.beforeEach 中只有一个 next() 会被执行</span></span><br><span class="line"><span class="comment">// 如果有多个 next() 被执行，将会出现重复路由的异常</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> login_router = [<span class="string">&#x27;/account&#x27;</span>, <span class="string">&#x27;/login&#x27;</span>];</span><br><span class="line">  <span class="comment">// 如果 跳转的目标 path 是登录页（看上面的路由设置 ）</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span> <span class="keyword">in</span> login_router) &#123;</span><br><span class="line">      <span class="comment">// 保存跳转到登录页之前的地址， 登录成功后跳转回该页</span></span><br><span class="line">      <span class="comment">// 回跳功能在 登录页 &quot;src/views/account/pages/Login.vue&quot; 实现</span></span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;preRoute&quot;</span>, router.<span class="property">currentRoute</span>.<span class="property">fullPath</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查跳转的目标路由是否需要登录(包含 meta: &#123;requiresAuth: true, &#125;,)</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">matched</span>.<span class="title function_">some</span>(<span class="function"><span class="params">record</span> =&gt;</span> record.<span class="property">meta</span>.<span class="property">requiresAuth</span>)) &#123;</span><br><span class="line">      <span class="comment">// 检查用户是否登录 </span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)) &#123;</span><br><span class="line">          <span class="title function_">next</span>(&#123;</span><br><span class="line">              <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">              <span class="attr">query</span>: &#123; <span class="attr">redirect</span>: to.<span class="property">fullPath</span> &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">next</span>();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure><p><code>路由守卫</code> 通过 <code>路由元信息</code> 判断该路由项是否需要登录后才能访问，如果需要，但当前没有已登录用户，则自动跳转到 登录界面，登录成功后，返回之前的页面（返回前一页在登录页实现，之前完成的登录页已经包含相应代码）</p><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/21/element-leancloud-project-VIII/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 VIII</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(六) - 实现用户注册、登录、找回密码</title>
      <link href="/2021/11/20/element-leancloud-project-VI/"/>
      <url>/2021/11/20/element-leancloud-project-VI/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="Leancloud-数据存储"><a href="#Leancloud-数据存储" class="headerlink" title="Leancloud 数据存储"></a>Leancloud 数据存储</h1><p><code>LeanCloud</code>（原 AVOS Cloud） 是针对移动应用的一站式云端服务，专注于为应用开发者提供工具和平台。提供包括<code>LeanStorage 数据存储</code>、<code>LeanMessage 通信服务</code>、<code>LeanAnalytics 统计分析</code>、<code>LeanModules 拓展模块</code>等四大类型的后端云服务。当前项目使用了<code>LeanStorage 数据存储</code>来实现论坛数据的保存。</p><h2 id="Leancloud-SDK-的初始化配置信息"><a href="#Leancloud-SDK-的初始化配置信息" class="headerlink" title="Leancloud SDK 的初始化配置信息"></a><code>Leancloud SDK</code> 的初始化配置信息</h2><p><code>LeanCloud</code> 国内默认的是<code>华北节点</code>，但是去年华北节点的文件服务器因为某些原因，出现了域名服务方面的问题。导致文件可以上传，但是没办法访问，所以这里建设使用 <code>华东节点</code>。</p><p>登录 <a href="https://console-e1.leancloud.cn/login">Leancloud华东节点</a> （没有账号的请先注册），然后创建应用，应用名称自己取，操作类似下图:</p><img src="/2021/11/20/element-leancloud-project-VI/001.png" class="" title="leancloud"><p>应用创建成功后，点击该应用最左边的 <code>数据存储</code> 图标，进入应用管理界面，如下图：</p><img src="/2021/11/20/element-leancloud-project-VI/002.png" class="" title="leancloud"><p>在右侧菜单选择：<code>设置</code> -&gt; <code>应用凭证</code>, 即可看到当前应用的 <code>AppID</code>, <code>AppKey</code>, <code>REST API服务器地址 </code>等初始化 <code>Leancloud SDK </code>所需要的信息，如下图:</p><img src="/2021/11/20/element-leancloud-project-VI/003.png" class="" title="leancloud"><p>请将上图中的 <code>AppID</code>, <code>AppKey</code>, <code>REST API服务器地址 </code> （画圈、打勾的那三个）信息复制后，粘贴到 <code>src/api/config/lc.config.js</code> 文件中完成初始化信息配置。</p><h2 id="Leancloud-SDK-数据存储"><a href="#Leancloud-SDK-数据存储" class="headerlink" title="Leancloud SDK 数据存储"></a><code>Leancloud SDK</code> 数据存储</h2><p>在 <code>Leancloud</code> 应用管理界面选择：<code>数据存储</code> -&gt; <code>结构化数据</code>，  列表显示当前应用以下划线开头的内置的<code>Class</code>, leancloud 的每一个 Class 就相当于数据库的一个表。</p><p>名为 <code>_User</code> 的内置 <code>Class</code> 用于保存用户信息的， 除了原来的字段，我们也可以添加更多的字段如：头像、昵称等。</p><img src="/2021/11/20/element-leancloud-project-VI/004.png" class="" title="leancloud"><h2 id="账号服务类"><a href="#账号服务类" class="headerlink" title="账号服务类"></a>账号服务类</h2><p>在 <code>src/api/</code> 文件夹下新建一个名为 <code>service</code> 的文件夹，并在该文件夹中添加文件：<code>account_service.js</code>。</p><p>打开新建的 <code>src/api/service/account_service.js</code>, 编辑其代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;  <span class="comment">// 导入 leancloud 数据存储模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账号管理的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册新用户账号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; username </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; password </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; email </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> 注册返回的状态码： 202: &quot;用户名已被注册&quot;, 203: &quot;邮箱已被注册&quot;, &quot;-1&quot;: &quot;无法连接到服务器&quot;</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">signUp</span>(<span class="params">username, password, email = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> user = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">User</span>();</span><br><span class="line">            user.<span class="title function_">setUsername</span>(username);</span><br><span class="line">            user.<span class="title function_">setPassword</span>(password);</span><br><span class="line">            <span class="comment">// 添加一个 昵称 字段，默认为用户名</span></span><br><span class="line">            user.<span class="title function_">set</span>(<span class="string">&#x27;nickname&#x27;</span>, username);</span><br><span class="line">            <span class="keyword">if</span> (email) &#123;</span><br><span class="line">                user.<span class="title function_">setEmail</span>(email);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> user.<span class="title function_">signUp</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;注册账号成功：&#x27;</span>, response);</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;status_code&quot;</span>: <span class="string">&quot;ok&quot;</span>,   <span class="comment">// 注册状态码</span></span><br><span class="line">                <span class="string">&quot;user&quot;</span>: response,    <span class="comment">// 用户</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;注册账号失败：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="comment">// 注册返回的状态码： 202: &quot;用户名已被注册&quot;, 203: &quot;邮箱已被注册&quot;, &quot;-1&quot;: &quot;无法连接到服务器&quot;</span></span><br><span class="line">                <span class="string">&quot;status_code&quot;</span>: e.<span class="property">code</span>,   <span class="comment">// 注册状态码</span></span><br><span class="line">                <span class="string">&quot;user&quot;</span>: <span class="literal">null</span>,    <span class="comment">// 注册失败，返回用户为 null</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登录 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; username </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; password </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span>  登录状态代码 和用户</span></span><br><span class="line"><span class="comment">     *  200: 登录成功</span></span><br><span class="line"><span class="comment">     *  210: 密码错误； </span></span><br><span class="line"><span class="comment">     *  211：用户不存在, </span></span><br><span class="line"><span class="comment">     *  219: 重试次数太多</span></span><br><span class="line"><span class="comment">     *  -1 : 请求被终止，一般是网络有问题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">logIn</span>(<span class="params">username, password</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> user = <span class="keyword">await</span> <span class="variable constant_">LC</span>.<span class="property">User</span>.<span class="title function_">logIn</span>(username, password);</span><br><span class="line">            <span class="keyword">if</span> (user) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;登录成功:&#x27;</span>, user);</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&quot;status_code&quot;</span>: <span class="string">&quot;ok&quot;</span>,   <span class="comment">// 登录状态码</span></span><br><span class="line">                    <span class="string">&quot;user&quot;</span>: user,    <span class="comment">// 用户</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="comment">// e.code</span></span><br><span class="line">            <span class="comment">// 210: 密码错误； </span></span><br><span class="line">            <span class="comment">//  211：用户不存在, </span></span><br><span class="line">            <span class="comment">//  -1 Error: Request has been terminated</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;登录失败：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;status_code&quot;</span>: e.<span class="property">code</span>,</span><br><span class="line">                <span class="string">&quot;user&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 退出登录 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> 无返回值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">logOut</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable constant_">LC</span>.<span class="property">User</span>.<span class="title function_">logOut</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过电子邮件重置密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; email </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> 状态码：</span></span><br><span class="line"><span class="comment">     * &quot;200&quot;: 发送邮件成功；</span></span><br><span class="line"><span class="comment">     * &quot;1&quot;: &quot;请不要往同一个邮件地址发送太多邮件&quot;,</span></span><br><span class="line"><span class="comment">     * &quot;205&quot;: &quot;此电子邮箱没有被注册使用&quot;,</span></span><br><span class="line"><span class="comment">     * &quot;-1&quot;: &quot;请求被终止，请检查网络连接状况&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">passwordResetByEmail</span>(<span class="params">email</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="variable constant_">LC</span>.<span class="property">User</span>.<span class="title function_">requestPasswordReset</span>(email);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">code</span>, <span class="keyword">typeof</span> response);</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="string">&quot;status_code&quot;</span>: <span class="string">&quot;ok&quot;</span> &#125;;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发送邮件：&quot;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;status_code&quot;</span>: e.<span class="property">code</span>,  <span class="comment">// 发送邮件不成功，返回错误代码</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前用户的 session token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span> session token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getToken</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable constant_">LC</span>.<span class="property">User</span>.<span class="title function_">current</span>().<span class="title function_">getSessionToken</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">AccountService</span>();</span><br></pre></td></tr></table></figure><blockquote><p><code>leancloud SDK</code> 用户的相关文档请查看：<a href="https://leancloud.cn/docs/leanstorage_guide-js.html#hash954895">https://leancloud.cn/docs/leanstorage_guide-js.html#hash954895</a></p></blockquote><h1 id="新用户注册功能的实现"><a href="#新用户注册功能的实现" class="headerlink" title="新用户注册功能的实现"></a>新用户注册功能的实现</h1><p>打开文件 <code>src/views/account/pages/SignUp.vue</code>, 编辑其代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;always&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-module&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span>&gt;</span>          </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container form-title&quot;</span>&gt;</span>                </span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>注册新用户<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-home fa-lg&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>           </span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-envelope-o fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;电子邮箱&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-user-o fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-lock fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 按钮添加单击事件调用函数创建用户 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">class</span>=<span class="string">&quot;full-width&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;createUser&quot;</span>&gt;</span>注册新用户<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>              </span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span>&gt;</span>使用已有账号登录<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入账号服务类</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">AccountService</span> <span class="keyword">from</span> <span class="string">&quot;../../../api/service/account_service&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;SignUp&quot;</span>,     <span class="comment">// 组件名称</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">username</span>: <span class="string">&quot;&quot;</span>,   <span class="comment">// 用于输入用户名</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">password</span>: <span class="string">&quot;&quot;</span>,   <span class="comment">// 用于输入密码</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">email</span>: <span class="string">&quot;&quot;</span>,      <span class="comment">// 用于输入邮箱 </span></span></span><br><span class="line"><span class="language-javascript">    &#125;),    </span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 调用 AccountService 中的异步方法时，函数前要加上 async </span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">createUser</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 注册函数返回值为 包含 状态码 和 用户 两个部分内容的对象</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">AccountService</span>.<span class="title function_">signUp</span>(<span class="variable language_">this</span>.<span class="property">username</span>, <span class="variable language_">this</span>.<span class="property">password</span>, <span class="variable language_">this</span>.<span class="property">email</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> == <span class="string">&quot;ok&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 调用异步方法不能缺少 await，不然等不到正确结果</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> token = <span class="keyword">await</span> <span class="title class_">AccountService</span>.<span class="title function_">getToken</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;token&quot;</span>, token);   <span class="comment">// 保存当前用户的 session token    </span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;currentUser&quot;</span>, <span class="variable language_">this</span>.<span class="property">username</span>);   <span class="comment">// 保存当前的用户名          </span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/dashboard&quot;</span>);  <span class="comment">// 跳转到后台管理）</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> errorMsg = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;125&quot;</span>: <span class="string">&quot;无效的电子邮件地址&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;202&quot;</span>: <span class="string">&quot;此用户名已被注册&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;203&quot;</span>: <span class="string">&quot;此电子邮箱已经被占用&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;-1&quot;</span>: <span class="string">&quot;请求被终止，请检查网络连接状况&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 使用 Notification 通知 显示注册失败的提示信息</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$notify</span>.<span class="title function_">error</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: <span class="string">&#x27;注册失败&#x27;</span>,                           <span class="comment">// 标题</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: errorMsg[response.<span class="property">status_code</span>],    <span class="comment">// 取出对应的消息内容</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// offset: 100,                             // 偏移量，消息距屏幕边缘偏移一段距离</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">showClose</span>: <span class="literal">false</span>,                           <span class="comment">// 不显示关闭按钮，只能等自动关闭</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-module</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">380px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在项目结果的网页中点击链接到<code>注册新用户</code>的界面, 输入新用户的<code>电子邮箱</code>，<code>用户名</code>和<code>密码</code>, 如下图所示(为方便看到可能出现的错误或异常信息，请按 <code>F12</code> 打开浏览器的<code>Web开发者工具</code>， 请切换到 <code>控制台(Console)</code>选项卡)：</p><img src="/2021/11/20/element-leancloud-project-VI/005.png" class="" title="leancloud"><p>点击 <code>注册新用户</code> 按钮， 注册成功后，浏览器跳转到后台管理界面, 如下图所示：</p><img src="/2021/11/20/element-leancloud-project-VI/006.png" class="" title="leancloud"><p>注册失败时，或上角显示 <code>注册失败</code> 的提示，同时浏览器的控制台输出相应的异常信息， 如下图所示：</p><img src="/2021/11/20/element-leancloud-project-VI/007.png" class="" title="leancloud"><p>注册成功后，在 <code>leancloud</code> 的应用管理后台 <code>刷新</code> 后可以看到 <code>_User</code> 已经添多了一条记录</p><img src="/2021/11/20/element-leancloud-project-VI/008.png" class="" title="signup"><h1 id="实现登录功能"><a href="#实现登录功能" class="headerlink" title="实现登录功能"></a>实现登录功能</h1><p>打开文件 <code>src/views/account/pages/Login.vue</code>, 编辑内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;always&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-module&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container form-title&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-home fa-lg&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-user-o fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-lock fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 登录按钮单击事件调用 login 函数 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">class</span>=<span class="string">&quot;full-width&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/password_reset&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span>&gt;</span>忘记密码<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/signup&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span>&gt;</span>没有账号<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入账号服务类</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">AccountService</span> <span class="keyword">from</span> <span class="string">&quot;../../../api/service/account_service&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; <span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;   <span class="comment">// 导入 Loading加载</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;Login&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">username</span>: <span class="string">&quot;zhangsan&quot;</span>,   <span class="comment">// 用于输入用户名</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">password</span>: <span class="string">&quot;123456&quot;</span>,   <span class="comment">// 用于输入密码    </span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">loading</span>: <span class="string">&#x27;&#x27;</span>,    <span class="comment">// 用于显示 Loading 加载 的变量        </span></span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">showLoading</span>(<span class="string">&#x27;#login&#x27;</span>, <span class="string">&#x27;正在登录中...&#x27;</span>);   <span class="comment">// 在选择器名为  # login 的元素上显示  loading</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 登录函数返回 包含 状态码 和 用户 两个信息的对象， 状态码为 字符类型 的 数字字符</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">AccountService</span>.<span class="title function_">logIn</span>(<span class="variable language_">this</span>.<span class="property">username</span>, <span class="variable language_">this</span>.<span class="property">password</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 为了进行登录失败的提示，只能通过 typeof currentUser 来 判断登录是否成功</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> == <span class="string">&quot;ok&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 读取进入登录页的前一页地址</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> curr = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;preRoute&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> token = <span class="keyword">await</span> <span class="title class_">AccountService</span>.<span class="title function_">getToken</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;token&quot;</span>, token);   <span class="comment">// 保存当前用户的 session token</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;currentUser&quot;</span>, <span class="variable language_">this</span>.<span class="property">username</span>);   <span class="comment">// 保存当前的用户名</span></span></span><br><span class="line"><span class="language-javascript">              </span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;response.user:&#x27;</span>, response.<span class="property">user</span>);</span></span><br><span class="line"><span class="language-javascript">               </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (curr === <span class="literal">null</span> || curr === <span class="string">&#x27;/&#x27;</span> || curr === <span class="string">&#x27;/account&#x27;</span> || curr === <span class="string">&quot;/login&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&quot;/dashboard&quot;</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 跳转到进入登录页之前的页面</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: curr &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;               </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> errorMsg = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;210&quot;</span>: <span class="string">&quot;用户名和密码不匹配&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;211&quot;</span>: <span class="string">&quot;找不到用户&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;219&quot;</span>:<span class="string">&#x27;登录失败次数超过限制，请稍候再试，或者重设密码&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;-1&quot;</span>: <span class="string">&quot;请求被终止，请检查网络连接状况&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;;               </span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 使用 Notification 通知 显示登录失败的的提示信息</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$notify</span>.<span class="title function_">error</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: <span class="string">&#x27;登录失败&#x27;</span>,      <span class="comment">// 标题</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: errorMsg[response.<span class="property">status_code</span>],     <span class="comment">// 消息内容</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// offset: 100,        // 偏移量，消息距屏幕边缘偏移一段距离</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">showClose</span>: <span class="literal">false</span>,      <span class="comment">// 不显示关闭按钮，只能等自动关闭</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 结束显示 loading </span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">endLoading</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * 自定义用于局部区域显示 loading 的函数</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * 局部区域显示 loading 的步骤：</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * 1、import &#123; Loading &#125; from &quot;element-ui&quot;;   // 导入 Loading加载</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * 2、在  data 定义控制变量： loading:false,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * 3、定义函数：showLoading(targetNode, message) 和 endLoading()</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * 4、调用第 3 步定义的两个函数</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; targetNode  目标区域的选择器，建设使用 id 选择器</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@returns</span> </span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       */</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">showLoading</span>(<span class="params">targetNode, message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="title class_">Loading</span>.<span class="title function_">service</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 锁定屏幕的滚动</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lock</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 显示的文本</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">text</span>: message,</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// document.querySelector 用于以获取到对应 DOM 节点</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">target</span>: <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(targetNode),</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 停止显示 loading</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">endLoading</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span>.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取用户数据中的用户名和邮箱两个信息</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getUser</span>(<span class="params">user</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: user.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: user.<span class="title function_">get</span>(<span class="string">&quot;username&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">email</span>: user.<span class="title function_">get</span>(<span class="string">&quot;email&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-module</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">380px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>浏览器进入到<code>登录页面</code>，输入 <code>用户名</code> 和 <code>密码</code> 登录, 登录不成功，显示相应的错误提示，效果如下图：</p><img src="/2021/11/20/element-leancloud-project-VI/009.png" class="" title="login"><p>登录成功，则进入后台管理 或是自动跳转到登录界面的前一页。</p><h1 id="实现通过邮箱找回密码"><a href="#实现通过邮箱找回密码" class="headerlink" title="实现通过邮箱找回密码"></a>实现通过邮箱找回密码</h1><p>打开文件 <code>src/views/account/pages/PasswordReset.vue</code>, 编辑其内容如下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;always&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-module&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container form-title&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>通过邮箱找回密码<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-home fa-lg&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 添加发送重置邮件成功后显示的内容 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;sendEmailSuccess&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-alert</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:title</span>=<span class="string">&quot;`请登录 $&#123;this.email&#125; 邮箱进行密码重置`&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;success&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">effect</span>=<span class="string">&quot;dark&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">center</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">show-icon</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:closable</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-alert</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 原来的表单项添加一个 &lt;div v-else&gt; &lt;/div&gt; 包裹起来  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-envelope-o fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">v-model</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">placeholder</span>=<span class="string">&quot;电子邮箱&quot;</span></span></span><br><span class="line"><span class="tag">                    &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 按钮单击事件添加调用 passwordReset 函数 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">class</span>=<span class="string">&quot;full-width&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;passwordReset&quot;</span>&gt;</span>发送找回密码的邮件<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span>&gt;</span>使用已有账号登录<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/signup&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span>&gt;</span>没有账号<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">AccountService</span> <span class="keyword">from</span> <span class="string">&quot;../../../api/service/account_service&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;PasswordReset&quot;</span>,     <span class="comment">// 组件名称</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">email</span>: <span class="string">&quot;&quot;</span>,      <span class="comment">// 用于输入邮箱 </span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">sendEmailSuccess</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">passwordReset</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> email = <span class="variable language_">this</span>.<span class="property">email</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 发送重置密码邮件后，返回值为 字符类型的状态码</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">AccountService</span>.<span class="title function_">passwordResetByEmail</span>(email);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> == <span class="string">&quot;ok&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">sendEmailSuccess</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 显示发送成功的提示信息</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$notify</span>.<span class="title function_">success</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: <span class="string">&#x27;发送重置密码邮件成功&#x27;</span>,             <span class="comment">// 标题</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: <span class="string">&quot;请查看邮件，以便完成密码重置&quot;</span>,    <span class="comment">// 消息内容</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// offset: 100,                          // 偏移量，消息距屏幕边缘偏移一段距离</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">showClose</span>: <span class="literal">false</span>,                        <span class="comment">// 不显示关闭按钮，只能等自动关闭</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> errorMsg = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;1&quot;</span>: <span class="string">&quot;请不要往同一个邮件地址发送太多邮件&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;205&quot;</span>: <span class="string">&quot;此电子邮箱没有被注册使用&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&quot;-1&quot;</span>: <span class="string">&quot;请求被终止，请检查网络连接状况&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 使用 Notification 通知 显示操作失败的的提示信息</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$notify</span>.<span class="title function_">error</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: <span class="string">&#x27;密码重置失败&#x27;</span>,           <span class="comment">// 标题</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: errorMsg[response.<span class="property">status_code</span>],    <span class="comment">// 消息内容</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// offset: 100,                 // 偏移量，消息距屏幕边缘偏移一段距离</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">showClose</span>: <span class="literal">false</span>,               <span class="comment">// 不显示关闭按钮，只能等自动关闭</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-module</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">380px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>浏览器进入到找回密码的界面，填写用户注册时的电子邮箱， 邮箱填写错误，显示相应的提示信息：</p><img src="/2021/11/20/element-leancloud-project-VI/010.png" class="" title="login"><p>填写正确的电子邮箱，发送重置密码邮件，登录到自己的邮箱，即可重置密码：</p><img src="/2021/11/20/element-leancloud-project-VI/011.png" class="" title="login"><h1 id="在后台管理界面显示当前登录用户及注销"><a href="#在后台管理界面显示当前登录用户及注销" class="headerlink" title="在后台管理界面显示当前登录用户及注销"></a>在后台管理界面显示当前登录用户及注销</h1><p>打开文件 <code>src/views/dashboard/layout/Header.vue</code>, 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lay-header horiz-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-bell fa-lg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 消息</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-envelope fa-lg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 邮件</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 从状态栏读取当前已登录用户的信息，并显示用户名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-link</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-if</span>=<span class="string">&quot;currentUser&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>当前用户： &#123;&#123; currentUser &#125;&#125;<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加注销功能 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;logout&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">AccountService</span> <span class="keyword">from</span> <span class="string">&quot;../../../api/service/account_service.js&quot;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;LayoutHeader&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 用户注销</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;logout&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">await</span> <span class="title class_">AccountService</span>.<span class="title function_">logOut</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">path</span> != <span class="string">&quot;/&quot;</span>) &#123;              </span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;preRoute&quot;</span>);  <span class="comment">// 删除已保存的前一页地址</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;token&quot;</span>);   <span class="comment">// 删除已保存的用户 token</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取当前登录的用户名</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">currentUser</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;currentUser&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.lay-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>登录成功后，后台管理页面的右上角显示 当前用户名，并实现用户的注销， 效果如下图所示：</p><img src="/2021/11/20/element-leancloud-project-VI/012.png" class="" title="login"><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/20/element-leancloud-project-VII/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 VII</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(五) - 后台管理界面</title>
      <link href="/2021/11/20/element-leancloud-project-V/"/>
      <url>/2021/11/20/element-leancloud-project-V/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="文件与路由规划"><a href="#文件与路由规划" class="headerlink" title="文件与路由规划"></a>文件与路由规划</h1><p>相对于其他两大部分来说，后台管理界面的组成更复杂，包含的组件、视图也更多。 为了更方便进行管理， 将相应的文件分别放到不同的文件夹下。就当前项目来说，主要实现一个论坛的后台管理功能，所以在 <code>dashboard</code> 文件夹中分别创建三个文件夹用于存放不同的文件：</p><ul><li><p><code>layout</code> 文件夹： 用于存放后台管理界面（仪表盘）的组成组件；</p></li><li><p><code>forum</code> 文件夹：用于存放和论坛管理有关的视图；</p></li><li><p><code>pages</code> 文件夹： 用于存放仪表盘其他部分的视图；</p></li></ul><blockquote><p>如果有更多的内容，也可以建相应的文件夹进行分类存放</p></blockquote><h2 id="创建文件夹和文件"><a href="#创建文件夹和文件" class="headerlink" title="创建文件夹和文件"></a>创建文件夹和文件</h2><p>根据以上规划，在 <code>dashboard</code> 文件夹 分别 创建名为：<code>layout</code> 、<code>forum</code> 、<code>pages</code> 的文件夹。</p><p>在 <code>src/views/dashboard/forum/</code> 文件夹下添加以下两个文件：</p><ol><li><p><code>TopicManager.vue</code>: 论坛话题管理视图；</p></li><li><p><code>CommentManager.vue</code>: 话题评论管理视图。</p></li></ol><p>在 <code>src/views/dashboard/layout/</code> 文件夹下添加以下三个文件：</p><ol><li><p><code>Aside.vue</code>: 侧边栏组件；</p></li><li><p><code>Header.vue</code>: 顶部栏组件；</p></li><li><p><code>MenuTree.vue</code>: 无限嵌套菜单组件.</p></li></ol><p>在 <code>src/views/dashboard/pages</code> 文件夹中添加以下一个文件：</p><ol><li><code>MainIndex.vue</code>: 仪表盘首页视图。</li></ol><p>文件夹和文件添加完毕后，<code>src/views</code> 文件夹内的结构如下图所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">|-- account</span><br><span class="line">|   |-- pages</span><br><span class="line">|   |   |-- Login.vue</span><br><span class="line">|   |   |-- PasswordReset.vue</span><br><span class="line">|   |   `-- SignUp.vue</span><br><span class="line">|   `-- Index.vue</span><br><span class="line">|-- dashboard</span><br><span class="line">|   |-- forum</span><br><span class="line">|   |   |-- CommentManager.vue</span><br><span class="line">|   |   `-- TopicManager.vue</span><br><span class="line">|   |-- layout</span><br><span class="line">|   |   |-- Aside.vue</span><br><span class="line">|   |   |-- Header.vue</span><br><span class="line">|   |   `-- MenuTree.vue</span><br><span class="line">|   |-- pages</span><br><span class="line">|   |   `-- MainIndex.vue</span><br><span class="line">|   `-- Index.vue</span><br><span class="line">`-- home</span><br><span class="line">    `-- Index.vue</span><br></pre></td></tr></table></figure><h2 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h2><p>打开路由配置文件 <code>src/router/index.js</code>， 在原 <code>path: &#39;/dashboard&#39;</code> 的路由项添加相应的子路由，修改后内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/home/Index.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/account&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/login&#x27;</span>,   <span class="comment">// 路由重定向, 跳转至其默认子路由</span></span><br><span class="line">    <span class="comment">// name: &#x27;Account&#x27;,  // 包含子路由时，父路由不需要 name, 此处注释掉</span></span><br><span class="line">    <span class="comment">// 父路由组件内必须有一个 &lt;router-view /&gt; 用于响应、显示匹配的子路由组件</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/Index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 子路由的 path 以 / 开头，表示绝对路径，父path 在子路由中不起作用</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,  <span class="comment">// 实际路径：/login</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,   <span class="comment">// 命名路由</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/Login.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/signup&#x27;</span>,  <span class="comment">// 实际路径：/signup</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;SignUp&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/SignUp.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/password_reset&#x27;</span>,  <span class="comment">// 实际路径：/password_reset</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;PasswordReset&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/PasswordReset.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 后台管理部分</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">    <span class="comment">// name: &#x27;Dashboard&#x27;,  // 包含子路由时，不需要 name 项</span></span><br><span class="line">    <span class="comment">// 父路由组件内必须有一个 &lt;router-view /&gt; 用于响应、显示匹配的子路由组件</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/dashboard/Index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 子路由的 path 不是以 / 开头时，实际路径为 父path 与 子path 的组合</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,       <span class="comment">// 实际路径为: /dashboard</span></span><br><span class="line">        <span class="attr">alias</span>: <span class="string">&#x27;index&#x27;</span>, <span class="comment">// 别名，相当于第二个 path, 实际路径为: /dashboard/index</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,  <span class="comment">// 父路由没有 name 项，此处使用父路由原来的 name</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/pages/MainIndex.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;topic_manager&#x27;</span>,   <span class="comment">// 实际路径为: /dashboard/topic_manager</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;TopicManager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/forum/TopicManager.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;comment_manager&#x27;</span>,   <span class="comment">// 实际路径为: /dashboard/comment_manager</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;CommentManager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/forum/CommentManager.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="后台管理界面的整体布局"><a href="#后台管理界面的整体布局" class="headerlink" title="后台管理界面的整体布局"></a>后台管理界面的整体布局</h1><p>打开文件 <code>src/views/dashboard/Index.vue</code> ， 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot;240px&quot;</span>&gt;</span>Aside<span class="tag">&lt;/<span class="name">el-aside</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-header</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-container</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#b3c0d1</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-main</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#e9eef3</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在运行结果的首页点击 链接跳转至 <code>后台管理</code>, 显示结果如下图所示：</p><img src="/2021/11/20/element-leancloud-project-V/001.png" class="" title="dashboard"><h1 id="顶栏的实现"><a href="#顶栏的实现" class="headerlink" title="顶栏的实现"></a>顶栏的实现</h1><p>打开文件 <code>src/views/dashboard/layout/Header.vue</code>, 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lay-header horiz-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-bell fa-lg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 消息</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-envelope fa-lg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 邮件</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span>当前用户：张三<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;LayoutHeader&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.lay-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打开文件 <code>src/views/dashboard/Index.vue</code> ， 添加对顶部栏组件<code>LayoutHeader</code>引用，修改后内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot;240px&quot;</span>&gt;</span>Aside<span class="tag">&lt;/<span class="name">el-aside</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-header</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 使用组件，组件名可以改为 短横线命名的格式 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">layout-header</span>&gt;</span><span class="tag">&lt;/<span class="name">layout-header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 引用的组件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 导入并注册顶部栏组件 LayoutHeader</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">LayoutHeader</span>:<span class="function">()=&gt;</span><span class="keyword">import</span>(<span class="string">&#x27;./layout/Header.vue&#x27;</span>),    </span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-container</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#b3c0d1</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-main</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#e9eef3</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>项目运行效果如下图所示：</p><img src="/2021/11/20/element-leancloud-project-V/002.png" class="" title="dashboard"><h1 id="侧边栏的实现"><a href="#侧边栏的实现" class="headerlink" title="侧边栏的实现"></a>侧边栏的实现</h1><p>后台管理的侧边栏一般显示仪表盘的控制菜单，菜单项可以通过 <code>json</code> 数据来生成。</p><h2 id="准备生成菜单项的-json-数据"><a href="#准备生成菜单项的-json-数据" class="headerlink" title="准备生成菜单项的 json 数据"></a>准备生成菜单项的 json 数据</h2><p>在 <code>assets</code> 文件夹下新建 <code>json</code> 文件夹，再创建文件： <code>menuItems.json</code>。</p><p>打开新建的文件 <code>src/assets/json/menuItems.json</code>， 复制以下内容粘贴到该文件中：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;menuItems&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;仪表盘&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-tachometer fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;评论管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-commenting-o fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span>      </span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图片管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-image fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;论坛管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-newspaper-o fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>               </span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">42</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;话题管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-pencil-square-o fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard/topic_manager&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">43</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;评论管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-commenting-o fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard/comment_manager&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;权限管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-user-secret fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;角色管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-id-card-o fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;用户管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa fa-users fa-lg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;仪表盘&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;el-icon-odometer&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;仪表盘&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;el-icon-odometer&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;仪表盘&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;el-icon-odometer&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;chip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dashboard&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>说明：还没有实际跳转目标的项，<code>&quot;link&quot;</code> 的值都是 <code>&quot;/dashboard&quot;</code>， 这么写是为了防止跳转到不存在的视图导致错误。如有添加其他后台管理功能，请自行修改就可以了。</p></blockquote><h2 id="创建无限菜单组件"><a href="#创建无限菜单组件" class="headerlink" title="创建无限菜单组件"></a>创建无限菜单组件</h2><p>侧边栏的菜单可以包含有子菜单项，如果想实现子菜单项的嵌套， 就需要通过一个组件来实现。 打开文件 <code>src/views/dashboard/layout/MenuTree.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in menuData&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">v-if</span>=<span class="string">&quot;!item.children&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> <span class="attr">:index</span>=<span class="string">&quot;item.link&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">:class</span>=<span class="string">&quot;item.icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                &#123;&#123; item.title &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">el-badge</span> <span class="attr">:value</span>=<span class="string">&quot;item.chip&quot;</span> <span class="attr">:max</span>=<span class="string">&quot;99&quot;</span> <span class="attr">class</span>=<span class="string">&quot;badge-item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-badge</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">v-else-if</span>=<span class="string">&quot;item.children.length &gt; 0&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;&#x27;s&#x27; + item.id&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">:class</span>=<span class="string">&quot;item.icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 递归生成下一级子菜单 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">menu-tree</span> <span class="attr">menuData</span>=<span class="string">&quot;item.children&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">menu-tree</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;MenuTree&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>: [<span class="string">&quot;menuData&quot;</span>], </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="编辑侧边栏组件"><a href="#编辑侧边栏组件" class="headerlink" title="编辑侧边栏组件"></a>编辑侧边栏组件</h2><p>打开文件 <code>src\views\dashboard\layout\Aside.vue</code>, 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dashboard-logo&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Admin<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-menu</span> <span class="attr">:router</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in menu.menuItems&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">v-if</span>=<span class="string">&quot;!item.children&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">:index</span>=<span class="string">&quot;item.link&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">:class</span>=<span class="string">&quot;item.icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    &#123;&#123; item.title &#125;&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-badge</span> <span class="attr">:value</span>=<span class="string">&quot;item.chip&quot;</span> <span class="attr">:max</span>=<span class="string">&quot;99&quot;</span> <span class="attr">class</span>=<span class="string">&quot;badge-item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-badge</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-submenu</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-else-if</span>=<span class="string">&quot;item.children.length &gt; 0&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:key</span>=<span class="string">&quot;&#x27;k&#x27; + item.id&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:index</span>=<span class="string">&quot;item.link&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">:class</span>=<span class="string">&quot;item.icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 子菜单组件 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">menu-tree</span> <span class="attr">:menuData</span>=<span class="string">&quot;item.children&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">menu-tree</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入生成左侧菜单列表的 json 文件</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> menu <span class="keyword">from</span> <span class="string">&#x27;@/assets/json/menuItems.json&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;LayoutAside&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">MenuTree</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./MenuTree.vue&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        menu,   <span class="comment">// 导入的json 数据 作为变量</span></span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.dashboard-logo</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">28px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">600</span>;   </span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用侧边栏组件, 打开文件 <code>src/views/dashboard/Index.vue</code> ， 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot;240px&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用侧边栏组件  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout-aside</span>&gt;</span><span class="tag">&lt;/<span class="name">layout-aside</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-aside</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-header</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">layout-header</span>&gt;</span><span class="tag">&lt;/<span class="name">layout-header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-header</span>&gt;</span>            </span><br><span class="line">            <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 引用的组件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">LayoutHeader</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./layout/Header.vue&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 导入侧边栏组件  LayoutAside</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">LayoutAside</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./layout/Aside.vue&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-container</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#b3c0d1</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-main</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#e9eef3</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>项目运行效果如下图所示：</p><img src="/2021/11/20/element-leancloud-project-V/003.png" class="" title="dashboard"><h2 id="菜单匹配的子路由视图"><a href="#菜单匹配的子路由视图" class="headerlink" title="菜单匹配的子路由视图"></a>菜单匹配的子路由视图</h2><p>打开文件 <code>src/views/dashboard/pages/MainIndex.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>仪表盘首页正在建设中<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;MainIndex&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打开文件 <code>src/views/dashboard/forum/TopicManager.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>话题管理<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;TopicManager&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打开文件 <code>src/views/dashboard/forum/CommentManager.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>评论管理<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;CommentManager&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="在父组件中显示匹配的子路由视图"><a href="#在父组件中显示匹配的子路由视图" class="headerlink" title="在父组件中显示匹配的子路由视图"></a>在父组件中显示匹配的子路由视图</h2><p>打开文件 <code>src/views/dashboard/Index.vue</code>, 在 <code>&lt;el-main&gt;&lt;/el-main&gt;</code> 标签中添加 <router-view /> 用于显示匹配的子路由的视图， 修改后的代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot;240px&quot;</span>&gt;</span>           </span><br><span class="line">            <span class="tag">&lt;<span class="name">layout-aside</span>&gt;</span><span class="tag">&lt;/<span class="name">layout-aside</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-aside</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-header</span>&gt;</span>               </span><br><span class="line">                <span class="tag">&lt;<span class="name">layout-header</span>&gt;</span><span class="tag">&lt;/<span class="name">layout-header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-main</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 用于响应匹配的子路由视图 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">LayoutHeader</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./layout/Header.vue&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">LayoutAside</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./layout/Aside.vue&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-container</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#b3c0d1</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-main</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#e9eef3</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改完毕，项目运行效果如下图：</p><img src="/2021/11/20/element-leancloud-project-V/004.png" class="" title="dashboard"><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/20/element-leancloud-project-VI/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 VI</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(四) - 登录与注册界面设计</title>
      <link href="/2021/11/18/element-leancloud-project-IV/"/>
      <url>/2021/11/18/element-leancloud-project-IV/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="账号模块的路由规划"><a href="#账号模块的路由规划" class="headerlink" title="账号模块的路由规划"></a>账号模块的路由规划</h1><p>在当前项目中， 账号模块实现三个部分的功能：<code>用户登录</code>、<code>用户注册</code>、<code>通过邮箱找回密码</code>， 这三个部分都放在 <code>src/views/account/</code> 文件夹下。</p><h2 id="创建文件夹和文件"><a href="#创建文件夹和文件" class="headerlink" title="创建文件夹和文件"></a>创建文件夹和文件</h2><p>在 <code>src/views/account/</code> 下创建名为 <code>pages</code> 的文件夹，然后在该文件下添加三个 vue文件：<code>Login.vue</code>, <code>PasswordReset.vue</code>, <code>SignUp.vue</code>。</p><p>创建完成后的 <code>views</code> 文件夹下的项目结构如下图：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|-- account</span><br><span class="line">|   |-- pages</span><br><span class="line">|   |   |-- Login.vue</span><br><span class="line">|   |   |-- PasswordReset.vue</span><br><span class="line">|   |   `-- SignUp.vue</span><br><span class="line">|   `-- Index.vue</span><br><span class="line">|-- dashboard</span><br><span class="line">|   `-- Index.vue</span><br><span class="line">`-- home</span><br><span class="line">    `-- Index.vue</span><br></pre></td></tr></table></figure><p>编辑<code>src/views/account/pages/Login.vue</code>, 内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>编辑<code>src/views/account/pages/PasswordReset.vue</code>, 内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>通过邮箱找回密码<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;PaswordReset&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>编辑<code>src/views/account/pages/SignUp.vue</code>, 内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>注册新用户<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;SignUp&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="路由设计"><a href="#路由设计" class="headerlink" title="路由设计"></a>路由设计</h2><p>打开 <code>src/router/index.js</code>， 给 <code>name: &#39;Account&#39;</code> 的路由项添加子路由，编辑后的代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/home/Index.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/account&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/login&#x27;</span>,   <span class="comment">// 路由重定向, 跳转至其默认子路由</span></span><br><span class="line">    <span class="comment">// name: &#x27;Account&#x27;,  // 包含子路由时，父路由不需要 name, 此处注释掉</span></span><br><span class="line">    <span class="comment">// 父路由组件内必须有一个 &lt;router-view /&gt; 用于响应、显示匹配的子路由组件</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/Index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 子路由的 path 以 / 开头，表示绝对路径，父path 在子路由中不起作用</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,  <span class="comment">// 实际路径：/login</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,   <span class="comment">// 命名路由</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/Login.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/signup&#x27;</span>,  <span class="comment">// 实际路径：/signup</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;SignUp&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/SignUp.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/password_reset&#x27;</span>,  <span class="comment">// 实际路径：/password_reset</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;PasswordReset&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/pages/PasswordReset.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/dashboard/Index.vue&#x27;</span>),</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure><h1 id="整体布局"><a href="#整体布局" class="headerlink" title="整体布局"></a>整体布局</h1><p>打开 <code>src/views/account/Index.vue</code>, 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:md</span>=<span class="string">&quot;12&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden-sm-and-down&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid-content bg-dark&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;login-title&quot;</span>&gt;</span>Element Forum Admin<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:md</span>=<span class="string">&quot;12&quot;</span> <span class="attr">:sm</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid-content bg-light&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;Account&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 水平及垂直居中 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.grid-content</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 使用弹性布局 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 主轴居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 交叉轴居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="comment">/* 深色背景，有不重复的背景图片 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.bg-dark</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#091d3b</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 请自行修改为自己的图片url */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;../../assets/login-pattern-left.png&quot;</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-repeat</span>: no-repeat;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: -<span class="number">30%</span> <span class="number">60%</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="comment">/* 浅色背景 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.bg-light</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#e5e9f2</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="comment">/* 左侧窗格的标题文字 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-title</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">36px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>项目运行，进入登录页后的效果如下图：</p><img src="/2021/11/18/element-leancloud-project-IV/001.png" class="" title="login"><p>说明: 这里使用了响应式设计，当窗口比较大时，可以看到页面分别 左右两个部分； 当把页面的宽度缩小，或是用手机等小尺寸设备打开网页时，左半部分将会被隐藏，效果如下图：</p><img src="/2021/11/18/element-leancloud-project-IV/002.png" class="" title="login"><h1 id="登录页的设计"><a href="#登录页的设计" class="headerlink" title="登录页的设计"></a>登录页的设计</h1><p>打开 <code>src/views/account/pages/Login.vue</code>, 编辑其如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;always&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-module&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- form-title 样式在父组件中定义 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container form-title&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-home fa-lg&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-user-o fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-lock fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- full-width 样式在父组件中定义 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">class</span>=<span class="string">&quot;full-width&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/password_reset&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span>&gt;</span>忘记密码<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/signup&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span>&gt;</span>没有账号<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;Login&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">username</span>: <span class="string">&quot;&quot;</span>,   <span class="comment">// 用于输入用户名</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">password</span>: <span class="string">&quot;&quot;</span>,   <span class="comment">// 用于输入密码            </span></span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-module</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">380px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>以上代码中， 有两个样式：<code>form-title</code> 与 <code>full-width</code> 在 <code>注册新用户</code> 和 <code>通过邮箱找回密码</code> 界面中也要使用，为了减少重复代码，改为在父组件 <code>src/views/account/Index.vue</code> 中进行定义，这样就可以实现三个界面使用相同的样式了。</p></blockquote><h2 id="在父组件中添加各个子组件共用的样式"><a href="#在父组件中添加各个子组件共用的样式" class="headerlink" title="在父组件中添加各个子组件共用的样式"></a>在父组件中添加各个子组件共用的样式</h2><p>编辑 <code>src/views/account/Index.vue</code>， 在其 <code>&lt;style&gt;&lt;/style&gt;</code> 小节中添加 样式<code>form-title</code> 与 <code>full-width</code> 的定义，代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:md</span>=<span class="string">&quot;12&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden-sm-and-down&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid-content bg-dark&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;login-title&quot;</span>&gt;</span>Element Forum Admin<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:md</span>=<span class="string">&quot;12&quot;</span> <span class="attr">:sm</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid-content bg-light&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;Account&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 水平及垂直居中 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.grid-content</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 使用弹性布局 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 主轴居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 交叉轴居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="comment">/* 深色背景，有不重复的背景图片 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.bg-dark</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#091d3b</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 请自行修改为自己的图片url */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;../../assets/login-pattern-left.png&quot;</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-repeat</span>: no-repeat;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: -<span class="number">30%</span> <span class="number">60%</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="comment">/* 浅色背景 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.bg-light</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#e5e9f2</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="comment">/* 左侧窗格的标题文字 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-title</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">36px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 以下为子组件共用的样式 */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.form-title</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.full-width</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>用户登录的界面效果如下图:</p><img src="/2021/11/18/element-leancloud-project-IV/003.PNG" class="" title="login"><h1 id="注册新用户"><a href="#注册新用户" class="headerlink" title="注册新用户"></a>注册新用户</h1><p>将 <code>src/views/account/pages/Login.vue</code> 的内容全部复制, 粘贴到 <code>src/views/account/pages/SignUp.vue</code> 中替换原来的内容, 然后做以下的修改:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;always&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-module&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- form-title 样式在父组件中定义 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container form-title&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 修改窗口标题文字 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>注册新用户<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-home fa-lg&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 添加用于输入电子邮箱的表单项 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-envelope-o fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;电子邮箱&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-user-o fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-lock fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 修改按钮提示文字 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">class</span>=<span class="string">&quot;full-width&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>注册新用户<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 保留一个 router-link, 并修改提示文字, 跳转路径和颜色 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span>&gt;</span>使用已有账号登录<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;SignUp&quot;</span>,     <span class="comment">// 组件名称</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">username</span>: <span class="string">&quot;&quot;</span>,   <span class="comment">// 用于输入用户名</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">password</span>: <span class="string">&quot;&quot;</span>,   <span class="comment">// 用于输入密码</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">email</span>: <span class="string">&quot;&quot;</span>,      <span class="comment">// 用于输入邮箱 </span></span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-module</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">380px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注册新用户的界面效果如下图:</p><img src="/2021/11/18/element-leancloud-project-IV/004.png" class="" title="signup"><h1 id="通过邮箱找回密码"><a href="#通过邮箱找回密码" class="headerlink" title="通过邮箱找回密码"></a>通过邮箱找回密码</h1><p>将 <code>src/views/account/pages/SignUp.vue</code> 的内容全部复制, 粘贴到 <code>src/views/account/pages/PaswordReset.vue</code> 中替换原来的内容, 然后做以下的修改:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;always&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-module&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- form-title 样式在父组件中定义 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container form-title&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 修改窗口标题文字 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>通过邮箱找回密码<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-home fa-lg&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 只保留用于输入电子邮箱的表单项 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">prefix-icon</span>=<span class="string">&quot;fa fa-envelope-o fa-lg&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-model</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">placeholder</span>=<span class="string">&quot;电子邮箱&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 修改按钮提示文字 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">class</span>=<span class="string">&quot;full-width&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>发送找回密码的邮件<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>               </span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span>&gt;</span>使用已有账号登录<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 加一个注册新用户的跳转 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/signup&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">:underline</span>=<span class="string">&quot;false&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span>&gt;</span>没有账号<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&quot;PasswordReset&quot;</span>,     <span class="comment">// 组件名称</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">email</span>: <span class="string">&quot;&quot;</span>,      <span class="comment">// 用于输入邮箱 </span></span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-module</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">380px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过邮箱找回密码的界面效果如下图:</p><img src="/2021/11/18/element-leancloud-project-IV/005.png" class="" title="signup"><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/20/element-leancloud-project-V/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 V</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(三) - 首页初步设计</title>
      <link href="/2021/11/17/element-leancloud-project-III/"/>
      <url>/2021/11/17/element-leancloud-project-III/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="首页初步设计"><a href="#首页初步设计" class="headerlink" title="首页初步设计"></a>首页初步设计</h1><p>对于一个论坛网站来说，用户登录、进入后台管理界面后发表话题， 首页才有内容可以显示。但是为了不让首页太难看、同时提供到过其他视图的跳转，需要先对首页进行一些简单的设计。</p><h2 id="修改首页的-template"><a href="#修改首页的-template" class="headerlink" title="修改首页的 template"></a>修改首页的 template</h2><p>打开 <code>src/views/home/Index.vue</code> ， 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span>Acme World APP<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>网站的内容正在建设中，敬请期待<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>编辑完毕并保存文件，运行结果如下图所示：</p><img src="/2021/11/17/element-leancloud-project-III/001.png" class="" title="home"><h2 id="添加样式"><a href="#添加样式" class="headerlink" title="添加样式"></a>添加样式</h2><p>上图显示的内容，由于没有样式，所以显示的效果并不太好。<code>Element UI</code> 的组件默认会生成一个同名的 class， 所以可以直接给组件添加样式，继续编辑 <code>src/views/home/Index.vue</code> ，其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span>Acme World APP<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>网站的内容正在建设中，敬请期待<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-container</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 让最外层组件占满整个可见的高度 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#b3c0d1</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-main</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#e9eef3</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>保存文件后，运行结果显示如下图：</p><img src="/2021/11/17/element-leancloud-project-III/002.png" class="" title="home"><h2 id="使用全局样式"><a href="#使用全局样式" class="headerlink" title="使用全局样式"></a>使用全局样式</h2><p>从上面的运行结果来看，网页的主体内容和浏览器之间有一个边距存在，另外跳转到 <code>后台管理</code> 和 <code>登录</code> 的两个链接也看不见了, 这些问题都可以通过添加样式来解决。</p><p>因为希望某些样式可以在多个组件间重复地使用，所以这里就把一些会在多个组件都出现的样式以全局样式的方式来进行组织。</p><h3 id="创建样式文件"><a href="#创建样式文件" class="headerlink" title="创建样式文件"></a>创建样式文件</h3><p>在 <code>assets </code>文件夹下新建文件夹： css</p><p>接下来在该文件夹下新建文件：<code>style.css</code></p><p>打开新建的样式文件： <code>src/assets/css/style.css</code>， 编辑其内容如以下代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * spacer 与 horiz-container  或 vertical-container 配合，</span></span><br><span class="line"><span class="comment"> * 实现水平或垂直方向将后继元素挤到最后 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.horiz-container</span> &#123;</span><br><span class="line">    <span class="comment">/* 使用弹性布局  */</span></span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="comment">/* 主轴方向: 从左到右  */</span></span><br><span class="line">    <span class="attribute">flex-flow</span>: row;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.vertical-container</span> &#123;</span><br><span class="line">    <span class="comment">/* 使用弹性布局  */</span></span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="comment">/* 主轴方向: 从上到下 */</span></span><br><span class="line">    <span class="attribute">flex-flow</span>: column;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.spacer</span> &#123;</span><br><span class="line">    <span class="comment">/* 在弹性布局中占去所有剩余空间，实现将后继元素挤到末尾   */</span></span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 通用外边距样式，值 为 m 后面的数字乘以 4  */</span></span><br><span class="line"><span class="selector-class">.m-1</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.m-2</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.m-3</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.m-4</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.m-5</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* m：margin; x: 水平方向，即：left 和 right */</span></span><br><span class="line"><span class="selector-class">.mx-1</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mx-2</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mx-3</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mx-4</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mx-5</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* m：margin; y: 垂直方向，即：top 和 bottom */</span></span><br><span class="line"><span class="selector-class">.my-1</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.my-2</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.my-3</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.my-4</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.my-5</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 通用内边距样式，值 为 p 后面的数字乘以 4  */</span></span><br><span class="line"><span class="selector-class">.p-1</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.p-2</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.p-3</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.p-4</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.p-5</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打开文件 <code>src/main.js</code>, 编辑其内容如以下代码:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementUI</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;   </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;  </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/display.css&#x27;</span>; </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./assets/font-awesome-4.7.0/css/font-awesome.min.css&#x27;</span>;  </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./assets/css/style.css&#x27;</span>;    <span class="comment">// 引入全局样式文件</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">ElementUI</span>);       </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./api/init.js&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存文件后，运行结果显示，网页主体和浏览器的边距已经消失：</p><img src="/2021/11/17/element-leancloud-project-III/003.png" class="" title="home"><p>继续编辑<code>src/views/home/Index.vue</code>, 修改其代码如以下所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加样式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-header</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span>Acme World APP<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 添加空 div 及样式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 添加样式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span> <span class="attr">class</span>=<span class="string">&quot;m-2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 添加样式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">class</span>=<span class="string">&quot;m-2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>网站的内容正在建设中，敬请期待<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-container</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 让最外层组件占满整个可见的高度 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#b3c0d1</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 交叉轴对齐方式：居中 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;  </span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-main</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#e9eef3</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>保存文件后，运行效果如下图所示：</p><img src="/2021/11/17/element-leancloud-project-III/004.png" class="" title="home"><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/18/element-leancloud-project-IV/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 IV</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Butterfly 主题的页脚养鱼</title>
      <link href="/2021/11/17/footer-fish/"/>
      <url>/2021/11/17/footer-fish/</url>
      
        <content type="html"><![CDATA[<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>首先必须引入需要的 <code>jquery</code> 文件，网址为 <a href="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js">https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js</a></p><p>再引入必要的鱼儿游动的 js 文件，网址为: <a href="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js">https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js</a> </p><p>将以上两个文件下载并保存到 <code>Hexo</code> 博客项目的 <code>themes/butterfly/source/js/</code> 文件夹中。</p><p>打开 <code>themes/butterfly/source/js/fishes.js</code> 文件，找到以下代码:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>(</span><br><span class="line">  <span class="string">&#x27;&lt;script src=&quot;https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fish.js&quot;&gt;&lt;/script&gt;&#x27;</span></span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>将 <code>https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fish.js</code> 文件下载并保存到 <code>themes/butterfly/source/js/</code> 文件夹中。</p><p>将上述代码注释, 改成在配置文件中引入相应的 js 文件。修改后的代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fish</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fish</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      $(<span class="string">&quot;#footer-wrap&quot;</span>).<span class="title function_">css</span>(&#123;</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&quot;absolute&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text-align&quot;</span>: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">        <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">right</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">bottom</span>: <span class="number">0</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      $(<span class="string">&quot;footer&quot;</span>).<span class="title function_">append</span>(</span><br><span class="line">        <span class="string">&#x27;&lt;div class=&quot;container&quot; id=&quot;jsi-flying-fish-container&quot;&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line">      ),</span><br><span class="line">      <span class="comment">// $(&quot;body&quot;).append(</span></span><br><span class="line">      <span class="comment">//   &#x27;&lt;script src=&quot;https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fish.js&quot;&gt;&lt;/script&gt;&#x27;</span></span><br><span class="line">      <span class="comment">// ),</span></span><br><span class="line">      <span class="variable language_">this</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="编辑主题配置文件"><a href="#编辑主题配置文件" class="headerlink" title="编辑主题配置文件"></a>编辑主题配置文件</h1><p>打开 <code>_config.butterfly.yml</code> , 找到 <code># Inject</code>, 在 <code>bottom</code> 添加以上三个 <code>js</code> 文件的引用即可(<code>cdn.jsdelivr.net</code>目前在国内使用很不稳定, 改成本地文件夹使用更好).</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inject</span></span><br><span class="line"><span class="comment"># Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span></span><br><span class="line"><span class="comment"># 插入代码到头部 &lt;/head&gt; 之前 和 底部 &lt;/body&gt; 之前</span></span><br><span class="line"></span><br><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/jquery.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="comment"># - &lt;script src=&quot;https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/fishes.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/fish.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>参考：<a href="https://weilining.github.io/204.html">https://weilining.github.io/204.html</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> butterfly </tag>
            
            <tag> fish </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(二) - 路由规划</title>
      <link href="/2021/11/17/element-leancloud-project-II/"/>
      <url>/2021/11/17/element-leancloud-project-II/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="路由规划与实现"><a href="#路由规划与实现" class="headerlink" title="路由规划与实现"></a>路由规划与实现</h1><p>本项目实现的是一个论坛网站，网站划分为三个部分:</p><ul><li><p>前台用户界面：主要是论坛的主题；主题的详细内容及评论；</p></li><li><p>帐号管理界面：主要是注册、登录等功能；</p></li><li><p>后台管理界面：主要是主题的管理；评论内容的管理等功能；</p></li></ul><h2 id="创建对应的文件夹及文件"><a href="#创建对应的文件夹及文件" class="headerlink" title="创建对应的文件夹及文件"></a>创建对应的文件夹及文件</h2><p>分别创建以下三个文件夹： </p><ul><li><p><code>src/views/home</code>：用于存放前台用户界面的文件 ；</p></li><li><p><code>src/views/account</code>：存放用户帐号相关的文件；</p></li><li><p><code>src/views/dashboard</code>：存放后台管理界面的文件；</p></li></ul><p>分别在以上三个文件夹各添加一个 <code>Index.vue</code> 文件，用于该模块的页面布局。</p><p>删除原有的两个视图文件： <code>src/views/About.vue</code> 和 <code>src/views/Home.vue</code>;</p><p>创建和删除完毕后的项目 views 文件夹下的文件结构如下图所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">└-- views</span><br><span class="line">    |-- account</span><br><span class="line">    |   └-- Index.vue</span><br><span class="line">    |-- dashboard</span><br><span class="line">    |   └-- Index.vue</span><br><span class="line">    └-- home</span><br><span class="line">        └-- Index.vue</span><br></pre></td></tr></table></figure><h2 id="编辑三个文件"><a href="#编辑三个文件" class="headerlink" title="编辑三个文件"></a>编辑三个文件</h2><p>打开 <code>src/views/account/Index.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;账号管理&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">    name: <span class="string">&#x27;Account&#x27;</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>打开 <code>src/views/dashboard/Index.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;后台管理&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">    name: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>打开 <code>src/views/home/Index.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;网站首页&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">    name: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="修改路由文件"><a href="#修改路由文件" class="headerlink" title="修改路由文件"></a>修改路由文件</h2><p>打开文件：<code>src/router/index.js</code>， 编辑其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/home/Index.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/account&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Account&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/account/Index.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/dashboard/Index.vue&#x27;</span>),</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure><h2 id="编辑-App-vue"><a href="#编辑-App-vue" class="headerlink" title="编辑 App.vue"></a>编辑 App.vue</h2><p>打开文件： <code>src/App.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div <span class="built_in">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">        &lt;router-view /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">    name: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>App.vue</code> 里面的 <code>&lt;router-view /&gt;</code> 是路由的最顶层的出口，渲染最高级路由匹配到的组件。</p></blockquote><h2 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h2><p>在控制台输入命令： <code>yarn serve</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\sources\vue_repos\acme<span class="literal">-world-app</span>&gt; yarn serve</span><br><span class="line">yarn run v1.<span class="number">22.5</span></span><br><span class="line"><span class="variable">$</span> vue<span class="literal">-cli-service</span> serve</span><br><span class="line"> INFO  Starting development server...</span><br><span class="line"><span class="number">98</span>% after emitting CopyPlugin</span><br><span class="line"></span><br><span class="line"> DONE  Compiled successfully <span class="keyword">in</span> <span class="number">6415</span>ms                                                                       下午<span class="number">9</span>:<span class="number">33</span>:<span class="number">19</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  App running at:</span><br><span class="line">  - Local:   http://localhost:<span class="number">8080</span>/</span><br><span class="line">  - Network: http://<span class="number">192.168</span>.<span class="number">3.52</span>:<span class="number">8080</span>/</span><br><span class="line"></span><br><span class="line">  Note that the development build is not optimized.</span><br><span class="line">  To create a production build, run yarn build.</span><br></pre></td></tr></table></figure><p>在浏览器输入地址： <code>http://localhost:8080/</code>， 因为当前创建项目时路由选择了<code> Hash 模式</code>，地址会自动变成：<code>http://localhost:8080/#/</code> , 显示效果如下图：</p><img src="/2021/11/17/element-leancloud-project-II/001home.png" class="" title="home"><p>根据 <code>src/router/index.js</code> 中定义的路由，输入地址：<code>http://localhost:8080/#/account</code>, 显示效果如下图：</p><img src="/2021/11/17/element-leancloud-project-II/002account.png" class="" title="account"><p>根据 <code>src/router/index.js</code> 中定义的路由，输入地址：<code>http://localhost:8080/#/dashboard</code>, 显示效果如下图：</p><img src="/2021/11/17/element-leancloud-project-II/003dashboard.png" class="" title="dashboard"><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/17/element-leancloud-project-III/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 III</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(一) - 创建项目</title>
      <link href="/2021/11/16/element-leancloud-project-I/"/>
      <url>/2021/11/16/element-leancloud-project-I/</url>
      
        <content type="html"><![CDATA[<p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p><hr><h1 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h1><p>在创建项目前需要先安装下列应用程序</p><blockquote><ol><li>node.js</li><li>yarn (可选)</li><li>@vue&#x2F;cli</li><li>Visual Studio Code (包含安装相应的扩展)</li><li>Git (可选)</li></ol></blockquote><h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><h2 id="包管理工具-npm-和-yarn"><a href="#包管理工具-npm-和-yarn" class="headerlink" title="包管理工具 npm 和 yarn"></a>包管理工具 npm 和 yarn</h2><p> <code>npm</code> 和 <code>yarn</code> 都是包管理工具， <code>npm</code> 是<code>node.js</code>自带的，<code>yarn</code> 需要额外安装。在使用一段时间之后，我现在比较喜欢使用 <code>yarn</code>, 至于优点，网上列出来的主要有这么几个：速度快、安装版本统一、输出信息更简洁等等。</p><p> 所以在下面的操作过程中，基本上就按照自己的习惯使用<code>yarn</code> 来完成，如果自己不习惯这个命令的话，也可以自行使用相应的 <code>npm</code> 命令来操作。只要得到的结果一样就可以了。</p><h2 id="Vue-js-2-x-和-Vue-js-3-x-的选择"><a href="#Vue-js-2-x-和-Vue-js-3-x-的选择" class="headerlink" title="Vue.js 2.x 和  Vue.js 3.x 的选择"></a>Vue.js 2.x 和  Vue.js 3.x 的选择</h2><p><code> Vue.js 3.x</code> 的正式版发布已经有一段时间了，而且和 <code> Vue.js 2.x</code> 相比变化非常大，这就导致了现在很多和<code> Vue.js</code>配套的库，特别是和 <code>UI</code> 有关的库大部分都还没有来得及未完成新版本的适配。虽然以后肯定是会升级到 <code> Vue.js 3.x</code>，但就目前阶段来说，继续使用<code> Vue.js 2.x</code> 来开发项目不失为目前比较好的选择。</p><h2 id="使用-vue-cli-创建项目"><a href="#使用-vue-cli-创建项目" class="headerlink" title="使用 @vue&#x2F;cli 创建项目"></a>使用 @vue&#x2F;cli 创建项目</h2><h3 id="打开-Powershell窗口"><a href="#打开-Powershell窗口" class="headerlink" title="打开 Powershell窗口"></a>打开 <code>Powershell窗口</code></h3><p>首先，我在自己的电脑建了一个专门的文件夹 <code>D:\sources\vue_repos</code> 用来存放 <code>Vue.js</code> 项目。按住<code>Shift</code>键，然后在该文件夹空白处点<code>鼠标右键</code>，在弹出的快捷菜单中选择 <code>在此处打开Powershell窗口(s)</code>。（打开<code>CMD窗口</code>中完成以下命令也是一样的）</p><blockquote><p>提示: 如果电脑已经安装 <code>Git</code>, 也可以在右键菜单中选择 <code>Git Bash Here</code>, 在 <code>Git Bash</code> 命令窗口下执行命令.</p></blockquote><h3 id="创建项目-1"><a href="#创建项目-1" class="headerlink" title="创建项目"></a>创建项目</h3><p>在 <code>Powershell窗口</code> 中输入命令：<code>vue create acme-world-app</code></p><blockquote><p><code>acme-world-app</code> 为项目名称，请把它 <code>替换</code> 为你自己的项目名。</p></blockquote><ul><li>在 <code>Please pick a preset</code>(请选择一个预设) 中选择 <code>Manually select features</code>(手动选择项目):</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.15</span><br><span class="line">? Please pick a preset:</span><br><span class="line">  Default ([Vue 2] babel, eslint)</span><br><span class="line">  Default (Vue 3) ([Vue 3] babel, eslint)</span><br><span class="line">&gt; Manually <span class="keyword">select</span> features</span><br></pre></td></tr></table></figure><ul><li>在 <code>Check the features needed for your project</code>(检查项目所需的功能) 中选择以下几项：<ul><li>Choose Vue version</li><li>Babel</li><li>Router</li><li>Vuex</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.15</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project:</span><br><span class="line"> (*) Choose Vue version</span><br><span class="line"> (*) Babel</span><br><span class="line"> ( ) TypeScript</span><br><span class="line"> ( ) Progressive Web App (PWA) Support</span><br><span class="line"> (*) Router</span><br><span class="line"> (*) Vuex</span><br><span class="line"> ( ) CSS Pre-processors</span><br><span class="line">&gt;( ) Linter / Formatter</span><br><span class="line"> ( ) Unit Testing</span><br><span class="line"> ( ) E2E Testing</span><br></pre></td></tr></table></figure><p>取消原来默认选中的 <code>Linter / Formatter</code>(当然你已经会使用这一项就选上，不知道这一项是做什么的，最好不要选)</p><ul><li>在 <code>Choose a version of Vue.js that you want to start the project with (Use arrow keys)</code>(选择项目的 Vue.js 版本) 选择 <code>2.x</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.15</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with (Use arrow keys)</span><br><span class="line">&gt; 2.x</span><br><span class="line">  3.x</span><br></pre></td></tr></table></figure><ul><li>在 <code>Use history mode for router?</code>(路由使用<code>history模式</code>) 中回答 <code>n</code>，不使用 <code>history模式</code> 。</li></ul><blockquote><p><code>history模式</code> : 网址的中间不显示 <code>#</code> 号, 但需要服务器端支持. 如果项目最后需要部署到 <code>Github Pages</code> 或 <code>Gitee Pages</code>, 则不要使用 <code>history模式</code>;</p></blockquote><blockquote><p><code>hash模式</code>: 网址的中间显示 <code>#</code>, 例如: <a href="http://localhost:8080/#/">http://localhost:8080/#/</a> </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.15</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) (Y/n) n</span><br></pre></td></tr></table></figure><ul><li>在<code>Where do you prefer placing config for Babel, ESLint, etc.? (Use arrow keys)</code> (选择<code>Babel</code>, <code>ESLint</code> 等等第三方包的配置文件) 中选择 <code>In dedicated config files</code>(在专用的配置文件中)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.15</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? (Use arrow keys)</span><br><span class="line">&gt; In dedicated config files</span><br><span class="line">  In package.json</span><br></pre></td></tr></table></figure><ul><li>在<code>Save this as a preset for future projects? </code>(保存刚才的选择到项目预设) 中回答 <code>n</code>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.15</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? In dedicated config files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? (y/N)</span><br></pre></td></tr></table></figure><p>以后建项目的时候如果确定回答和上面的完全一样的，也可以回答<code>y</code>，把刚才的选择项都存为一个预设，以后可以使用该预设完成项目的创建。</p><p>对于初学者来说，多做几次才能熟悉操作，所以建议不存预设，给自己一个练习的机会。</p><ul><li>完成了创建项目的所有选项，创建项目的过程显示如以下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos&gt; vue create acme-world-app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue CLI v4.5.15</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? In dedicated config files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? No</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue CLI v4.5.15</span><br><span class="line">✨  Creating project <span class="keyword">in</span> D:\sources\vue_repos\acme-world-app.</span><br><span class="line">🗃  Initializing git repository...</span><br><span class="line">⚙️  Installing CLI plugins. This might take a <span class="keyword">while</span>...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">info No lockfile found.</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 20.52s.</span><br><span class="line">🚀  Invoking generators...</span><br><span class="line">📦  Installing additional dependencies...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 5.25s.</span><br><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">📄  Generating README.md...</span><br><span class="line"></span><br><span class="line">🎉  Successfully created project acme-world-app.</span><br><span class="line">👉  Get started with the following commands:</span><br><span class="line"></span><br><span class="line"> $ <span class="built_in">cd</span> acme-world-app</span><br><span class="line"> $ yarn serve</span><br><span class="line"></span><br><span class="line"> WARN  Skipped git commit due to missing username and email <span class="keyword">in</span> git config, or failed to sign commit.</span><br><span class="line">You will need to perform the initial commit yourself.</span><br></pre></td></tr></table></figure><h1 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h1><h3 id="进入创建好的项目文件夹"><a href="#进入创建好的项目文件夹" class="headerlink" title="进入创建好的项目文件夹"></a>进入创建好的项目文件夹</h3><p>根据项目创建完成后倒数第二行提示，输入命令：<code>cd acme-world-app</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos&gt; <span class="built_in">cd</span> acme-world-app</span><br><span class="line">PS D:\sources\vue_repos\acme-world-app&gt;</span><br></pre></td></tr></table></figure><h3 id="在-Visual-Studio-Code-中打开项目"><a href="#在-Visual-Studio-Code-中打开项目" class="headerlink" title="在 Visual Studio Code 中打开项目"></a>在 <code>Visual Studio Code</code> 中打开项目</h3><p>方法一： 启动 <code>Visual Studio Code</code>， 选择<code>打开文件夹</code>, 选中<code>D:\sources\vue_repos\acme-world-app</code> 打开。</p><p>方法二： 在上一步使用命令进入项目文件夹的基础上，直接在命令行中输入：<code>code .</code>(<code>code</code>  和  <code>.</code>  之间至少有一个空格隔开 )， 则可以启动 <code>Visual Studio Code</code> 并打开当前的文件夹。(我比较喜欢这种打开方式。)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos\acme-world-app&gt; code .</span><br></pre></td></tr></table></figure><h3 id="启动开发服务器的时候自动打开默认浏览器"><a href="#启动开发服务器的时候自动打开默认浏览器" class="headerlink" title="启动开发服务器的时候自动打开默认浏览器"></a>启动开发服务器的时候自动打开默认浏览器</h3><p>在 <code>Visudl Studio Code</code> 打开 <code>package.json</code> 文件。其内容如以下代码所示:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;acme-world-app&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;core-js&quot;</span>: <span class="string">&quot;^3.6.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue&quot;</span>: <span class="string">&quot;^2.6.11&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue-router&quot;</span>: <span class="string">&quot;^3.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vuex&quot;</span>: <span class="string">&quot;^3.4.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-babel&quot;</span>: <span class="string">&quot;~4.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-router&quot;</span>: <span class="string">&quot;~4.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-vuex&quot;</span>: <span class="string">&quot;~4.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-service&quot;</span>: <span class="string">&quot;~4.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue-template-compiler&quot;</span>: <span class="string">&quot;^2.6.11&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 第5行的<code>scripts</code>用于定义脚本命令：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>在上面这个 <code>scripts</code>小节中，定义了两个脚本命令<code>serve</code>和<code>build</code></p><ul><li><p>每一行冒号左边的名字是命令名称，可以通过类似<code> npm run serve</code>或是 <code>yarn serve</code> 的方式在控制台运行。</p></li><li><p>每一行冒号右边的内容侧是该命令执行时实际调用的脚本。</p></li></ul><p>两个脚本命令的说明：</p><blockquote><p><code>vue-cli-service serve</code> 命令会启动一个开发服务器 (基于 webpack-dev-server) 并附带开箱即用的模块热重载 (Hot-Module-Replacement)</p></blockquote><blockquote><p><code>vue-cli-service build</code> 会在 dist&#x2F; 目录产生一个可用于生产环境的包，带有 JS&#x2F;CSS&#x2F;HTML 的压缩，和为更好的缓存而做的自动的 vendor chunk splitting</p></blockquote><p>复制 <code>&quot;serve&quot;: &quot;vue-cli-service serve&quot;,</code>那一行。并修改冒号左边的命令名称为 <code>dev</code>, 在冒号右边的脚本后加空格，再添加选择 <code>--open</code>(用于自动打开默认浏览器)，修改后的代码如以下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vue-cli-service serve --open&quot;</span>,</span><br><span class="line">    <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><blockquote><p>以后在项目的控制台中运行命令：<code>yarn dev</code> 或<code>npm run dev</code> 就可以启动开发服务器，并自动打开默认浏览器显示运行的结果了。</p></blockquote><h3 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h3><p>在控制台输入命令：<code>yarn dev</code>, 项目运行成功后将看到内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos\acme-world-app&gt; yarn dev</span><br><span class="line">yarn run v1.22.5</span><br><span class="line">$ vue-cli-service serve --open</span><br><span class="line"> INFO  Starting development server...</span><br><span class="line">98% after emitting CopyPlugin</span><br><span class="line"></span><br><span class="line"> DONE  Compiled successfully <span class="keyword">in</span> 4008ms </span><br><span class="line"></span><br><span class="line">  App running at:</span><br><span class="line">  - Local:   http://localhost:8080/</span><br><span class="line">  - Network: http://192.168.3.52:8080/</span><br><span class="line"></span><br><span class="line">  Note that the development build is not optimized.</span><br><span class="line">  To create a production build, run yarn build.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在自动打开的默认浏览器中，可以看到项目运行的结果如下图所示：</p><img src="/2021/11/16/element-leancloud-project-I/001.PNG" class="" title="start"><h1 id="添加-Element-UI"><a href="#添加-Element-UI" class="headerlink" title="添加 Element UI"></a>添加 Element UI</h1><p>Element UI 是一套采用 Vue 2.0 作为基础框架实现的组件库，提供了配套设计资源，帮助网站快速成型.</p><h2 id="安装-Element-UI"><a href="#安装-Element-UI" class="headerlink" title="安装 Element UI"></a>安装 Element UI</h2><p>npm 安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i element-ui -S</span><br></pre></td></tr></table></figure><p>yarn 安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add element-ui</span><br></pre></td></tr></table></figure><p>yarn 安装过程如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos\acme-world-app&gt; yarn add element-ui</span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">warning element-ui &gt; async-validator &gt; babel-runtime &gt; core-js@2.6.12: core-js@&lt;3.3 is no longer maintained and not recommended <span class="keyword">for</span> usage due to the number of issues. Because of the V8 engine whims, feature detection <span class="keyword">in</span> old core-js versions could cause a slowdown up to 100x even <span class="keyword">if</span> nothing is polyfilled. Please, upgrade your dependencies to the actual version of core-js.</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 8 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ element-ui@2.15.6</span><br><span class="line">info All dependencies</span><br><span class="line">├─ async-validator@1.8.5</span><br><span class="line">├─ babel-helper-vue-jsx-merge-props@2.0.3</span><br><span class="line">├─ babel-runtime@6.26.0</span><br><span class="line">├─ element-ui@2.15.6</span><br><span class="line">├─ normalize-wheel@1.0.1</span><br><span class="line">├─ regenerator-runtime@0.11.1</span><br><span class="line">├─ resize-observer-polyfill@1.5.1</span><br><span class="line">└─ throttle-debounce@1.1.0</span><br><span class="line">Done <span class="keyword">in</span> 6.71s.</span><br></pre></td></tr></table></figure><h2 id="引入-Element"><a href="#引入-Element" class="headerlink" title="引入 Element"></a>引入 Element</h2><p>编辑 <code>src/main.js</code>， 内容如以下代码所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementUI</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;   <span class="comment">// 导入ElementUI</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;  <span class="comment">// 导入element ui 主题</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/display.css&#x27;</span>;  <span class="comment">// 导入用于隐藏断点的样式</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">ElementUI</span>);  <span class="comment">//通过全局方法 Vue.use() 使用插件</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><h1 id="使用-Leancloud"><a href="#使用-Leancloud" class="headerlink" title="使用 Leancloud"></a>使用 Leancloud</h1><p> <code>Leancloud</code>（原 AVOS Cloud） 是针对移动应用的一站式云端服务，专注于为应用开发者提供工具和平台, 这里使用 <code>leancloud</code> 的 <code>数据存储</code>功能来保存数据。</p><blockquote><p>请提前到 <a href="https://www.leancloud.cn/">leanclou.cn</a> 注册一个账号。因 <code>华北节点</code> 的 <code>文件服务</code> 功能去年无法使用，建议选择使用 <code>华东节点</code>。</p></blockquote><h2 id="安装-leancloud-SDK"><a href="#安装-leancloud-SDK" class="headerlink" title="安装 leancloud SDK"></a>安装 leancloud SDK</h2><p> 在控制台输入命令：<code>yarn add leancloud-storage</code></p><p> 安装过程显示如以下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos\acme-world-app&gt; yarn add leancloud-storage</span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">warning leancloud-storage &gt; leancloud-realtime &gt; uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() <span class="keyword">in</span> certain circumstances, <span class="built_in">which</span> is known to be problematic.  See https://v8.dev/blog/math-random <span class="keyword">for</span> details.</span><br><span class="line">warning leancloud-storage &gt; @leancloud/platform-adapters-node &gt; @leancloud/adapters-superagent &gt; superagent &gt; formidable@1.2.6: Please upgrade to latest, formidable@v2 or formidable@v3! Check these notes: https://bit.ly/2ZEqIau</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 35 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ leancloud-storage@4.12.0</span><br><span class="line">info All dependencies</span><br><span class="line">├─ @leancloud/platform-adapters-browser@1.5.2</span><br><span class="line">├─ @leancloud/platform-adapters-node@1.5.2</span><br><span class="line">├─ @leancloud/platform-adapters-weapp@1.6.1</span><br><span class="line">├─ @types/cookiejar@2.1.2</span><br><span class="line">├─ @types/superagent@4.1.13</span><br><span class="line">├─ @types/ws@7.4.7</span><br><span class="line">├─ ascli@1.0.1</span><br><span class="line">├─ base64-arraybuffer@0.1.5</span><br><span class="line">├─ bytebuffer@5.0.1</span><br><span class="line">├─ charenc@0.0.2</span><br><span class="line">├─ code-point-at@1.1.0</span><br><span class="line">├─ colour@0.7.1</span><br><span class="line">├─ cookiejar@2.1.3</span><br><span class="line">├─ crypt@0.0.2</span><br><span class="line">├─ event-target-shim@5.0.1</span><br><span class="line">├─ eventemitter3@2.0.3</span><br><span class="line">├─ fast-safe-stringify@2.1.1</span><br><span class="line">├─ formidable@1.2.6</span><br><span class="line">├─ invert-kv@1.0.0</span><br><span class="line">├─ javascript-state-machine@2.4.0</span><br><span class="line">├─ lcid@1.0.0</span><br><span class="line">├─ leancloud-realtime-plugin-live-query@1.2.0</span><br><span class="line">├─ leancloud-realtime@5.0.0-rc.7</span><br><span class="line">├─ leancloud-storage@4.12.0</span><br><span class="line">├─ localstorage-memory@1.0.3</span><br><span class="line">├─ long@3.2.0</span><br><span class="line">├─ md5@2.3.0</span><br><span class="line">├─ miniprogram-api-typings@2.12.0</span><br><span class="line">├─ number-is-nan@1.0.1</span><br><span class="line">├─ optjs@3.2.2</span><br><span class="line">├─ os-locale@1.4.0</span><br><span class="line">├─ protobufjs@5.0.3</span><br><span class="line">├─ superagent@5.3.1</span><br><span class="line">├─ underscore@1.13.1</span><br><span class="line">└─ window-size@0.1.4</span><br><span class="line">Done <span class="keyword">in</span> 7.98s.</span><br></pre></td></tr></table></figure><h2 id="添加-leancloud-SDK-配置文件"><a href="#添加-leancloud-SDK-配置文件" class="headerlink" title="添加 leancloud SDK 配置文件"></a>添加 leancloud SDK 配置文件</h2><blockquote><p>如果还没有 leancloud 账号，请参考本教程的第六部分 <a href="https://hujiyi.github.io/2021/11/20/element-leancloud-project-VI/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 VI：实现用户注册、登录、找回密码</a>, 在 <code>leancloud</code> 中<code>创建应用</code>并找到相应的 <code>keys</code>。</p></blockquote><p>在项目中创建文件夹：<code>src/api/config/</code></p><p>再文件夹中创建文件：<code>src/api/config/lc.config.js</code>, 编辑其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//&#x27;这里填写 leancloud 的 appId&#x27;,</span></span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;9MCRS87WVkReLtNbQWbnllm9-********&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// &#x27;这里填写 leancloud 的 appKey&#x27;,</span></span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;zAfYTXaiXYGeQUm8********&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// &#x27;这里填写 leancloud 的 REST API 服务器地址，国际版应用等未绑定自定义域名的此项留空&#x27;</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://********.lc-cn-n1-shared.com&#x27;</span>,</span><br><span class="line">  &#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>以上部分字符已经改成了<code>*</code> 以隐藏真实的keys，请用自己的 leancloud <code>应用keys</code> 中相应的内容替换以上三个值。</p></blockquote><h2 id="添加-leancloud-SDK-初始化文件"><a href="#添加-leancloud-SDK-初始化文件" class="headerlink" title="添加 leancloud SDK 初始化文件"></a>添加 leancloud SDK 初始化文件</h2><p>在项目中创建文件：<code>src/api/init.js</code>，编辑其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;   <span class="comment">// 导入 leancloud 数据存储模块</span></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;./config/lc.config&#x27;</span>;  <span class="comment">// 导入 leancloud 的应用keys</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initOptions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (config.<span class="property">url</span>.<span class="title function_">trim</span>() === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// url 为空的时候，访问国际版：leancloud.app</span></span><br><span class="line">    initOptions = &#123;</span><br><span class="line">        <span class="attr">appId</span>: config.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">appKey</span>: config.<span class="property">key</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// url 不为空的时候，访问国内版:leancloud.cn</span></span><br><span class="line">    initOptions = &#123;</span><br><span class="line">        <span class="attr">appId</span>: config.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">appKey</span>: config.<span class="property">key</span>,</span><br><span class="line">        <span class="attr">serverURLs</span>: config.<span class="property">url</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 leanCloud 初始化</span></span><br><span class="line"><span class="variable constant_">LC</span>.<span class="title function_">init</span>(initOptions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出模块</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="在-main-js-中导入并执行-leancloud-SDK-初始化"><a href="#在-main-js-中导入并执行-leancloud-SDK-初始化" class="headerlink" title="在 main.js 中导入并执行 leancloud SDK 初始化"></a>在 <code>main.js</code> 中导入并执行 <code>leancloud SDK</code> 初始化</h2><p>编辑文件：<code>src/main.js</code>, 内容如以下代码所示:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementUI</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;   </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;  </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/display.css&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">ElementUI</span>);  </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./api/init.js&#x27;</span>);  <span class="comment">// 导入并执行 LeanCloud SDK 初始化</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Moment-js-和-Marked"><a href="#Moment-js-和-Marked" class="headerlink" title="Moment.js 和 Marked"></a>Moment.js 和 Marked</h1><p>Moment.js 是一个 JavaScript 日期处理类库，用于解析、检验、操作、以及显示日期。</p><h2 id="安装-Moment-js"><a href="#安装-Moment-js" class="headerlink" title="安装 Moment.js"></a>安装 Moment.js</h2><p>npm 安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install moment -S  </span><br></pre></td></tr></table></figure><p>yarn 安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add moment        </span><br></pre></td></tr></table></figure><h2 id="安装-Marked"><a href="#安装-Marked" class="headerlink" title="安装 Marked"></a>安装 Marked</h2><p><code>Markdown</code> 是一种轻量级标记语言，创始人为约翰·格鲁伯（John Gruber）。它允许人们“使用易读易写的纯文本格式编写文档，然后转换成有效的XHTML(或者HTML)文档”。 <code>Marked</code> 是一个高效的 <code>Markdown</code> 解析器。</p><p>npm 安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install marked -S  </span><br></pre></td></tr></table></figure><p>yarn 安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add marked        </span><br></pre></td></tr></table></figure><p><code>moment.js</code> 和 <code>marked.js</code> 安装完毕待用。</p><h1 id="使用-font-awesome-4-7-图标"><a href="#使用-font-awesome-4-7-图标" class="headerlink" title="使用 font-awesome-4.7 图标"></a>使用 font-awesome-4.7 图标</h1><p>Element UI 自带的图标少，也不好看，这里使用 <code>font-awesome-4.7</code> 的图标</p><ol><li><p>载 <code>font-awesome-4.7</code>  <a href="http://www.fontawesome.com.cn/download/font-awesome-4.7.0.zip">下载地址</a>  代码到本地, 解压到当前项目的  <code>src/assets</code> 文件夹中。</p></li><li><p>编辑 <code>main.js</code> ，添加以下引用(和设置 moment 的语言地区一起)：</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementUI</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;   </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;  </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/display.css&#x27;</span>; </span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./assets/font-awesome-4.7.0/css/font-awesome.min.css&#x27;</span>;  <span class="comment">// 导入 font awesome 图标</span></span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;        <span class="comment">// 导入时期时间库</span></span><br><span class="line"></span><br><span class="line">moment.<span class="title function_">locale</span>(<span class="string">&#x27;zh-cn&#x27;</span>);    <span class="comment">// 设置时期时间的地区</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">ElementUI</span>);  </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./api/init.js&#x27;</span>);  </span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li><p>使用示例：<a href="http://www.fontawesome.com.cn/examples/">http://www.fontawesome.com.cn/examples/</a></p></li><li><p>查找想要的图标：</p></li></ol><ul><li><p>网址1(带名字的小图标)： <a href="http://www.fontawesome.com.cn/faicons/#web-application">http://www.fontawesome.com.cn/faicons/#web-application</a></p></li><li><p>网址2(没有名字的大图标)： <a href="http://www.fontawesome.com.cn/icons-ui/">http://www.fontawesome.com.cn/icons-ui/</a></p></li></ul><p>后继内容：<br><a href="https://hujiyi.github.io/2021/11/17/element-leancloud-project-II/">使用 Element UI 和 Leancloud 的 Vue.js 项目开发 II</a></p><p>&#x3D;&#x3D;&#x3D; END &#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leancloud </tag>
            
            <tag> element ui </tag>
            
            <tag> vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Butterfly 主题 搭建 Github Pages 上的 Hexo 博客</title>
      <link href="/2021/11/15/hexo-with-butterfly/"/>
      <url>/2021/11/15/hexo-with-butterfly/</url>
      
        <content type="html"><![CDATA[<h1 id="安装前提"><a href="#安装前提" class="headerlink" title="安装前提"></a>安装前提</h1><p>安装 <code>Hexo</code> 需要先安装下列应用程序：</p><blockquote><ol><li>Node.js (Node.js 版本需不低于 10.13，建议使用 Node.js 12.0 及以上版本)</li><li>Git</li></ol></blockquote><h1 id="安装-hexo-cli"><a href="#安装-hexo-cli" class="headerlink" title="安装 hexo cli"></a>安装 hexo cli</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure><h1 id="初始化博客项目"><a href="#初始化博客项目" class="headerlink" title="初始化博客项目"></a>初始化博客项目</h1><ol><li><p>创建 hexo 博客项目文件夹： <code>hujiyi.github.io</code></p></li><li><p>进入文件后， 打开 <code>Git Bash</code> 命令行窗口</p></li><li><p>输入命令执行初始化：<code>hexo init</code></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init</span><br></pre></td></tr></table></figure><p>程序初始化过程如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init</span><br><span class="line">INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git</span><br><span class="line">INFO  Install dependencies</span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; urix@0.1.0: Please see https://github.com/lydell/urix#deprecat</span><br><span class="line">ed</span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve &gt; urix@0.1.0: Please see https://github.com</span><br><span class="line">/lydell/urix#deprecated</span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve &gt; resolve-url@0.2.1: https://github.com/lyd</span><br><span class="line">ell/resolve-url#deprecated</span><br><span class="line">warning Your current version of Yarn is out of <span class="built_in">date</span>. The latest version is <span class="string">&quot;1.22.15&quot;</span>, <span class="keyword">while</span> you<span class="string">&#x27;re on &quot;1.22.5&quot;.</span></span><br><span class="line"><span class="string">INFO  Start blogging with Hexo!</span></span><br></pre></td></tr></table></figure><ol start="4"><li>还原所有的包</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ yarn</span><br><span class="line">yarn install v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">Done <span class="keyword">in</span> 1.39s.</span><br></pre></td></tr></table></figure><h1 id="运行测试-Hexo-博客"><a href="#运行测试-Hexo-博客" class="headerlink" title="运行测试 Hexo 博客"></a>运行测试 Hexo 博客</h1><ol><li>生成博客文件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p>生成静态文件过程如以下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Files loaded <span class="keyword">in</span> 212 ms</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;lineno&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(Use `node --trace-warnings ...` to show <span class="built_in">where</span> the warning was created)</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;column&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;filename&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;lineno&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;column&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;filename&#x27;</span> of module exports inside circular dependency</span><br><span class="line">INFO  Generated: archives/index.html</span><br><span class="line">INFO  Generated: archives/2021/index.html</span><br><span class="line">INFO  Generated: index.html</span><br><span class="line">INFO  Generated: archives/2021/11/index.html</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.min.css</span><br><span class="line">INFO  Generated: js/script.js</span><br><span class="line">INFO  Generated: css/fonts/FontAwesome.otf</span><br><span class="line">INFO  Generated: css/style.css</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.min.js</span><br><span class="line">INFO  Generated: js/jquery-3.4.1.min.js</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.eot</span><br><span class="line">INFO  Generated: css/images/banner.jpg</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.woff</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.ttf</span><br><span class="line">INFO  Generated: 2021/11/16/hello-world/index.html</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.woff2</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.svg</span><br><span class="line">INFO  17 files generated <span class="keyword">in</span> 584 ms</span><br></pre></td></tr></table></figure><ol start="2"><li>启动本地的测试服务器</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>过程如以下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure><p>根据提示，在浏览器中打开网址：<a href="http://localhost:4000/">http://localhost:4000</a> ， 即可看到博客的运行效果：</p><img src="/2021/11/15/hexo-with-butterfly/001.PNG" class="" title="hexo"><h1 id="配置博客"><a href="#配置博客" class="headerlink" title="配置博客"></a>配置博客</h1><ol><li>修改项目根目录的 <code>_config.yml </code>, 配置博客的标题、作者等相关信息：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo Configuration</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/configuration.html</span></span><br><span class="line"><span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">Laohoo</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">&#x27;有时间，就多写点Bug，这样大家才有工作。&#x27;</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&#x27;如果你交给某人一个程序，你将折磨他一整天；如果你教某人如何编写程序，你将折磨他一辈子。. ——David Leinweber.&#x27;</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">Laohoo</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>修改项目根目录的 <code>_config.yml </code>, 配置github pages 仓库地址：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:hujiyi/hujiyi.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><ol start="3"><li>新建博客文章时使用资源文件夹</li></ol><p>使用文章资源文件夹(例如存放图片), 编辑 <code>_config.yml </code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span>   <span class="string">改为true</span>  </span><br></pre></td></tr></table></figure><h1 id="配置-git-用于部署-hexo-博客到-github-pages-仓库"><a href="#配置-git-用于部署-hexo-博客到-github-pages-仓库" class="headerlink" title="配置 git 用于部署 hexo 博客到 github pages 仓库"></a>配置 git 用于部署 hexo 博客到 github pages 仓库</h1><blockquote><p>特别说明：因为这台电脑 <code>Git</code> 配置了同时使用 <code>gitee</code> 和 <code>github</code>， 不使用全局配置, 需要对每个项目进行本地 git 配置。 和使用了 Git全局配置 操作略有不同。</p></blockquote><ol><li>初始化 git 仓库<br>在根目录下执行命令：<code>git init</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> D:/sources/hexo-repos/hujiyi.github.io/.git/</span><br></pre></td></tr></table></figure><ol start="2"><li>创建增加本地配置</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --<span class="built_in">local</span> user.name <span class="string">&#x27;你自己的github用户名&#x27;</span></span><br><span class="line">git config --<span class="built_in">local</span> user.email <span class="string">&#x27;你自己的github邮箱&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>git 非全局配置时的增加配置</li></ol><p>编辑项目中的文件： <code>.deploy_git/.git/config</code>， 在文件中添加以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">name = username</span><br><span class="line">email = email</span><br></pre></td></tr></table></figure><ol start="4"><li>安装  hexo-deployer-git</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add hexo-deployer-git</span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 1 new dependency.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ hexo-deployer-git@3.0.0</span><br><span class="line">info All dependencies</span><br><span class="line">└─ hexo-deployer-git@3.0.0</span><br><span class="line">Done <span class="keyword">in</span> 1.87s.</span><br></pre></td></tr></table></figure><ol start="5"><li>生成博客静态文件: hexo g</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Files loaded <span class="keyword">in</span> 212 ms</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;lineno&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(Use `node --trace-warnings ...` to show <span class="built_in">where</span> the warning was created)</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;column&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;filename&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;lineno&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;column&#x27;</span> of module exports inside circular dependency</span><br><span class="line">(node:1616) Warning: Accessing non-existent property <span class="string">&#x27;filename&#x27;</span> of module exports inside circular dependency</span><br><span class="line">INFO  Generated: archives/index.html</span><br><span class="line">INFO  Generated: archives/2021/index.html</span><br><span class="line">INFO  Generated: index.html</span><br><span class="line">INFO  Generated: archives/2021/11/index.html</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.min.css</span><br><span class="line">INFO  Generated: js/script.js</span><br><span class="line">INFO  Generated: css/fonts/FontAwesome.otf</span><br><span class="line">INFO  Generated: css/style.css</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.min.js</span><br><span class="line">INFO  Generated: js/jquery-3.4.1.min.js</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.eot</span><br><span class="line">INFO  Generated: css/images/banner.jpg</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.woff</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.ttf</span><br><span class="line">INFO  Generated: 2021/11/16/hello-world/index.html</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.woff2</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.svg</span><br><span class="line">INFO  17 files generated <span class="keyword">in</span> 584 ms</span><br></pre></td></tr></table></figure><ol start="6"><li>上传到 <code>github pages</code> 仓库: hexo d</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">$ hexo d</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">INFO  Copying files from extend <span class="built_in">dirs</span>...</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> 2021/11/16/hello-world/index.html.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> archives/2021/11/index.html.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> archives/2021/index.html.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> archives/index.html.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> css/fonts/fontawesome-webfont.svg.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> css/style.css.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> fancybox/jquery.fancybox.min.js.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> index.html.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> js/jquery-3.4.1.min.js.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">warning: LF will be replaced by CRLF <span class="keyword">in</span> js/script.js.</span><br><span class="line">The file will have its original line endings <span class="keyword">in</span> your working directory</span><br><span class="line">[master (root-commit) ffab492] Site updated: 2021-11-16 16:31:26</span><br><span class="line"> 17 files changed, 5202 insertions(+)</span><br><span class="line"> create mode 100644 2021/11/16/hello-world/index.html</span><br><span class="line"> create mode 100644 archives/2021/11/index.html</span><br><span class="line"> create mode 100644 archives/2021/index.html</span><br><span class="line"> create mode 100644 archives/index.html</span><br><span class="line"> create mode 100644 css/fonts/FontAwesome.otf</span><br><span class="line"> create mode 100644 css/fonts/fontawesome-webfont.eot</span><br><span class="line"> create mode 100644 css/fonts/fontawesome-webfont.svg</span><br><span class="line"> create mode 100644 css/fonts/fontawesome-webfont.ttf</span><br><span class="line"> create mode 100644 css/fonts/fontawesome-webfont.woff</span><br><span class="line"> create mode 100644 css/fonts/fontawesome-webfont.woff2</span><br><span class="line"> create mode 100644 css/images/banner.jpg</span><br><span class="line"> create mode 100644 css/style.css</span><br><span class="line"> create mode 100644 fancybox/jquery.fancybox.min.css</span><br><span class="line"> create mode 100644 fancybox/jquery.fancybox.min.js</span><br><span class="line"> create mode 100644 index.html</span><br><span class="line"> create mode 100644 js/jquery-3.4.1.min.js</span><br><span class="line"> create mode 100644 js/script.js</span><br><span class="line">Enumerating objects: 31, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (31/31), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 4 threads</span><br><span class="line">Compressing objects: 100% (25/25), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (31/31), 881.69 KiB | 2.44 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 31 (delta 4), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">To github.com:hujiyi/hujiyi.github.io.git</span><br><span class="line"> + bff8ce1...ffab492 HEAD -&gt; master (forced update)</span><br><span class="line">Branch <span class="string">&#x27;master&#x27;</span> <span class="built_in">set</span> up to track remote branch <span class="string">&#x27;master&#x27;</span> from <span class="string">&#x27;git@github.com:hujiyi/hujiyi.github.io.git&#x27;</span>.</span><br><span class="line">INFO  Deploy <span class="keyword">done</span>: git</span><br></pre></td></tr></table></figure><ol start="7"><li>在相应的 github 仓库中启用 pages 服务后，通过浏览器查看博客运行结果(此项目网址：<a href="https://hujiyi.github.io/">https://hujiyi.github.io/</a>)</li></ol><img src="/2021/11/15/hexo-with-butterfly/002.PNG" class="" title="hexo"><h1 id="使用-Butterfly-主题"><a href="#使用-Butterfly-主题" class="headerlink" title="使用 Butterfly 主题"></a>使用 Butterfly 主题</h1><h2 id="安装-Butterfly-主题"><a href="#安装-Butterfly-主题" class="headerlink" title="安装 Butterfly 主题"></a>安装 <code>Butterfly</code> 主题</h2><p>在项目根目录下执行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span><br></pre></td></tr></table></figure><p>命令执行如以下过程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span><br><span class="line">Cloning into <span class="string">&#x27;themes/butterfly&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 4685, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (719/719), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (409/409), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 4685 (delta 389), reused 551 (delta 308), pack-reused 3966</span><br><span class="line">Receiving objects: 100% (4685/4685), 2.34 MiB | 5.16 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (3028/3028), <span class="keyword">done</span>.</span><br></pre></td></tr></table></figure><h2 id="切换为-Butterfly-主题"><a href="#切换为-Butterfly-主题" class="headerlink" title="切换为 Butterfly 主题"></a>切换为 <code>Butterfly</code> 主题</h2><p>编辑项目根目录的文件： <code>_config.yml </code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line">theme: butterfly   <span class="comment"># 在这里更改主题名称</span></span><br></pre></td></tr></table></figure><h2 id="安装-Butterfly-主题需要的插件"><a href="#安装-Butterfly-主题需要的插件" class="headerlink" title="安装 Butterfly 主题需要的插件"></a>安装 <code>Butterfly</code> 主题需要的插件</h2><p>在项目根目录下执行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo-renderer-pug hexo-renderer-stylus</span><br></pre></td></tr></table></figure><p>命令执行如以下过程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add hexo-renderer-pug hexo-renderer-stylus</span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 30 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">├─ hexo-renderer-pug@2.0.0</span><br><span class="line">└─ hexo-renderer-stylus@2.0.1</span><br><span class="line">info All dependencies</span><br><span class="line">├─ @babel/helper-validator-identifier@7.15.7</span><br><span class="line">├─ @babel/parser@7.16.3</span><br><span class="line">├─ assert-never@1.2.1</span><br><span class="line">├─ babel-walk@3.0.0-canary-5</span><br><span class="line">├─ call-bind@1.0.2</span><br><span class="line">├─ character-parser@2.2.0</span><br><span class="line">├─ doctypes@1.1.0</span><br><span class="line">├─ get-intrinsic@1.1.1</span><br><span class="line">├─ has-symbols@1.0.2</span><br><span class="line">├─ has-tostringtag@1.0.0</span><br><span class="line">├─ hexo-renderer-pug@2.0.0</span><br><span class="line">├─ hexo-renderer-stylus@2.0.1</span><br><span class="line">├─ is-expression@4.0.0</span><br><span class="line">├─ is-promise@2.2.2</span><br><span class="line">├─ is-regex@1.1.4</span><br><span class="line">├─ jstransformer@1.0.0</span><br><span class="line">├─ promise@7.3.1</span><br><span class="line">├─ pug-attrs@3.0.0</span><br><span class="line">├─ pug-code-gen@3.0.2</span><br><span class="line">├─ pug-filters@4.0.0</span><br><span class="line">├─ pug-lexer@5.0.1</span><br><span class="line">├─ pug-linker@4.0.0</span><br><span class="line">├─ pug-load@3.0.0</span><br><span class="line">├─ pug-parser@6.0.0</span><br><span class="line">├─ pug-strip-comments@2.0.0</span><br><span class="line">├─ pug@3.0.2</span><br><span class="line">├─ to-fast-properties@2.0.0</span><br><span class="line">├─ token-stream@1.0.0</span><br><span class="line">├─ void-elements@3.1.0</span><br><span class="line">└─ with@7.0.2</span><br><span class="line">Done <span class="keyword">in</span> 2.48s.</span><br></pre></td></tr></table></figure><p>重新生成博客</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO</span><br><span class="line">  ===================================================================</span><br><span class="line"></span><br><span class="line">      <span class="comment">#####  #    # ##### ##### ###### #####  ###### #      #   #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #    # #      #       # #</span></span><br><span class="line">      <span class="comment">#####  #    #   #     #   #####  #    # #####  #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #####  #      #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #   #  #      #        #</span></span><br><span class="line">      <span class="comment">#####   ####    #     #   ###### #    # #      ######   #</span></span><br><span class="line"></span><br><span class="line">                            3.8.4</span><br><span class="line">  ===================================================================</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Files loaded <span class="keyword">in</span> 3.37 s</span><br><span class="line">INFO  Generated: 2021/11/16/hello-world/index.html</span><br><span class="line">INFO  Generated: archives/2021/11/index.html</span><br><span class="line">INFO  Generated: archives/2021/index.html</span><br><span class="line">INFO  Generated: archives/index.html</span><br><span class="line">INFO  Generated: index.html</span><br><span class="line">INFO  5 files generated <span class="keyword">in</span> 127 ms</span><br></pre></td></tr></table></figure><p>测试运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO</span><br><span class="line">  ===================================================================</span><br><span class="line"></span><br><span class="line">      <span class="comment">#####  #    # ##### ##### ###### #####  ###### #      #   #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #    # #      #       # #</span></span><br><span class="line">      <span class="comment">#####  #    #   #     #   #####  #    # #####  #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #####  #      #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #   #  #      #        #</span></span><br><span class="line">      <span class="comment">#####   ####    #     #   ###### #    # #      ######   #</span></span><br><span class="line"></span><br><span class="line">                            3.8.4</span><br><span class="line">  ===================================================================</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure><p>在浏览器中打开网址： <a href="http://localhost:4000/">http://localhost:4000</a> ， 运行效果如下图所示：</p><img src="/2021/11/15/hexo-with-butterfly/003.PNG" class="" title="hexo"><h2 id="添加博客的-page"><a href="#添加博客的-page" class="headerlink" title="添加博客的 page"></a>添加博客的 page</h2><ol><li>新建标签 tags 页面</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><ol><li>新建标签 tags 页面</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page <span class="string">&quot;tags&quot;</span></span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO</span><br><span class="line">  ===================================================================</span><br><span class="line"></span><br><span class="line">      <span class="comment">#####  #    # ##### ##### ###### #####  ###### #      #   #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #    # #      #       # #</span></span><br><span class="line">      <span class="comment">#####  #    #   #     #   #####  #    # #####  #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #####  #      #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #   #  #      #        #</span></span><br><span class="line">      <span class="comment">#####   ####    #     #   ###### #    # #      ######   #</span></span><br><span class="line"></span><br><span class="line">                            3.8.4</span><br><span class="line">  ===================================================================</span><br><span class="line">INFO  Created: D:\sources\hexo-repos\hujiyi.github.io\<span class="built_in">source</span>\tags\index.md</span><br></pre></td></tr></table></figure><p>编辑文件: <code>source/tags/index.md</code> , 修改内容如以下所示:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: tags</span><br><span class="line">date: 2021-11-16 16:00:00</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line"><span class="section">layout: &quot;tags&quot;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><ol start="2"><li>新建分类 categories 页面</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page <span class="string">&quot;categories&quot;</span></span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO</span><br><span class="line">  ===================================================================</span><br><span class="line"></span><br><span class="line">      <span class="comment">#####  #    # ##### ##### ###### #####  ###### #      #   #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #    # #      #       # #</span></span><br><span class="line">      <span class="comment">#####  #    #   #     #   #####  #    # #####  #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #####  #      #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #   #  #      #        #</span></span><br><span class="line">      <span class="comment">#####   ####    #     #   ###### #    # #      ######   #</span></span><br><span class="line"></span><br><span class="line">                            3.8.4</span><br><span class="line">  ===================================================================</span><br><span class="line">INFO  Created: D:\sources\hexo-repos\hujiyi.github.io\<span class="built_in">source</span>\categories\index.md</span><br></pre></td></tr></table></figure><p>编辑文件: <code>source/categories/index.md</code> , 修改内容如以下所示:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: categories</span><br><span class="line">date: 2021-11-16 16:00:00</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line"><span class="section">layout: &quot;categories&quot;</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>新建关于 about 页面</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page <span class="string">&quot;about&quot;</span></span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO</span><br><span class="line">  ===================================================================</span><br><span class="line"></span><br><span class="line">      <span class="comment">#####  #    # ##### ##### ###### #####  ###### #      #   #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #    # #      #       # #</span></span><br><span class="line">      <span class="comment">#####  #    #   #     #   #####  #    # #####  #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #####  #      #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #   #  #      #        #</span></span><br><span class="line">      <span class="comment">#####   ####    #     #   ###### #    # #      ######   #</span></span><br><span class="line"></span><br><span class="line">                            3.8.4</span><br><span class="line">  ===================================================================</span><br><span class="line">INFO  Created: D:\sources\hexo-repos\hujiyi.github.io\<span class="built_in">source</span>\about\index.md</span><br></pre></td></tr></table></figure><p>编辑文件: <code>source/about/index.md</code> , 修改内容如以下所示:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: about</span><br><span class="line">date: 2021-11-16 16:00:00</span><br><span class="line">type: &quot;about&quot;</span><br><span class="line"><span class="section">layout: &quot;about&quot;</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line">这里什么都没有留下</span><br></pre></td></tr></table></figure><ol start="4"><li>新建友情链接 link 页面</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page <span class="built_in">link</span></span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO</span><br><span class="line">  ===================================================================</span><br><span class="line"></span><br><span class="line">      <span class="comment">#####  #    # ##### ##### ###### #####  ###### #      #   #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #    # #      #       # #</span></span><br><span class="line">      <span class="comment">#####  #    #   #     #   #####  #    # #####  #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #####  #      #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #   #  #      #        #</span></span><br><span class="line">      <span class="comment">#####   ####    #     #   ###### #    # #      ######   #</span></span><br><span class="line"></span><br><span class="line">                            3.8.4</span><br><span class="line">  ===================================================================</span><br><span class="line">INFO  Created: D:\sources\hexo-repos\hujiyi.github.io\<span class="built_in">source</span>\<span class="built_in">link</span>\index.md</span><br></pre></td></tr></table></figure><p>编辑文件: <code>source/link/index.md</code> , 修改内容如以下所示:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: link</span><br><span class="line">date: 2021-11-16 16:00:00</span><br><span class="line">type: &quot;link&quot;</span><br><span class="line"><span class="section">layout: &quot;link&quot;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><p>在 <code>Hexo博客目录</code> 中的 <code>source/_data</code>（如果没有 _data 文件夹，请自行创建），创建一个文件 <code>link.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">class_name:</span> <span class="string">友情链接</span></span><br><span class="line">  <span class="attr">class_desc:</span> <span class="string">那些人，那些事</span></span><br><span class="line">  <span class="attr">link_list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hexo</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://hexo.io/zh-tw/</span></span><br><span class="line">      <span class="attr">avatar:</span> <span class="string">https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg</span></span><br><span class="line">      <span class="attr">descr:</span> <span class="string">快速、简单且强大的网誌框架</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">class_name:</span> <span class="string">网站</span></span><br><span class="line">  <span class="attr">class_desc:</span> <span class="string">值得推荐的网站</span></span><br><span class="line">  <span class="attr">link_list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Laohoo</span> <span class="string">@gitee.io</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://hujiyi.gitee.io/</span></span><br><span class="line">      <span class="attr">avatar:</span> <span class="string">https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png</span></span><br><span class="line">      <span class="attr">descr:</span> <span class="string">博客网站</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Weibo</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://www.weibo.com/</span></span><br><span class="line">      <span class="attr">avatar:</span> <span class="string">https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png</span></span><br><span class="line">      <span class="attr">descr:</span> <span class="string">中国最大社交分享平台</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Twitter</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://twitter.com/</span></span><br><span class="line">      <span class="attr">avatar:</span> <span class="string">https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png</span></span><br><span class="line">      <span class="attr">descr:</span> <span class="string">社交分享平台</span></span><br></pre></td></tr></table></figure><blockquote><p>class_name和class_desc支持html格式书写，如不需要，也可以留空。</p></blockquote><ol start="5"><li>新建音乐 music 页面</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page music</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO</span><br><span class="line">  ===================================================================</span><br><span class="line"></span><br><span class="line">      <span class="comment">#####  #    # ##### ##### ###### #####  ###### #      #   #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #    # #      #       # #</span></span><br><span class="line">      <span class="comment">#####  #    #   #     #   #####  #    # #####  #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #####  #      #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #   #  #      #        #</span></span><br><span class="line">      <span class="comment">#####   ####    #     #   ###### #    # #      ######   #</span></span><br><span class="line"></span><br><span class="line">                            3.8.4</span><br><span class="line">  ===================================================================</span><br><span class="line">INFO  Created: D:\sources\hexo-repos\hujiyi.github.io\<span class="built_in">source</span>\music\index.md</span><br></pre></td></tr></table></figure><p>编辑文件: <code>source/music/index.md</code> , 修改内容如以下所示:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: music</span><br><span class="line">date: 2021-11-16 16:00:00</span><br><span class="line">type: &quot;music&quot;</span><br><span class="line"><span class="section">layout: &quot;music&quot;</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line">这里什么都没有留下</span><br></pre></td></tr></table></figure><ol start="6"><li>新建电影 movies 页面</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page movies</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO</span><br><span class="line">  ===================================================================</span><br><span class="line"></span><br><span class="line">      <span class="comment">#####  #    # ##### ##### ###### #####  ###### #      #   #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #    # #      #       # #</span></span><br><span class="line">      <span class="comment">#####  #    #   #     #   #####  #    # #####  #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #####  #      #        #</span></span><br><span class="line">      <span class="comment">#    # #    #   #     #   #      #   #  #      #        #</span></span><br><span class="line">      <span class="comment">#####   ####    #     #   ###### #    # #      ######   #</span></span><br><span class="line"></span><br><span class="line">                            3.8.4</span><br><span class="line">  ===================================================================</span><br><span class="line">INFO  Created: D:\sources\hexo-repos\hujiyi.github.io\<span class="built_in">source</span>\movies\index.md</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编辑文件: <code>source/movies/index.md</code> , 修改内容如以下所示:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: movies</span><br><span class="line">date: 2021-11-16 16:00:00</span><br><span class="line">type: &quot;movies&quot;</span><br><span class="line"><span class="section">layout: &quot;movies&quot;</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line">这里什么都没有留下</span><br></pre></td></tr></table></figure><h2 id="配置主题"><a href="#配置主题" class="headerlink" title="配置主题"></a>配置主题</h2><p>在 <code>hexo博客</code> 的根目录创建一个文件 <code>_config.butterfly.yml</code>，并把主题目录的 <code>themes/butterfly/_config.yml</code> 内容复制到 <code>_config.butterfly.yml</code> 去</p><p>编辑 <code>_config.butterfly.yml</code>，启用导航主菜单：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># format: name: link || icon</span></span><br><span class="line"><span class="comment"># sub-menu</span></span><br><span class="line"><span class="comment"># name || icon:</span></span><br><span class="line"><span class="comment">#   name: link || icon</span></span><br><span class="line"></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">Home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="attr">Archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="attr">Tags:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="attr">Categories:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-folder-open</span></span><br><span class="line">  <span class="string">List||fas</span> <span class="attr">fa-list:</span></span><br><span class="line">    <span class="attr">Music:</span> <span class="string">/music/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-music</span></span><br><span class="line">    <span class="attr">Movie:</span> <span class="string">/movies/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-video</span></span><br><span class="line">  <span class="attr">Link:</span> <span class="string">/link/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-link</span></span><br><span class="line">  <span class="attr">About:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-heart</span></span><br></pre></td></tr></table></figure><blockquote><p>注意： 不要把主题目录的 _config.yml 删掉</p></blockquote><blockquote><p>注意： 以后只需要在 _config.butterfly.yml进行配置就行。如果使用了 _config.butterfly.yml， 配置主题的 themes&#x2F;butterfly&#x2F;_config.yml  将不会有效果。</p></blockquote><blockquote><p>Hexo会自动合并主题中的themes&#x2F;butterfly&#x2F;_config.yml 和 _config.butterfly.yml 里的配置，如果存在同名配置，会使用_config.butterfly.yml 的配置，其优先度较高</p></blockquote><h2 id="使用本地搜索-hexo-generator-search"><a href="#使用本地搜索-hexo-generator-search" class="headerlink" title="使用本地搜索 hexo-generator-search"></a>使用本地搜索 <code>hexo-generator-search</code></h2><ol><li>安装搜索插件:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add hexo-generator-search</span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 1 new dependency.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ hexo-generator-search@2.4.3</span><br><span class="line">info All dependencies</span><br><span class="line">└─ hexo-generator-search@2.4.3</span><br><span class="line">Done <span class="keyword">in</span> 2.66s.</span><br></pre></td></tr></table></figure><ol start="2"><li>编辑 <code>_config.butterfly.yml </code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line">local_search:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span>    <span class="comment"># 改为 true</span></span><br></pre></td></tr></table></figure><h2 id="字数统计"><a href="#字数统计" class="headerlink" title="字数统计"></a>字数统计</h2><ol><li>安装插件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo-wordcount</span><br></pre></td></tr></table></figure><ol start="2"><li>编辑 <code>_config.butterfly.yml </code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wordcount (字數統計)</span></span><br><span class="line">wordcount:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span>    <span class="comment"># 改为 true</span></span><br><span class="line">  post_wordcount: <span class="literal">true</span></span><br><span class="line">  min2read: <span class="literal">true</span></span><br><span class="line">  total_wordcount: <span class="literal">true</span></span><br></pre></td></tr></table></figure><h1 id="使用-Gitalk-评论系统"><a href="#使用-Gitalk-评论系统" class="headerlink" title="使用 Gitalk 评论系统"></a>使用 <code>Gitalk</code> 评论系统</h1><h2 id="创建-OAuth-Application"><a href="#创建-OAuth-Application" class="headerlink" title="创建 OAuth Application"></a>创建 <code>OAuth Application</code></h2><p><code>Gitalk</code> 需要一个<code> Github Application</code>，打开 <a href="https://github.com/settings/applications/new">https://github.com/settings/applications/new</a>  当然，也可以在用户头像下的 <code>setting</code> 下的 <code>Developer settings</code> 中 new 一个 <code>Application</code>，然后填写相应的参数。</p><p>Register a new OAuth application</p><p>Application name  （名字随便填，例如：Hujy blog comments）</p><pre><code>Something users will recognize and trust.</code></pre><p>Homepage URL  （博客地址：<a href="https://hujiyi.github.io/%EF%BC%89">https://hujiyi.github.io/）</a></p><pre><code>The full URL to your application homepage.</code></pre><p>Application description  （描述，随便填）</p><pre><code>This is displayed to all users of your application.</code></pre><p>Authorization callback URL  （博客地址，回调地址：<a href="https://hujiyi.github.io/%EF%BC%89">https://hujiyi.github.io/）</a></p><pre><code>Your application’s callback URL. Read our OAuth documentation for more information.</code></pre><p>完成后会生成相应的 <code>clientID</code> 和 <code>clientSecret</code>。</p><h2 id="启用-Gitalk-评论系统"><a href="#启用-Gitalk-评论系统" class="headerlink" title="启用 Gitalk 评论系统"></a>启用 <code>Gitalk</code> 评论系统</h2><p>打开 <code>_config.butterfly.yml</code> , 找到 <code># Comments System</code>, 修改如以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comments System</span></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"></span><br><span class="line">comments:</span><br><span class="line">  <span class="comment"># Up to two comments system, the first will be shown as default</span></span><br><span class="line">  <span class="comment"># Choose: Disqus/Disqusjs/Livere/Gitalk/Valine/Waline/Utterances/Facebook Comments/Twikoo</span></span><br><span class="line">  use:</span><br><span class="line">   - Gitalk </span><br><span class="line">  <span class="comment"># - Valine</span></span><br><span class="line">  <span class="comment"># - Disqus</span></span><br><span class="line">  text: <span class="literal">true</span> <span class="comment"># Display the comment name next to the button</span></span><br><span class="line">  <span class="comment"># lazyload: The comment system will be load when comment element enters the browser&#x27;s viewport.</span></span><br><span class="line">  <span class="comment"># If you set it to true, the comment count will be invalid</span></span><br><span class="line">  lazyload: <span class="literal">true</span></span><br><span class="line">  count: <span class="literal">true</span> <span class="comment"># Display comment count in post&#x27;s top_img</span></span><br><span class="line">  card_post_count: <span class="literal">true</span> <span class="comment"># Display comment count in Home Page</span></span><br></pre></td></tr></table></figure><p>继续在 <code>_config.butterfly.yml</code>中 , 找到 <code># gitalk</code>, 修改如以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gitalk</span></span><br><span class="line"><span class="comment"># https://github.com/gitalk/gitalk</span></span><br><span class="line">gitalk:</span><br><span class="line">  client_id: 66************** <span class="comment">#必须. GitHub Application Client ID.</span></span><br><span class="line">  client_secret: abac*************************************** <span class="comment">#必须. GitHub Application Client Secret.</span></span><br><span class="line">  repo: blogcomments <span class="comment">#必须. GitHub repository.</span></span><br><span class="line">  owner: hujiyi <span class="comment">#必须. GitHub repository 所有者，可以是个人或者组织。</span></span><br><span class="line">  admin: hujiyi <span class="comment">#必须. GitHub repository 的所有者和合作者 (对这个 repository 有写权限的用户)。</span></span><br><span class="line">  language: zh-CN <span class="comment"># en, zh-CN, zh-TW, es-ES, fr, ru</span></span><br><span class="line">  perPage: 10 <span class="comment"># Pagination size, with maximum 100.</span></span><br><span class="line">  distractionFreeMode: <span class="literal">false</span> <span class="comment"># Facebook-like distraction free mode.</span></span><br><span class="line">  pagerDirection: last <span class="comment"># Comment sorting direction, available values are last and first.</span></span><br><span class="line">  createIssueManually: <span class="literal">false</span> <span class="comment"># Gitalk will create a corresponding github issue for your every single page automatically</span></span><br><span class="line">  option:</span><br></pre></td></tr></table></figure><blockquote><p>以上内容中的 <code>client_id</code> 和 <code>client_secret</code> 的值已用 <code>*</code> 进行隐藏;</p></blockquote><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
            <tag> github pages </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flutter introduction part II：使用Provider 的深浅色模式和多语言切换</title>
      <link href="/2021/02/04/flutter-introduction-part-II/"/>
      <url>/2021/02/04/flutter-introduction-part-II/</url>
      
        <content type="html"><![CDATA[<p>上一节创建了项目，并通过 <code>Intl</code> 实现在项目的多语言国际化支持。但是还没有在项目提供多语言的切换功能。</p><p>这一节除了实现多语言的选择切换功能，还同时实现项目的深色、浅色主题切换，需要用过以下两个包：</p><ol><li><p><code>Provider</code>: <code>Provider</code>是 <code>Google I/O 2019</code>官方推荐的状态管理方式，是一套实现跨组件状态共享的解决方案。</p></li><li><p><code>shared_preferences</code> : <code>shared_preferences</code> 是一个轻量级存储类，以键值对的形式保存设置，属性和数据。</p></li></ol><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在项目的 <code>pubspec.yaml</code> 文件中增加以下包依赖：</p><p><code>Provider</code>的最新版本查询：<a href="https://pub.dev/packages/provider">https://pub.dev/packages/provider</a><br><code>shared_preferences</code>的最新版本查询：<a href="https://pub.dev/packages/shared_preferences">https://pub.dev/packages/shared_preferences</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">flutter:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line">  <span class="comment"># 国际化</span></span><br><span class="line">  <span class="attr">flutter_localizations:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cupertino_icons:</span> <span class="string">^1.0.0</span></span><br><span class="line">  <span class="attr">intl:</span> <span class="string">^0.16.1</span></span><br><span class="line">  <span class="attr">intl_translation:</span> <span class="string">^0.17.10+1</span></span><br><span class="line">  <span class="attr">provider:</span> <span class="string">^4.3.3</span>                 <span class="comment"># 增加这一行</span></span><br><span class="line">  <span class="attr">shared_preferences:</span> <span class="string">^0.5.12+4</span>    <span class="comment"># 增加这一行</span></span><br></pre></td></tr></table></figure><p>保存 <code>pubspec.yaml</code> 文件以获取包文件</p><p>打开语言文件 <code>lib\l10n\intl_en.arb</code>，编辑其内容如以下代码：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;appName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Deep Sky&quot;</span><span class="punctuation">,</span>   </span><br><span class="line">    <span class="attr">&quot;login&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Login&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tabHome&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Home&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tabProject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Project&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Settings&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settingLanguage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Language&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;autoBySystem&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;themeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Theme Mode&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;darkMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Dark Mode&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lightMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;Light Mode&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>打开语言文件 <code>lib\l10n\intl_zh.arb</code>，编辑其内容如以下代码：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;appName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深处天空&quot;</span><span class="punctuation">,</span>    </span><br><span class="line">    <span class="attr">&quot;login&quot;</span><span class="punctuation">:</span> <span class="string">&quot;登录&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tabHome&quot;</span><span class="punctuation">:</span> <span class="string">&quot;首页&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tabProject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;项目&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="string">&quot;设置&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settingLanguage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;语言设置&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;autoBySystem&quot;</span><span class="punctuation">:</span> <span class="string">&quot;跟随系统&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;themeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;主题模式&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;darkMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深色模式&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lightMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;浅色模式&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="主导航页"><a href="#主导航页" class="headerlink" title="主导航页"></a>主导航页</h2><p>在项目中新建文件夹: <code>lib\views</code> </p><p>在项目中新建文件: <code>lib\views\home_page.dart</code> </p><p>在项目中新建文件夹: <code>lib\views\settings</code> </p><p>在项目中新建文件：<code>lib\views\settings\settings_page.dart</code></p><p>打开文件 <code>lib\views\home_page.dart</code> ， 编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      child: Text(<span class="string">&#x27;Home&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打开文件 <code>lib\views\settings\settings_page.dart</code>， 编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SettingsPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      child: Text(<span class="string">&#x27;Settings&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打开文件 <code>lib\views\tab_navigator_page.dart</code>， 编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/generated/l10n.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/views/home_page.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/views/settings/settings_page.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TabNavigatorPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _TabNavigatorPageState createState() =&gt; _TabNavigatorPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_TabNavigatorPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">TabNavigatorPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _selectedIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; widgets = [HomePage(), HomePage(), SettingsPage()];</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      child: Scaffold(</span><br><span class="line">        body: widgets[_selectedIndex],</span><br><span class="line">        bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">          onTap: (index) &#123;</span><br><span class="line">            setState(() &#123;</span><br><span class="line">              _selectedIndex = index;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">          currentIndex: _selectedIndex,</span><br><span class="line">          type: BottomNavigationBarType.fixed,</span><br><span class="line">          items: [</span><br><span class="line">            BottomNavigationBarItem(</span><br><span class="line">              icon: Icon(Icons.home_outlined),</span><br><span class="line">              activeIcon: Icon(Icons.home),</span><br><span class="line">              label: S.of(context).tabHome,</span><br><span class="line">            ),</span><br><span class="line">            BottomNavigationBarItem(</span><br><span class="line">              icon: Icon(Icons.adb_outlined),</span><br><span class="line">              label: S.of(context).tabProject,</span><br><span class="line">            ),</span><br><span class="line">            BottomNavigationBarItem(</span><br><span class="line">              icon: Icon(Icons.account_circle_outlined),</span><br><span class="line">              activeIcon: Icon(Icons.account_circle),</span><br><span class="line">              label: S.of(context).settings,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目运行</p><img src="/2021/02/04/flutter-introduction-part-II/01home_run.png" class="" title="homerun"><h2 id="添加-Provider-状态管理类"><a href="#添加-Provider-状态管理类" class="headerlink" title="添加 Provider 状态管理类"></a>添加 <code>Provider</code> 状态管理类</h2><p>新建文件夹：<code>lib\provider</code>, 然后新建两个状态管理文件：<code>lib\provider\locale_provider.dart</code> 和 <code>lib\provider\theme_provider.dart</code></p><h3 id="主题模式状态管理"><a href="#主题模式状态管理" class="headerlink" title="主题模式状态管理"></a>主题模式状态管理</h3><p>打开文件 <code>lib\provider\theme_provider.dart</code>, 编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:shared_preferences/shared_preferences.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/generated/l10n.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参考资料：https://omadijaya.id/flutter-dynamic-dark-mode-with-provider-and-shared-preferences/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemeProvider</span> <span class="keyword">extends</span> <span class="title">ChangeNotifier</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> key = <span class="string">&#x27;theme&#x27;</span>; <span class="comment">// 用于保存当前主题状态的键名</span></span><br><span class="line">  <span class="comment">// 定义用于三种主题模式的字典</span></span><br><span class="line">  <span class="built_in">Map</span> themeModeList = &lt;<span class="built_in">String</span>, ThemeMode&gt;&#123;</span><br><span class="line">    <span class="string">&#x27;dark&#x27;</span>: ThemeMode.dark, <span class="comment">// 深色模式</span></span><br><span class="line">    <span class="string">&#x27;light&#x27;</span>: ThemeMode.light, <span class="comment">// 浅色模式</span></span><br><span class="line">    <span class="string">&#x27;system&#x27;</span>: ThemeMode.system <span class="comment">// 跟随系统</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  SharedPreferences _preferences;</span><br><span class="line">  <span class="built_in">String</span> _themeMode;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回当前的主题模式</span></span><br><span class="line">  <span class="built_in">String</span> <span class="keyword">get</span> themeMode =&gt; _themeMode;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 构造方法</span></span><br><span class="line">  ThemeProvider() &#123;</span><br><span class="line">    _themeMode = <span class="string">&#x27;system&#x27;</span>; <span class="comment">// 默认为跟随系统</span></span><br><span class="line">    _loadFromPreferences(); <span class="comment">// 读取已有模式设置</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回用于显示在界面上的主题选项名称</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">String</span> getThemeModeName(<span class="built_in">String</span> mode, context) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;dark&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> S.of(context).darkMode;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;light&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> S.of(context).lightMode;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> S.of(context).autoBySystem;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回当前的主题模式</span></span><br><span class="line">  ThemeMode getThemeMode(<span class="built_in">String</span> mode) &#123;</span><br><span class="line">    <span class="keyword">return</span> themeModeList[mode];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 深色、浅色模式设置</span></span><br><span class="line">  ThemeData getThemeData(&#123;<span class="built_in">bool</span> isDark = <span class="keyword">false</span>&#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> ThemeData(brightness: isDark ? Brightness.dark : Brightness.light);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 SharedPreferences</span></span><br><span class="line">  _initialPreferences() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (_preferences == <span class="keyword">null</span>)</span><br><span class="line">      _preferences = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  保存状态</span></span><br><span class="line">  _savePreferences() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> _initialPreferences();</span><br><span class="line">    _preferences.setString(key, _themeMode);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读取状态</span></span><br><span class="line">  _loadFromPreferences() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> _initialPreferences();</span><br><span class="line">    _themeMode = _preferences.getString(key) ?? <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    notifyListeners();  <span class="comment">// 变更通知，在数据处理完成后执行</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 深浅色切换状态</span></span><br><span class="line">  toggleChangeTheme(val) &#123;</span><br><span class="line">    _themeMode = val;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;current theme mode: <span class="subst">$_themeMode</span>&#x27;</span>);</span><br><span class="line">    _savePreferences();</span><br><span class="line">    notifyListeners();  <span class="comment">// 变更通知，在数据处理完成后执行</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="多语言状态管理"><a href="#多语言状态管理" class="headerlink" title="多语言状态管理"></a>多语言状态管理</h3><p>打开文件 <code>lib\provider\locale_provider.dart</code>， 编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:shared_preferences/shared_preferences.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/generated/l10n.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocaleProvider</span> <span class="keyword">extends</span> <span class="title">ChangeNotifier</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> key = <span class="string">&#x27;locale&#x27;</span>; <span class="comment">// 用于保存当前语言的键名</span></span><br><span class="line"></span><br><span class="line">  SharedPreferences _preferences;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> _language; <span class="comment">// 当前的语言名称，例如：&#x27;zh&#x27;，&#x27;en&#x27;等</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> <span class="keyword">get</span> language =&gt; _language; <span class="comment">// 返回当前语言名称</span></span><br><span class="line"></span><br><span class="line">  Locale <span class="keyword">get</span> locale &#123;</span><br><span class="line">    <span class="keyword">if</span> (_language != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> Locale(_language);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回用于显示在界面中的语言名字</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">String</span> localeName(<span class="built_in">String</span> lang, context) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (lang) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;en&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;English&#x27;</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;zh&#x27;</span>:</span><br><span class="line">        <span class="comment">// case &#x27;zh_CN&#x27;:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;简体中文&#x27;</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> S.of(context).autoBySystem;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 构造方法</span></span><br><span class="line">  LocaleProvider() &#123;</span><br><span class="line">    _language = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 默认语言跟随系统</span></span><br><span class="line">    _loadFromPreferences();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 SharedPreferences</span></span><br><span class="line">  _initialPreferences() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (_preferences == <span class="keyword">null</span>)</span><br><span class="line">      _preferences = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保存当前的语言名称</span></span><br><span class="line">  _savePreferences() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> _initialPreferences();</span><br><span class="line">    _preferences.setString(key, _language);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读取已保存的语言名称</span></span><br><span class="line">  _loadFromPreferences() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> _initialPreferences();</span><br><span class="line">    _language = _preferences.getString(key) ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    notifyListeners();  <span class="comment">// 变更通知，在数据处理完成后执行</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 切换语言</span></span><br><span class="line">  toggleChangeLocale(<span class="built_in">String</span> language) &#123;</span><br><span class="line">    _language = language;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;current locale: <span class="subst">$language</span>&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    _savePreferences();</span><br><span class="line">    notifyListeners();  <span class="comment">// 变更通知，在数据处理完成后执行</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="修改入口文件-main-dart"><a href="#修改入口文件-main-dart" class="headerlink" title="修改入口文件 main.dart"></a>修改入口文件 <code>main.dart</code></h2><p>打开文件<code>lib\main.dart</code>， 编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_localizations/flutter_localizations.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:provider/provider.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/generated/l10n.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/provider/locale_provider.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/provider/theme_provider.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/views/tab_navigator_page.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// This widget is the root of your application.</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// MultiProvider 用于管理多个 Provider</span></span><br><span class="line">    <span class="keyword">return</span> MultiProvider(</span><br><span class="line">      providers: [</span><br><span class="line">        <span class="comment">// ChangeNotifierProvider 用于对 ChangeNotifier 进行监听</span></span><br><span class="line">        ChangeNotifierProvider&lt;ThemeProvider&gt;(</span><br><span class="line">            create: (context) =&gt; ThemeProvider()),</span><br><span class="line">        <span class="comment">// ChangeNotifierProvider 用于对 ChangeNotifier 进行监听</span></span><br><span class="line">        ChangeNotifierProvider&lt;LocaleProvider&gt;(</span><br><span class="line">            create: (context) =&gt; LocaleProvider()),</span><br><span class="line">      ],</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 通过 Consumer2 来组合同时监听两个结果，&lt;&gt;内的对象数量与 Consumer 后面的数字一致</span></span><br><span class="line">      child: Consumer2&lt;ThemeProvider, LocaleProvider&gt;(</span><br><span class="line">        builder: (context, ThemeProvider themeProvider,</span><br><span class="line">            LocaleProvider localeProvider, child) &#123;</span><br><span class="line">          <span class="keyword">return</span> MaterialApp(</span><br><span class="line">            localizationsDelegates: <span class="keyword">const</span> [</span><br><span class="line">              S.delegate,</span><br><span class="line">              GlobalMaterialLocalizations.delegate,</span><br><span class="line">              GlobalCupertinoLocalizations.delegate,</span><br><span class="line">              GlobalWidgetsLocalizations.delegate</span><br><span class="line">            ],</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 语言列表方式一：自动获取所有语言列表</span></span><br><span class="line">            <span class="comment">// supportedLocales: S.delegate.supportedLocales,</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 语言列表方式二：自动获取并设置一个默认语言</span></span><br><span class="line">            supportedLocales: [</span><br><span class="line">              <span class="keyword">const</span> Locale(<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">              ...S.delegate.supportedLocales</span><br><span class="line">            ],</span><br><span class="line">            <span class="comment">// 语言列表方式三：手动添加语言列表</span></span><br><span class="line">            <span class="comment">// supportedLocales: [</span></span><br><span class="line">            <span class="comment">//   const Locale(&#x27;zh&#x27;, &#x27;CN&#x27;),</span></span><br><span class="line">            <span class="comment">//   const Locale(&#x27;en&#x27;, &#x27;US&#x27;),</span></span><br><span class="line">            <span class="comment">// ],</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// localeListResolutionCallback: (locale, supportedLocales) &#123;</span></span><br><span class="line">            <span class="comment">//   print(locale); // 在控制台显示当前语言</span></span><br><span class="line">            <span class="comment">//                return null;</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 插件目前不完善手动处理简繁体</span></span><br><span class="line">            <span class="comment">// 也用于处理 zh 和 zh_CN 这样有两个不同名字的语言</span></span><br><span class="line">            localeResolutionCallback: (locale, supportLocales) &#123;</span><br><span class="line">              <span class="comment">// 中文 简繁体处理</span></span><br><span class="line">              <span class="keyword">if</span> (locale?.languageCode == <span class="string">&#x27;zh&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (locale?.scriptCode == <span class="string">&#x27;Hant&#x27;</span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">const</span> Locale(<span class="string">&#x27;zh&#x27;</span>, <span class="string">&#x27;HK&#x27;</span>); <span class="comment">//繁体</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">const</span> Locale(<span class="string">&#x27;zh&#x27;</span>, <span class="string">&#x27;CN&#x27;</span>); <span class="comment">//简体</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取 当前的语言</span></span><br><span class="line">            locale: Provider.of&lt;LocaleProvider&gt;(context, listen: <span class="keyword">false</span>).locale,</span><br><span class="line"></span><br><span class="line">            title: <span class="string">&#x27;Deep Sky&#x27;</span>,</span><br><span class="line">            <span class="comment">// 生成应用标题</span></span><br><span class="line">            onGenerateTitle: (context) &#123;</span><br><span class="line">              <span class="keyword">return</span> S.of(context).appName;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 深色、浅色主题选择 的第一种方式</span></span><br><span class="line">            <span class="comment">// theme: themeProvider.darkMode ? dark_mode : light_mode,</span></span><br><span class="line"></span><br><span class="line">            theme: ThemeData(</span><br><span class="line">              primarySwatch: Colors.blue,</span><br><span class="line">              visualDensity: VisualDensity.adaptivePlatformDensity,</span><br><span class="line">            ),</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 深色、浅色主题选择 的第二种方式的第一个选项</span></span><br><span class="line">            themeMode: themeProvider.getThemeMode(</span><br><span class="line">                Provider.of&lt;ThemeProvider&gt;(context, listen: <span class="keyword">false</span>).themeMode),</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 深色、浅色主题选择 的第二种方式的第二个选项, 少了这个上面的第一个选项不起作用</span></span><br><span class="line">            darkTheme: ThemeData(brightness: Brightness.dark),</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置文字大小不随系统设置改变</span></span><br><span class="line">            builder: (context, widget) &#123;</span><br><span class="line">              <span class="keyword">return</span> MediaQuery(</span><br><span class="line">                  data: MediaQuery.of(context).copyWith(textScaleFactor: <span class="number">1.0</span>),</span><br><span class="line">                  child: widget);</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 主页</span></span><br><span class="line">            home: TabNavigatorPage(),</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="设置页"><a href="#设置页" class="headerlink" title="设置页"></a>设置页</h2><p>新建文件夹：<code>lib\views\settings\widgets</code></p><p>然后新建文件：<code>lib\views\settings\widgets\account_info.dart</code> 和 <code>lib\views\settings\widgets\common_settings.dart</code></p><h3 id="设置页的用户信息部分"><a href="#设置页的用户信息部分" class="headerlink" title="设置页的用户信息部分"></a>设置页的用户信息部分</h3><p>打开文件<code>lib\views\settings\widgets\account_info.dart</code>， 编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/generated/l10n.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountInfo</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      width: MediaQuery.of(context).size.width,</span><br><span class="line">      padding: EdgeInsets.only(top: <span class="number">80</span>, bottom: <span class="number">50</span>),</span><br><span class="line">      child: CircleAvatar(</span><br><span class="line">        backgroundColor: Theme.of(context).primaryColor,</span><br><span class="line">        radius: <span class="number">50</span>,</span><br><span class="line">        child: Text(</span><br><span class="line">          S.of(context).login,</span><br><span class="line">          style: TextStyle(fontSize: <span class="number">20</span>),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="设置页的-主题模式切换和多语言切换部分"><a href="#设置页的-主题模式切换和多语言切换部分" class="headerlink" title="设置页的 主题模式切换和多语言切换部分"></a>设置页的 <code>主题模式切换</code>和<code>多语言切换</code>部分</h3><p>打开文件<code>lib\views\settings\widgets\common_settings.dart</code>，编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:provider/provider.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/generated/l10n.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/provider/locale_provider.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/provider/theme_provider.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonSettings</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      <span class="comment">// 使用 MediaQuery 获取屏幕宽度</span></span><br><span class="line">      width: MediaQuery.of(context).size.width,</span><br><span class="line">      child: Column(</span><br><span class="line">        <span class="comment">// 交叉轴对齐方式</span></span><br><span class="line">        crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">        children: [</span><br><span class="line">          Padding(</span><br><span class="line">            padding: EdgeInsets.only(left: <span class="number">15</span>, top: <span class="number">10</span>),</span><br><span class="line">            child: Text(S.of(context).settings),</span><br><span class="line">          ),</span><br><span class="line">          SizedBox(</span><br><span class="line">            height: <span class="number">10</span>,</span><br><span class="line">          ),</span><br><span class="line">          Container(</span><br><span class="line">            child: ExpansionTile(</span><br><span class="line">              title: Row(</span><br><span class="line">                <span class="comment">// 主轴对齐方式</span></span><br><span class="line">                mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">                children: [</span><br><span class="line">                  Text(S.of(context).themeMode),</span><br><span class="line">                  Text(ThemeProvider.getThemeModeName(</span><br><span class="line">                      Provider.of&lt;ThemeProvider&gt;(context).themeMode, context)),</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">              children: [</span><br><span class="line">                <span class="comment">// system: 表示主题模式跟随系统</span></span><br><span class="line">                _themeModeItem(Icon(Icons.<span class="keyword">sync</span>), <span class="string">&#x27;system&#x27;</span>, context),</span><br><span class="line">                <span class="comment">// dark: 深色模式</span></span><br><span class="line">                _themeModeItem(Icon(Icons.brightness_2), <span class="string">&#x27;dark&#x27;</span>, context),</span><br><span class="line">                <span class="comment">// light：浅色模式</span></span><br><span class="line">                _themeModeItem(Icon(Icons.wb_sunny_outlined), <span class="string">&#x27;light&#x27;</span>, context),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Container(</span><br><span class="line">            child: ExpansionTile(</span><br><span class="line">              title: Row(</span><br><span class="line">                mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">                children: [</span><br><span class="line">                  Text(S.of(context).settingLanguage),</span><br><span class="line">                  Text(LocaleProvider.localeName(</span><br><span class="line">                      Provider.of&lt;LocaleProvider&gt;(context).language, context)),</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">              children: [</span><br><span class="line">                <span class="comment">// &#x27;&#x27;: 表示 语言跟随系统</span></span><br><span class="line">                _languageItem(<span class="string">&#x27;&#x27;</span>, context),</span><br><span class="line">                <span class="comment">// &#x27;zh&#x27;: 表示(简体)中文</span></span><br><span class="line">                _languageItem(<span class="string">&#x27;zh&#x27;</span>, context),</span><br><span class="line">                <span class="comment">// &#x27;en&#x27;: 表示 English</span></span><br><span class="line">                _languageItem(<span class="string">&#x27;en&#x27;</span>, context),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 多语言设置选项</span></span><br><span class="line">  Widget _languageItem(<span class="built_in">String</span> lang, context) &#123;</span><br><span class="line">    <span class="keyword">return</span> InkWell(</span><br><span class="line">      onTap: () &#123;</span><br><span class="line">        <span class="comment">// Provider 状态修改方式一：</span></span><br><span class="line">        Provider.of&lt;LocaleProvider&gt;(context, listen: <span class="keyword">false</span>)</span><br><span class="line">            .toggleChangeLocale(lang);</span><br><span class="line">      &#125;,</span><br><span class="line">      child: Container(</span><br><span class="line">        padding: EdgeInsets.only(</span><br><span class="line">          left: <span class="number">15</span>,</span><br><span class="line">          right: <span class="number">15</span>,</span><br><span class="line">          top: <span class="number">0</span>,</span><br><span class="line">          bottom: <span class="number">0</span>,</span><br><span class="line">        ),</span><br><span class="line">        child: Container(</span><br><span class="line">          <span class="comment">// 添加 ListTile 选中项的背景颜色</span></span><br><span class="line">          decoration: <span class="keyword">new</span> BoxDecoration(</span><br><span class="line">            color: Provider.of&lt;LocaleProvider&gt;(context).language == lang</span><br><span class="line">                ? Theme.of(context).buttonColor</span><br><span class="line">                : <span class="keyword">null</span>,</span><br><span class="line">          ),</span><br><span class="line">          child: ListTile(</span><br><span class="line">            leading: Icon(Icons.drag_handle),</span><br><span class="line">            title: Container(</span><br><span class="line">              <span class="comment">// 缩小 leading 和 title之的间隔</span></span><br><span class="line">              transform: Matrix4.translationValues(<span class="number">-20</span>, <span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">              child: Text(</span><br><span class="line">                LocaleProvider.localeName(lang, context),</span><br><span class="line">                <span class="comment">// style: TextStyle(</span></span><br><span class="line">                <span class="comment">//   color: Provider.of&lt;LocaleProvider&gt;(context).language == lang</span></span><br><span class="line">                <span class="comment">//       ? Theme.of(context).primaryColor</span></span><br><span class="line">                <span class="comment">//       : null,</span></span><br><span class="line">                <span class="comment">// ),</span></span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            <span class="comment">// title: Text(LocaleProvider.localeName(lang, context)),</span></span><br><span class="line">            <span class="comment">// trailing: Opacity(</span></span><br><span class="line">            <span class="comment">//   opacity:</span></span><br><span class="line">            <span class="comment">//       Provider.of&lt;LocaleProvider&gt;(context).language == lang ? 1 : 0,</span></span><br><span class="line">            <span class="comment">//   child: Icon(Icons.done),</span></span><br><span class="line">            <span class="comment">// ),</span></span><br><span class="line">            trailing: Provider.of&lt;LocaleProvider&gt;(context).language == lang</span><br><span class="line">                ? Icon(Icons.done)</span><br><span class="line">                : <span class="keyword">null</span>,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 主题选择选项</span></span><br><span class="line">  Widget _themeModeItem(Icon icon, <span class="built_in">String</span> mode, context) &#123;</span><br><span class="line">    <span class="comment">// Provider 状态修改方式二：1. Consumer&lt;ThemeProvider&gt;(builder:)</span></span><br><span class="line">    <span class="keyword">return</span> Consumer&lt;ThemeProvider&gt;(</span><br><span class="line">      builder: (context, themeProvider, child) =&gt; InkWell(</span><br><span class="line">        onTap: () &#123;</span><br><span class="line">          <span class="comment">// Provider 状态修改方式二：2. 调用</span></span><br><span class="line">          themeProvider.toggleChangeTheme(mode);</span><br><span class="line">        &#125;,</span><br><span class="line">        child: Container(</span><br><span class="line">          padding: EdgeInsets.only(</span><br><span class="line">            left: <span class="number">15</span>,</span><br><span class="line">            right: <span class="number">15</span>,</span><br><span class="line">            top: <span class="number">0</span>,</span><br><span class="line">            bottom: <span class="number">0</span>,</span><br><span class="line">          ),</span><br><span class="line">          child: ListTile(</span><br><span class="line">            leading: icon,</span><br><span class="line">            title: Container(</span><br><span class="line">              <span class="comment">// 缩小 leading 和 title之的间隔</span></span><br><span class="line">              transform: Matrix4.translationValues(<span class="number">-20</span>, <span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">              child: Text(ThemeProvider.getThemeModeName(mode, context)),</span><br><span class="line">            ),</span><br><span class="line">            <span class="comment">// trailing: Opacity(</span></span><br><span class="line">            <span class="comment">//   opacity: themeProvider.themeMode == mode ? 1 : 0,</span></span><br><span class="line">            <span class="comment">//   child: Icon(Icons.done),</span></span><br><span class="line">            <span class="comment">// ),</span></span><br><span class="line">            trailing: themeProvider.themeMode == mode ? Icon(Icons.done) : <span class="keyword">null</span>,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="编辑设置页"><a href="#编辑设置页" class="headerlink" title="编辑设置页"></a>编辑设置页</h3><p>打开文件<code>lib\views\settings\settings_page.dart</code>，编辑其内容如以下代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/views/settings/widgets/account_info.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/views/settings/widgets/common_settings.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SettingsPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> SingleChildScrollView(</span><br><span class="line">      child: Container(</span><br><span class="line">        width: MediaQuery.of(context).size.width,</span><br><span class="line">        child: Column(</span><br><span class="line">          children: [</span><br><span class="line">            AccountInfo(),</span><br><span class="line">            SizedBox(</span><br><span class="line">              height: <span class="number">5</span>,</span><br><span class="line">            ),</span><br><span class="line">            CommonSettings(),</span><br><span class="line">            SizedBox(</span><br><span class="line">              height: <span class="number">5</span>,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><p>启动项目调试，程序运行结果如下：</p><p>简体中文、浅色主题：</p><img src="/2021/02/04/flutter-introduction-part-II/02zh_light.png" class="" title="zh_light"><p>English、深色主题：</p><img src="/2021/02/04/flutter-introduction-part-II/03en_dark.png" class="" title="en_dark"><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
            <tag> provider </tag>
            
            <tag> shared_preferences </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flutter introduction part I：创建项目及多语言国际化支持</title>
      <link href="/2021/02/02/flutter-introduction-part-I/"/>
      <url>/2021/02/02/flutter-introduction-part-I/</url>
      
        <content type="html"><![CDATA[<blockquote><p>特别说明：<code>Flutter SDK 1.22.5</code> 及以上版本需要依赖 <a href="https://git-scm.com/">Git</a> ， 所以下面输入 <code>flutter</code>命令的时候，一般都是在 <code>Git Bash</code> 命令行窗口 中进行。</p></blockquote><blockquote><p><code>D:\sources\flutter_repos</code> 是专门用于保存 <code>Flutter</code> 项目的文件夹。</p></blockquote><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>在 <code>D:\sources\flutter_repos</code>(或其他用于保存 <code>Flutter</code> 项目的文件夹) 文件夹下鼠标右键，在弹出的快捷菜单中选择<code>Git Bash Here</code> 打开 <code>Git Bash</code> 命令行窗口</p><img src="/2021/02/02/flutter-introduction-part-I/01gitbashhere.png" class="" title="Git Bash Here"><p>在打开的<code>Git Bash</code> 命令行窗口中输入命令： <code>flutter create deep_sky_app</code></p><img src="/2021/02/02/flutter-introduction-part-I/02fluttercreate.png" class="" title="flutter create"><p>完整的命令执行过程如以下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">Laohoo@DESKTOP-NUNPB7R MINGW64 /d/sources/flutter_repos</span><br><span class="line">$ flutter create deep_sky_app</span><br><span class="line">Creating project deep_sky_app...</span><br><span class="line">  deep_sky_app\.gitignore (created)</span><br><span class="line">  deep_sky_app\.idea\libraries\Dart_SDK.xml (created)</span><br><span class="line">  deep_sky_app\.idea\libraries\KotlinJavaRuntime.xml (created)</span><br><span class="line">  deep_sky_app\.idea\modules.xml (created)</span><br><span class="line">  deep_sky_app\.idea\runConfigurations\main_dart.xml (created)</span><br><span class="line">  deep_sky_app\.idea\workspace.xml (created)</span><br><span class="line">  deep_sky_app\.metadata (created)</span><br><span class="line">  deep_sky_app\android\app\build.gradle (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\kotlin\com\example\deep_sky_app\MainActivity.kt (created)</span><br><span class="line">  deep_sky_app\android\build.gradle (created)</span><br><span class="line">  deep_sky_app\android\deep_sky_app_android.iml (created)</span><br><span class="line">  deep_sky_app\android\.gitignore (created)</span><br><span class="line">  deep_sky_app\android\app\src\debug\AndroidManifest.xml (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\AndroidManifest.xml (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\drawable\launch_background.xml (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\drawable-v21\launch_background.xml (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\mipmap-hdpi\ic_launcher.png (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\mipmap-mdpi\ic_launcher.png (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\mipmap-xhdpi\ic_launcher.png (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\mipmap-xxhdpi\ic_launcher.png (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\mipmap-xxxhdpi\ic_launcher.png (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\values\styles.xml (created)</span><br><span class="line">  deep_sky_app\android\app\src\main\res\values-night\styles.xml (created)</span><br><span class="line">  deep_sky_app\android\app\src\profile\AndroidManifest.xml (created)</span><br><span class="line">  deep_sky_app\android\gradle\wrapper\gradle-wrapper.properties (created)</span><br><span class="line">  deep_sky_app\android\gradle.properties (created)</span><br><span class="line">  deep_sky_app\android\settings.gradle (created)</span><br><span class="line">  deep_sky_app\ios\Runner\AppDelegate.swift (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Runner-Bridging-Header.h (created)</span><br><span class="line">  deep_sky_app\ios\Runner.xcodeproj\project.pbxproj (created)</span><br><span class="line">  deep_sky_app\ios\Runner.xcodeproj\xcshareddata\xcschemes\Runner.xcscheme (created)</span><br><span class="line">  deep_sky_app\ios\.gitignore (created)</span><br><span class="line">  deep_sky_app\ios\Flutter\AppFrameworkInfo.plist (created)</span><br><span class="line">  deep_sky_app\ios\Flutter\Debug.xcconfig (created)</span><br><span class="line">  deep_sky_app\ios\Flutter\Release.xcconfig (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Contents.json (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-1024x1024@1x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-20x20@1x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-20x20@2x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-20x20@3x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-29x29@1x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-29x29@2x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-29x29@3x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-40x40@1x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-40x40@2x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-40x40@3x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-60x60@2x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-60x60@3x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-76x76@1x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-76x76@2x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\AppIcon.appiconset\Icon-App-83.5x83.5@2x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\LaunchImage.imageset\Contents.json (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\LaunchImage.imageset\LaunchImage.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\LaunchImage.imageset\LaunchImage@2x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\LaunchImage.imageset\LaunchImage@3x.png (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Assets.xcassets\LaunchImage.imageset\README.md (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Base.lproj\LaunchScreen.storyboard (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Base.lproj\Main.storyboard (created)</span><br><span class="line">  deep_sky_app\ios\Runner\Info.plist (created)</span><br><span class="line">  deep_sky_app\ios\Runner.xcodeproj\project.xcworkspace\contents.xcworkspacedata (created)</span><br><span class="line">  deep_sky_app\ios\Runner.xcodeproj\project.xcworkspace\xcshareddata\IDEWorkspaceChecks.plist (created)</span><br><span class="line">  deep_sky_app\ios\Runner.xcodeproj\project.xcworkspace\xcshareddata\WorkspaceSettings.xcsettings (created)</span><br><span class="line">  deep_sky_app\ios\Runner.xcworkspace\contents.xcworkspacedata (created)</span><br><span class="line">  deep_sky_app\ios\Runner.xcworkspace\xcshareddata\IDEWorkspaceChecks.plist (created)</span><br><span class="line">  deep_sky_app\ios\Runner.xcworkspace\xcshareddata\WorkspaceSettings.xcsettings (created)</span><br><span class="line">  deep_sky_app\lib\main.dart (created)</span><br><span class="line">  deep_sky_app\deep_sky_app.iml (created)</span><br><span class="line">  deep_sky_app\pubspec.yaml (created)</span><br><span class="line">  deep_sky_app\README.md (created)</span><br><span class="line">  deep_sky_app\<span class="built_in">test</span>\widget_test.dart (created)</span><br><span class="line">  deep_sky_app\web\favicon.png (created)</span><br><span class="line">  deep_sky_app\web\icons\Icon-192.png (created)</span><br><span class="line">  deep_sky_app\web\icons\Icon-512.png (created)</span><br><span class="line">  deep_sky_app\web\index.html (created)</span><br><span class="line">  deep_sky_app\web\manifest.json (created)</span><br><span class="line">Running <span class="string">&quot;flutter pub get&quot;</span> <span class="keyword">in</span> deep_sky_app...                     2,585ms</span><br><span class="line">Wrote 78 files.</span><br><span class="line"></span><br><span class="line">All <span class="keyword">done</span>!</span><br><span class="line">In order to run your application, <span class="built_in">type</span>:</span><br><span class="line"></span><br><span class="line">  $ <span class="built_in">cd</span> deep_sky_app</span><br><span class="line">  $ flutter run</span><br><span class="line"></span><br><span class="line">To <span class="built_in">enable</span> null safety, <span class="built_in">type</span>:</span><br><span class="line"></span><br><span class="line">  $ <span class="built_in">cd</span> deep_sky_app</span><br><span class="line">  $ dart migrate --apply-changes</span><br><span class="line"></span><br><span class="line">Your application code is <span class="keyword">in</span> deep_sky_app\lib\main.dart.</span><br></pre></td></tr></table></figure><p>名为 <code>deep_sky_app</code> 的项目创建成功。使用以下两个命令进入项目文件夹，并使用 <code>Visual Studio Code </code> 打开项目：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> deep_sky_app</span><br><span class="line">code .</span><br></pre></td></tr></table></figure><img src="/2021/02/02/flutter-introduction-part-I/03cdskytownapp.png" class="" title="cd deep_sky_app"><h2 id="使用-Intl-添加多语言国际化支持"><a href="#使用-Intl-添加多语言国际化支持" class="headerlink" title="使用 Intl 添加多语言国际化支持"></a>使用 Intl 添加多语言国际化支持</h2><p>在 <code>Visual Studio Code</code> 中安装 <code>Flutter Intl</code> 插件(如果还没有安装该插件的话)</p><img src="/2021/02/02/flutter-introduction-part-I/flutter_intl.jpg" class="" title="flutter_intl.jpg"><p>在项目的 <code>pubspec.yaml</code> 文件中增加以下包依赖：</p><p><code>Intl</code> 的最新版本查询： <a href="https://pub.dev/packages/intl">https://pub.dev/packages/intl</a></p><p><code>intl_translation</code> 的最新版本查询：<a href="https://pub.dev/packages/intl_translation">https://pub.dev/packages/intl_translation</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 国际化</span></span><br><span class="line">  <span class="attr">flutter_localizations:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="attr">intl:</span> <span class="string">^0.16.1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="使用-Intl-初始化项目"><a href="#使用-Intl-初始化项目" class="headerlink" title="使用 Intl 初始化项目"></a>使用 <code>Intl</code> 初始化项目</h3><p>在<code>Visual Studio Code</code>中打开命令面板: <code>View -&gt; Command Palette…</code></p><img src="/2021/02/02/flutter-introduction-part-I/04commandpale.png" class="" title="CommanePale"><p>在打开的命令面板中输入 <code>flutter intl</code>, 在下拉的命令项中选择：<code>Flutter Intl: Initialize</code>， 开始执行项目的初始化。</p><img src="/2021/02/02/flutter-introduction-part-I/05intialize.png" class="" title="IntlInitialize"><p>初始化执行成功后，在 <code>pubspec.yaml</code> 末尾会自动增加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">flutter_intl:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>同时在 lib 文件夹下生成 generated 和 l10n 两个文件夹：</p><img src="/2021/02/02/flutter-introduction-part-I/06finished.png" class="" title="finished"><blockquote><p><code>generated</code>包下的<code>intl</code>目录默认生成 <code>messages_all.dart</code> 和 <code>messages_en.dart</code> 文件，messages开头的文件无需手动修改，是自动生成的。</p></blockquote><blockquote><p><code>generated</code> 包下的 <code>I10n.dart</code> 是 <code>Localizations</code>和 <code>Delegate</code> 的实现，无需手动修改，是自动生成的。</p></blockquote><blockquote><p><code>l10n</code>包下存在一个<code>intl_en.arb</code>文件，文案存放在此处。</p></blockquote><blockquote><p>ARB文件扩展名为：<code>Application Resource Bundle</code> 意为应用程序资源包，并得到Google的支持，每个.arb文件都包含一个JSON表，该表从资源ID映射到本地化值，文件名包含已为其转换值的语言环境。</p></blockquote><h3 id="添加语言"><a href="#添加语言" class="headerlink" title="添加语言"></a>添加语言</h3><p>在 <code>Visual Studio Code</code> 中打开命令面板: <code>View -&gt; Command Palette…</code></p><p>在打开的命令面板中输入 <code>flutter intl</code>, 在下拉的命令项中选择：<code>Flutter Intl: Add Locale</code>。</p><img src="/2021/02/02/flutter-introduction-part-I/07addlocale.png" class="" title="addlocale"><p>在命令面板中输入新的语言名称：<code>zh</code></p><img src="/2021/02/02/flutter-introduction-part-I/08zh.png" class="" title="addzh"><p>添加新的语言成功后，在 <code>generated\intl</code> 文件夹下多了一个名为<code>messages_zh.dart</code> 的文件</p><p>在 <code>l10n</code> 文件夹下多了一个名为 <code>intl_zh.arb</code> 的文件</p><img src="/2021/02/02/flutter-introduction-part-I/09zhfinished.png" class="" title="zhfinished"><h3 id="添加系统国际化支持"><a href="#添加系统国际化支持" class="headerlink" title="添加系统国际化支持"></a>添加系统国际化支持</h3><p>在 <code>intl_en.arb</code> 和 <code>intl_zh.arb</code> 下添加文案</p><p>打开文件<code>lib\l10n\intl_en.arb</code>，修改内容如以下代码所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;appName&quot;:&quot;Deep Sky&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打开文件<code>lib\l10n\intl_zh.arb</code>，修改内容如以下代码所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;appName&quot;:&quot;深处天空&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打开文件 <code>lib\main.dart</code>，在文件的前面添加以下两个引用：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_localizations/flutter_localizations.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/generated/l10n.dart&#x27;</span>;</span><br></pre></td></tr></table></figure><p>然后在 <code>MaterialApp</code> 中添加如以下所示代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MaterialApp(</span><br><span class="line">  ...</span><br><span class="line">  localizationsDelegates: [</span><br><span class="line">        S.delegate,</span><br><span class="line">        GlobalMaterialLocalizations.delegate,</span><br><span class="line">        GlobalWidgetsLocalizations.delegate,</span><br><span class="line">        GlobalCupertinoLocalizations.delegate,</span><br><span class="line">      ],      </span><br><span class="line">      supportedLocales:S.delegate.supportedLocales,  </span><br><span class="line">  ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>解释下上面这段代码出现的变量:</p><blockquote><p><code>localizationsDelegates</code> 列表中的元素是生成本地化值集合的工厂。</p></blockquote><blockquote><p><code>S.delegate</code>  项目的本地化委托类，插件自动生成，它会根据你的arb文件自动生成对应的函数。</p></blockquote><blockquote><p><code>GlobalMaterialLocalizations.delegate</code> 为<code>Material Components</code>库提供了本地化的字符串和其他值。</p></blockquote><blockquote><p><code>GlobalCupertinoLocalizations.delegate</code> 为<code>Cupertino Components</code>库提供了本地化的字符串和其他值。</p></blockquote><blockquote><p><code>GlobalWidgetsLocalizations.delegate</code>定义<code>widget</code>默认的文本方向，从左到右或从右到左。</p></blockquote><blockquote><p><code>supportedLocales</code>支持的本地化。</p></blockquote><blockquote><p><code>S.delegate.supportedLocales</code> 项目支持的本地化，插件自动生成，它会在你添加arb文件时自动更新你的支持的本地化。</p></blockquote><h2 id="在组件中使用国际化的值"><a href="#在组件中使用国际化的值" class="headerlink" title="在组件中使用国际化的值"></a>在组件中使用国际化的值</h2><p>在需要配置国际化的地方调用 <code>S.of(context).key</code> 即可. 没有<code>context</code> 时可以使用 <code>S.current.key</code> 。</p><p>当不能使用 <code>S.of(context).key</code> 进行调用时，会看到类似以下的错误信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">════════ Exception caught by widgets library ═══════════════════════════════════</span><br><span class="line">The following NoSuchMethodError was thrown building MyApp(dirty):</span><br><span class="line">The getter <span class="string">&#x27;appName&#x27;</span> was called on null.</span><br><span class="line">Receiver: null</span><br><span class="line">Tried calling: appName</span><br></pre></td></tr></table></figure><p>将 <code>MaterialApp</code> 中 <code>title</code> 的值修改为：<code>S.of(context).appName</code> (如果提示出错，则改为：<code>S.current.appName</code>)</p><p>修改完成后 <code>lib\main.dart</code> 文件中前段的代码如以下所示：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_localizations/flutter_localizations.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:deep_sky_app/generated/l10n.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// This widget is the root of your application.</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      localizationsDelegates: <span class="keyword">const</span> [</span><br><span class="line">        S.delegate,</span><br><span class="line">        GlobalMaterialLocalizations.delegate,</span><br><span class="line">        GlobalCupertinoLocalizations.delegate,</span><br><span class="line">        GlobalWidgetsLocalizations.delegate</span><br><span class="line">      ],      </span><br><span class="line">      supportedLocales: S.delegate.supportedLocales,</span><br><span class="line">      localeListResolutionCallback: (locales, supportedLocales) &#123;</span><br><span class="line">        <span class="built_in">print</span>(locales); <span class="comment">// 在控制台显示当前语言</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      title: <span class="string">&#x27;Deep Sky&#x27;</span>, </span><br><span class="line"></span><br><span class="line">      <span class="comment">// 生成应用标题</span></span><br><span class="line">      onGenerateTitle: (context) &#123;</span><br><span class="line">        <span class="comment">// 在需要配置国际化的地方调用 S.of(context).key 即可.</span></span><br><span class="line">        <span class="comment">// 没有context 时可以使用 S.current.key</span></span><br><span class="line">        <span class="keyword">return</span> S.of(context).appName;</span><br><span class="line">      &#125;,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">        visualDensity: VisualDensity.adaptivePlatformDensity,</span><br><span class="line">      ),</span><br><span class="line">      </span><br><span class="line">      home: MyHomePage(title: <span class="string">&#x27;Flutter demo&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><p>在 <code>Visual Studio Code</code> 菜单中选择: <code>Run -&gt; Start Debugging</code>，运行成功后，选择手机（或模拟器）上的程序切换，在APP的缩略图上看到显示的标题文字。</p><img src="/2021/02/02/flutter-introduction-part-I/10run.PNG" class="" title="RunAPP"><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
            <tag> 多语言 </tag>
            
            <tag> 国际化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Visual Studio Code 中使用 flutter_intl 实现 Flutter 应用国际化</title>
      <link href="/2021/01/26/use-flutter-intl-to-internationalize/"/>
      <url>/2021/01/26/use-flutter-intl-to-internationalize/</url>
      
        <content type="html"><![CDATA[<p>·Flutter Intl· 插件，包含用于处理国际化&#x2F;本地化消息，日期和数字格式和解析，双向文本以及其他国际化问题。</p><h2 id="安装-Flutter-Intl-插件"><a href="#安装-Flutter-Intl-插件" class="headerlink" title="安装 Flutter Intl 插件"></a>安装 <code>Flutter Intl</code> 插件</h2><img src="/2021/01/26/use-flutter-intl-to-internationalize/flutter_intl.jpg" class="" title="flutter_intl.jpg"><p>在项目的 <code>pubspec.yaml</code> 文件中添加依赖：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  flutter:</span><br><span class="line">    sdk: flutter</span><br><span class="line">  # 国际化</span><br><span class="line">  flutter_localizations:</span><br><span class="line">    sdk: flutter</span><br></pre></td></tr></table></figure><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><p>在<code>Visual Studio Code</code>中打开命令面板: View -&gt; Command Palette…</p><img src="/2021/01/26/use-flutter-intl-to-internationalize/command_palette.png" class="" title="command_palette"><p>在打开的命令面板中输入 <code>flutter intl</code>, 在下拉的命令项中选择：<code>Flutter Intl: Initialze</code>， 开始执行项目的初始化。</p><img src="/2021/01/26/use-flutter-intl-to-internationalize/initialize.png" class="" title="initialize"><p>初始化执行成功后，会自动在 <code>pubspec.yaml</code> 末尾增加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter_intl:</span><br><span class="line">  enabled: true</span><br></pre></td></tr></table></figure><p>同时在 <code>lib</code> 文件夹下生成 <code>generated</code> 和 <code>l10n</code> 两个文件夹</p><img src="/2021/01/26/use-flutter-intl-to-internationalize/initialze_finish.png" class="" title="initialze_finish"><blockquote><p><code>generated</code>包下的<code>intl</code>目录默认生成 <code>messages_all.dart</code> 和 <code>messages_en.dart</code> 文件，messages开头的文件无需手动修改，是自动生成的。</p></blockquote><blockquote><p><code>generated</code> 包下的 <code>I10n.dart</code> 是 <code>Localizations</code>和 <code>Delegate</code> 的实现，无需手动修改，是自动生成的。</p></blockquote><blockquote><p><code>l10n</code>包下存在一个<code>intl_en.arb</code>文件，文案存放在此处。</p></blockquote><blockquote><p>ARB文件扩展名为：<code>Application Resource Bundle</code> 意为应用程序资源包，并得到Google的支持，每个.arb文件都包含一个JSON表，该表从资源ID映射到本地化值，文件名包含已为其转换值的语言环境。</p></blockquote><h2 id="添加语言"><a href="#添加语言" class="headerlink" title="添加语言"></a>添加语言</h2><p>在<code>Visual Studio Code</code>中打开命令面板: View -&gt; Command Palette…</p><p>在打开的命令面板中输入 <code>flutter intl</code>, 在下拉的命令项中选择：<code>Flutter Intl: Add Locale</code>。</p><img src="/2021/01/26/use-flutter-intl-to-internationalize/add_locale.png" class="" title="add_locale"><p>在命令面板中输入中文的语言名称：<code>zh</code></p><img src="/2021/01/26/use-flutter-intl-to-internationalize/add_locale_zh.png" class="" title="add_locale_zh"><p>添加语言成功后，在 <code>generated\intl</code> 文件夹下多了一个名为<code>messages_zh.dart</code> 的文件</p><p>在 <code>l10n</code> 文件夹下多了一个名为 <code>intl_zh.arb</code> 的文件</p><img src="/2021/01/26/use-flutter-intl-to-internationalize/add_locale_zh_finish.png" class="" title="add_locale_zh_finish"><h2 id="添加系统国际化支持"><a href="#添加系统国际化支持" class="headerlink" title="添加系统国际化支持"></a>添加系统国际化支持</h2><p>MaterialApp 修改如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">MaterialApp(</span><br><span class="line">  ...</span><br><span class="line">  localizationsDelegates: [</span><br><span class="line">        S.delegate,</span><br><span class="line">        GlobalMaterialLocalizations.delegate,</span><br><span class="line">        GlobalWidgetsLocalizations.delegate,</span><br><span class="line">        GlobalCupertinoLocalizations.delegate,</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 将 en设置为第一项, 没有适配语言时, 英语为首选项</span></span><br><span class="line">      supportedLocales: [</span><br><span class="line">        <span class="keyword">const</span> Locale(<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">        ...S.delegate.supportedLocales</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 插件目前不完善手动处理简繁体</span></span><br><span class="line">      localeResolutionCallback: (locale, supportLocales) &#123;</span><br><span class="line">        <span class="comment">// 中文 简繁体处理</span></span><br><span class="line">        <span class="keyword">if</span> (locale?.languageCode == <span class="string">&#x27;zh&#x27;</span>) &#123;</span><br><span class="line">          <span class="comment">// zh-CN：地区限制匹配规范，表示用在中国大陆区域的中文。</span></span><br><span class="line">          <span class="comment">// 包括各种大方言、小方言、繁体、简体等等都可以被匹配到。</span></span><br><span class="line">          <span class="keyword">if</span> (locale?.scriptCode == <span class="string">&#x27;Hant&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// zh-Hant和zh-CHT相同相对应;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">const</span> Locale(<span class="string">&#x27;zh&#x27;</span>, <span class="string">&#x27;HK&#x27;</span>); <span class="comment">//繁体</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// zh-Hans：语言限制匹配规范，表示简体中文</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">const</span> Locale(<span class="string">&#x27;zh&#x27;</span>, <span class="string">&#x27;CN&#x27;</span>); <span class="comment">//简体</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>解释下上面这段代码出现的变量</p><blockquote><p><code>localizationsDelegates</code> 列表中的元素是生成本地化值集合的工厂。</p></blockquote><blockquote><p><code>S.delegate</code>  项目的本地化委托类，插件自动生成，它会根据你的arb文件自动生成对应的函数。</p></blockquote><blockquote><p><code>GlobalMaterialLocalizations.delegate</code> 为<code>Material Components</code>库提供了本地化的字符串和其他值。</p></blockquote><blockquote><p><code>GlobalCupertinoLocalizations.delegate</code> 为<code>Cupertino Components</code>库提供了本地化的字符串和其他值。</p></blockquote><blockquote><p><code>GlobalWidgetsLocalizations.delegate</code>定义<code>widget</code>默认的文本方向，从左到右或从右到左。</p></blockquote><blockquote><p><code>supportedLocales</code>支持的本地化。</p></blockquote><blockquote><p><code>S.delegate.supportedLocales</code> 项目支持的本地化，插件自动生成，它会在你添加arb文件时自动更新你的支持的本地化。</p></blockquote><p>在 <code>intl_en.arb</code> 和 <code>intl_zh.arb</code> 下添加文案</p><p>添加一个 <code>title</code> 文案，<code>intl_en.arb</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;hello word&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>intl_zh.arb</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;你好&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>保存修改，<code>generated</code> 目录下相关文件将会重新生成。</p><h2 id="使用Flutter-Intl"><a href="#使用Flutter-Intl" class="headerlink" title="使用Flutter Intl"></a>使用Flutter Intl</h2><p>普通使用</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;content&quot;</span>: <span class="string">&quot;内容&quot;</span>&#125;</span><br><span class="line">S.of(context).content</span><br></pre></td></tr></table></figure><p>占位</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;welcome&quot;</span>: <span class="string">&quot;welcome &#123;name&#125;&quot;</span>&#125;</span><br><span class="line">S.of(context).welcome(<span class="string">&quot;phoenixsky&quot;</span>)</span><br></pre></td></tr></table></figure><p>重复占位</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;goodStudy&quot;</span>: <span class="string">&quot;&#123;good&#125;&#123;good&#125;学习,&#123;day&#125;&#123;day&#125;向上&quot;</span>&#125;</span><br><span class="line">S.of(context).goodStudy(<span class="string">&quot;好&quot;</span>, <span class="string">&quot;天&quot;</span>)</span><br></pre></td></tr></table></figure><p>复数形式</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;getMessageTips&quot;</span>: <span class="string">&quot;&#123;howMany, plural, zero&#123;You have no message&#125; one&#123;You have 1 message&#125; other&#123;You have &#123;howMany&#125; messages&#125;&#125;&quot;</span>&#125;</span><br><span class="line">S.of(context).getMessageTips(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>参考:<a href="https://github.com/localizely/flutter-intl-plugin-sample-app">https://github.com/localizely/flutter-intl-plugin-sample-app</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
            <tag> 国际化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>创建基于 Vuetify 和 leancloud 的 Vue.js 应用程序(二)</title>
      <link href="/2021/01/20/create-a-vue-app-based-vuetify-and-leancloud-part-II/"/>
      <url>/2021/01/20/create-a-vue-app-based-vuetify-and-leancloud-part-II/</url>
      
        <content type="html"><![CDATA[<h1 id="路由规划"><a href="#路由规划" class="headerlink" title="路由规划"></a>路由规划</h1><p>本项目在实现的是一个论坛网站，网站划分为三个部分:</p><ul><li><p>前台用户界面：主要是论坛的主题；主题的详细内容及评论；</p></li><li><p>帐号管理界面：主要是注册、登录等功能；</p></li><li><p>后台管理界面：主要是主题的管理；评论内容的管理等功能；</p></li></ul><h2 id="修改路由文件"><a href="#修改路由文件" class="headerlink" title="修改路由文件"></a>修改路由文件</h2><p>打开文件：<code>src/router/index.js</code>， 编辑其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,   <span class="comment">// 前台页面模块及其嵌套子路由</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/home/Index.vue&#x27;</span>),  <span class="comment">// 父路由指向的文件一般用于整个模块布局</span></span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,  <span class="comment">// 此处实际访问路径为父子path的结合:  /</span></span><br><span class="line">        <span class="attr">alias</span>: <span class="string">&#x27;home&#x27;</span>,    <span class="comment">// alias（别名）相当于第二个path， 类似重定向的效果, 指向实际路径： /home</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,     <span class="comment">// 命名路由</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/home/pages/TopicList.vue&#x27;</span>),  <span class="comment">// 指向的实际文件</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;topicdetails/:id&#x27;</span>,    <span class="comment">// 此处实际访问路径为父子path的结合:  /topicdetails/:id</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;topic-details&#x27;</span>,       <span class="comment">// 命令路由建议使用 短横线命名 或 Pascal 命名</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/home/pages/TopicDetails.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>,  <span class="comment">// 后台管理模块及嵌套子路由</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/Index.vue&#x27;</span>), <span class="comment">// 父路由指向的文件一般用于整个模块布局</span></span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,  <span class="comment">// 此处实际访问路径为父子path的结合:  /dashboard/       </span></span><br><span class="line">        <span class="attr">alias</span>: <span class="string">&#x27;topiclist&#x27;</span>, <span class="comment">// 别名指向实际路径:  /dashboard/topiclist</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;topic-manager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/pages/TopicManager.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;commentclist&#x27;</span>,  <span class="comment">// 此处实际访问路径为父子path的结合:  /dashboard/commentclist</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;comment-manager&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/pages/CommentManager.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;createtopic&#x27;</span>, <span class="comment">// 此处实际访问路径为父子path的结合:  /dashboard/createtopic</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;create-topic&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/pages/CreateTopic.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 动态路由， 冒号后面的 id 为传递参数的变量名</span></span><br><span class="line">        <span class="comment">// 例如：/dashboard/createtopic/5  , 则参数值 5， 会以变量名 id 传递进去</span></span><br><span class="line">        <span class="comment">// 在目标组件可以用 this.$route.params.id 来接收这个值 </span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;edittopic/:id&#x27;</span>,  <span class="comment">// 实际指向路径为: /dashboard/createtopic/:id,</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;edit-topic&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/pages/EditTopic.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/account&#x27;</span>,   <span class="comment">// 账号模块及其嵌套子路由</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/account/Index.vue&#x27;</span>),  <span class="comment">// 父路由指向的文件一般用于整个模块布局</span></span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,      <span class="comment">// 此处实际访问路径为:  /account</span></span><br><span class="line">        <span class="attr">alias</span>: <span class="string">&#x27;login&#x27;</span>,   <span class="comment">// 别名指向实际路径：/account/login</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/account/pages/Login.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;signup&#x27;</span>,    <span class="comment">// 此处实际访问路径为父子path的结合:  /account/signup</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;signup&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/account/pages/SignUp.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用路由拦截保存跳转到登录页的地址，登录成功后跳转回该页(回跳功能在登录页实现)</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 如果 跳转的目标 path 是登录页（看上面的路由设置中对应的path ）</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span> == <span class="string">&#x27;/account&#x27;</span> || to.<span class="property">path</span> == <span class="string">&#x27;/account/login&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 保存当前路由， 用于登录成功后跳转到登录前的页面</span></span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;preRoute&quot;</span>, router.<span class="property">currentRoute</span>.<span class="property">fullPath</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="创建与路由对应的文件夹及文件"><a href="#创建与路由对应的文件夹及文件" class="headerlink" title="创建与路由对应的文件夹及文件"></a>创建与路由对应的文件夹及文件</h2><p>分别创建以下三个文件夹： </p><ul><li><p><code>src/views/home</code>：存放前台用户界面的 <code>vue</code> 文件；</p></li><li><p><code>src/views/account</code>：存放用户帐号相关的 <code>vue</code> 文件；</p></li><li><p><code>src/views/dashboard</code>：存放后台管理界面的 <code>vue</code> 文件；</p></li></ul><p>分别在以上三个文件夹各添加一个 <code>Index.vue</code> 文件，用于该模块的页面布局。</p><p>分别在以上三个文件夹内各添加一个 <code>pages</code> 文件夹，并在里面创建各模块所需的视图文件。</p><blockquote><p>具体的各个文件请参照路由 <code>src/router/index.js</code> 中各个 <code>component: () =&gt; import(&#39;&#39;)</code> 内的文件路径进行创建。</p></blockquote><p>创建完毕后的项目结构如下图所示：</p><img src="/2021/01/20/create-a-vue-app-based-vuetify-and-leancloud-part-II/filelist.png" class="" title="file list"><h2 id="编辑-App-vue"><a href="#编辑-App-vue" class="headerlink" title="编辑 App.vue"></a>编辑 App.vue</h2><p>打开文件： <code>src/App.vue</code>， 编辑其内容如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">v-app</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 路由出口 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 路由匹配到的组件将渲染在这里 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">v-app</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">  &#125;),</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在上面的代码中, 标签 <code>v-app</code> 是所有应用都需要的组件。 这是 <code>Vuetify</code> 组件和功能的挂载点，并确保它将默认的应用 变体 （dark&#x2F;light）传递给子组件，并可以保证它将默认的应用程序变种（暗色或亮色）传递给子组件，还可以保证跨浏览器支持 <code>Safari</code> 等浏览器中某些点击事件。<code>v-app</code> 应该在应用程序中仅使用一次。</p><p><code>&lt;router-view /&gt;</code> 是路由出口，用于渲染路由匹配到的组件。</p><p>在本例中使用了两层的嵌套路由配置，<code>App.vue</code>里面的 <code>&lt;router-view /&gt;</code> 是最顶层的出口，渲染最高级路由匹配到的组件。</p><p>对于嵌套的二级路由，则需要在每个模块的 <code>Index.vue</code> 文件中再添加一个  <code>&lt;router-view /&gt;</code>  用于渲染匹配到的组件。</p><h2 id="前台用户界面模块布局"><a href="#前台用户界面模块布局" class="headerlink" title="前台用户界面模块布局"></a>前台用户界面模块布局</h2><p>打开文件: <code>src/views/home/Index.vue</code>, 编辑其内容如以下代码:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">  &#125;),</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="多语言国际化"><a href="#多语言国际化" class="headerlink" title="多语言国际化"></a>多语言国际化</h1><p><code>Vue I18n</code> 是 <code>Vue.js</code> 的国际化插件, <code>Vuetify</code> 支持其组件的语言国际化 (i18n),  可以非常容易地将<code>Vue I18n</code>与 <code>Vuetify</code> 进行集成。</p><h2 id="安装多语言国际化组件"><a href="#安装多语言国际化组件" class="headerlink" title="安装多语言国际化组件"></a>安装多语言国际化组件</h2><p>在控制台输入命令：<code>yarn add vue-i18n</code></p><p>安装的过程显示如下:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PS</span> <span class="attr">D</span>:\sources\vue_repos\mad-world-app&gt; yarn add vue-i18n</span><br><span class="line">yarn add v1<span class="number">.22</span><span class="number">.5</span></span><br><span class="line">[<span class="number">1</span>/<span class="number">4</span>] <span class="title class_">Resolving</span> packages...</span><br><span class="line">[<span class="number">2</span>/<span class="number">4</span>] <span class="title class_">Fetching</span> packages...</span><br><span class="line">info fsevents@<span class="number">2.3</span><span class="number">.1</span>: <span class="title class_">The</span> platform <span class="string">&quot;win32&quot;</span> is incompatible <span class="keyword">with</span> <span class="variable language_">this</span> <span class="variable language_">module</span>.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.1&quot;</span> is an optional dependency and failed compatibility check. <span class="title class_">Excluding</span> it <span class="keyword">from</span> installation.</span><br><span class="line">info fsevents@<span class="number">1.2</span><span class="number">.13</span>: <span class="title class_">The</span> platform <span class="string">&quot;win32&quot;</span> is incompatible <span class="keyword">with</span> <span class="variable language_">this</span> <span class="variable language_">module</span>.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. <span class="title class_">Excluding</span> it <span class="keyword">from</span> installation.</span><br><span class="line">[<span class="number">3</span>/<span class="number">4</span>] <span class="title class_">Linking</span> dependencies...</span><br><span class="line">warning <span class="string">&quot; &gt; sass-loader@8.0.2&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.36.0 || ^5.0.0&quot;</span>.</span><br><span class="line">warning <span class="string">&quot;vue-cli-plugin-vuetify &gt; null-loader@3.0.0&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.3.0&quot;</span>.</span><br><span class="line">warning <span class="string">&quot; &gt; vuetify-loader@1.6.0&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.0.0&quot;</span>.</span><br><span class="line">[<span class="number">4</span>/<span class="number">4</span>] <span class="title class_">Building</span> fresh packages...</span><br><span class="line"></span><br><span class="line">success <span class="title class_">Saved</span> lockfile.</span><br><span class="line">success <span class="title class_">Saved</span> <span class="number">1</span> <span class="keyword">new</span> dependency.</span><br><span class="line">info <span class="title class_">Direct</span> dependencies</span><br><span class="line">└─ vue-i18n@<span class="number">8.22</span><span class="number">.4</span></span><br><span class="line">info <span class="title class_">All</span> dependencies</span><br><span class="line">└─ vue-i18n@<span class="number">8.22</span><span class="number">.4</span></span><br><span class="line"><span class="title class_">Done</span> <span class="keyword">in</span> <span class="number">78.</span>80s.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="添加国际化语言包文件"><a href="#添加国际化语言包文件" class="headerlink" title="添加国际化语言包文件"></a>添加国际化语言包文件</h2><p>在项目中创建文件夹：<code>src/locale</code></p><p>添加 <code>English</code> 的语言文件：<code>src/locale/en.js</code>， 编辑其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> en <span class="keyword">from</span> <span class="string">&#x27;vuetify/es5/locale/en&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;English&#x27;</span>,</span><br><span class="line">    <span class="comment">//page login</span></span><br><span class="line">    <span class="attr">login</span>: <span class="string">&#x27;Log In&#x27;</span>,</span><br><span class="line">    <span class="attr">signup</span>: <span class="string">&#x27;Sign Up&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;Username&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;Password&#x27;</span>,</span><br><span class="line">    <span class="attr">login_account</span>: <span class="string">&#x27;Login accoount&#x27;</span>,</span><br><span class="line">    <span class="comment">// menu</span></span><br><span class="line">    <span class="attr">menu</span>: &#123;</span><br><span class="line">        <span class="attr">home</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">        <span class="attr">dashboard</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    ...en,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建<code>简体中文</code>的语言文件：<code>src/locale/zh-Hans.js</code>, 编辑其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zhHans <span class="keyword">from</span> <span class="string">&#x27;vuetify/es5/locale/zh-Hans&#x27;</span>;  <span class="comment">// 导入Vuetify 自带的简体中文语言包</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;简体中文&#x27;</span>,</span><br><span class="line">    <span class="comment">// 登录页</span></span><br><span class="line">    <span class="attr">login</span>: <span class="string">&#x27;登录&#x27;</span>,</span><br><span class="line">    <span class="attr">signup</span>: <span class="string">&#x27;注册&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">    <span class="attr">login_account</span>: <span class="string">&#x27;登录帐户&#x27;</span>,</span><br><span class="line">    <span class="comment">// 菜单</span></span><br><span class="line">    <span class="attr">menu</span>: &#123;</span><br><span class="line">        <span class="attr">home</span>: <span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">        <span class="attr">dashboard</span>: <span class="string">&#x27;仪表盘&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 展开 简体中文语言包的所有项目</span></span><br><span class="line">    ...zhHans,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果还需要其他的语言文件，添加相应的文件并按照上面的格式进行修改即可。</p></blockquote><h2 id="国际化的配置文件"><a href="#国际化的配置文件" class="headerlink" title="国际化的配置文件"></a>国际化的配置文件</h2><p>打开 <code>Vuetify</code> 的配置文件： <code>src/plugins/vuetify</code>.js&#96;， 修改其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuetify</span> <span class="keyword">from</span> <span class="string">&#x27;vuetify/lib/framework&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ 是项目中文件夹 src 的别名</span></span><br><span class="line"><span class="keyword">import</span> zhHans <span class="keyword">from</span> <span class="string">&#x27;@/locale/zh-Hans&#x27;</span>;   <span class="comment">// 导入简体中文语言</span></span><br><span class="line"><span class="keyword">import</span> en <span class="keyword">from</span> <span class="string">&#x27;@/locale/en&#x27;</span>;            <span class="comment">// 导入English语言</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuetify</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuetify</span>(&#123;</span><br><span class="line">    <span class="attr">lang</span>: &#123;</span><br><span class="line">        <span class="attr">locales</span>: &#123; zhHans, en &#125;,   <span class="comment">// 所有可用的语言</span></span><br><span class="line">        <span class="attr">current</span>: <span class="string">&#x27;en&#x27;</span>,             <span class="comment">// 当前语言</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="添加多语言选择菜单组件"><a href="#添加多语言选择菜单组件" class="headerlink" title="添加多语言选择菜单组件"></a>添加多语言选择菜单组件</h2><p>添加新文件：<code>src/components/LocaleLanguage.vue</code>，编辑其内容如以下代码所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 多语言选择菜单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-menu</span></span></span><br><span class="line"><span class="tag">      <span class="attr">offset-y</span></span></span><br><span class="line"><span class="tag">      <span class="attr">origin</span>=<span class="string">&quot;center center&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;elelvation-1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">transition</span>=<span class="string">&quot;scale-transition&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:activator</span>=<span class="string">&quot;&#123; on &#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">text</span> <span class="attr">slot</span>=<span class="string">&quot;activator&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-icon</span> <span class="attr">medium</span>&gt;</span>mdi-translate<span class="tag">&lt;/<span class="name">v-icon</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 显示当前语言名称 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;ml-2&quot;</span>&gt;</span> &#123;&#123; localeText &#125;&#125; <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-icon</span> <span class="attr">small</span>&gt;</span>mdi-menu-down<span class="tag">&lt;/<span class="name">v-icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 显示所有语言包组成的下拉菜单 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-list-item-group</span> <span class="attr">v-model</span>=<span class="string">&quot;$vuetify.lang.current&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-list-item</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">click</span>=<span class="string">&quot;handleChangeLocale(item)&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-for</span>=<span class="string">&quot;item in availableLanguages&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:key</span>=<span class="string">&quot;item.value&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:value</span>=<span class="string">&quot;item.value&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">v-list-item-title</span> <span class="attr">v-text</span>=<span class="string">&quot;item.text&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">v-list-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-list-item-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;locale-language&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置当前语言</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleChangeLocale</span>(<span class="params">&#123; value &#125;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$vuetify</span>.<span class="property">lang</span>.<span class="property">current</span> = value;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 遍历并获取项目中的所有语言包</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">availableLanguages</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; locales &#125; = <span class="variable language_">this</span>.<span class="property">$vuetify</span>.<span class="property">lang</span>; <span class="comment">// 所有的语言，来自 src/plugins/vuetify.js 中的配置</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(locales).<span class="title function_">map</span>(<span class="function">(<span class="params">lang</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">text</span>: locales[lang].<span class="property">label</span>, <span class="comment">// 语言包显示的名字</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">value</span>: lang, <span class="comment">// 语言包的值</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 当前语言, 用于语言切换菜单中显示的当前语言名字</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">localeText</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> find = <span class="variable language_">this</span>.<span class="property">availableLanguages</span>.<span class="title function_">find</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">value</span> === <span class="variable language_">this</span>.<span class="property">$vuetify</span>.<span class="property">lang</span>.<span class="property">current</span></span></span><br><span class="line"><span class="language-javascript">      );</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> find.<span class="property">text</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在需要切换多语言的地方，添加对 <code>LocaleLanguage</code> 组件的引用和注册，并调用该组件即可(这个部分将在后台管理和前台页面完成)。</p><h2 id="使用多语言国际化功能"><a href="#使用多语言国际化功能" class="headerlink" title="使用多语言国际化功能"></a>使用多语言国际化功能</h2><p>在其他需要使用多语言功能的地方，可以通过类似<code> &#123;&#123; $vuetify.lang.t("$vuetify.label") &#125;&#125;</code> 的形式来使用事先在 语言包中定义好的名字，这里的 <code>label</code> 就是在语言包中定义好的变量。</p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vuetify </tag>
            
            <tag> leancloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>创建基于 Vuetify 和 leancloud 的 Vue.js 应用程序(一)</title>
      <link href="/2021/01/20/create-a-vue-app-based-vuetify-and-leancloud-part-I/"/>
      <url>/2021/01/20/create-a-vue-app-based-vuetify-and-leancloud-part-I/</url>
      
        <content type="html"><![CDATA[<p> 假设各位的电脑已经安装好配置了相应的开发环境：</p><blockquote><ol><li>node.js</li></ol></blockquote><blockquote><ol start="2"><li>yarn</li></ol></blockquote><blockquote><ol start="3"><li>@vue&#x2F;cli</li></ol></blockquote><blockquote><ol start="4"><li>Visual Studio Code</li></ol></blockquote><h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><h2 id="包管理工具-npm-和-yarn"><a href="#包管理工具-npm-和-yarn" class="headerlink" title="包管理工具 npm 和 yarn"></a>包管理工具 npm 和 yarn</h2><p> <code>npm</code> 和 <code>yarn</code> 都是包管理工具， <code>npm</code> 是<code>node.js</code>自带的，<code>yarn</code> 需要额外安装。在使用一段时间之后，我现在比较喜欢使用 <code>yarn</code>, 至于优点，网上列出来的主要有这么几个：速度快、安装版本统一、输出信息更简洁等等。</p><p> 所以在下面的操作过程中，基本上就按照自己的习惯使用<code>yarn</code> 来完成，如果自己不习惯这个命令的话，也可以自行使用相应的 <code>npm</code> 命令来操作。只要得到的结果一样就可以了。</p><h2 id="Vue-js-2-x-和-Vue-js-3-x-的选择"><a href="#Vue-js-2-x-和-Vue-js-3-x-的选择" class="headerlink" title="Vue.js 2.x 和  Vue.js 3.x 的选择"></a>Vue.js 2.x 和  Vue.js 3.x 的选择</h2><p><code> Vue.js 3.x</code> 的正式版发布已经有一段时间了，而且和 <code> Vue.js 2.x</code> 相比变化非常大，这就导致了现在很多和<code> Vue.js</code>配套的库，特别是和 <code>UI</code> 有关的库大部分都还没有来得及未完成新版本的适配。虽然以后肯定是会升级到 <code> Vue.js 3.x</code>，但就目前阶段来说，继续使用<code> Vue.js 2.x</code> 来开发项目不失为一个明智的选择。</p><h2 id="使用-vue-cli-创建项目"><a href="#使用-vue-cli-创建项目" class="headerlink" title="使用 @vue&#x2F;cli 创建项目"></a>使用 @vue&#x2F;cli 创建项目</h2><h3 id="打开Powershell窗口"><a href="#打开Powershell窗口" class="headerlink" title="打开Powershell窗口"></a>打开<code>Powershell窗口</code></h3><p>首先，我在自己的电脑建了一个专门的文件夹 <code>D:\sources\vue_repos</code> 用来存放 <code>Vue.js</code> 项目。按住<code>Shift</code>键，然后在该文件夹空白处点<code>鼠标右键</code>，在弹出的快捷菜单中选择 <code>在此处打开Powershell窗口(s)</code>。（打开<code>CMD窗口</code>中完成以下命令也是一样的）</p><h3 id="创建项目-mad-world-app"><a href="#创建项目-mad-world-app" class="headerlink" title="创建项目 mad-world-app"></a>创建项目 <code>mad-world-app</code></h3><p>在<code>Powershell窗口</code> 中输入命令：<code>vue create mad-world-app</code></p><blockquote><p><code>mad-world-app</code> 为项目名称，请把它替换为你自己的项目名。</p></blockquote><ul><li>在 <code>Please pick a preset</code>(请选择一个预设) 中选择 <code>Manually select features</code>(手动选择项目):</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.10</span><br><span class="line">? Please pick a preset:</span><br><span class="line">  Default ([Vue 2] babel, eslint)</span><br><span class="line">  Default (Vue 3 Preview) ([Vue 3] babel, eslint)</span><br><span class="line">&gt; Manually <span class="keyword">select</span> features</span><br></pre></td></tr></table></figure><ul><li><p>在<code>Check the features needed for your project</code>()中选择以下几项：</p><ul><li>Choose Vue version</li><li>Babel</li><li>Router</li><li>Vuex</li></ul></li></ul><p>取消原来默认选中的 <code>Linter / Formatter</code>(当然你已经会使用这一项就选上，不知道这一项是做什么的，最好不要选)</p><p>以下是选择后的结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.10</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project:</span><br><span class="line"> (*) Choose Vue version</span><br><span class="line"> (*) Babel</span><br><span class="line"> ( ) TypeScript</span><br><span class="line"> ( ) Progressive Web App (PWA) Support</span><br><span class="line"> (*) Router</span><br><span class="line"> (*) Vuex</span><br><span class="line"> ( ) CSS Pre-processors</span><br><span class="line">&gt;( ) Linter / Formatter</span><br><span class="line"> ( ) Unit Testing</span><br><span class="line"> ( ) E2E Testing</span><br></pre></td></tr></table></figure><ul><li>在 <code>Choose a version of Vue.js that you want to start the project with (Use arrow keys)</code>(选择项目的 Vue.js 版本) 选择 <code>2.x</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.10</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with (Use arrow keys)</span><br><span class="line">&gt; 2.x</span><br><span class="line">  3.x (Preview)</span><br></pre></td></tr></table></figure><ul><li>在 <code>Use history mode for router?</code>(路由使用<code>history</code>模式) 中回答 <code>n</code>，不使用<code>history</code>模式。(当然了，这一项目<code>y</code>或<code>n</code>都没有任何影响，只是个人的习惯而已)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.10</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) (Y/n)n</span><br></pre></td></tr></table></figure><ul><li>在<code>Where do you prefer placing config for Babel, ESLint, etc.? (Use arrow keys)</code> (选择<code>Babel</code>, <code>ESLint</code> 等等第三方包的配置文件) 中选择 <code>In dedicated config files</code>(在专用的配置文件中)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.10</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? (Use arrow keys)</span><br><span class="line">&gt; In dedicated config files</span><br><span class="line">  In package.json</span><br></pre></td></tr></table></figure><ul><li>在<code>Save this as a preset for future projects? </code>(保存刚才的选择到项目预设) 中回答 <code>n</code>。</li></ul><p>以后建项目的时候如果确定回答和上面的完全一样的，也可以回答<code>y</code>，把刚才的选择项都存为一个预设，以后可以使用该预设完成项目的创建。</p><p>对于初学者来说，多做几次才能熟悉操作，所以建议不存预设，给自己一个练习的机会。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.10</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? In dedicated config files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? (y/N)n</span><br></pre></td></tr></table></figure><ul><li>完成了创建项目的所有选项，创建项目的过程显示如以下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos&gt; vue create mad-world-app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue CLI v4.5.10</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? In dedicated config files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? No</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue CLI v4.5.10</span><br><span class="line">✨  Creating project <span class="keyword">in</span> D:\sources\vue_repos\mad-world-app.</span><br><span class="line">⚙️  Installing CLI plugins. This might take a <span class="keyword">while</span>...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">info No lockfile found.</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.1: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.1&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 22.18s.</span><br><span class="line">🚀  Invoking generators...</span><br><span class="line">📦  Installing additional dependencies...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.1: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.1&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 5.81s.</span><br><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">📄  Generating README.md...</span><br><span class="line"></span><br><span class="line">🎉  Successfully created project mad-world-app.</span><br><span class="line">👉  Get started with the following commands:</span><br><span class="line"></span><br><span class="line"> $ <span class="built_in">cd</span> mad-world-app</span><br><span class="line"> $ yarn serve</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="进入创建好的项目文件夹"><a href="#进入创建好的项目文件夹" class="headerlink" title="进入创建好的项目文件夹"></a>进入创建好的项目文件夹</h3><p>根据项目创建完成后倒数第二行提示，输入命令：<code>cd mad-world-app</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos&gt; <span class="built_in">cd</span> mad-world-app</span><br><span class="line">PS D:\sources\vue_repos\mad-world-app&gt;</span><br></pre></td></tr></table></figure><h3 id="在-Visual-Studio-Code-中打开项目"><a href="#在-Visual-Studio-Code-中打开项目" class="headerlink" title="在 Visual Studio Code 中打开项目"></a>在 <code>Visual Studio Code</code> 中打开项目</h3><p>方法一： 启动 <code>Visual Studio Code</code>， 选择<code>打开文件夹</code>, 选中<code>D:\sources\vue_repos\mad-world-app</code> 打开。</p><p>方法二： 在上一步使用命令进入项目文件夹的基础上，直接在命令行中输入：<code>code .</code>(<code>code</code>  和  <code>.</code>  之间至少有一个空格隔开 )， 则可以启动 <code>Visual Studio Code</code> 并打开当前的文件夹。(我比较喜欢这种打开方式。)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos\mad-world-app&gt; code .</span><br></pre></td></tr></table></figure><h3 id="启动开发服务器的时候自动打开默认浏览器"><a href="#启动开发服务器的时候自动打开默认浏览器" class="headerlink" title="启动开发服务器的时候自动打开默认浏览器"></a>启动开发服务器的时候自动打开默认浏览器</h3><p>在 <code>Visudl Studio Code</code> 打开 <code>package.json</code> 文件。其内容如以下代码所示:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;mad-world-app&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;core-js&quot;</span>: <span class="string">&quot;^3.6.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue&quot;</span>: <span class="string">&quot;^2.6.11&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue-router&quot;</span>: <span class="string">&quot;^3.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vuex&quot;</span>: <span class="string">&quot;^3.4.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-babel&quot;</span>: <span class="string">&quot;~4.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-router&quot;</span>: <span class="string">&quot;~4.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-vuex&quot;</span>: <span class="string">&quot;~4.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-service&quot;</span>: <span class="string">&quot;~4.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue-template-compiler&quot;</span>: <span class="string">&quot;^2.6.11&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 第5行的<code>scripts</code>用于定义脚本命令：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>在上面这个 <code>scripts</code>小节中，定义了两个脚本命令<code>serve</code>和<code>build</code></p><ul><li><p>每一行冒号左边的名字是命令名称，可以通过类似<code> npm run serve</code>或是 <code>yarn serve</code> 的方式在控制台运行。</p></li><li><p>每一行冒号右边的内容侧是该命令执行时实际调用的脚本。</p></li></ul><p>两个脚本命令的说明：</p><blockquote><p><code>vue-cli-service serve</code> 命令会启动一个开发服务器 (基于 webpack-dev-server) 并附带开箱即用的模块热重载 (Hot-Module-Replacement)</p></blockquote><blockquote><p><code>vue-cli-service build</code> 会在 dist&#x2F; 目录产生一个可用于生产环境的包，带有 JS&#x2F;CSS&#x2F;HTML 的压缩，和为更好的缓存而做的自动的 vendor chunk splitting</p></blockquote><p>复制 <code>&quot;serve&quot;: &quot;vue-cli-service serve&quot;,</code>那一行。并修改冒号左边的命令名称为 <code>dev</code>, 在冒号右边的脚本后加空格，再添加选择 <code>--open</code>(用于自动打开默认浏览器)，修改后的代码如以下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vue-cli-service serve --open&quot;</span>,</span><br><span class="line">    <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><blockquote><p>以后在项目的控制台中运行命令：<code>yarn dev</code> 或<code>npm run dev</code> 就可以启动开发服务器，并自动打开默认浏览器显示运行的结果了。</p></blockquote><h1 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h1><p>在控制台输入命令：<code>yarn dev</code>, 项目运行成功后将看到内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DONE  Compiled successfully <span class="keyword">in</span> 144ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> App running at:</span><br><span class="line"> - Local:   http://localhost:8080/</span><br><span class="line"> - Network: http://192.168.1.80:8080/</span><br><span class="line"></span><br><span class="line"> Note that the development build is not optimized.</span><br><span class="line"> To create a production build, run yarn build.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在自动打开的默认浏览器中，可以看到项目运行的结果如下图所示：</p><img src="/2021/01/20/create-a-vue-app-based-vuetify-and-leancloud-part-I/yarndev.png" class="" title="yarn dev"><h1 id="安装-Vuetify-和-leancloud-SDK"><a href="#安装-Vuetify-和-leancloud-SDK" class="headerlink" title="安装 Vuetify 和 leancloud SDK"></a>安装 Vuetify 和 leancloud SDK</h1><p>开发 Vue.js 应用程序的时候，需要给程序做一个好看的界面，同时还需要后台服务器端。</p><p>应用程序界面这里选择使用 <code>Vuetify</code> 框架，同时使用 <code>LeanCloud</code> 为应用程序提供后端支持，免去自己开发后台服务器端，还有布置、管理服务器等诸多难题。</p><blockquote><p>要使用 <code>LeanCloud</code> 的数据存储服务，需要先到 <a href="https://www.leancloud.cn/">leancloud.cn</a>  或 <a href="https://www.leancloud.app/">leancloud.app</a>注册一个帐号，并创建应用。</p></blockquote><h2 id="在项目中添加-Vuetify"><a href="#在项目中添加-Vuetify" class="headerlink" title="在项目中添加 Vuetify"></a>在项目中添加 Vuetify</h2><p><code>Vuetify</code> 完全按照 <code>Material Design specification</code> 开发, 是一个用于 <code>Vue.js</code> 的 <code>Material Design</code> 组件框架, 语义化的 <code>Material</code> 组件非常方便使用。</p><p>在控制台输入命令：<code>vue add vuetify</code></p><p>出现以下选项时，选择第一项：<code>Default (recommended)</code>(默认) 即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">? Choose a preset: (Use arrow keys)</span><br><span class="line">&gt; Default (recommended)</span><br><span class="line">  Prototype (rapid development)</span><br><span class="line">  Configure (advanced)</span><br></pre></td></tr></table></figure><p>完整的安装命令过程如以下显示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos\mad-world-app&gt; vue add vuetify</span><br><span class="line"></span><br><span class="line">📦  Installing vue-cli-plugin-vuetify...</span><br><span class="line"></span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.1: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.1&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 5 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ vue-cli-plugin-vuetify@2.0.9</span><br><span class="line">info All dependencies</span><br><span class="line">├─ interpret@1.4.0</span><br><span class="line">├─ null-loader@3.0.0</span><br><span class="line">├─ rechoir@0.6.2</span><br><span class="line">├─ shelljs@0.8.4</span><br><span class="line">└─ vue-cli-plugin-vuetify@2.0.9</span><br><span class="line">Done <span class="keyword">in</span> 10.36s.</span><br><span class="line">✔  Successfully installed plugin: vue-cli-plugin-vuetify</span><br><span class="line"></span><br><span class="line">? Choose a preset: Default (recommended)</span><br><span class="line"></span><br><span class="line">🚀  Invoking generator <span class="keyword">for</span> vue-cli-plugin-vuetify...</span><br><span class="line">📦  Installing additional dependencies...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.1: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.1&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 10.99s.</span><br><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">✔  Successfully invoked generator <span class="keyword">for</span> plugin: vue-cli-plugin-vuetify</span><br><span class="line"> vuetify  Discord community: https://community.vuetifyjs.com</span><br><span class="line"> vuetify  Github: https://github.com/vuetifyjs/vuetify</span><br><span class="line"> vuetify  Support Vuetify: https://github.com/sponsors/johnleider</span><br></pre></td></tr></table></figure><blockquote><p>使用 <code>vue add vuetify</code> 安装的 <code>Vuetify</code> 已经自动完成相应的配置，之后直接使用就可以了。</p></blockquote><h3 id="使用本地的图标和样式-可选"><a href="#使用本地的图标和样式-可选" class="headerlink" title="使用本地的图标和样式(可选)"></a>使用本地的图标和样式(可选)</h3><blockquote><p>(这一项不是必须的，内容待定)</p></blockquote><h2 id="安装-leancloud-SDK"><a href="#安装-leancloud-SDK" class="headerlink" title="安装 leancloud SDK"></a>安装 leancloud SDK</h2><p> <code>LeanCloud</code>（原 AVOS Cloud） 是针对移动应用的一站式云端服务，专注于为应用开发者提供工具和平台, 这里使用 <code>leancloud</code> 的 <code>数据存储</code>功能来保存数据。</p><p>在控制台输入命令：<code>yarn add leancloud-storage</code> (在命令后面添加使用淘宝源的选项加快安装速度：<code> --registry https://registry.npm.taobao.org</code>)</p><p>安装过程显示如以下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">PS D:\sources\vue_repos\mad-world-app&gt; yarn add leancloud-storage</span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">warning leancloud-storage &gt; babel-runtime &gt; core-js@2.6.12: core-js@&lt;3 is no longer maintained and not recommended <span class="keyword">for</span> usage due to the number of issues. Please, upgrade your dependencies to the actual version of core-js@3.</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.3.1: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.3.1&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">warning <span class="string">&quot; &gt; sass-loader@8.0.2&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.36.0 || ^5.0.0&quot;</span>.</span><br><span class="line">warning <span class="string">&quot;vue-cli-plugin-vuetify &gt; null-loader@3.0.0&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.3.0&quot;</span>.</span><br><span class="line">warning <span class="string">&quot; &gt; vuetify-loader@1.6.0&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.0.0&quot;</span>.</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 37 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ leancloud-storage@4.10.0</span><br><span class="line">info All dependencies</span><br><span class="line">├─ @leancloud/platform-adapters-browser@1.5.2</span><br><span class="line">├─ @leancloud/platform-adapters-node@1.5.2</span><br><span class="line">├─ @leancloud/platform-adapters-weapp@1.6.1</span><br><span class="line">├─ @types/cookiejar@2.1.2</span><br><span class="line">├─ @types/superagent@4.1.10</span><br><span class="line">├─ @types/ws@7.4.0</span><br><span class="line">├─ ascli@1.0.1</span><br><span class="line">├─ babel-runtime@6.26.0</span><br><span class="line">├─ base64-arraybuffer@0.1.5</span><br><span class="line">├─ bytebuffer@5.0.1</span><br><span class="line">├─ charenc@0.0.2</span><br><span class="line">├─ code-point-at@1.1.0</span><br><span class="line">├─ colour@0.7.1</span><br><span class="line">├─ cookiejar@2.1.2</span><br><span class="line">├─ crypt@0.0.2</span><br><span class="line">├─ event-target-shim@5.0.1</span><br><span class="line">├─ eventemitter3@2.0.3</span><br><span class="line">├─ fast-safe-stringify@2.0.7</span><br><span class="line">├─ formidable@1.2.2</span><br><span class="line">├─ invert-kv@1.0.0</span><br><span class="line">├─ javascript-state-machine@2.4.0</span><br><span class="line">├─ lcid@1.0.0</span><br><span class="line">├─ leancloud-realtime-plugin-live-query@1.2.0</span><br><span class="line">├─ leancloud-realtime@5.0.0-rc.5</span><br><span class="line">├─ leancloud-storage@4.10.0</span><br><span class="line">├─ localstorage-memory@1.0.3</span><br><span class="line">├─ long@3.2.0</span><br><span class="line">├─ md5@2.3.0</span><br><span class="line">├─ miniprogram-api-typings@2.12.0</span><br><span class="line">├─ number-is-nan@1.0.1</span><br><span class="line">├─ optjs@3.2.2</span><br><span class="line">├─ os-locale@1.4.0</span><br><span class="line">├─ protobufjs@5.0.3</span><br><span class="line">├─ regenerator-runtime@0.11.1</span><br><span class="line">├─ superagent@5.3.1</span><br><span class="line">├─ underscore@1.12.0</span><br><span class="line">└─ window-size@0.1.4</span><br><span class="line">Done <span class="keyword">in</span> 210.00s.</span><br></pre></td></tr></table></figure><h2 id="在项目中初始化-leancloud-SDK"><a href="#在项目中初始化-leancloud-SDK" class="headerlink" title="在项目中初始化 leancloud SDK"></a>在项目中初始化 leancloud SDK</h2><h3 id="设置-leancloud-应用keys"><a href="#设置-leancloud-应用keys" class="headerlink" title="设置 leancloud 应用keys"></a>设置 leancloud 应用keys</h3><p>在项目中创建文件夹：<code>src/api/config/</code></p><p>再文件夹中创建文件：<code>src/api/config/lc.config.js</code>, 编辑其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//&#x27;这里填写 leancloud 的 appId&#x27;,</span></span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;9MCRS87WVkReLtNbQWbnllm9-********&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// &#x27;这里填写 leancloud 的 appKey&#x27;,</span></span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;zAfYTXaiXYGeQUm8********&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// &#x27;这里填写 leancloud 的 REST API 服务器地址，国际版应用等未绑定自定义域名的此项留空&#x27;</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://********.lc-cn-n1-shared.com&#x27;</span>,</span><br><span class="line">  &#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>以上部分字符已经改成了<code>*</code> 以隐藏真实的keys，请用自己的 leancloud <code>应用keys</code> 中相应的内容替换以上三个值。</p></blockquote><h3 id="leancloud-SDK-初始化"><a href="#leancloud-SDK-初始化" class="headerlink" title="leancloud SDK 初始化"></a>leancloud SDK 初始化</h3><p>在项目中创建文件：<code>src/api/init.js</code>，编辑其内容如以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;   <span class="comment">// 导入 leancloud 数据存储模块</span></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;./config/lc.config&#x27;</span>;  <span class="comment">// 导入 leancloud 的应用keys</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initOptions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (config.<span class="property">url</span>.<span class="title function_">trim</span>() === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// url 为空的时候，访问国际版：leancloud.app</span></span><br><span class="line">    initOptions = &#123;</span><br><span class="line">        <span class="attr">appId</span>: config.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">appKey</span>: config.<span class="property">key</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// url 不为空的时候，访问国内版:leancloud.cn</span></span><br><span class="line">    initOptions = &#123;</span><br><span class="line">        <span class="attr">appId</span>: config.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">appKey</span>: config.<span class="property">key</span>,</span><br><span class="line">        <span class="attr">serverURLs</span>: config.<span class="property">url</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 leanCloud 初始化</span></span><br><span class="line"><span class="variable constant_">LC</span>.<span class="title function_">init</span>(initOptions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出模块</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="在-main-js-中导入并执行-leancloud-初始化"><a href="#在-main-js-中导入并执行-leancloud-初始化" class="headerlink" title="在 main.js 中导入并执行 leancloud 初始化"></a>在 <code>main.js</code> 中导入并执行 <code>leancloud</code> 初始化</h3><p>编辑文件：<code>src/main.js</code>, 添加 <code>leancloud</code> 导入并执行初始化的代码如以下所示:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> vuetify <span class="keyword">from</span> <span class="string">&#x27;./plugins/vuetify&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./api/init.js&#x27;</span>);  <span class="comment">// 导入并执行 LeanCloud 初始化</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  vuetify,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vuetify </tag>
            
            <tag> leancloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Vuetify 中使用 vue-i18n 实现多语言国际化</title>
      <link href="/2021/01/08/use-both-vuetify-and-vue-i18n/"/>
      <url>/2021/01/08/use-both-vuetify-and-vue-i18n/</url>
      
        <content type="html"><![CDATA[<h1 id="安装-Vue-I18n"><a href="#安装-Vue-I18n" class="headerlink" title="安装 Vue I18n"></a>安装 Vue I18n</h1><p>在项目(此前已经安装好 <code>Vuetify</code> )的控制台下输入命令：<code>yarn add vue-i18n</code></p><p>安装的过程显示如以下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add vue-i18n  --registry https://registry.npm.taobao.org</span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.3: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.3&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">warning <span class="string">&quot; &gt; sass-loader@8.0.2&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.36.0 || ^5.0.0&quot;</span>.</span><br><span class="line">warning <span class="string">&quot;vue-cli-plugin-vuetify &gt; null-loader@3.0.0&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.3.0&quot;</span>.</span><br><span class="line">warning <span class="string">&quot; &gt; vuetify-loader@1.6.0&quot;</span> has unmet peer dependency <span class="string">&quot;webpack@^4.0.0&quot;</span>.</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 1 new dependency.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ vue-i18n@8.22.3</span><br><span class="line">info All dependencies</span><br><span class="line">└─ vue-i18n@8.22.3</span><br><span class="line">Done <span class="keyword">in</span> 7.19s.</span><br></pre></td></tr></table></figure><h1 id="添加语言文件"><a href="#添加语言文件" class="headerlink" title="添加语言文件"></a>添加语言文件</h1><p>在项目中新建文件夹 <code>src/locale</code>, 然后添加 <code>English</code> 的语言文件：<code>src/locale/en.js</code> 和<code>简体中文</code>的语言文件：<code>src/locale/zh-Hans.js</code> 。</p><p>分别修改以上两个语言文件，<code>src/locale/en.js</code>  的内容如以下代码所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/locale/en.js</span></span><br><span class="line"><span class="keyword">import</span> en <span class="keyword">from</span> <span class="string">&#x27;vuetify/es5/locale/en&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;English&#x27;</span>,</span><br><span class="line">    <span class="comment">//page login</span></span><br><span class="line">    <span class="attr">login</span>: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">    <span class="attr">register</span>: <span class="string">&#x27;Register&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;Username&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;Password&#x27;</span>,</span><br><span class="line">    <span class="attr">login_account</span>: <span class="string">&#x27;Login accoount&#x27;</span>,</span><br><span class="line">    <span class="comment">// menu</span></span><br><span class="line">    <span class="attr">menu</span>: &#123;</span><br><span class="line">        <span class="attr">home</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">        <span class="attr">dashboard</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    ...en,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>src/locale/zh-Hans.js</code>  的内容如以下代码所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/locale/zh-Hans.js</span></span><br><span class="line"><span class="keyword">import</span> zhHans <span class="keyword">from</span> <span class="string">&#x27;vuetify/es5/locale/zh-Hans&#x27;</span>;  <span class="comment">// 导入Vuetify 自带的简体中文语言包</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;简体中文&#x27;</span>,</span><br><span class="line">    <span class="comment">// page login</span></span><br><span class="line">    <span class="attr">login</span>: <span class="string">&#x27;登录&#x27;</span>,</span><br><span class="line">    <span class="attr">register</span>: <span class="string">&#x27;注册&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">    <span class="attr">login_account</span>: <span class="string">&#x27;登录帐户&#x27;</span>,</span><br><span class="line">    <span class="comment">// menu</span></span><br><span class="line">    <span class="attr">menu</span>: &#123;</span><br><span class="line">        <span class="attr">home</span>: <span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">        <span class="attr">dashboard</span>: <span class="string">&#x27;仪表盘&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 展开 简体中文语言包的所有项目</span></span><br><span class="line">    ...zhHans,   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果还需要其他的语言文件，则按照上面的格式进行修改即可。</p><h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><p>打开 <code>Vuetify</code> 的配置文件： <code>src/plugins/vuetify.js</code>， 修改其内容如以下代码所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/plugins/vuetify.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuetify</span> <span class="keyword">from</span> <span class="string">&#x27;vuetify/lib/framework&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> zhHans <span class="keyword">from</span> <span class="string">&#x27;@/locale/zh-Hans&#x27;</span>;   <span class="comment">// 导入简体中文语言</span></span><br><span class="line"><span class="keyword">import</span> en <span class="keyword">from</span> <span class="string">&#x27;@/locale/en&#x27;</span>;            <span class="comment">// 导入English语言</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuetify</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuetify</span>(&#123;</span><br><span class="line">    <span class="attr">lang</span>: &#123;</span><br><span class="line">        <span class="attr">locales</span>: &#123; zhHans, en &#125;,   <span class="comment">// 所有的语言</span></span><br><span class="line">        <span class="attr">current</span>: <span class="string">&#x27;en&#x27;</span>,             <span class="comment">// 当前语言</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="添加多语言选择菜单组件"><a href="#添加多语言选择菜单组件" class="headerlink" title="添加多语言选择菜单组件"></a>添加多语言选择菜单组件</h1><p>添加新文件：<code>src/components/LocaleLanguage.vue</code>，编辑其内容如以下代码所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- src/components/LocaleLanguage.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 多语言选择菜单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-menu</span></span></span><br><span class="line"><span class="tag">      <span class="attr">offset-y</span></span></span><br><span class="line"><span class="tag">      <span class="attr">origin</span>=<span class="string">&quot;center center&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;elelvation-1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">transition</span>=<span class="string">&quot;scale-transition&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:activator</span>=<span class="string">&quot;&#123; on &#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">text</span> <span class="attr">slot</span>=<span class="string">&quot;activator&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-icon</span> <span class="attr">medium</span>&gt;</span>mdi-translate<span class="tag">&lt;/<span class="name">v-icon</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 显示当前语言名称 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;ml-2&quot;</span>&gt;</span> &#123;&#123; localeText &#125;&#125; <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-icon</span> <span class="attr">small</span>&gt;</span>mdi-menu-down<span class="tag">&lt;/<span class="name">v-icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 显示所有语言包组成的下拉菜单 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-list-item-group</span> <span class="attr">v-model</span>=<span class="string">&quot;$vuetify.lang.current&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-list-item</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">click</span>=<span class="string">&quot;handleChangeLocale(item)&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-for</span>=<span class="string">&quot;item in availableLanguages&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:key</span>=<span class="string">&quot;item.value&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:value</span>=<span class="string">&quot;item.value&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">v-list-item-title</span> <span class="attr">v-text</span>=<span class="string">&quot;item.text&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">v-list-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-list-item-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;locale-language&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置当前语言</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleChangeLocale</span>(<span class="params">&#123; value &#125;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$vuetify</span>.<span class="property">lang</span>.<span class="property">current</span> = value;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 遍历并获取项目中的所有语言包</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">availableLanguages</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; locales &#125; = <span class="variable language_">this</span>.<span class="property">$vuetify</span>.<span class="property">lang</span>; <span class="comment">// 所有的语言，来自 src/plugins/vuetify.js 中的配置</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(locales).<span class="title function_">map</span>(<span class="function">(<span class="params">lang</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">text</span>: locales[lang].<span class="property">label</span>, <span class="comment">// 语言包显示的名字</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">value</span>: lang, <span class="comment">// 语言包的值</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 当前语言, 用于语言切换菜单中显示的当前语言名字</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">localeText</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> find = <span class="variable language_">this</span>.<span class="property">availableLanguages</span>.<span class="title function_">find</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">value</span> === <span class="variable language_">this</span>.<span class="property">$vuetify</span>.<span class="property">lang</span>.<span class="property">current</span></span></span><br><span class="line"><span class="language-javascript">      );</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> find.<span class="property">text</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="在-AppBar-中添加语言选择菜单"><a href="#在-AppBar-中添加语言选择菜单" class="headerlink" title="在 AppBar 中添加语言选择菜单"></a>在 AppBar 中添加语言选择菜单</h1><p>将上一步编写好的组件添加到顶部的 AppBar 中，打开 <code>src/components/AppBar.vue</code>，添加对 <code>LocaleLanguage</code>组件的引用和注册，并调用该组件，修改其代码如以下所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment"> * @FilePath: \chat-zone-app\src\components\AppBar.vue</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">v-app-bar</span> <span class="attr">app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-toolbar-title</span>&gt;</span> Char Zone App <span class="tag">&lt;/<span class="name">v-toolbar-title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">text</span> <span class="attr">class</span>=<span class="string">&quot;mx-3&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">      Home</span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">v-if</span>=<span class="string">&quot;current_user&quot;</span> <span class="attr">text</span> <span class="attr">class</span>=<span class="string">&quot;mx-3&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span>&gt;</span></span><br><span class="line">      Dashboard</span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-spacer</span>&gt;</span><span class="tag">&lt;/<span class="name">v-spacer</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  第 2 步：这里添加多语言选择菜单组件的调用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">locale-language</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 此处省略了与当前功能无关的其他代码  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">v-app-bar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">//  此处省略了与当前功能无关的其他代码</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;cz-app-bar&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 第 1 步：导入并注册 多语言选择组件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">LocaleLanguage</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;@/components/LocaleLanguage.vue&quot;</span>),  </span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">   </span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//  此处省略了与当前功能无关的其他代码</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>完成后，在 <code>AppBar</code> 上已经可以看到用于多语言选择的下拉菜单</p><img src="/2021/01/08/use-both-vuetify-and-vue-i18n/locales.PNG" class="" title="locales"><h1 id="应用多语言"><a href="#应用多语言" class="headerlink" title="应用多语言"></a>应用多语言</h1><p>在其他需要使用多语言功能的地方，可以通过类似 <code> &#123;&#123; $vuetify.lang.t("$vuetify.label") &#125;&#125;</code> 的形式来使用事先在 语言包中定义好的名字，这里的 <code>label</code> 就是在语言包中定义好的变量。</p><p>下面来看一个实例， 打开 <code>src/components/AppBar.vue</code> 文件，找到 <code>template</code> 中的文字<code>Home</code> 和 <code>Dashboard</code>， 待修改的代码如以下所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> * @FilePath: \chat-zone-app\src\components\AppBar.vue</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">v-app-bar</span> <span class="attr">app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-toolbar-title</span>&gt;</span> Char Zone App <span class="tag">&lt;/<span class="name">v-toolbar-title</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">text</span> <span class="attr">class</span>=<span class="string">&quot;mx-3&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">      Home</span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">v-if</span>=<span class="string">&quot;current_user&quot;</span> <span class="attr">text</span> <span class="attr">class</span>=<span class="string">&quot;mx-3&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span>&gt;</span></span><br><span class="line">      Dashboard</span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br></pre></td></tr></table></figure><p>将这两个文字修改为如以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> * @FilePath: \chat-zone-app\src\components\AppBar.vue</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">v-app-bar</span> <span class="attr">app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-toolbar-title</span>&gt;</span> Char Zone App <span class="tag">&lt;/<span class="name">v-toolbar-title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">text</span> <span class="attr">class</span>=<span class="string">&quot;mx-3&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; $vuetify.lang.t(&quot;$vuetify.menu.home&quot;) &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">v-if</span>=<span class="string">&quot;current_user&quot;</span> <span class="attr">text</span> <span class="attr">class</span>=<span class="string">&quot;mx-3&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/dashboard&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; $vuetify.lang.t(&quot;$vuetify.menu.dashboard&quot;) &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 后面的代码与当前功能无关， 省略了。 --&gt;</span></span><br></pre></td></tr></table></figure><p>现在可以进行语言切换，并看到效果了</p><p>当前语言为：<code>English</code></p><img src="/2021/01/08/use-both-vuetify-and-vue-i18n/english.PNG" class="" title="English"><p>当前语言更改为：<code>简体中文</code></p><img src="/2021/01/08/use-both-vuetify-and-vue-i18n/zhhans.PNG" class="" title="简体中文"><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vuetify </tag>
            
            <tag> leancloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Vuetify 的 v-data-table 组件实现基于 leancloud 的 CRUD 应用</title>
      <link href="/2020/12/23/vuetify-data-table-with-leancloud/"/>
      <url>/2020/12/23/vuetify-data-table-with-leancloud/</url>
      
        <content type="html"><![CDATA[<h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><h2 id="使用-vue-cli-新建项目-vuetify-data-table-example"><a href="#使用-vue-cli-新建项目-vuetify-data-table-example" class="headerlink" title="使用 @vue/cli 新建项目 vuetify-data-table-example"></a>使用 <code>@vue/cli</code> 新建项目 <code>vuetify-data-table-example</code></h2><p>输入命令：<code>vue create vuetify-data-table-example</code></p><p>在看到的选项中选择以下几项：</p><ul><li>Choose Vue version</li><li>Babel </li><li>Router </li><li>Vuex</li></ul><p>控制台显示安装过程如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">D:\sources\vue_repos&gt;vue create vuetify-data-table-example</span><br><span class="line"></span><br><span class="line">Vue CLI v4.5.9</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? In dedicated config files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? No</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue CLI v4.5.9</span><br><span class="line">✨  Creating project <span class="keyword">in</span> D:\sources\vue_repos\vuetify-data-table-example.</span><br><span class="line">⚙️  Installing CLI plugins. This might take a <span class="keyword">while</span>...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">info No lockfile found.</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.3: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.3&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...#################################################################################################] 1060/1060</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 16.28s.</span><br><span class="line">🚀  Invoking generators...</span><br><span class="line">📦  Installing additional dependencies...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.3: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.3&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 5.71s.</span><br><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">📄  Generating README.md...</span><br><span class="line"></span><br><span class="line">🎉  Successfully created project vuetify-data-table-example.</span><br><span class="line">👉  Get started with the following commands:</span><br><span class="line"></span><br><span class="line"> $ <span class="built_in">cd</span> vuetify-data-table-example</span><br><span class="line"> $ yarn serve</span><br></pre></td></tr></table></figure><h1 id="安装-Vuetify-和-leancloud-SDK"><a href="#安装-Vuetify-和-leancloud-SDK" class="headerlink" title="安装 Vuetify 和 leancloud SDK"></a>安装 Vuetify 和 leancloud SDK</h1><h2 id="添加-vuetify"><a href="#添加-vuetify" class="headerlink" title="添加 vuetify"></a>添加 vuetify</h2><p>当vue 项目创建成功后，输入以下命令进入项目文件夹：</p><p><code>cd vuetify-data-table-example</code> </p><p>然后再使用命令在项目中安装 vuetify:</p><p><code>vue add vuetify</code></p><p>遇到以下选项时，选择 Default(默认) 项：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">? Choose a preset: (Use arrow keys)</span><br><span class="line">&gt; Default (recommended)</span><br><span class="line">  Prototype (rapid development)</span><br><span class="line">  Configure (advanced)</span><br></pre></td></tr></table></figure><p>控制台显示安装过程如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">D:\sources\vue_repos\vuetify-data-table-example&gt;vue add vuetify</span><br><span class="line"></span><br><span class="line">📦  Installing vue-cli-plugin-vuetify...</span><br><span class="line"></span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.3: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.3&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 5 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ vue-cli-plugin-vuetify@2.0.8</span><br><span class="line">info All dependencies</span><br><span class="line">├─ interpret@1.4.0</span><br><span class="line">├─ null-loader@3.0.0</span><br><span class="line">├─ rechoir@0.6.2</span><br><span class="line">├─ shelljs@0.8.4</span><br><span class="line">└─ vue-cli-plugin-vuetify@2.0.8</span><br><span class="line">Done <span class="keyword">in</span> 9.23s.</span><br><span class="line">✔  Successfully installed plugin: vue-cli-plugin-vuetify</span><br><span class="line"></span><br><span class="line">? Choose a preset: Default (recommended)</span><br><span class="line"></span><br><span class="line">🚀  Invoking generator <span class="keyword">for</span> vue-cli-plugin-vuetify...</span><br><span class="line">📦  Installing additional dependencies...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.3: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.3&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 6.94s.</span><br><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">✔  Successfully invoked generator <span class="keyword">for</span> plugin: vue-cli-plugin-vuetify</span><br><span class="line"> vuetify  Discord community: https://community.vuetifyjs.com</span><br><span class="line"> vuetify  Github: https://github.com/vuetifyjs/vuetify</span><br><span class="line"> vuetify  Support Vuetify: https://github.com/sponsors/johnleider</span><br></pre></td></tr></table></figure><h2 id="安装-leancloud-SDK"><a href="#安装-leancloud-SDK" class="headerlink" title="安装 leancloud SDK"></a>安装 leancloud SDK</h2><p>在控制台输入以下命令安装 leancloud SDK, 建议使用淘宝源以加快安装速度（在 npm install 后添加 –registry&#x3D;<a href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a> 参数）：</p><p><code>npm install leancloud-storage --save</code></p><p>控制台显示安装过程如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">D:\sources\vue_repos\vuetify-data-table-example&gt;npm install leancloud-storage --save --registry https://registry.npm.taobao.org</span><br><span class="line">npm WARN deprecated core-js@2.6.12: core-js@&lt;3 is no longer maintained and not recommended <span class="keyword">for</span> usage due to the number of issues. Please, upgrade your dependencies to the actual version of core-js@3.</span><br><span class="line">npm WARN deprecated @hapi/address@2.1.4: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/topo@3.1.6: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/hoek@8.5.1: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/bourne@1.3.2: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/joi@15.1.1: joi is leaving the @hapi organization and moving back to <span class="string">&#x27;joi&#x27;</span> (https://github.com/sideway/joi/issues/2411)</span><br><span class="line">npm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142</span><br><span class="line">npm WARN deprecated har-validator@5.1.5: this library is no longer supported</span><br><span class="line">npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated</span><br><span class="line">npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated</span><br><span class="line">npm WARN deprecated chokidar@2.1.8: Chokidar 2 will <span class="built_in">break</span> on node v14+. Upgrade to chokidar 3 with 15x less dependencies.</span><br><span class="line">npm WARN deprecated fsevents@1.2.13: fsevents 1 will <span class="built_in">break</span> on node v14+ and could be using insecure binaries. Upgrade to fsevents 2.</span><br><span class="line">npm WARN <span class="built_in">rm</span> not removing D:\sources\vue_repos\vuetify-data-table-example\node_modules\.bin\semver.cmd as it wasn<span class="string">&#x27;t installed by D:\sources\vue_repos\vuetify-data-table-example\node_modules\semver</span></span><br><span class="line"><span class="string">npm WARN rm not removing D:\sources\vue_repos\vuetify-data-table-example\node_modules\.bin\semver as it wasn&#x27;</span>t installed by D:\sources\vue_repos\vuetify-data-table-example\node_modules\semver</span><br><span class="line">npm WARN <span class="built_in">rm</span> not removing D:\sources\vue_repos\vuetify-data-table-example\node_modules\.bin\json5.cmd as it wasn<span class="string">&#x27;t installed by D:\sources\vue_repos\vuetify-data-table-example\node_modules\json5</span></span><br><span class="line"><span class="string">npm WARN rm not removing D:\sources\vue_repos\vuetify-data-table-example\node_modules\.bin\json5 as it wasn&#x27;</span>t installed by D:\sources\vue_repos\vuetify-data-table-example\node_modules\json5</span><br><span class="line"></span><br><span class="line">&gt; core-js@3.8.1 postinstall D:\sources\vue_repos\vuetify-data-table-example\node_modules\@vue\babel-preset-app\node_modules\core-js</span><br><span class="line">&gt; node -e <span class="string">&quot;try&#123;require(&#x27;./postinstall&#x27;)&#125;catch(e)&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> using core-js ( https://github.com/zloirock/core-js ) <span class="keyword">for</span> polyfilling JavaScript standard library!</span><br><span class="line"></span><br><span class="line">The project needs your <span class="built_in">help</span>! Please consider supporting of core-js on Open Collective or Patreon:</span><br><span class="line">&gt; https://opencollective.com/core-js</span><br><span class="line">&gt; https://www.patreon.com/zloirock</span><br><span class="line"></span><br><span class="line">Also, the author of core-js ( https://github.com/zloirock ) is looking <span class="keyword">for</span> a good job -)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; core-js@2.6.12 postinstall D:\sources\vue_repos\vuetify-data-table-example\node_modules\babel-runtime\node_modules\core-js</span><br><span class="line">&gt; node -e <span class="string">&quot;try&#123;require(&#x27;./postinstall&#x27;)&#125;catch(e)&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; ejs@2.7.4 postinstall D:\sources\vue_repos\vuetify-data-table-example\node_modules\ejs</span><br><span class="line">&gt; node ./postinstall.js</span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> installing EJS: built with the Jake JavaScript build tool (https://jakejs.com/)</span><br><span class="line"></span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: vue-loader-v16@npm:vue-loader@^16.0.0-beta.7 (node_modules\@vue\cli-service\node_modules\vue-loader-v16):</span><br><span class="line">npm WARN notarget SKIPPING OPTIONAL DEPENDENCY: No matching version found <span class="keyword">for</span> vue-loader-v16@16.1.2.</span><br><span class="line">npm WARN @vue/babel-preset-app@4.5.9 requires a peer of core-js@^3 but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.13 (node_modules\chokidar\node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@1.2.13: wanted &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;darwin&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;any&quot;</span>&#125; (current: &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;win32&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;x64&quot;</span>&#125;)</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@2.1.3 (node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@2.1.3: wanted &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;darwin&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;any&quot;</span>&#125; (current: &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;win32&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;x64&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">+ leancloud-storage@4.9.0</span><br><span class="line">added 157 packages from 87 contributors, removed 70 packages and updated 1093 packages <span class="keyword">in</span> 101.605s</span><br><span class="line"></span><br><span class="line">64 packages are looking <span class="keyword">for</span> funding</span><br><span class="line">  run `npm fund` <span class="keyword">for</span> details</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="leancloud-初始化"><a href="#leancloud-初始化" class="headerlink" title="leancloud 初始化"></a>leancloud 初始化</h2><p>在项目中添加以下文件及文件夹：</p><ul><li><code>src/api/init.js</code></li><li><code>src/api/config/lc.config.js</code></li></ul><p>编辑 <code>src/api/config/lc.config.js</code> 内容如以下所示(部分字符已经更改为 <code>*</code> , 请使用自己 <code>leancloud</code> 中 <code>应用Keys</code> 进行替换)：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/api/config/lc.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//&#x27;这里填写 leancloud 的 appId&#x27;,</span></span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;9MCRS87WVkReLtNbQWbnllm9-********&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// &#x27;这里填写 leancloud 的 appKey&#x27;,</span></span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;zAfYTXaiXYGeQUm8********&#x27;</span>,</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// &#x27;这里填写 leancloud 的 REST API 服务器地址，国际版应用等未绑定自定义域名的此项留空&#x27;</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://*******.lc-cn-n1-shared.com&#x27;</span>,</span><br><span class="line">  &#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编辑 <code>src/api/init.js</code>， 内容如以下代码所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/api/init.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;./config/lc.config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initOptions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (config.<span class="property">url</span>.<span class="title function_">trim</span>() === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">  <span class="comment">// url 为空的时候，访问国际版：leancloud.app</span></span><br><span class="line">  initOptions = &#123;</span><br><span class="line">    <span class="attr">appId</span>: config.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">appKey</span>: config.<span class="property">key</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// url 不为空的时候，访问国内版:leancloud.cn</span></span><br><span class="line">  initOptions = &#123;</span><br><span class="line">    <span class="attr">appId</span>: config.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">appKey</span>: config.<span class="property">key</span>,</span><br><span class="line">    <span class="attr">serverURLs</span>: config.<span class="property">url</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 leanCloud 初始化</span></span><br><span class="line"><span class="variable constant_">LC</span>.<span class="title function_">init</span>(initOptions);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>编辑 <code>src/main.js</code>, 添加导入并执行LeanCloud初始化的语句，如以下代码所示:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> vuetify <span class="keyword">from</span> <span class="string">&#x27;./plugins/vuetify&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./api/init.js&#x27;</span>);  <span class="comment">// 导入并执行LeanCloud初始化</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  vuetify,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><p>完成以上操作之后，项目的结构如下图所示：</p><img src="/2020/12/23/vuetify-data-table-with-leancloud/01project_structure.PNG" class="" title="project structure"><h1 id="开发基于-leancloud-的-CRUD-应用"><a href="#开发基于-leancloud-的-CRUD-应用" class="headerlink" title="开发基于 leancloud 的 CRUD 应用"></a>开发基于 <code>leancloud</code> 的 <code>CRUD</code> 应用</h1><h2 id="在-leancloud-添加-class"><a href="#在-leancloud-添加-class" class="headerlink" title="在 leancloud 添加 class"></a>在 <code>leancloud</code> 添加 <code>class</code></h2><p>登录到 <code>leancloud</code> 官方网站，在应用中添加名为 <code>Tutorial</code> 的 <code>class</code>。</p><img src="/2020/12/23/vuetify-data-table-with-leancloud/Tutorial.PNG" class="" title="create class"><p>在 <code>Tutorial</code> 类中添加以下三列:</p><table><thead><tr><th>属性名</th><th>类型</th><th>含义</th></tr></thead><tbody><tr><td>title</td><td>String</td><td>标题</td></tr><tr><td>description</td><td>String</td><td>描述</td></tr><tr><td>published</td><td>Boolean</td><td>状态</td></tr></tbody></table><blockquote><p>小技巧：上述在 <code>leancloud</code> 中创建<code>Tutorial</code>的步骤可以省略，当第一次执行添加记录操作时，会自动完成相应类以及列的创建。</p></blockquote><h2 id="创建数据服务层"><a href="#创建数据服务层" class="headerlink" title="创建数据服务层"></a>创建数据服务层</h2><p>添加文件 <code>src/api/services/TutorialDataService.js</code>, 编辑其文件内容如以下代码所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/api/services/TutorialDataService.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TutorialDataService</span> &#123;</span><br><span class="line">    <span class="comment">// 获取所有数据，此例使用数据表组件自带的分页功能</span></span><br><span class="line">    <span class="comment">// 如要使用手动分页，请参加vuetify 数据表组件进行修改</span></span><br><span class="line">    <span class="title function_">getAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="string">&#x27;Tutorial&#x27;</span>); </span><br><span class="line">            <span class="comment">// 按 createdAt 降序</span></span><br><span class="line">            query.<span class="title function_">descending</span>(<span class="string">&#x27;createdAt&#x27;</span>)   </span><br><span class="line">                .<span class="title function_">find</span>()</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getAll:&#x27;</span>, resp);</span><br><span class="line">                    <span class="title function_">resolve</span>(resp);</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getAll:&#x27;</span>, error);</span><br><span class="line">                    <span class="title function_">reject</span>(error);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用id 查询一条记录</span></span><br><span class="line">    <span class="title function_">get</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="string">&#x27;Tutorial&#x27;</span>);</span><br><span class="line">            query.<span class="title function_">get</span>(id)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get(id):&#x27;</span>, resp);</span><br><span class="line">                    <span class="title function_">resolve</span>(resp);</span><br><span class="line">                &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get(id):&#x27;</span>, error);</span><br><span class="line">                    <span class="title function_">reject</span>(error);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加新记录，data包含添加的字段及对应的值</span></span><br><span class="line">    <span class="title function_">create</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="title class_">Tutorial</span> = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">extend</span>(<span class="string">&#x27;Tutorial&#x27;</span>);</span><br><span class="line">            <span class="keyword">let</span> tutorial = <span class="keyword">new</span> <span class="title class_">Tutorial</span>(data);</span><br><span class="line">            tutorial.<span class="title function_">save</span>()</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create:&#x27;</span>, resp);</span><br><span class="line">                    <span class="title function_">resolve</span>(resp);</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create:&#x27;</span>, error);</span><br><span class="line">                    <span class="title function_">reject</span>(error)</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改记录, data 包含要修改的值</span></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">id, data</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tutorial = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="string">&#x27;Tutorial&#x27;</span>, id);</span><br><span class="line">            tutorial.<span class="title function_">set</span>(data);</span><br><span class="line">            tutorial.<span class="title function_">save</span>()</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;delete(id):&#x27;</span>, resp);</span><br><span class="line">                    <span class="title function_">resolve</span>(resp)</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;delete(id):&#x27;</span>, error);</span><br><span class="line">                    <span class="title function_">reject</span>(error)</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除一条记录</span></span><br><span class="line">    <span class="title function_">delete</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tutorial = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="string">&#x27;Tutorial&#x27;</span>, id);</span><br><span class="line">            tutorial.<span class="title function_">destroy</span>()</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;delete(id):&#x27;</span>, resp);</span><br><span class="line">                    <span class="title function_">resolve</span>(resp)</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;delete(id):&#x27;</span>, error);</span><br><span class="line">                    <span class="title function_">reject</span>(error)</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 批量删除记录，data 为包含批量操作记录的数组</span></span><br><span class="line">    <span class="title function_">deletaAll</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 获取所有待删除记录的id</span></span><br><span class="line">            <span class="keyword">let</span> ids = data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;<span class="keyword">return</span> item.<span class="property">id</span>&#125;);</span><br><span class="line">            <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="string">&#x27;Tutorial&#x27;</span>); </span><br><span class="line">            query.<span class="title function_">containedIn</span>(<span class="string">&#x27;objectId&#x27;</span>,ids)  <span class="comment">// 使用id 把所有要删除的记录打出来</span></span><br><span class="line">            .<span class="title function_">destroyAll</span>()          <span class="comment">// 执行批量删除操作</span></span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;deletaAll(data):&#x27;</span>, resp);</span><br><span class="line">                    <span class="title function_">resolve</span>(resp);</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;deletaAll(data):&#x27;</span>, error);</span><br><span class="line">                    <span class="title function_">reject</span>(error);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">TutorialDataService</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="编辑路由"><a href="#编辑路由" class="headerlink" title="编辑路由"></a>编辑路由</h2><p>打开 <code>src/router/index.js</code> 文件，编辑内容如以下代码所示:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/router/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,            <span class="comment">// 路由</span></span><br><span class="line">    <span class="attr">alias</span>: <span class="string">&#x27;/tutorials&#x27;</span>,  <span class="comment">// 别名</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;tutorials&#x27;</span>,     </span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/TutorialsList.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/tutorials/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;tutorial-details&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/Tutorial.vue&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/add&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/AddTutorial.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure><h2 id="添加视图文件"><a href="#添加视图文件" class="headerlink" title="添加视图文件"></a>添加视图文件</h2><p>打开<code>src/App.vue</code> 文件，编辑其内容所以下代码所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">v-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-app-bar</span> <span class="attr">app</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex align-center mr-2&quot;</span>&gt;</span>bezKoder<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">to</span>=<span class="string">&quot;/tutorials&quot;</span> <span class="attr">text</span>&gt;</span>Tutorials<span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">to</span>=<span class="string">&quot;/add&quot;</span> <span class="attr">text</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-app-bar</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">v-app</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">  &#125;),</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="添加-Vuetify-视图-组件"><a href="#添加-Vuetify-视图-组件" class="headerlink" title="添加 Vuetify 视图(组件)"></a>添加 <code>Vuetify</code> 视图(组件)</h2><p>分别添加以下文件，以便和路由文件的设置相匹配：</p><ul><li><code>src/views/TutorialsList.vue</code></li><li><code>src/views/Tutorial.vue</code></li><li><code>src/views/AddTutorial.vue</code></li></ul><h3 id="新增记录的视图"><a href="#新增记录的视图" class="headerlink" title="新增记录的视图"></a>新增记录的视图</h3><p>打开 <code>src/views/AddTutorial.vue</code> 文件，编辑其内容如以下代码所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;submit-form mt-3 mx-auto&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;headline&quot;</span>&gt;</span>Add Tutorial<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;!submitted&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-form</span> <span class="attr">ref</span>=<span class="string">&quot;form&quot;</span> <span class="attr">lazy-validation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-text-field</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-model</span>=<span class="string">&quot;tutorial.title&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:rules</span>=<span class="string">&quot;[(v) =&gt; !!v || &#x27;Title is required&#x27;]&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">label</span>=<span class="string">&quot;Title&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">required</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">v-text-field</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-text-field</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-model</span>=<span class="string">&quot;tutorial.description&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:rules</span>=<span class="string">&quot;[(v) =&gt; !!v || &#x27;Description is required&#x27;]&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">label</span>=<span class="string">&quot;Description&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">required</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">v-text-field</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">color</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mt-3&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;saveTutorial&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-card</span> <span class="attr">class</span>=<span class="string">&quot;mx-auto&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-card-title</span>&gt;</span> Submitted successfully! <span class="tag">&lt;/<span class="name">v-card-title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-card-subtitle</span>&gt;</span></span><br><span class="line">          Click the button to add new Tutorial.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-card-subtitle</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-card-actions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">color</span>=<span class="string">&quot;success&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;newTutorial&quot;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-card-actions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-card</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">TutorialDataService</span> <span class="keyword">from</span> <span class="string">&quot;@/api/services/TutorialDataService.js&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;add-tutorial&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">tutorial</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">id</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">title</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">description</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">published</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">submitted</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">  &#125;),</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">saveTutorial</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>: <span class="variable language_">this</span>.<span class="property">tutorial</span>.<span class="property">title</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">description</span>: <span class="variable language_">this</span>.<span class="property">tutorial</span>.<span class="property">description</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">published</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TutorialDataService</span>.<span class="title function_">create</span>(data)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">tutorial</span>.<span class="property">id</span> = response.<span class="property">id</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">submitted</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">newTutorial</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">submitted</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tutorial</span> = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.submit-form</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">max-width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="使用-v-data-table-组件展示所有数据"><a href="#使用-v-data-table-组件展示所有数据" class="headerlink" title="使用 v-data-table 组件展示所有数据"></a>使用 <code>v-data-table</code> 组件展示所有数据</h3><p>打开 <code>src/views/TutorialsList.vue</code> 文件，编辑其内容如以下文件所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">v-row</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list px-3 mx-auto&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-spacer</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-col</span> <span class="attr">cols</span>=<span class="string">&quot;12&quot;</span> <span class="attr">md</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-text-field</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">&quot;search&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">append-icon</span>=<span class="string">&quot;mdi-magnify&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">label</span>=<span class="string">&quot;Search&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">single-line</span></span></span><br><span class="line"><span class="tag">        <span class="attr">hide-details</span></span></span><br><span class="line"><span class="tag">      &gt;</span><span class="tag">&lt;/<span class="name">v-text-field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-col</span> <span class="attr">cols</span>=<span class="string">&quot;12&quot;</span> <span class="attr">sm</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-card</span> <span class="attr">class</span>=<span class="string">&quot;mx-auto&quot;</span> <span class="attr">tile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-card-title</span>&gt;</span>Tutorials<span class="tag">&lt;/<span class="name">v-card-title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-data-table</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:headers</span>=<span class="string">&quot;headers&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:items</span>=<span class="string">&quot;tutorials&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:search</span>=<span class="string">&quot;search&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-model</span>=<span class="string">&quot;selected&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">show-select</span></span></span><br><span class="line"><span class="tag">          <span class="attr">disable-pagination</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:hide-default-footer</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:</span>[`<span class="attr">item.actions</span>`]=<span class="string">&quot;&#123; item &#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">v-icon</span> <span class="attr">small</span> <span class="attr">class</span>=<span class="string">&quot;mr-2&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;editTutorial(item.id)&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span>mdi-pencil&lt;/v-icon</span><br><span class="line">            &gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">v-icon</span> <span class="attr">small</span> @<span class="attr">click</span>=<span class="string">&quot;deleteTutorial(item.id)&quot;</span>&gt;</span>mdi-delete<span class="tag">&lt;/<span class="name">v-icon</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-data-table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-card-actions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">:disabled</span>=<span class="string">&quot;selected.length&lt;=0&quot;</span> <span class="attr">small</span> <span class="attr">color</span>=<span class="string">&quot;error&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;removeAllTutorials&quot;</span>&gt;</span></span><br><span class="line">            Remove Selected</span><br><span class="line">          <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-card-actions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-card</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">v-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">TutorialDataService</span> <span class="keyword">from</span> <span class="string">&quot;@/api/services/TutorialDataService.js&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;tutorials-list&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tutorials</span>: [], <span class="comment">// 数据表的显示的所有数据</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">selected</span>: [], <span class="comment">//多选框选中的项</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">search</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// 用于搜索功能，分别绑定到搜索框和数据表组件     </span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 数据表的表头</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">headers</span>: [</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">text</span>: <span class="string">&quot;Title&quot;</span>, <span class="attr">align</span>: <span class="string">&quot;start&quot;</span>, <span class="attr">sortable</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="string">&quot;title&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">text</span>: <span class="string">&quot;Description&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;description&quot;</span>, <span class="attr">sortable</span>: <span class="literal">false</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">text</span>: <span class="string">&quot;Status&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;status&quot;</span>, <span class="attr">sortable</span>: <span class="literal">false</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">text</span>: <span class="string">&quot;Actions&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;actions&quot;</span>, <span class="attr">sortable</span>: <span class="literal">false</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">      ],</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取所有数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">retrieveTutorials</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tutorials</span> = []; <span class="comment">// 每次要先清空数据</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TutorialDataService</span>.<span class="title function_">getAll</span>()</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 遍历获取的数据，并提取需要的字段</span></span></span><br><span class="line"><span class="language-javascript">          response.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">tutorials</span>.<span class="title function_">push</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">id</span>: item.<span class="property">id</span>, <span class="comment">// leancloud中的id值直接获取</span></span></span><br><span class="line"><span class="language-javascript">              <span class="attr">title</span>: item.<span class="title function_">get</span>(<span class="string">&quot;title&quot;</span>), <span class="comment">// 自定义字段要使用 get() 获取值</span></span></span><br><span class="line"><span class="language-javascript">              <span class="attr">description</span>: item.<span class="title function_">get</span>(<span class="string">&quot;description&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 此处将 published 以  status 进行显示</span></span></span><br><span class="line"><span class="language-javascript">              <span class="attr">status</span>: item.<span class="title function_">get</span>(<span class="string">&quot;published&quot;</span>) ? <span class="string">&quot;Published&quot;</span> : <span class="string">&quot;Pending&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">          &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 刷新数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">refreshList</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">retrieveTutorials</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 批量删除选中的记录</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">removeAllTutorials</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 判断是否有已选中的记录</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selected</span>.<span class="property">length</span>&gt;<span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;selected: &quot;</span>, <span class="variable language_">this</span>.<span class="property">selected</span>);        </span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">TutorialDataService</span>.<span class="title function_">deletaAll</span>(<span class="variable language_">this</span>.<span class="property">selected</span>)</span></span><br><span class="line"><span class="language-javascript">          .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">refreshList</span>();  <span class="comment">// 更新数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">selected</span> =[];   <span class="comment">// 清空已选中数据</span></span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">          .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">          &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 搜索标题， 此功能未使用，可以注释或是删除，搜索功能直接由数据表组件提供</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">searchTitle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// this.tutorials=this.tutorials.filter(item=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   return !item.title.indexOf(this.title);</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// &#125;);</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 编辑记录</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">editTutorial</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 使用命名路由跳转到 Tutorial.vue ，传递参数为记录的id</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;tutorial-details&quot;</span>, <span class="attr">params</span>: &#123; <span class="attr">id</span>: id &#125; &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 删除一条记录</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">deleteTutorial</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TutorialDataService</span>.<span class="title function_">delete</span>(id)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">refreshList</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 格式化显示数据，对标题和描述只显示前 30个字符的内容</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getDisplayTutorial</span>(<span class="params">tutorial</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">id</span>: tutorial.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>:</span></span><br><span class="line"><span class="language-javascript">          tutorial.<span class="property">title</span>.<span class="property">length</span> &gt; <span class="number">30</span></span></span><br><span class="line"><span class="language-javascript">            ? tutorial.<span class="property">title</span>.<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">30</span>) + <span class="string">&quot;...&quot;</span></span></span><br><span class="line"><span class="language-javascript">            : tutorial.<span class="property">title</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">description</span>:</span></span><br><span class="line"><span class="language-javascript">          tutorial.<span class="property">description</span>.<span class="property">length</span> &gt; <span class="number">30</span></span></span><br><span class="line"><span class="language-javascript">            ? tutorial.<span class="property">description</span>.<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">30</span>) + <span class="string">&quot;...&quot;</span></span></span><br><span class="line"><span class="language-javascript">            : tutorial.<span class="property">description</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">status</span>: tutorial.<span class="property">published</span> ? <span class="string">&quot;Published&quot;</span> : <span class="string">&quot;Pending&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">retrieveTutorials</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.list</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">max-width</span>: <span class="number">750px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="显示详细信息以及修改数据"><a href="#显示详细信息以及修改数据" class="headerlink" title="显示详细信息以及修改数据"></a>显示详细信息以及修改数据</h3><p>打开 <code>src/views/Tutorial.vue</code> 文件，编辑其内容如以下代码所示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;currentTutorial&quot;</span> <span class="attr">class</span>=<span class="string">&quot;edit-form py-3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;headline&quot;</span>&gt;</span>Edit Tutorial<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-form</span> <span class="attr">ref</span>=<span class="string">&quot;form&quot;</span> <span class="attr">lazy-validation</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-text-field</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">&quot;currentTutorial.title&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:rules</span>=<span class="string">&quot;[(v) =&gt; !!v || &#x27;Title is required&#x27;]&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">label</span>=<span class="string">&quot;Title&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">required</span></span></span><br><span class="line"><span class="tag">      &gt;</span><span class="tag">&lt;/<span class="name">v-text-field</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-text-field</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">&quot;currentTutorial.description&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:rules</span>=<span class="string">&quot;[(v) =&gt; !!v || &#x27;Description is required&#x27;]&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">label</span>=<span class="string">&quot;Description&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">required</span></span></span><br><span class="line"><span class="tag">      &gt;</span><span class="tag">&lt;/<span class="name">v-text-field</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>Status:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      &#123;&#123; currentTutorial.published ? &quot;Published&quot; : &quot;Pending&quot; &#125;&#125;</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-divider</span> <span class="attr">class</span>=<span class="string">&quot;my-5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">v-divider</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-btn</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-if</span>=<span class="string">&quot;currentTutorial.published&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;updatePublished(false)&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">color</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">small</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;mr-2&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        UnPublish</span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-btn</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-else</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;updatePublished(true)&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">color</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">small</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;mr-2&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        Publish</span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">color</span>=<span class="string">&quot;error&quot;</span> <span class="attr">small</span> <span class="attr">class</span>=<span class="string">&quot;mr-2&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteTutorial&quot;</span>&gt;</span></span><br><span class="line">        Delete</span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">color</span>=<span class="string">&quot;success&quot;</span> <span class="attr">small</span> @<span class="attr">click</span>=<span class="string">&quot;updateTutorial&quot;</span>&gt;</span> Update <span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;mt-3&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Please click on a Tutorial...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">TutorialDataService</span> <span class="keyword">from</span> <span class="string">&quot;@/api/services/TutorialDataService.js&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;tutorial&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">currentTutorial</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">message</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getTutorial</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TutorialDataService</span>.<span class="title function_">get</span>(id)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">currentTutorial</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: item.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: item.<span class="title function_">get</span>(<span class="string">&quot;title&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">description</span>: item.<span class="title function_">get</span>(<span class="string">&quot;description&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">published</span>: item.<span class="title function_">get</span>(<span class="string">&quot;published&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">          &#125;;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">currentTutorial</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">updatePublished</span>(<span class="params">status</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">currentTutorial</span>.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>: <span class="variable language_">this</span>.<span class="property">currentTutorial</span>.<span class="property">title</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">description</span>: <span class="variable language_">this</span>.<span class="property">currentTutorial</span>.<span class="property">description</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">published</span>: status,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TutorialDataService</span>.<span class="title function_">update</span>(<span class="variable language_">this</span>.<span class="property">currentTutorial</span>.<span class="property">id</span>, data)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">currentTutorial</span>.<span class="property">published</span> = status;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">updateTutorial</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TutorialDataService</span>.<span class="title function_">update</span>(<span class="variable language_">this</span>.<span class="property">currentTutorial</span>.<span class="property">id</span>, <span class="variable language_">this</span>.<span class="property">currentTutorial</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&quot;The tutorial was updated successfully!&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">deleteTutorial</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">TutorialDataService</span>.<span class="title function_">delete</span>(<span class="variable language_">this</span>.<span class="property">currentTutorial</span>.<span class="property">id</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;tutorials&quot;</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">getTutorial</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.edit-form</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">max-width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: auto;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h1><p>在项目文件夹打开<code>CMD控制台</code> 或 <code>PowerShell窗口</code>，输入以下命令运行程序：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure><p>如果运行成功，将看到类似以下的信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DONE  Compiled successfully <span class="keyword">in</span> 266ms</span><br><span class="line"></span><br><span class="line"> App running at:</span><br><span class="line"> - Local:   http://localhost:8080/</span><br><span class="line"> - Network: http://192.168.1.80:8080/</span><br></pre></td></tr></table></figure><p>打开浏览器，并输入以上网址回车就可以看到运行的结果了。</p><img src="/2020/12/23/vuetify-data-table-with-leancloud/addTutorial.PNG" class="" title="addTutorial"><img src="/2020/12/23/vuetify-data-table-with-leancloud/tutorialList.PNG" class="" title="tutorialList"><img src="/2020/12/23/vuetify-data-table-with-leancloud/tutorialedit.PNG" class="" title="tutorialedit"><h1 id="项目源代码"><a href="#项目源代码" class="headerlink" title="项目源代码"></a>项目源代码</h1><p>查看源代码，请浏览以下网址：<br><a href="https://gitee.com/hujiyi/vuetify-data-table-example">https://gitee.com/hujiyi/vuetify-data-table-example</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vuetify </tag>
            
            <tag> leancloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue.js with vuetify and leancloud</title>
      <link href="/2020/12/12/vue-js-with-vuetify-and-leancloud/"/>
      <url>/2020/12/12/vue-js-with-vuetify-and-leancloud/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="安装-Vue-CLI"><a href="#安装-Vue-CLI" class="headerlink" title="安装 Vue CLI"></a>安装 Vue CLI</h1><h2 id="检查正确已经安装-Vue-CLI"><a href="#检查正确已经安装-Vue-CLI" class="headerlink" title="检查正确已经安装 Vue CLI"></a>检查正确已经安装 Vue CLI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\sources\vue_repos&gt;vue --version</span><br><span class="line"><span class="string">&#x27;vue&#x27;</span> 不是内部或外部命令，也不是可运行的程序</span><br><span class="line">或批处理文件。</span><br></pre></td></tr></table></figure><blockquote><p>出现以上提示时，表示还没有安装 Vue CLI， 则需要先安装 Vue CLI</p></blockquote><h2 id="安装-Vue-CLI-1"><a href="#安装-Vue-CLI-1" class="headerlink" title="安装 Vue CLI"></a>安装 Vue CLI</h2><p>执行命令：<code>npm install -g @vue/cli</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">D:\sources\vue_repos&gt;npm install -g @vue/cli</span><br><span class="line">npm WARN deprecated @hapi/joi@15.1.1: joi is leaving the @hapi organization and moving back to <span class="string">&#x27;joi&#x27;</span> (https://github.com/sideway/joi/issues/2411)</span><br><span class="line">npm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142</span><br><span class="line">npm WARN deprecated @hapi/address@2.1.4: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/bourne@1.3.2: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/topo@3.1.6: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/hoek@8.5.1: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated har-validator@5.1.5: this library is no longer supported</span><br><span class="line">npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated</span><br><span class="line">npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated</span><br><span class="line">npm WARN deprecated chokidar@2.1.8: Chokidar 2 will <span class="built_in">break</span> on node v14+. Upgrade to chokidar 3 with 15x less dependencies.</span><br><span class="line">npm WARN deprecated fsevents@1.2.13: fsevents 1 will <span class="built_in">break</span> on node v14+ and could be using insecure binaries. Upgrade to fsevents 2.</span><br><span class="line"></span><br><span class="line">&gt; yarn@1.22.10 preinstall C:\Users\Laohoo\AppData\Roaming\npm\node_modules\@vue\cli\node_modules\yarn</span><br><span class="line">&gt; :; (node ./preinstall.js &gt; /dev/null 2&gt;&amp;1 || <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">C:\Users\Laohoo\AppData\Roaming\npm\vue -&gt; C:\Users\Laohoo\AppData\Roaming\npm\node_modules\@vue\cli\bin\vue.js</span><br><span class="line"></span><br><span class="line">&gt; core-js@3.8.1 postinstall C:\Users\Laohoo\AppData\Roaming\npm\node_modules\@vue\cli\node_modules\core-js</span><br><span class="line">&gt; node -e <span class="string">&quot;try&#123;require(&#x27;./postinstall&#x27;)&#125;catch(e)&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> using core-js ( https://github.com/zloirock/core-js ) <span class="keyword">for</span> polyfilling JavaScript standard library!</span><br><span class="line"></span><br><span class="line">The project needs your <span class="built_in">help</span>! Please consider supporting of core-js on Open Collective or Patreon:</span><br><span class="line">&gt; https://opencollective.com/core-js</span><br><span class="line">&gt; https://www.patreon.com/zloirock</span><br><span class="line"></span><br><span class="line">Also, the author of core-js ( https://github.com/zloirock ) is looking <span class="keyword">for</span> a good job -)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; @apollo/protobufjs@1.0.5 postinstall C:\Users\Laohoo\AppData\Roaming\npm\node_modules\@vue\cli\node_modules\@apollo\protobufjs</span><br><span class="line">&gt; node scripts/postinstall</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; nodemon@1.19.4 postinstall C:\Users\Laohoo\AppData\Roaming\npm\node_modules\@vue\cli\node_modules\nodemon</span><br><span class="line">&gt; node bin/postinstall || <span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">Love nodemon? You can now support the project via the open collective:</span><br><span class="line"> &gt; https://opencollective.com/nodemon/donate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; ejs@2.7.4 postinstall C:\Users\Laohoo\AppData\Roaming\npm\node_modules\@vue\cli\node_modules\ejs</span><br><span class="line">&gt; node ./postinstall.js</span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> installing EJS: built with the Jake JavaScript build tool (https://jakejs.com/)</span><br><span class="line"></span><br><span class="line">npm WARN @vue/compiler-sfc@3.0.4 requires a peer of vue@3.0.4 but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.13 (node_modules\@vue\cli\node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@1.2.13: wanted &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;darwin&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;any&quot;</span>&#125; (current: &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;win32&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;x64&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">+ @vue/cli@4.5.9</span><br><span class="line">added 1347 packages from 699 contributors <span class="keyword">in</span> 72.435s</span><br></pre></td></tr></table></figure><h1 id="使用-Vue-CLI-创建项目"><a href="#使用-Vue-CLI-创建项目" class="headerlink" title="使用 Vue CLI 创建项目"></a>使用 Vue CLI 创建项目</h1><ol><li>执行命令：<code>vue create book-store-app</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\sources\vue_repos&gt;vue create book-store-app</span><br><span class="line">?  Your connection to the default yarn registry seems to be slow.</span><br><span class="line">   Use https://registry.npm.taobao.org <span class="keyword">for</span> faster installation? Yes</span><br><span class="line">   ( 是否选择使用 tabbao 源来加快安装速度，回答: y)</span><br></pre></td></tr></table></figure><blockquote><p>此处使用了 <code>yarn</code> 包管理工具，如果没有安装  <code>yarn</code> 将没有类似提示及选择</p></blockquote><ol start="2"><li>选择预设选项</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.9</span><br><span class="line">? Please pick a preset:</span><br><span class="line">  Default ([Vue 2] babel, eslint)                    ( Vue2 默认选项)</span><br><span class="line">  Default (Vue 3 Preview) ([Vue 3] babel, eslint)    ( Vue3 默认选项)</span><br><span class="line">&gt; Manually <span class="keyword">select</span> features             (手动选择功能，选择这一项，回车)</span><br></pre></td></tr></table></figure><ol start="3"><li>手动选择功能（星号表示选中该项； 空格用于 <code>选择/取消</code> ）</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.9</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project:</span><br><span class="line"> (*) Choose Vue version       (选择版本)</span><br><span class="line"> (*) Babel                    (编码转换)</span><br><span class="line"> ( ) TypeScript               (TypeScript 开发支持)</span><br><span class="line"> ( ) Progressive Web App (PWA) Support  (渐进式网页支持，国内网络目前对这一项支持不好)</span><br><span class="line"> (*) Router                   (路由功能)</span><br><span class="line"> (*) Vuex                     (状态管理)</span><br><span class="line"> ( ) CSS Pre-processors       (CSS预处理)</span><br><span class="line">&gt;( ) Linter / Formatter       (代码规范)</span><br><span class="line"> ( ) Unit Testing             (单元测试)</span><br><span class="line"> ( ) E2E Testing              (ESE测试)</span><br></pre></td></tr></table></figure><ol start="4"><li>选择 Vue 2.x 版本</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.9</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with (Use arrow keys)</span><br><span class="line">&gt; 2.x</span><br><span class="line">  3.x (Preview)</span><br></pre></td></tr></table></figure><ol start="5"><li>路由是否使用 history 模式，选择 n</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.9</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br></pre></td></tr></table></figure><ol start="6"><li>Babel, ESLint等配置使用专用配置文件或使用 package.json</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.9</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? (Use arrow keys)</span><br><span class="line">&gt; In dedicated config files</span><br><span class="line">  In package.json</span><br></pre></td></tr></table></figure><ol start="7"><li>是否保存选项到预设中</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.9</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? In dedicated config files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? (y/N)</span><br></pre></td></tr></table></figure><ol start="8"><li>所有选项以及安装过程</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.5.9</span><br><span class="line">? Please pick a preset: Manually <span class="keyword">select</span> features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Choose Vue version, Babel, Router, Vuex</span><br><span class="line">? Choose a version of Vue.js that you want to start the project with 2.x</span><br><span class="line">? Use <span class="built_in">history</span> mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) No</span><br><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? In dedicated config files</span><br><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? No</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue CLI v4.5.9</span><br><span class="line">✨  Creating project <span class="keyword">in</span> D:\sources\vue_repos\book-store-app.</span><br><span class="line">⚙️  Installing CLI plugins. This might take a <span class="keyword">while</span>...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">info No lockfile found.</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.3: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.3&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 16.82s.</span><br><span class="line">🚀  Invoking generators...</span><br><span class="line">📦  Installing additional dependencies...</span><br><span class="line"></span><br><span class="line">yarn install v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.3: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.3&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 5.36s.</span><br><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">📄  Generating README.md...</span><br><span class="line"></span><br><span class="line">🎉  Successfully created project book-store-app.</span><br><span class="line">👉  Get started with the following commands:</span><br><span class="line"></span><br><span class="line"> $ <span class="built_in">cd</span> book-store-app</span><br><span class="line"> $ yarn serve</span><br></pre></td></tr></table></figure><h1 id="安装-vuetify-和-leancloud-SDK"><a href="#安装-vuetify-和-leancloud-SDK" class="headerlink" title="安装 vuetify 和 leancloud SDK"></a>安装 vuetify 和 leancloud SDK</h1><h2 id="进入项目文件夹"><a href="#进入项目文件夹" class="headerlink" title="进入项目文件夹"></a>进入项目文件夹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> book-store-app</span><br></pre></td></tr></table></figure><h2 id="安装-vuetify"><a href="#安装-vuetify" class="headerlink" title="安装 vuetify"></a>安装 vuetify</h2><p>输入命令：<code>vue add vuetify</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">D:\sources\vue_repos\book-store-app&gt;vue add vuetify</span><br><span class="line"></span><br><span class="line">📦  Installing vue-cli-plugin-vuetify...</span><br><span class="line"></span><br><span class="line">yarn add v1.22.5</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.3: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.3&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.13: The platform <span class="string">&quot;win32&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.13&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 5 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ vue-cli-plugin-vuetify@2.0.8</span><br><span class="line">info All dependencies</span><br><span class="line">├─ interpret@1.4.0</span><br><span class="line">├─ null-loader@3.0.0</span><br><span class="line">├─ rechoir@0.6.2</span><br><span class="line">├─ shelljs@0.8.4</span><br><span class="line">└─ vue-cli-plugin-vuetify@2.0.8</span><br><span class="line">Done <span class="keyword">in</span> 6.29s.</span><br><span class="line">✔  Successfully installed plugin: vue-cli-plugin-vuetify</span><br><span class="line"></span><br><span class="line">? Choose a preset: (Use arrow keys)   (选择预设，使用方向键)</span><br><span class="line">&gt; Default (recommended)               (默认值，推荐 -- 选择这一项)</span><br><span class="line">  Prototype (rapid development)       (原型， 快速开发)</span><br><span class="line">  Configure (advanced)                (配置，高级)</span><br></pre></td></tr></table></figure><h2 id="安装-leancloud-SDK"><a href="#安装-leancloud-SDK" class="headerlink" title="安装 leancloud SDK"></a>安装 leancloud SDK</h2><p>输入命令：<code> npm install leancloud-storage --save --registry https://registry.npm.taobao.org</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">D:\sources\vue_repos\book-store-app&gt; npm install leancloud-storage --save  --registry https://registry.npm.taobao.org</span><br><span class="line">npm WARN deprecated core-js@2.6.12: core-js@&lt;3 is no longer maintained and not recommended <span class="keyword">for</span> usage due to the number of issues. Please, upgrade your dependencies to the actual version of core-js@3.</span><br><span class="line">npm WARN deprecated @hapi/address@2.1.4: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/bourne@1.3.2: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/topo@3.1.6: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/hoek@8.5.1: This version has been deprecated and is no longer supported or maintained</span><br><span class="line">npm WARN deprecated @hapi/joi@15.1.1: joi is leaving the @hapi organization and moving back to <span class="string">&#x27;joi&#x27;</span> (https://github.com/sideway/joi/issues/2411)</span><br><span class="line">npm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142</span><br><span class="line">npm WARN deprecated har-validator@5.1.5: this library is no longer supported</span><br><span class="line">npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated</span><br><span class="line">npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated</span><br><span class="line">npm WARN deprecated chokidar@2.1.8: Chokidar 2 will <span class="built_in">break</span> on node v14+. Upgrade to chokidar 3 with 15x less dependencies.</span><br><span class="line">npm WARN deprecated fsevents@1.2.13: fsevents 1 will <span class="built_in">break</span> on node v14+ and could be using insecure binaries. Upgrade to fsevents 2.</span><br><span class="line">npm WARN <span class="built_in">rm</span> not removing D:\sources\vue_repos\book-store-app\node_modules\.bin\semver.cmd as it wasn<span class="string">&#x27;t installed by D:\sources\vue_repos\book-store-app\node_modules\semver</span></span><br><span class="line"><span class="string">npm WARN rm not removing D:\sources\vue_repos\book-store-app\node_modules\.bin\semver as it wasn&#x27;</span>t installed by D:\sources\vue_repos\book-store-app\node_modules\semver</span><br><span class="line">npm WARN <span class="built_in">rm</span> not removing D:\sources\vue_repos\book-store-app\node_modules\.bin\json5.cmd as it wasn<span class="string">&#x27;t installed by D:\sources\vue_repos\book-store-app\node_modules\json5</span></span><br><span class="line"><span class="string">npm WARN rm not removing D:\sources\vue_repos\book-store-app\node_modules\.bin\json5 as it wasn&#x27;</span>t installed by D:\sources\vue_repos\book-store-app\node_modules\json5</span><br><span class="line"></span><br><span class="line">&gt; core-js@2.6.12 postinstall D:\sources\vue_repos\book-store-app\node_modules\@babel\runtime-corejs2\node_modules\core-js</span><br><span class="line">&gt; node -e <span class="string">&quot;try&#123;require(&#x27;./postinstall&#x27;)&#125;catch(e)&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> using core-js ( https://github.com/zloirock/core-js ) <span class="keyword">for</span> polyfilling JavaScript standard library!</span><br><span class="line"></span><br><span class="line">The project needs your <span class="built_in">help</span>! Please consider supporting of core-js on Open Collective or Patreon:</span><br><span class="line">&gt; https://opencollective.com/core-js</span><br><span class="line">&gt; https://www.patreon.com/zloirock</span><br><span class="line"></span><br><span class="line">Also, the author of core-js ( https://github.com/zloirock ) is looking <span class="keyword">for</span> a good job -)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; core-js@3.8.1 postinstall D:\sources\vue_repos\book-store-app\node_modules\@vue\babel-preset-app\node_modules\core-js</span><br><span class="line">&gt; node -e <span class="string">&quot;try&#123;require(&#x27;./postinstall&#x27;)&#125;catch(e)&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; core-js@2.6.12 postinstall D:\sources\vue_repos\book-store-app\node_modules\babel-runtime\node_modules\core-js</span><br><span class="line">&gt; node -e <span class="string">&quot;try&#123;require(&#x27;./postinstall&#x27;)&#125;catch(e)&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; ejs@2.7.4 postinstall D:\sources\vue_repos\book-store-app\node_modules\ejs</span><br><span class="line">&gt; node ./postinstall.js</span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> installing EJS: built with the Jake JavaScript build tool (https://jakejs.com/)</span><br><span class="line"></span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: vue-loader-v16@npm:vue-loader@^16.0.0-beta.7 (node_modules\@vue\cli-service\node_modules\vue-loader-v16):</span><br><span class="line">npm WARN notarget SKIPPING OPTIONAL DEPENDENCY: No matching version found <span class="keyword">for</span> vue-loader-v16@16.1.1.</span><br><span class="line">npm WARN @vue/babel-preset-app@4.5.9 requires a peer of core-js@^3 but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.13 (node_modules\chokidar\node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@1.2.13: wanted &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;darwin&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;any&quot;</span>&#125; (current: &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;win32&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;x64&quot;</span>&#125;)</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@2.1.3 (node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@2.1.3: wanted &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;darwin&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;any&quot;</span>&#125; (current: &#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;win32&quot;</span>,<span class="string">&quot;arch&quot;</span>:<span class="string">&quot;x64&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">+ leancloud-storage@4.8.2</span><br><span class="line">added 162 packages from 87 contributors, removed 70 packages and updated 1097 packages <span class="keyword">in</span> 72.668s</span><br><span class="line"></span><br><span class="line">64 packages are looking <span class="keyword">for</span> funding</span><br><span class="line">  run `npm fund` <span class="keyword">for</span> details</span><br></pre></td></tr></table></figure><h2 id="配置-leancloud-SDK"><a href="#配置-leancloud-SDK" class="headerlink" title="配置 leancloud SDK"></a>配置 leancloud SDK</h2><p>创建文件夹: <code>src\api\config\</code></p><p>创建并编辑文件： <code>src\api\config\lc.config.js</code> ， 内容如以下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//&#x27;这里填写 leancloud 的 appId&#x27;,</span></span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;9MCRS87WVkReLtNbQWbnllm9-********&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x27;这里填写 leancloud 的 appKey&#x27;,</span></span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;zAfYTXaiXYGeQUm8********&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x27;这里填写 leancloud 的 REST API 服务器地址，国际版应用等未绑定自定义域名的此项留空&#x27;</span></span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://********.lc-cn-n1-shared.com&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>以上部分内容已经用 星号 隐藏，请用自己的 leancloud 应用 key 代替以上三个内容</p></blockquote><h2 id="leancloud-SDK-初始化"><a href="#leancloud-SDK-初始化" class="headerlink" title="leancloud SDK 初始化"></a>leancloud SDK 初始化</h2><p>创建并编辑文件：<code>src\api\init.js</code>， 文件内容如以下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;./config/lc.config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initOptions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (config.<span class="property">url</span>.<span class="title function_">trim</span>() === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">  <span class="comment">// url 为空的时候，访问国际版：leancloud.app</span></span><br><span class="line">  initOptions = &#123;</span><br><span class="line">    <span class="attr">appId</span>: config.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">appKey</span>: config.<span class="property">key</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// url 不为空的时候，访问国内版:leancloud.cn</span></span><br><span class="line">  initOptions = &#123;</span><br><span class="line">    <span class="attr">appId</span>: config.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">appKey</span>: config.<span class="property">key</span>,</span><br><span class="line">    <span class="attr">serverURLs</span>: config.<span class="property">url</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 leanCloud 初始化</span></span><br><span class="line"><span class="variable constant_">LC</span>.<span class="title function_">init</span>(initOptions);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="在-main-js-中导入并执行-leancloud-初始化"><a href="#在-main-js-中导入并执行-leancloud-初始化" class="headerlink" title="在 main.js 中导入并执行 leancloud 初始化"></a>在 main.js 中导入并执行 leancloud 初始化</h2><p>编辑 <code>src\main.js</code>, 添加 leancloud 初始化</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> vuetify <span class="keyword">from</span> <span class="string">&#x27;./plugins/vuetify&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./api/init.js&#x27;</span>);  <span class="comment">// 导入并执行 leanCloud 初始化</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"> router,</span><br><span class="line"> store,</span><br><span class="line"> vuetify,</span><br><span class="line"> <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;&#x3D; END &#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> vue.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vuetify </tag>
            
            <tag> leancloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 .NET Core 的 HttpClient 爬虫中处理 GB2312/GBK 字符</title>
      <link href="/2020/03/14/HttpClient-with-GB2312-GBK/"/>
      <url>/2020/03/14/HttpClient-with-GB2312-GBK/</url>
      
        <content type="html"><![CDATA[<p>最近开始尝试使用 <code>.NET Core</code> 的 <code>HttpClient</code> 来学习写爬虫程序，第一步就遇到了某个使用 <code>GB2312</code> 编码的网页， 爬到的结果里面中文都是乱码， 于是想当然地在 <code>Headers</code> 里面添加了 <code>&quot;Content-Type: text/html; charset=utf-8&quot;</code>, 却被无情地抛出一个不支持这个头部的异常，于是走了很多的弯路，才发觉，这个问题原来是 <code>HttpClient</code>的默认字符集支持问题 。</p><h2 id="创建-HttpClient-服务接口"><a href="#创建-HttpClient-服务接口" class="headerlink" title="创建 HttpClient 服务接口"></a>创建 HttpClient 服务接口</h2><p>在 .Application 项目中添加名为 <code>ISampleClient</code> 的接口，其代码如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">﻿<span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Marcin.Application</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISampleClient</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Task&lt;<span class="built_in">string</span>&gt; <span class="title">GetDataAsync</span>(<span class="params"><span class="built_in">string</span> uri, <span class="built_in">string</span> charset = <span class="string">&quot;UTF-8&quot;</span></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="实现-HttpClient-服务接口"><a href="#实现-HttpClient-服务接口" class="headerlink" title="实现 HttpClient 服务接口"></a>实现 HttpClient 服务接口</h2><p><code>HttpClient</code> 默认不支持 <code>GB2312</code> 和 <code>GBK</code>, 所以如果使用它来下载， 网页编码为 <code>GB2312</code> 和 <code>GBK</code> 的话，其内的中文将显示为乱码。 </p><p>解决办法：<br>添加 <code>NuGet</code> 包：System.Text.Encoding.CodePages， 在代码中还需要添加注册 <code>EncodingProvider</code>的方法 <code>Encoding.RegisterProvider(CodePagesEncodingProvider.Instance);</code></p><p>添加接口的实现类 <code>SampleClient</code>，其代码如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Logging;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> HtmlAgilityPack;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Marcin.Application</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SampleClient</span> : <span class="title">ISampleClient</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> HttpClient _httpClient;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger _logger;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SampleClient</span>(<span class="params">ILogger&lt;SampleClient&gt; logger,</span></span></span><br><span class="line"><span class="params"><span class="function">            HttpClient httpClient</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 先添加这一个，才能使用 UTF 以外的其他编码 </span></span><br><span class="line">            Encoding.RegisterProvider(CodePagesEncodingProvider.Instance);</span><br><span class="line"></span><br><span class="line">            httpClient.DefaultRequestHeaders.Add(<span class="string">&quot;Accept&quot;</span>,</span><br><span class="line">                <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            httpClient.DefaultRequestHeaders.Add(<span class="string">&quot;User-Agent&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0&quot;</span>);</span><br><span class="line"></span><br><span class="line">            _httpClient = httpClient;</span><br><span class="line">            _logger = logger;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// charset 默认为 UTF-8, 根据需要可以修改为 GBK,GB2312等 </span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">string</span>&gt; <span class="title">GetDataAsync</span>(<span class="params"><span class="built_in">string</span> uri, <span class="built_in">string</span> charset = <span class="string">&quot;UTF-8&quot;</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _logger.LogInformation(<span class="string">&quot;SampleClient &#123;0&#125; at &#123;1&#125;&quot;</span>, <span class="string">&quot;Started&quot;</span>, DateTime.UtcNow);</span><br><span class="line"></span><br><span class="line">            Stopwatch sw = <span class="keyword">new</span> Stopwatch();</span><br><span class="line">            sw.Start();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> response = <span class="keyword">await</span> _httpClient.GetAsync(uri).ConfigureAwait(<span class="literal">false</span>);                </span><br><span class="line">                <span class="comment">// 读取字符流</span></span><br><span class="line">                <span class="keyword">var</span> result = <span class="keyword">await</span> response.Content.ReadAsStreamAsync();</span><br><span class="line">                <span class="comment">// 使用指定的字符编码读取字符流， 默认编码：UTF-8，其他如：GBK</span></span><br><span class="line">                <span class="keyword">var</span> stream = <span class="keyword">new</span> StreamReader(result, Encoding.GetEncoding(charset));</span><br><span class="line">                <span class="comment">// 字符流转为字符串并返回</span></span><br><span class="line">                <span class="keyword">return</span> stream.ReadToEnd();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (HttpRequestException hre)</span><br><span class="line">            &#123;</span><br><span class="line">                hre.ToString();</span><br><span class="line">                <span class="keyword">throw</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                sw.Stop();</span><br><span class="line">                _logger.LogInformation(<span class="string">&quot;response.Content.ReadAsStreamAsync time cost: &#123;0&#125; &quot;</span>, sw.ElapsedMilliseconds.ToString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> .NET Core </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HttpClient </tag>
            
            <tag> GB2312 </tag>
            
            <tag> GBK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 .NET Core 3.1 Console 应用程序中使用依赖注入</title>
      <link href="/2020/03/14/dependency-injection-net-core-console-app-using-generic-hostbuilder/"/>
      <url>/2020/03/14/dependency-injection-net-core-console-app-using-generic-hostbuilder/</url>
      
        <content type="html"><![CDATA[<h1 id="创建-NET-Core-Console-App"><a href="#创建-NET-Core-Console-App" class="headerlink" title="创建 .NET Core Console App"></a>创建 .NET Core Console App</h1><p>在 <code>Visual Studio 2019</code> 中创建一个 <code>Console App</code></p><img src="/2020/03/14/dependency-injection-net-core-console-app-using-generic-hostbuilder/Console-app-depedency-injection-1024x213.jpg" class="" title="Console App"><p>在解决方案中添加其他层， 创建类似于下图的解决方案项目结构：</p><img src="/2020/03/14/dependency-injection-net-core-console-app-using-generic-hostbuilder/dependency-injection-console-app-form-app-dotnet-core-658x520.jpg" class="" title="solution"><h1 id="添加-NuGet-包"><a href="#添加-NuGet-包" class="headerlink" title="添加 NuGet 包"></a>添加 NuGet 包</h1><p>在 控制台项目中添加以下三个NuGet包：</p><ol><li>Microsoft.Extensions.DependencyInjection;</li><li>Microsoft.Extensions.Hosting;</li><li>Microsoft.Extensions.Logging;</li></ol><h1 id="添加-DI-容器"><a href="#添加-DI-容器" class="headerlink" title="添加 DI 容器"></a>添加 DI 容器</h1><p>打包 控制台项目中的 <code>program.cs</code> 文件，将其代码中的 <code>main()</code> 修改为以下内容:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">async</span> System.Threading.Tasks.<span class="function">Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> HostBuilder()</span><br><span class="line">            .ConfigureServices((hostContext, services)=&gt; &#123;</span><br><span class="line">                services.AddLogging(configure =&gt; configure.AddConsole());</span><br><span class="line">                services.AddTransient&lt;MyApplication&gt;();</span><br><span class="line">                services.AddSingleton&lt;ISampleClient, SampleClient&gt;();</span><br><span class="line">                services.AddTransient&lt;HttpClient&gt;();</span><br><span class="line">               </span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="keyword">var</span> host = builder.Build();            </span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> serviceScope = host.Services.CreateScope()) &#123;</span><br><span class="line">            <span class="keyword">var</span> services = serviceScope.ServiceProvider;                              </span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> myService = services.GetRequiredService&lt;MyApplication&gt;();</span><br><span class="line">                <span class="keyword">await</span> myService.Run();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;Error Occured:  &#123;0&#125;&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>控制台项目中的 <code>MyApplication.cs</code> 文件类似于以下内容：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyApplication</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger _logger;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IBusinessLayer _business;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyApplication</span>(<span class="params">ILogger&lt;MyApplication&gt; logger, IBusinessLayer business</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _logger = logger;</span><br><span class="line">            _business = business;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">internal</span> <span class="keyword">async</span> Task <span class="title">Run</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _logger.LogInformation(<span class="string">&quot;Application &#123;applicationEvent&#125; at &#123;dateTime&#125;&quot;</span>, <span class="string">&quot;Started&quot;</span>, DateTime.UtcNow);</span><br><span class="line"></span><br><span class="line">            _business.PerformBusiness();</span><br><span class="line"></span><br><span class="line">            _logger.LogInformation(<span class="string">&quot;Application &#123;applicationEvent&#125; at &#123;dateTime&#125;&quot;</span>, <span class="string">&quot;Ended&quot;</span>, DateTime.UtcNow);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;PRESS &lt;ENTER&gt; TO EXIT&quot;</span>);</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> .NET Core </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Console </tag>
            
            <tag> Dependency Injection </tag>
            
            <tag> HostBuilder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Hexo 博客中使用标签云 hexo-tag-cloud</title>
      <link href="/2020/02/29/use-hexo-tag-cloud/"/>
      <url>/2020/02/29/use-hexo-tag-cloud/</url>
      
        <content type="html"><![CDATA[<h2 id="Hexo-标签云插件效果图"><a href="#Hexo-标签云插件效果图" class="headerlink" title="Hexo 标签云插件效果图"></a>Hexo 标签云插件效果图</h2><img src="/2020/02/29/use-hexo-tag-cloud/tagcloud.png" class="" title="词云"><h2 id="安装-hexo-tag-cloud"><a href="#安装-hexo-tag-cloud" class="headerlink" title="安装 hexo-tag-cloud"></a>安装 hexo-tag-cloud</h2><p>进入到 <code>Hexo</code> 的根目录，打开终端，输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo-tag-cloud</span><br></pre></td></tr></table></figure><h2 id="去修改主题的-tagcloud-的模板"><a href="#去修改主题的-tagcloud-的模板" class="headerlink" title="去修改主题的 tagcloud 的模板"></a>去修改主题的 <code>tagcloud</code> 的模板</h2><p>打开文件：themes&#x2F;pure&#x2F;layout&#x2F;_widget&#x2F;tagcloud.ejs， 将这个文件修改为如下内容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (site.<span class="property">tags</span>.<span class="property">length</span>) &#123; %&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%- url_for(&#x27;/js/tagcloud.js&#x27;) %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%- url_for(&#x27;/js/tagcanvas.js&#x27;) %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget-wrap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;widget-title&quot;</span>&gt;</span>&lt;%= __(&#x27;tagcloud&#x27;) %&gt;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;myCanvasContainer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;widget tagcloud&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">width</span>=<span class="string">&quot;250&quot;</span> <span class="attr">height</span>=<span class="string">&quot;250&quot;</span> <span class="attr">id</span>=<span class="string">&quot;resCanvas&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &lt;%- tagcloud() %&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><h2 id="最后一步"><a href="#最后一步" class="headerlink" title="最后一步"></a>最后一步</h2><p>完成安装和显示，可以通过 hexo clean &amp;&amp; hexo g &amp;&amp; hexo s 来进行本地预览, hexo clean 为必须选项。</p><blockquote><p>PS:不要使用 hexo g -d 或者 hexo d -g 这类组合命令</p></blockquote><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> tag </tag>
            
            <tag> cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx 配置文件参数详解</title>
      <link href="/2020/02/28/nginx-configuration-file-parameters/"/>
      <url>/2020/02/28/nginx-configuration-file-parameters/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line">#定义Nginx运行的用户和用户组</span><br><span class="line"></span><br><span class="line">user www www;</span><br><span class="line"></span><br><span class="line">#nginx进程数，建议设置为等于CPU总核心数。</span><br><span class="line"></span><br><span class="line">worker_processes 8;</span><br><span class="line"></span><br><span class="line">#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span><br><span class="line"></span><br><span class="line">error_log /var/log/nginx/error.log info;</span><br><span class="line"></span><br><span class="line">#进程文件</span><br><span class="line"></span><br><span class="line">pid /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">#一个nginx进程打开的最多文件描述符数目，</span><br><span class="line">#理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，</span><br><span class="line">#但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span><br><span class="line"></span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line">#工作模式与连接数上限</span><br><span class="line"></span><br><span class="line">events</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">#epoll是多路复用IO(I/O Multiplexing)中的一种方式,</span><br><span class="line"></span><br><span class="line">#仅用于linux2.6以上内核,可以大大提高nginx的性能</span><br><span class="line"></span><br><span class="line">use epoll;</span><br><span class="line"></span><br><span class="line">#单个后台worker process进程的最大并发链接数 ,</span><br><span class="line">#并发总数是 worker_processes 和 worker_connections 的乘积</span><br><span class="line"></span><br><span class="line">worker_connections 1024;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#设定http服务器</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">#文件扩展名与文件类型映射表</span><br><span class="line"></span><br><span class="line">include    mime.types;</span><br><span class="line"></span><br><span class="line">default_typeapplication/octet-stream; #默认文件类型</span><br><span class="line"></span><br><span class="line">#charsetutf-8; #默认编码</span><br><span class="line"></span><br><span class="line">server_names_hash_bucket_size128; #服务器名字的hash表大小</span><br><span class="line"></span><br><span class="line">client_header_buffer_size32k; #上传文件大小限制</span><br><span class="line"></span><br><span class="line">large_client_header_buffers4 64k; #设定请求缓</span><br><span class="line"></span><br><span class="line">client_max_body_size8m; #设定请求缓</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，</span><br><span class="line">#对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，</span><br><span class="line">#以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span><br><span class="line"></span><br><span class="line">sendfileon; </span><br><span class="line"></span><br><span class="line">autoindexon; #开启目录列表访问，合适下载服务器，默认关闭。</span><br><span class="line"></span><br><span class="line">tcp_nopushon; #防止网络阻塞</span><br><span class="line"></span><br><span class="line">tcp_nodelayon; #防止网络阻塞</span><br><span class="line"></span><br><span class="line">keepalive_timeout60; #长连接超时时间，单位是秒</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#gzip模块设置</span><br><span class="line"></span><br><span class="line">gzip on; #开启gzip压缩输出</span><br><span class="line"></span><br><span class="line">gzip_min_length 1k; #最小压缩文件大小</span><br><span class="line"></span><br><span class="line">gzip_buffers 4 16k; #压缩缓冲区</span><br><span class="line"></span><br><span class="line">gzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span><br><span class="line"></span><br><span class="line">gzip_comp_level 2; #压缩等级</span><br><span class="line"></span><br><span class="line">gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line"></span><br><span class="line">#压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</span><br><span class="line"></span><br><span class="line">gzip_vary on;</span><br><span class="line"></span><br><span class="line">#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用</span><br><span class="line"></span><br><span class="line">#虚拟主机的配置</span><br><span class="line"></span><br><span class="line">server</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">#监听端口</span><br><span class="line"></span><br><span class="line">listen 80;</span><br><span class="line"></span><br><span class="line">#域名可以有多个，用空格隔开</span><br><span class="line"></span><br><span class="line">server_name en.codeday.me;</span><br><span class="line"></span><br><span class="line">#默认首页</span><br><span class="line"></span><br><span class="line">index index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line">#站点文件存放路径</span><br><span class="line"></span><br><span class="line">root /data/www/codeday;</span><br><span class="line"></span><br><span class="line">#PHP 脚本请求全部转发到 FastCGI处理. 使用FastCGI默认配置.</span><br><span class="line"></span><br><span class="line">location ~ ..(php|php5)?$</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">fastcgi_pass 127.0.0.1:9000;</span><br><span class="line"></span><br><span class="line">fastcgi_index index.php;</span><br><span class="line"></span><br><span class="line">fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line"></span><br><span class="line">include fastcgi.conf;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#静态文件，nginx自己处理</span><br><span class="line"></span><br><span class="line">location ~ ^/(images|javascript|js|css|flash|media|static)/ &#123;</span><br><span class="line"></span><br><span class="line">#过期30天，静态文件不怎么更新，过期可以设大一点，</span><br><span class="line"></span><br><span class="line">#如果频繁更新，则可以设置得小一点。</span><br><span class="line"></span><br><span class="line">expires 30d;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#定义本虚拟主机的访问日志</span><br><span class="line"></span><br><span class="line">access_log /var/log/nginx/access.log access;</span><br><span class="line"></span><br><span class="line">#默认请求</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line"></span><br><span class="line">#反向代理</span><br><span class="line"></span><br><span class="line">proxy_passhttp://127.0.0.1:88;</span><br><span class="line"></span><br><span class="line">proxy_redirectoff;</span><br><span class="line"></span><br><span class="line">proxy_set_headerX-Real-IP $remote_addr;</span><br><span class="line"></span><br><span class="line">#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line"></span><br><span class="line">proxy_set_headerX-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">#以下是一些反向代理的配置，可选。</span><br><span class="line"></span><br><span class="line">proxy_set_headerHost $host;</span><br><span class="line"></span><br><span class="line">client_max_body_size10m; #允许客户端请求的最大单文件字节数</span><br><span class="line"></span><br><span class="line">client_body_buffer_size128k; #缓冲区代理缓冲用户端请求的最大字节数，</span><br><span class="line"></span><br><span class="line">proxy_connect_timeout90; #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line"></span><br><span class="line">proxy_send_timeout90; #后端服务器数据回传时间(代理发送超时)</span><br><span class="line"></span><br><span class="line">proxy_read_timeout90; #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line"></span><br><span class="line">proxy_buffer_size4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line"></span><br><span class="line">proxy_buffers432k; #proxy_buffers缓冲区，网页平均在32k以下的设置</span><br><span class="line"></span><br><span class="line">proxy_busy_buffers_size64k; #高负荷下缓冲大小（proxy_buffers2）</span><br><span class="line"></span><br><span class="line">proxy_temp_file_write_size64k;</span><br><span class="line"></span><br><span class="line">#设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#本地动静分离反向代理配置</span><br><span class="line"></span><br><span class="line">#所有jsp的页面均交由tomcat或resin处理</span><br><span class="line"></span><br><span class="line">location ~ .(jsp|jspx|do)?$ &#123;</span><br><span class="line"></span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line"></span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line"></span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">proxy_pass http://127.0.0.1:8080;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#所有静态文件由nginx直接读取不经过tomcat或resin</span><br><span class="line"></span><br><span class="line">location ~ ..(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">expires 15d;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ ..(js|css)?$</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">expires 1h;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Linux Mint 19.3 中使用 JetBrains Rider 2019 开发 ABP vNext 应用程序</title>
      <link href="/2020/02/25/use-abp-vnext-with-rider-on-linux-mint-19/"/>
      <url>/2020/02/25/use-abp-vnext-with-rider-on-linux-mint-19/</url>
      
        <content type="html"><![CDATA[<h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><p>在 <code>ABP vNext</code> 网站的 <a href="http://abp.io/get-started">Get Started</a> 创建一个名字为 <code>Acorn.BookStore</code> 的 <code>MVC</code> 项目</p><img src="/2020/02/25/use-abp-vnext-with-rider-on-linux-mint-19/create-project.png" class="" title="创建新项目"><p>将下载后的 <code>BookStore.zip</code> 解压缩到 <code>Acron.BookStore</code> 文件夹，并用 Rider 2019 打开该文件夹下名为 <code>Acorn.BookStore.sln</code> 的解决方案。</p><h1 id="切换到-EF-Core-MySql-提供程序"><a href="#切换到-EF-Core-MySql-提供程序" class="headerlink" title="切换到 EF Core MySql 提供程序"></a>切换到 <code>EF Core MySql</code> 提供程序</h1><h2 id="安装-Volo-Abp-EntityFrameworkCore-MySQL包"><a href="#安装-Volo-Abp-EntityFrameworkCore-MySQL包" class="headerlink" title="安装 Volo.Abp.EntityFrameworkCore.MySQL包"></a>安装 <code>Volo.Abp.EntityFrameworkCore.MySQL</code>包</h2><p>在解决方案的 <code>src</code> 文件夹中的 <code>Acorn.BookStore.EntityFrameworkCore</code> 项目上 <code>右键</code> 选择 <code>Manage NuGet Packages</code>, 在下面出现的搜索框输入 <code>Volo.Abp.EntityFrameworkCore.MySQL </code>， 并选择安装到 <code>Acorn.BookStore.EntityFrameworkCore</code> 项目中。</p><h2 id="替换模块依赖项"><a href="#替换模块依赖项" class="headerlink" title="替换模块依赖项"></a>替换模块依赖项</h2><p>在 <code>.EntityFrameworkCore</code> 项目中找到 <code>BookStoreEntityFrameworkCoreModule</code> 类(<code>BookStoreEntityFrameworkCoreModule</code> 前面的 <code>BookStore</code>为创建项目时使用的名称，如果使用了不同的名字，找到对应的即可), 删除 <code>DependsOn attribute</code> 上的 <code>typeof(AbpEntityFrameworkCoreSqlServerModule)</code>, 添加 <code>typeof(AbpEntityFrameworkCoreMySQLModule)</code> (或者替换 <code>using Volo.Abp.EntityFrameworkCore.SqlServer;</code> 为 <code>using Volo.Abp.EntityFrameworkCore.MySQL;</code>).</p><h2 id="使用-UseMySQL"><a href="#使用-UseMySQL" class="headerlink" title="使用 UseMySQL()"></a>使用 UseMySQL()</h2><ol><li>在 <code>BookStoreEntityFrameworkCoreModule</code> 的 <code>ConfigureServices</code> 方法中找到以下代码：</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Configure&lt;AbpDbContextOptions&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* The main point to change your DBMS.</span></span><br><span class="line"><span class="comment">     * See also BookStoreMigrationsDbContextFactory for EF Core tooling. */</span></span><br><span class="line">    options.UseSqlServer();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>替换为：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Configure&lt;AbpDbContextOptions&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* The main point to change your DBMS.</span></span><br><span class="line"><span class="comment">     * See also BookStoreMigrationsDbContextFactory for EF Core tooling. */</span></span><br><span class="line">    <span class="comment">// options.UseSqlServer(); </span></span><br><span class="line">    options.UseMySQL();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>Acorn.BookStore.EntityFrameworkCore.DbMigrations</code> 项目中打开文件 <code>BookStoreMigrationsDbContextFactory</code>, 找到 <code>BookStoreMigrationsDbContext</code> 中的以下代码：</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> BookStoreMigrationsDbContext <span class="title">CreateDbContext</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> configuration = BuildConfiguration();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> builder = <span class="keyword">new</span> DbContextOptionsBuilder&lt;BookStoreMigrationsDbContext&gt;()</span><br><span class="line">        .UseSqlServer(configuration.GetConnectionString(<span class="string">&quot;Default&quot;</span>));</span><br><span class="line">           </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BookStoreMigrationsDbContext(builder.Options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改为：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> BookStoreMigrationsDbContext <span class="title">CreateDbContext</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> configuration = BuildConfiguration();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> builder = <span class="keyword">new</span> DbContextOptionsBuilder&lt;BookStoreMigrationsDbContext&gt;()</span><br><span class="line">        .UseMySql(configuration.GetConnectionString(<span class="string">&quot;Default&quot;</span>));</span><br><span class="line">        <span class="comment">//.UseSqlServer(configuration.GetConnectionString(&quot;Default&quot;));</span></span><br><span class="line">           </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BookStoreMigrationsDbContext(builder.Options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="更改迁移-DbContext"><a href="#更改迁移-DbContext" class="headerlink" title="更改迁移 DbContext"></a>更改迁移 DbContext</h2><p>在 <code>Acorn.BookStore.EntityFrameworkCore.DbMigrations</code> 项目中打开文件 <code>BookStoreMigrationsDbContext</code>, 找到其中的 <code>protected override void OnModelCreating(ModelBuilder builder)</code> 方法，将该方法中的以下语句：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builder.ConfigureIdentityServer();    </span><br></pre></td></tr></table></figure><p>替换为：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// builder.ConfigureIdentityServer();</span></span><br><span class="line">builder.ConfigureIdentityServer(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.DatabaseProvider = EfCoreDatabaseProvider.MySql;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>MySQL DBMS</code> 与 <code>SQL Server</code>有一些细微的差异. 某些模块数据库映射配置(尤其是字段长度)会导致<code>MySQL</code> 出现问题. 例如某些 <code>IdentityServer</code> 模块表就存在这样的问题,它提供了一个选项可以根据您的 <code>DBMS</code> 配置字段.</p><p>启动模板包含 <code>BookStoreMigrationsDbContext</code>,它负责维护和迁移数据库架构. 此<code>DbContext</code>基本上调用依赖模块的扩展方法来配置其数据库表.</p><p>然后 <code>ConfigureIdentityServer()</code> 方法会将字段长度设置为不超过 <code>MySQL</code> 的限制. </p><blockquote><p>少了这一步，全出现类似 <code>BLOB/TEXT column &#39;Value&#39; used in key specification without a key length</code> 的错误提示。</p></blockquote><h2 id="更改连接字符串"><a href="#更改连接字符串" class="headerlink" title="更改连接字符串"></a>更改连接字符串</h2><p><code>MySQL连接字符串</code> 与 <code>SQL Server连接字符串</code> 不同. 所以检查你的解决方案中所有的 <code>appsettings.json</code> 文件,更改其中的连接字符串.<br>MySQL 连接字符串示例：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;ConnectionStrings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Server=localhost;Database=BookStore20200225;Uid=root;Pwd=123456&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>通常需要更改 <code>.DbMigrator</code> 和 <code>.Web </code>项目里面的 <code>appsettings.json</code> ,但它取决于你的解决方案结构.</p><blockquote><p>我不知道在 Rider 里面怎么设置某个项目为启动项目，或者是没有这个功能, 但是在可以启动的项目上 <code>右键</code> 时， 会出现 <code>Run&#39;src/Acron.BookStore...&#39;</code> 的菜单项. 所以这里的做法是在 <code>appsettings.json</code> 中修改了连接字符串后，把相应的 <code>appsettings.json</code> 文件也复制一份到 <code>.EntityFrameworkCore.DbMigrations</code> 项目中, 以便能够进行数据库的迁移和更新。</p></blockquote><h2 id="重新生成迁移"><a href="#重新生成迁移" class="headerlink" title="重新生成迁移"></a>重新生成迁移</h2><ol><li><p>删除 <code>.EntityFrameworkCore.DbMigrations</code> 项目下的 <code>Migrations</code>文件夹, 并重新生成解决方案.</p></li><li><p>在 <code>Rider 2019</code> 的 <code>Terminal</code> 中将当前文件夹定位到 <code>.EntityFrameworkCore.DbMigrations</code> 项目下。</p></li><li><p>执行数据迁移命令：</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ dotnet ef add migrations <span class="string">&quot;inti&quot;</span></span><br><span class="line">Could not execute because the specified <span class="built_in">command</span> or file was not found.</span><br><span class="line">Possible reasons <span class="keyword">for</span> this include:</span><br><span class="line">  * You misspelled a built-in dotnet <span class="built_in">command</span>.</span><br><span class="line">  * You intended to execute a .NET Core program, but dotnet-ef does not exist.</span><br><span class="line">  * You intended to run a global tool, but a dotnet-prefixed executable with this name could not be found on the PATH.</span><br></pre></td></tr></table></figure><p>如果出现以上提示，是因为没有添加 <code>dotnet-ef</code> 的工具包，解决办法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ dotnet tool update --global dotnet-ef</span><br><span class="line">You can invoke the tool using the following <span class="built_in">command</span>: dotnet-ef</span><br><span class="line">Tool <span class="string">&#x27;dotnet-ef&#x27;</span> (version <span class="string">&#x27;3.1.2&#x27;</span>) was successfully installed</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>再次执行数据迁移命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ dotnet ef migrations add <span class="string">&quot;init_mysql&quot;</span></span><br><span class="line">Build started...</span><br><span class="line">Build succeeded.</span><br><span class="line">Done. To undo this action, use <span class="string">&#x27;ef migrations remove&#x27;</span></span><br></pre></td></tr></table></figure><p>更新到数据库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ dotnet ef database update</span><br><span class="line">Build started...</span><br><span class="line">Build succeeded.</span><br><span class="line">Applying migration <span class="string">&#x27;20200225085639_init_mysql&#x27;</span>.</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure><h2 id="初始化种子数据"><a href="#初始化种子数据" class="headerlink" title="初始化种子数据"></a>初始化种子数据</h2><p>运行 <code>.DbMigrator</code> 项目创建数据库和初始种子数据。但是直接运行时会出现以下信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[17:02:17 INF] Started database migrations...</span><br><span class="line">[17:02:17 INF] Migrating host database schema...</span><br><span class="line">[17:02:18 INF] Executing host database seed...</span><br><span class="line">[17:02:20 INF] Successfully completed host database migrations.</span><br><span class="line">[17:02:20 INF] Successfully completed database migrations.</span><br><span class="line">info: Microsoft.Hosting.Lifetime[0]</span><br><span class="line">      Application started. Press Ctrl+C to shut down.</span><br><span class="line">info: Microsoft.Hosting.Lifetime[0]</span><br><span class="line">      Hosting environment: Production</span><br><span class="line">info: Microsoft.Hosting.Lifetime[0]</span><br><span class="line">      Content root path: /home/yoda/source/Acorn.BookStore/src/Acorn.BookStore.DbMigrator/bin/Debug/netcoreapp3.1</span><br></pre></td></tr></table></figure><p>在 <code>Run</code> 窗口显示以上内容时，就卡住不动了，所以这里的解决办法是，先执行数据迁移和更新数据库命令， 再运行 <code>.DbMigrator</code> 项目(正常情况应该是执行迁移命令之后 ，就可以直接运行这个项目完成数据库创建和初始种子数据两个工作).</p><h1 id="运行应用程序"><a href="#运行应用程序" class="headerlink" title="运行应用程序"></a>运行应用程序</h1><p>最后运行 <code>.Web</code> 项目，就可以了。</p><img src="/2020/02/25/use-abp-vnext-with-rider-on-linux-mint-19/web-start.png" class="" title="运行应用程序"><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> ABP vNext </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MariaDB </tag>
            
            <tag> Rider </tag>
            
            <tag> MVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 CentOS 7 上为 Nginx 添加自签名SSL证书</title>
      <link href="/2020/02/21/create-self-signed-sll-certificate-nginx-centos7/"/>
      <url>/2020/02/21/create-self-signed-sll-certificate-nginx-centos7/</url>
      
        <content type="html"><![CDATA[<h1 id="解决OpenSSL创建的自签名证书在chrome端无法信任的问题"><a href="#解决OpenSSL创建的自签名证书在chrome端无法信任的问题" class="headerlink" title="解决OpenSSL创建的自签名证书在chrome端无法信任的问题"></a>解决OpenSSL创建的自签名证书在chrome端无法信任的问题</h1><p><code>OpenSSL</code> 创建自签名证书的方法在 <code>chrome</code> 上会遇到了证书无效的错误:</p><img src="/2020/02/21/create-self-signed-sll-certificate-nginx-centos7/20181217143844670.PNG" class="" title="证书无效的错误"><h2 id="原因概述"><a href="#原因概述" class="headerlink" title="原因概述"></a>原因概述</h2><p>Chrome浏览器要求证书中必须包含 “Subject Alternative Names” 这一参数。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>修改待用的openssl配置文件</p><h3 id="1-拷贝openssl配置文件以备修改"><a href="#1-拷贝openssl配置文件以备修改" class="headerlink" title="1 拷贝openssl配置文件以备修改"></a>1 拷贝openssl配置文件以备修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/pki/tls/openssl.cnf  /etc/pki/tls/openssl_bak.cnf</span><br></pre></td></tr></table></figure><h3 id="2-修改-openssl-cnf-文件"><a href="#2-修改-openssl-cnf-文件" class="headerlink" title="2 修改 openssl.cnf 文件"></a>2 修改 openssl.cnf 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/pki/tls/openssl.cnf</span><br></pre></td></tr></table></figure><p>(1) 找到[ req ] 段落，添加如下配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req_extentions = v3_req</span><br></pre></td></tr></table></figure><img src="/2020/02/21/create-self-signed-sll-certificate-nginx-centos7/20181217145626178.png" class="" title="req_extentions"><p>(2) 添加 <code>v3_req</code> 配置信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ v3_req ]</span><br><span class="line"># Extensions to add to a certificate request</span><br><span class="line"># basicConstraints = CA:FALSE</span><br><span class="line"># keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span><br><span class="line">subjectAltName = @alt_names</span><br></pre></td></tr></table></figure><p>(3) 添加 <code>alt_names</code> 配置信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ alt_names ]</span><br><span class="line">DNS.1 = linux111.esrichina.com</span><br></pre></td></tr></table></figure><blockquote><p>注：这里填入的即为 <code>Subject Alternative Names</code> 的域名名称</p></blockquote><h1 id="创建自签名SSL证书"><a href="#创建自签名SSL证书" class="headerlink" title="创建自签名SSL证书"></a>创建自签名SSL证书</h1><h2 id="创建自签名证书"><a href="#创建自签名证书" class="headerlink" title="创建自签名证书"></a>创建自签名证书</h2><h3 id="创建存放证书的文件夹"><a href="#创建存放证书的文件夹" class="headerlink" title="创建存放证书的文件夹"></a>创建存放证书的文件夹</h3><p>打算把创建好的SSL证书放在 <code>/etc/ssl/private</code> 文件夹中，CentOS 7中没有这个文件夹，所以先创建好：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> /etc/ssl/private</span><br></pre></td></tr></table></figure><p>在命令中使用 <code>OpenSSL</code> 创建自签名密钥和证书(此处有效期3650天)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt  -extensions v3_req</span><br></pre></td></tr></table></figure><p>在我们继续操作之前，让我们看看命令中发生了什么：</p><ul><li><p>openssl：这是用于创建和管理 <code>OpenSSL</code> 证书、密钥和其他文件的基本命令工具。</p></li><li><p>req：此子命令指定我们要使用X.509证书签名请求管理。“X.509”是SSL和TLS为其密钥和证书管理所遵循的公钥基础结构标准。我们想要创建一个新的 X.509 证书，所以我们使用这个子命令。</p></li><li><p>-x509：这通过告诉实用程序我们要创建自签名证书而不是生成证书签名请求来进一步修改上一个子命令。</p></li><li><p>-nodes：这告诉 <code>OpenSSL</code> 跳过用密码保护我们的证书的选项。当服务器启动时，我们需要 <code>Nginx</code> 能够在没有用户干预的情况下读取文件。密码短语会阻止这种情况发生，因为我们必须在每次重启后输入密码。</p></li><li><p>-days 3650：此选项设置证书的有效时间长度。我们在这里设置了十年。</p></li><li><p>-newkey rsa：2048：这指定我们要同时生成新证书和新密钥。我们没有创建在上一步中签署证书所需的密钥，因此我们需要将其与证书一起创建。该rsa:2048部分告诉它制作一个2048位长的RSA密钥。</p></li><li><p>-keyout：这一行告诉 <code>OpenSSL</code> 在哪里放置我们正在创建的生成的私钥文件。</p></li><li><p>-out：这告诉<code> OpenSSL</code> 在哪里放置我们正在创建的证书。</p></li></ul><p>如上所述，这些选项将创建密钥文件和证书。我们将询问有关我们服务器的一些问题，以便将信息正确地填入到证书中。</p><p> <em>最重要的一行是请求Common Name (e.g. server FQDN or YOUR name)。您需要输入与服务器关联的域名，或者是您服务器的公共IP地址。</em></p><p>整个提示将如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Country Name (2 letter code) [AU]:US</span><br><span class="line">State or Province Name (full name) [Some-State]:New York</span><br><span class="line">Locality Name (eg, city) []:New York City</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Bouncy Castles, Inc.</span><br><span class="line">Organizational Unit Name (eg, section) []:Ministry of Water Slides</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:server_IP_address</span><br><span class="line">Email Address []:admin@your_domain.com</span><br></pre></td></tr></table></figure><p>创建的两个文件都将放在 <code>/etc/ssl</code> 目录的相应子目录中。</p><p>在我们使用OpenSSL的同时，我们还应该创建一个完整的 <code>Diffie-Hellman</code> 组，用于与客户协商完整的保密。</p><p>通过输入以下内容来执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048</span><br></pre></td></tr></table></figure><p>这可能需要几分钟，一旦完成，您将拥有一个强大的DH组。&#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;dhparam.pem 可以在我们的配置中使用。</p><h2 id="配置-Nginx-以使用-SSL"><a href="#配置-Nginx-以使用-SSL" class="headerlink" title="配置 Nginx 以使用 SSL"></a>配置 Nginx 以使用 SSL</h2><p>我们在&#x2F;etc&#x2F;ssl目录下创建了密钥和证书文件。现在我们只需要修改我们的Nginx配置就可以使用它们。</p><p>我们将对配置进行一些调整。</p><ol><li><p>我们将创建一个包含 SSL 密钥和证书文件位置的配置代码。</p></li><li><p>我们将创建一个包含强 SSL 设置的配置代码，可以在将来与任何证书一起使用。</p></li><li><p>我们将调整我们的 <code>Nginx</code> 配置文件来处理 SSL 请求并使用上面的两个代码段。</p></li></ol><p>这种配置 <code>Nginx</code> 的方法将允许将常见配置段放入可重用模块中。</p><h3 id="创建指向SSL密钥和证书的配置代码"><a href="#创建指向SSL密钥和证书的配置代码" class="headerlink" title="创建指向SSL密钥和证书的配置代码"></a>创建指向SSL密钥和证书的配置代码</h3><p>首先，让我们在 <code>/etc/nginx/snippets</code>目录中创建一个新的 <code>Nginx</code> 配置代码。</p><p>为了正确区分此文件，我们称之为 <code>self-signed.conf</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/nginx/snippets/self-signed.conf</span><br></pre></td></tr></table></figure><p>在这个文件中，我们只需要将 <code>ssl_certificate</code> 设置为我们的证书文件和 <code>ssl_certificate_key</code> 相关的密钥。在我们的例子中，是这样的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;</span><br><span class="line">ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;</span><br></pre></td></tr></table></figure><p>添加这些行后，保存并关闭该文件。</p><h3 id="使用强加密设置创建配置代码"><a href="#使用强加密设置创建配置代码" class="headerlink" title="使用强加密设置创建配置代码"></a>使用强加密设置创建配置代码</h3><p>接下来，我们将创建另一个代码，用于定义一些SSL设置。这将使Nginx更加安全，并启用一些有助于保证我们的服务器安全的高级功能。</p><p>我们为了使设置的参数可以在将来的Nginx配置中重用，因此我们将为该文件指定一个通用名称：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/nginx/snippets/ssl-params.conf</span><br></pre></td></tr></table></figure><p>对其进行修改如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># from https://cipherli.st/</span><br><span class="line"># and https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html</span><br><span class="line"></span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line">ssl_ciphers &quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;;</span><br><span class="line">ssl_ecdh_curve secp384r1;</span><br><span class="line">ssl_session_cache shared:SSL:10m;</span><br><span class="line">ssl_session_tickets off;</span><br><span class="line">ssl_stapling on;</span><br><span class="line">ssl_stapling_verify on;</span><br><span class="line">resolver 8.8.8.8 8.8.4.4 valid=300s;</span><br><span class="line">resolver_timeout 5s;</span><br><span class="line"># Disable preloading HSTS for now.  You can use the commented out header line that includes</span><br><span class="line"># the &quot;preload&quot; directive if you understand the implications.</span><br><span class="line">#add_header Strict-Transport-Security &quot;max-age=63072000; includeSubdomains; preload&quot;;</span><br><span class="line">add_header Strict-Transport-Security &quot;max-age=63072000; includeSubdomains&quot;;</span><br><span class="line">add_header X-Frame-Options DENY;</span><br><span class="line">add_header X-Content-Type-Options nosniff;</span><br><span class="line"></span><br><span class="line">ssl_dhparam /etc/ssl/certs/dhparam.pem;</span><br></pre></td></tr></table></figure><h2 id="调整Nginx配置以使用SSL"><a href="#调整Nginx配置以使用SSL" class="headerlink" title="调整Nginx配置以使用SSL"></a>调整Nginx配置以使用SSL</h2><p>打开 <code>nginx</code> 配置文件进行调整</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/nginx/nginx.cnf</span><br></pre></td></tr></table></figure><p>在里面，原来的nginx配置文件开始可能像这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line"></span><br><span class="line">    # SSL configuration</span><br><span class="line"></span><br><span class="line">    # listen 443 ssl default_server;</span><br><span class="line">    # listen [::]:443 ssl default_server;</span><br><span class="line"></span><br><span class="line">    . . .</span><br></pre></td></tr></table></figure><p>修改此配置，以便将未加密的HTTP请求自动重定向到加密的HTTPS。这为我们的网站提供了最佳安全性。如果要同时允许HTTP和HTTPS流量，请使用后面的配置。<br>将把配置分成两个独立的块。在两个第一个listen指令之后，我们将添加一个server_name指令，设置为服务器的域名，或者是IP地址。然后，我们将设置重定向到我们将要创建的第二个Nginx配置文件。之后，我们将关闭这个短块：</p><blockquote><p>注意：我们将使用302重定向，直到我们确认网站正常。我们可以将其更改为永久301重定向。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80 default_server;</span><br><span class="line">    listen       [::]:80 default_server;</span><br><span class="line">    server_name  _;</span><br><span class="line"><span class="built_in">return</span> 302 https://192.168.0.100;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">ssl on;</span><br><span class="line">    listen       443 ssl http2 default_server;</span><br><span class="line">    listen       [::]:443 ssl http2 default_server;</span><br><span class="line">    server_name  _;</span><br><span class="line">    root         /usr/share/nginx/html;</span><br><span class="line">charset utf-8,gbk;</span><br><span class="line">include /etc/nginx/snippets/self-singed.conf;</span><br><span class="line">    include /etc/nginx/snippets/ssl-params.conf;</span><br><span class="line">    <span class="comment"># Load configuration files for the default server block</span></span><br><span class="line">    include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">        location = /40x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完成后保存并关闭文件。</p><h1 id="启用Nginx中的更改"><a href="#启用Nginx中的更改" class="headerlink" title="启用Nginx中的更改"></a>启用Nginx中的更改</h1><p>首先，我们应该检查以确保我们的文件中没有语法错误。我们可以通过输入以下内容来执</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nginx -t</span><br></pre></td></tr></table></figure><p>如果一切顺利，您将得到如下结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx: [warn] <span class="string">&quot;ssl_stapling&quot;</span> ignored, issuer certificate not found</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure><p>如果输出与上述内容匹配，则配置文件没有语法错误。我们可以安全地重启Nginx以实现我们的更改：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart nginx</span><br></pre></td></tr></table></figure><p>我们的服务器现在可以通过HTTPS访问。</p><h2 id="更改为永久重定向"><a href="#更改为永久重定向" class="headerlink" title="更改为永久重定向"></a>更改为永久重定向</h2><p>如果您的重定向工作正常并且您确定只想允许加密流量，则应修改 <code>Nginx</code> 配置以使永久重定向。</p><p>再次打开 <code>Nginx</code>配置文件配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>找到return 302并将其更改为return 301：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line">    server_name server_domain_or_IP;</span><br><span class="line">    return 301 https://$server_name$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">. . .</span><br></pre></td></tr></table></figure><p>保存并关闭文件。</p><p>检查配置是否存在语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nginx -t</span><br></pre></td></tr></table></figure><p>准备好后，重新启动Nginx以使重定向永久化：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart nginx</span><br></pre></td></tr></table></figure><p>您的站点现在应该在通过HTTP访问时永久重定向到HTTPS。</p><h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ol><li><p><a href="https://blog.csdn.net/zssai2015/article/details/85049905">OpenSSL创建的自签名证书在chrome端无法信任</a></p></li><li><p><a href="https://cloud.tencent.com/developer/article/1160294">如何为Nginx创建自签名SSL证书</a></p></li><li><p><a href="https://www.liaoxuefeng.com/article/990311924891552">给Nginx配置一个自签名的SSL证书</a></p></li></ol><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS 7 </tag>
            
            <tag> Nginx </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多电脑同步使用 hexo</title>
      <link href="/2020/02/03/hexo-multi-computer-sync/"/>
      <url>/2020/02/03/hexo-multi-computer-sync/</url>
      
        <content type="html"><![CDATA[<h2 id="创建私有仓库"><a href="#创建私有仓库" class="headerlink" title="创建私有仓库"></a>创建私有仓库</h2><p>在 <code>github</code> 上创建名为： <code>hexoblog</code> 的私有仓库，步骤略。</p><h2 id="删除新增加主题的-git-文件夹"><a href="#删除新增加主题的-git-文件夹" class="headerlink" title="删除新增加主题的 .git 文件夹"></a>删除新增加主题的 .git 文件夹</h2><p>在 <code>Hexo</code> 中添加的第三方主题 <code>pure</code> 包含有 <code>.git</code> 文件夹，如果这个文件夹没有删除的话，该主题内的所有内容都不能上传仓库中，所以需要先把该文件夹删除掉。</p><p>显示 <code>pure</code> 文件夹的内容，包含隐藏文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> ./themes/pure -la</span><br><span class="line"></span><br><span class="line">total 84</span><br><span class="line">drwxr-xr-x  9 yoda yoda 4096 2月   2 22:59 .</span><br><span class="line">drwxr-xr-x  4 yoda yoda 4096 2月   2 22:49 ..</span><br><span class="line">-rw-r--r--  1 yoda yoda 6491 2月   3 11:49 _config.yml</span><br><span class="line">-rw-r--r--  1 yoda yoda 6350 2月   2 22:59 _config.yml.example</span><br><span class="line">drwxr-xr-x  8 yoda yoda 4096 2月   2 22:59 .git</span><br><span class="line">-rw-r--r--  1 yoda yoda   28 2月   3 14:11 .gitignore</span><br><span class="line">drwxr-xr-x  2 yoda yoda 4096 2月   2 22:59 languages</span><br><span class="line">drwxr-xr-x  7 yoda yoda 4096 2月   2 22:59 layout</span><br><span class="line">-rw-r--r--  1 yoda yoda 1053 2月   2 22:59 LICENSE</span><br><span class="line">-rw-r--r--  1 yoda yoda  102 2月   2 22:59 package.json</span><br><span class="line">-rw-r--r--  1 yoda yoda 9523 2月   2 22:59 README.cn.md</span><br><span class="line">-rw-r--r--  1 yoda yoda 4164 2月   2 22:59 README.md</span><br><span class="line">drwxr-xr-x  2 yoda yoda 4096 2月   2 22:59 screenshot</span><br><span class="line">drwxr-xr-x  2 yoda yoda 4096 2月   2 22:59 scripts</span><br><span class="line">drwxr-xr-x  6 yoda yoda 4096 2月   2 22:59 <span class="built_in">source</span></span><br><span class="line">drwxr-xr-x 10 yoda yoda 4096 2月   2 22:59 _source</span><br></pre></td></tr></table></figure><p>删除 <code>.git</code> 文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">rm</span> ./themes/pure/.git -rf</span><br></pre></td></tr></table></figure><h2 id="上传项目到-github"><a href="#上传项目到-github" class="headerlink" title="上传项目到 github"></a>上传项目到 github</h2><p>初始化本地仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br></pre></td></tr></table></figure><p>添加远程仓库地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:hujiyi/hexoblog.git</span><br></pre></td></tr></table></figure><p>添加要提交的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">warning: adding embedded git repository: themes/pure</span><br><span class="line">hint: You<span class="string">&#x27;ve added another git repository inside your current repository.</span></span><br><span class="line"><span class="string">hint: Clones of the outer repository will not contain the contents of</span></span><br><span class="line"><span class="string">hint: the embedded repository and will not know how to obtain it.</span></span><br><span class="line"><span class="string">hint: If you meant to add a submodule, use:</span></span><br><span class="line"><span class="string">hint: </span></span><br><span class="line"><span class="string">hint: git submodule add &lt;url&gt; themes/pure</span></span><br><span class="line"><span class="string">hint: </span></span><br><span class="line"><span class="string">hint: If you added this path by mistake, you can remove it from the</span></span><br><span class="line"><span class="string">hint: index with:</span></span><br><span class="line"><span class="string">hint: </span></span><br><span class="line"><span class="string">hint: git rm --cached themes/pure</span></span><br><span class="line"><span class="string">hint: </span></span><br><span class="line"><span class="string">hint: See &quot;git help submodule&quot; for more information.</span></span><br></pre></td></tr></table></figure><p>添加提交注释信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">&quot;init&quot;</span></span><br><span class="line">[master (root-commit) 3b6c260] init</span><br><span class="line"> 105 files changed, 8951 insertions(+)</span><br><span class="line"> create mode 100644 .gitignore</span><br><span class="line"></span><br><span class="line"> create mode 100644 yarn.lock</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>提交到 <code>master</code> 分支</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure><p> 撰写完后如何再次同步</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;这里填写你本次提交的备注，内容随意&quot;</span></span><br><span class="line">git push origin 分支名</span><br></pre></td></tr></table></figure><p>取回远程主机某个分支的更新</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，这样可以来回控制你的版本，只要善用 <code>git</code>，你可以在任意电脑撰写你的博客。控制你的项目。</p><p>所以，部署完项目后A电脑和B电脑部署区别如下</p><p>A:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;这里填写你本次提交的备注，内容随意&quot;</span></span><br><span class="line">git push origin 分支名</span><br></pre></td></tr></table></figure><p>B:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br><span class="line">hexo new 文章名</span><br><span class="line">hexo g -d</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;这里填写你本次提交的备注，内容随意&quot;</span></span><br><span class="line">git push origin 分支名</span><br></pre></td></tr></table></figure><p>A:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br><span class="line">hexo new 文章名</span><br><span class="line">hexo g -d</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;这里填写你本次提交的备注，内容随意&quot;</span></span><br><span class="line">git push origin 分支名</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用国内镜像安装Rust开发环境</title>
      <link href="/2020/02/03/download-Rustup-and-install-Rust-with-USTC-mirrors/"/>
      <url>/2020/02/03/download-Rustup-and-install-Rust-with-USTC-mirrors/</url>
      
        <content type="html"><![CDATA[<h1 id="安装Rust"><a href="#安装Rust" class="headerlink" title="安装Rust"></a>安装Rust</h1><p><code>Rustup</code> 是 <code>Rust</code> 官方的跨平台 <code>Rust</code> 安装工具。 在国内安装时，可能会出现网络问题无法安装或是安装速度非常慢，可以通过修改环境变量 <code>RUSTUP_DIST_SERVER</code> 和 <code>RUSTUP_UPDATE_ROOT</code> 来改为使用国内的镜像进行安装。</p><h2 id="设置使用国内镜像"><a href="#设置使用国内镜像" class="headerlink" title="设置使用国内镜像"></a>设置使用国内镜像</h2><p>参考：<a href="https://mirrors.ustc.edu.cn/help/rust-static.html">Rust Toolchain 反向代理使用帮助</a></p><p>使用 rustup 前，先设置环境变量 <code>RUSTUP_DIST_SERVER</code> （用于更新 toolchain）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static</span><br></pre></td></tr></table></figure><p>以及 <code>RUSTUP_UPDATE_ROOT</code> （用于更新 rustup）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> RUSTUP_UPDATE_ROOT=https://mirrors.ustc.edu.cn/rust-static/rustup</span><br></pre></td></tr></table></figure><blockquote><p>第一次安装 <code>rustup</code> 的时候，如果按照官网教程 <a href="https://sh.rustup.rs/">https://sh.rustup.rs</a> 链接无法下载，可以通过 jsdelivr 下载 rustup-init.sh， 然后把脚本中的 <code>RUSTUP_UPDATE_ROOT</code> 变量改为 <a href="https://mirrors.ustc.edu.cn/rust-static/rustup%E3%80%82">https://mirrors.ustc.edu.cn/rust-static/rustup。</a></p></blockquote><h2 id="下载-Rustup-并安装-Rust"><a href="#下载-Rustup-并安装-Rust" class="headerlink" title="下载 Rustup 并安装 Rust"></a>下载 Rustup 并安装 Rust</h2><p>要下载 <code>Rustup</code> 并安装 <code>Rust</code>，请在终端中运行以下命令，然后遵循屏幕上的指示。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br></pre></td></tr></table></figure><h1 id="在Rust中，cargo使用国内镜像源"><a href="#在Rust中，cargo使用国内镜像源" class="headerlink" title="在Rust中，cargo使用国内镜像源"></a>在Rust中，cargo使用国内镜像源</h1><p>为应用添加依赖时，默认的依赖安装源在 crates.io，即 Rust 包的仓库中找到所有类别的库。</p><p>程序中引用 crates，编译时需要从官方仓库中下载 crates 文件，但是使用官方的源有的时候很慢并且不稳定，所以使用时需要替换为国内镜像地址，目前常用的是中科大的源。</p><p>在 <code>cargo.toml</code> 文件中添加了依赖之后，运行 <code>cargo build</code> 命令时，如果网络出现问题，则会卡在 <code>blocking waiting for file lock on package cache lock</code> 这里。</p><h2 id="更换cargo的源"><a href="#更换cargo的源" class="headerlink" title="更换cargo的源"></a>更换cargo的源</h2><p>参考：<a href="http://mirrors.ustc.edu.cn/help/crates.io-index.html">Rust Crates 源使用帮助</a></p><h2 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h2><p>在 <code>$HOME/.cargo/config</code> 中添加如下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[source.crates-io]</span></span><br><span class="line"><span class="attr">replace-with</span> = <span class="string">&#x27;ustc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[source.ustc]</span></span><br><span class="line"><span class="attr">registry</span> = <span class="string">&quot;git://mirrors.ustc.edu.cn/crates.io-index&quot;</span></span><br></pre></td></tr></table></figure><p>如果所处的环境中不允许使用 git 协议，可以把上述地址改为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">registry</span> = <span class="string">&quot;https://mirrors.ustc.edu.cn/crates.io-index&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>说明：如果更换 <code>cargo</code> 源后使用 <code>cargo build</code> 命令还是出现 <code>blocking waiting for file lock on package cache lock</code> ， 则删除文件 <code>$HOME/.cargo/.package-cache</code> 即可.</p></blockquote><blockquote><p>警告: cargo search 无法使用镜像。</p></blockquote><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rustup </tag>
            
            <tag> Rust </tag>
            
            <tag> USTC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>创建基于 hexo 和 github 的博客</title>
      <link href="/2020/02/03/building-blog-based-hexo-and-github/"/>
      <url>/2020/02/03/building-blog-based-hexo-and-github/</url>
      
        <content type="html"><![CDATA[<p>创建一个基于hexo和github的静态博客。</p><h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><p>检查电脑是否已经安装git,如果没有的话，执行以下命令安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> apt install git</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  git-man liberror-perl</span><br><span class="line">Suggested packages:</span><br><span class="line">  git-daemon-run | git-daemon-sysvinit git-doc git-el git-email git-gui gitk gitweb git-cvs git-mediawiki git-svn</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  git git-man liberror-perl</span><br><span class="line">0 upgraded, 3 newly installed, 0 to remove and 27 not upgraded.</span><br><span class="line">Need to get 4,738 kB of archives.</span><br><span class="line">After this operation, 33.9 MB of additional disk space will be used.</span><br><span class="line">Do you want to <span class="built_in">continue</span>? [Y/n] </span><br><span class="line">Get:1 http://mirrors.aliyun.com/ubuntu bionic/main amd64 liberror-perl all 0.17025-1 [22.8 kB]</span><br><span class="line">Get:2 http://mirrors.aliyun.com/ubuntu bionic-updates/main amd64 git-man all 1:2.17.1-1ubuntu0.5 [803 kB]</span><br><span class="line">Get:3 http://mirrors.aliyun.com/ubuntu bionic-updates/main amd64 git amd64 1:2.17.1-1ubuntu0.5 [3,912 kB]</span><br><span class="line">Fetched 4,738 kB <span class="keyword">in</span> 7s (633 kB/s)                                                                                      </span><br><span class="line">Selecting previously unselected package liberror-perl.</span><br><span class="line">(Reading database ... 292089 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../liberror-perl_0.17025-1_all.deb ...</span><br><span class="line">Unpacking liberror-perl (0.17025-1) ...</span><br><span class="line">Selecting previously unselected package git-man.</span><br><span class="line">Preparing to unpack .../git-man_1%3a2.17.1-1ubuntu0.5_all.deb ...</span><br><span class="line">Unpacking git-man (1:2.17.1-1ubuntu0.5) ...</span><br><span class="line">Selecting previously unselected package git.</span><br><span class="line">Preparing to unpack .../git_1%3a2.17.1-1ubuntu0.5_amd64.deb ...</span><br><span class="line">Unpacking git (1:2.17.1-1ubuntu0.5) ...</span><br><span class="line">Setting up git-man (1:2.17.1-1ubuntu0.5) ...</span><br><span class="line">Setting up liberror-perl (0.17025-1) ...</span><br><span class="line">Setting up git (1:2.17.1-1ubuntu0.5) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> man-db (2.8.3-2ubuntu0.1) ...</span><br></pre></td></tr></table></figure><p>安装成功后，将你的Git与GitHub帐号绑定，设置user.name和user.email配置信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;你的GitHub用户名&quot;</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;你的GitHub注册邮箱&quot;</span></span><br><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;你的GitHub注册邮箱&quot;</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/home/yoda/.ssh/id_rsa): </span><br><span class="line">Created directory <span class="string">&#x27;/home/yoda/.ssh&#x27;</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /home/yoda/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /home/yoda/.ssh/id_rsa.pub.</span><br></pre></td></tr></table></figure><p>显示生成的.ssh的文件夹中的id_rsa.pub密钥，将内容全部复制</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> ~/.ssh/id_rsa.pub </span><br></pre></td></tr></table></figure><p>打开GitHub_Settings_keys 页面，新建new SSH Key，Title为标题，任意填即可，将刚刚复制的id_rsa.pub内容粘贴进去，最后点击Add SSH key。</p><p>在Git Bash中检测GitHub公钥设置是否成功，输入 ssh <a href="mailto:&#103;&#105;&#116;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#x2e;&#x63;&#x6f;&#109;">&#103;&#105;&#116;&#64;&#103;&#105;&#116;&#104;&#117;&#98;&#x2e;&#x63;&#x6f;&#109;</a> ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ssh git@github.com</span><br><span class="line">Warning: Permanently added the RSA host key <span class="keyword">for</span> IP address <span class="string">&#x27;13.250.177.223&#x27;</span> to the list of known hosts.</span><br><span class="line">PTY allocation request failed on channel 0</span><br><span class="line">Hi hujiyi! You<span class="string">&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span></span><br><span class="line"><span class="string">Connection to github.com closed.</span></span><br></pre></td></tr></table></figure><h2 id="安装-hexo"><a href="#安装-hexo" class="headerlink" title="安装 hexo"></a>安装 hexo</h2><p>使用 yarn 命令安装Hexo，输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> yarn global add hexo-cli</span><br><span class="line">yarn global v1.21.1</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.2: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Installed <span class="string">&quot;hexo-cli@3.1.0&quot;</span> with binaries:</span><br><span class="line">      - hexo</span><br><span class="line">Done <span class="keyword">in</span> 86.85s.</span><br></pre></td></tr></table></figure><h2 id="创建博客项目"><a href="#创建博客项目" class="headerlink" title="创建博客项目"></a>创建博客项目</h2><p>创建博客文件夹，输入命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> hujiyi.github.io</span><br></pre></td></tr></table></figure><p>进入文件夹，并执行博客的初始化：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> hujiyi.github.io/</span><br><span class="line">~/hujiyi.github.io$ hexo init</span><br><span class="line">INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git</span><br><span class="line">Cloning into <span class="string">&#x27;/home/yoda/hujiyi.github.io&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 30, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (30/30), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (24/24), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 161 (delta 12), reused 12 (delta 4), pack-reused 131</span><br><span class="line">Receiving objects: 100% (161/161), 31.79 KiB | 174.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (74/74), <span class="keyword">done</span>.</span><br><span class="line">Submodule <span class="string">&#x27;themes/landscape&#x27;</span> (https://github.com/hexojs/hexo-theme-landscape.git) registered <span class="keyword">for</span> path <span class="string">&#x27;themes/landscape&#x27;</span></span><br><span class="line">Cloning into <span class="string">&#x27;/home/yoda/hujiyi.github.io/themes/landscape&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 1054, <span class="keyword">done</span>.        </span><br><span class="line">remote: Total 1054 (delta 0), reused 0 (delta 0), pack-reused 1054        </span><br><span class="line">Receiving objects: 100% (1054/1054), 3.21 MiB | 107.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (581/581), <span class="keyword">done</span>.</span><br><span class="line">Submodule path <span class="string">&#x27;themes/landscape&#x27;</span>: checked out <span class="string">&#x27;73a23c51f8487cfcd7c6deec96ccc7543960d350&#x27;</span></span><br><span class="line">INFO  Install dependencies</span><br><span class="line">yarn install v1.21.1</span><br><span class="line">info No lockfile found.</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.2: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.11: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.11&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> 129.04s.</span><br><span class="line">INFO  Start blogging with Hexo!</span><br></pre></td></tr></table></figure><h3 id="添加-pure-主题"><a href="#添加-pure-主题" class="headerlink" title="添加 pure 主题"></a>添加 pure 主题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~/hujiyi.github.io$ git <span class="built_in">clone</span> https://github.com/cofess/hexo-theme-pure.git themes/pure</span><br><span class="line">Cloning into <span class="string">&#x27;themes/pure&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 3385, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 3385 (delta 0), reused 0 (delta 0), pack-reused 3385</span><br><span class="line">Receiving objects: 100% (3385/3385), 4.59 MiB | 51.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (1892/1892), <span class="keyword">done</span>.</span><br></pre></td></tr></table></figure><p>将 themes&#x2F;pure&#x2F;_source 文件夹下的所有文件夹复制到 站点的 source&#x2F; 文件夹下。</p><h3 id="安装字数统计插件"><a href="#安装字数统计插件" class="headerlink" title="安装字数统计插件"></a>安装字数统计插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">~/hujiyi.github.io$ yarn add hexo-wordcount</span><br><span class="line">yarn add v1.21.1</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.2: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.11: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.11&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 1 new dependency.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ hexo-wordcount@6.0.1</span><br><span class="line">info All dependencies</span><br><span class="line">└─ hexo-wordcount@6.0.1</span><br><span class="line">Done <span class="keyword">in</span> 9.20s.</span><br></pre></td></tr></table></figure><p>修改主题的配置文件 themes&#x2F;pure&#x2F;_config.yml，启用字数统计功能，如以下代码所示：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wordcount</span></span><br><span class="line"><span class="attr">postCount:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">wordcount:</span> <span class="literal">true</span>  <span class="comment"># 文章字数统计</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span>  <span class="comment"># 阅读时长预计 </span></span><br></pre></td></tr></table></figure><h3 id="hexo-generator-json-content"><a href="#hexo-generator-json-content" class="headerlink" title="hexo-generator-json-content"></a>hexo-generator-json-content</h3><p>简介：用于生成静态站点数据，提供搜索功能的数据源。</p><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~/hujiyi.github.io$ yarn add hexo-generator-json-content</span><br><span class="line">yarn add v1.21.1</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">warning Pattern [<span class="string">&quot;hexo-util@latest&quot;</span>] is trying to unpack <span class="keyword">in</span> the same destination <span class="string">&quot;/home/yoda/.cache/yarn/v6/npm-hexo-util-1.8.1-d8287561709e246a6a73f07fccaed2a82865a736-integrity/node_modules/hexo-util&quot;</span> as pattern [<span class="string">&quot;hexo-util@^1.8.0&quot;</span>,<span class="string">&quot;hexo-util@^1.4.0&quot;</span>,<span class="string">&quot;hexo-util@^1.0.0&quot;</span>]. This could result <span class="keyword">in</span> non-deterministic behavior, skipping.</span><br><span class="line">warning Pattern [<span class="string">&quot;moment@latest&quot;</span>] is trying to unpack <span class="keyword">in</span> the same destination <span class="string">&quot;/home/yoda/.cache/yarn/v6/npm-moment-2.24.0-0d055d53f5052aa653c9f6eb68bb5d12bf5c2b5b-integrity/node_modules/moment&quot;</span> as pattern [<span class="string">&quot;moment@^2.22.2&quot;</span>,<span class="string">&quot;moment@&gt;= 2.9.0&quot;</span>,<span class="string">&quot;moment@^2.10.6&quot;</span>,<span class="string">&quot;moment@^2.18.0&quot;</span>]. This could result <span class="keyword">in</span> non-deterministic behavior, skipping.</span><br><span class="line">info fsevents@2.1.2: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.11: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.11&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 4 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ hexo-generator-json-content@4.1.6</span><br><span class="line">info All dependencies</span><br><span class="line">├─ hexo-generator-json-content@4.1.6</span><br><span class="line">├─ keyword-extractor@0.0.18</span><br><span class="line">├─ underscore.string@3.3.5</span><br><span class="line">└─ underscore@1.9.1</span><br><span class="line">Done <span class="keyword">in</span> 2.13s.</span><br></pre></td></tr></table></figure><p>配置：</p><p>在博客配置文件_config.yml中添加</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jsonContent:</span></span><br><span class="line">  <span class="attr">ignore:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">path/to/a/page</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">url/to/one/post</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">an-entire-category</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">specific.file</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">.ext</span> <span class="comment"># a file extension</span></span><br></pre></td></tr></table></figure><h3 id="自动压缩代码插件-hexo-neat"><a href="#自动压缩代码插件-hexo-neat" class="headerlink" title="自动压缩代码插件 hexo-neat"></a>自动压缩代码插件 hexo-neat</h3><p>简介：自动压缩html、css、js代码</p><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">~/hujiyi.github.io$ yarn add hexo-neat</span><br><span class="line">yarn add v1.21.1</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">warning Pattern [<span class="string">&quot;hexo-util@latest&quot;</span>] is trying to unpack <span class="keyword">in</span> the same destination <span class="string">&quot;/home/yoda/.cache/yarn/v6/npm-hexo-util-1.8.1-d8287561709e246a6a73f07fccaed2a82865a736-integrity/node_modules/hexo-util&quot;</span> as pattern [<span class="string">&quot;hexo-util@^1.8.0&quot;</span>,<span class="string">&quot;hexo-util@^1.4.0&quot;</span>,<span class="string">&quot;hexo-util@^1.0.0&quot;</span>]. This could result <span class="keyword">in</span> non-deterministic behavior, skipping.</span><br><span class="line">warning Pattern [<span class="string">&quot;moment@latest&quot;</span>] is trying to unpack <span class="keyword">in</span> the same destination <span class="string">&quot;/home/yoda/.cache/yarn/v6/npm-moment-2.24.0-0d055d53f5052aa653c9f6eb68bb5d12bf5c2b5b-integrity/node_modules/moment&quot;</span> as pattern [<span class="string">&quot;moment@^2.22.2&quot;</span>,<span class="string">&quot;moment@&gt;= 2.9.0&quot;</span>,<span class="string">&quot;moment@^2.10.6&quot;</span>,<span class="string">&quot;moment@^2.18.0&quot;</span>]. This could result <span class="keyword">in</span> non-deterministic behavior, skipping.</span><br><span class="line">info fsevents@2.1.2: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.11: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.11&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 25 new dependencies.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ hexo-neat@1.0.4</span><br><span class="line">info All dependencies</span><br><span class="line">├─ any-promise@1.3.0</span><br><span class="line">├─ change-case@3.0.2</span><br><span class="line">├─ clean-css@4.2.3</span><br><span class="line">├─ commander@2.9.0</span><br><span class="line">├─ constant-case@2.0.0</span><br><span class="line">├─ dot-case@2.1.1</span><br><span class="line">├─ he@1.1.1</span><br><span class="line">├─ header-case@1.0.1</span><br><span class="line">├─ hexo-neat@1.0.4</span><br><span class="line">├─ html-minifier@2.1.7</span><br><span class="line">├─ is-lower-case@1.1.3</span><br><span class="line">├─ is-upper-case@1.1.2</span><br><span class="line">├─ lower-case-first@1.0.2</span><br><span class="line">├─ ncname@1.0.0</span><br><span class="line">├─ object-assign@4.1.1</span><br><span class="line">├─ param-case@2.1.1</span><br><span class="line">├─ path-case@2.1.1</span><br><span class="line">├─ relateurl@0.2.7</span><br><span class="line">├─ sentence-case@2.1.1</span><br><span class="line">├─ stream-to-array@2.3.0</span><br><span class="line">├─ swap-case@1.1.2</span><br><span class="line">├─ title-case@2.1.1</span><br><span class="line">├─ uglify-js@2.6.4</span><br><span class="line">├─ upper-case-first@1.1.2</span><br><span class="line">└─ xml-char-classes@1.0.0</span><br><span class="line">Done <span class="keyword">in</span> 4.09s.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置：</p><p>在博客配置文件_config.yml中添加</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">neat_enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩html代码</span></span><br><span class="line"><span class="attr">neat_html:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩CSS</span></span><br><span class="line"><span class="attr">neat_css:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;*.min.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#压缩JS</span></span><br><span class="line"><span class="attr">neat_js:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mangle:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">output:</span></span><br><span class="line">  <span class="attr">compress:</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;*.min.js&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="安装Git部署插件-hexo-deployer-git"><a href="#安装Git部署插件-hexo-deployer-git" class="headerlink" title="安装Git部署插件 hexo-deployer-git"></a>安装Git部署插件 hexo-deployer-git</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">~/hujiyi.github.io$ yarn add hexo-deployer-git</span><br><span class="line">yarn add v1.21.1</span><br><span class="line">[1/4] Resolving packages...</span><br><span class="line">[2/4] Fetching packages...</span><br><span class="line">info fsevents@2.1.2: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@2.1.2&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">info fsevents@1.2.11: The platform <span class="string">&quot;linux&quot;</span> is incompatible with this module.</span><br><span class="line">info <span class="string">&quot;fsevents@1.2.11&quot;</span> is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">[3/4] Linking dependencies...</span><br><span class="line">[4/4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 1 new dependency.</span><br><span class="line">info Direct dependencies</span><br><span class="line">└─ hexo-deployer-git@2.1.0</span><br><span class="line">info All dependencies</span><br><span class="line">└─ hexo-deployer-git@2.1.0</span><br><span class="line">Done <span class="keyword">in</span> 7.44s.</span><br></pre></td></tr></table></figure><p>打开站点的配置文件_config.yml，翻到最后修改为：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:用户名/用户名.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>完成后运行 hexo d 将网站上传部署到 GitHub Pages。</p><p>完成！这时访问我们的 GitHub 域名 https:&#x2F;&#x2F;用户名.github.io 就可以看到 Hexo 网站了</p><h2 id="添加博客文章"><a href="#添加博客文章" class="headerlink" title="添加博客文章"></a>添加博客文章</h2><p>创建新文章</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">&quot;your bolg title&quot;</span></span><br></pre></td></tr></table></figure><p>编辑 source&#x2F;_posts&#x2F; 文件夹下的 同名 md 文件。</p><p>生成静态博客</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p>上传到github</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><h2 id="添加-gitalk-评论"><a href="#添加-gitalk-评论" class="headerlink" title="添加 gitalk 评论"></a>添加 gitalk 评论</h2><p>创建OAuth Application</p><p>Gitalk 需要一个 Github Application，打开 <a href="https://github.com/settings/applications/new">https://github.com/settings/applications/new</a>  当然，也可以在用户头像下的setting下的Developer settings中new一个Application，然后填写相应的参数。</p><p>Register a new OAuth application</p><p>Application name  （名字随便填，例如：Hujy blog comments）</p><pre><code>Something users will recognize and trust.</code></pre><p>Homepage URL  （博客地址：<a href="https://hujiyi.github.io/%EF%BC%89">https://hujiyi.github.io/）</a></p><pre><code>The full URL to your application homepage.</code></pre><p>Application description  （描述，随便填）</p><pre><code>This is displayed to all users of your application.</code></pre><p>Authorization callback URL  （博客地址，回调地址：<a href="https://hujiyi.github.io/%EF%BC%89">https://hujiyi.github.io/）</a></p><pre><code>Your application’s callback URL. Read our OAuth documentation for more information.</code></pre><p>完成后会生成相应的clientID 和 clientSecret。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Hujy blog comments</span><br><span class="line">@hujiyi</span><br><span class="line"></span><br><span class="line">hujiyi owns this application.</span><br><span class="line"></span><br><span class="line">You can list your application in the GitHub Marketplace so that other users can discover it.</span><br><span class="line"></span><br><span class="line">0 users</span><br><span class="line"></span><br><span class="line">Client ID</span><br><span class="line">    66f51d5c8d75dac*****</span><br><span class="line">Client Secret</span><br><span class="line">    abac11570202d779515d511e338cf3**********</span><br></pre></td></tr></table></figure><p>新建一个名字为 blogcomments 的仓库用于存储评论内容</p><p>修改主题的配置文件 themes&#x2F;pure&#x2F;_config.yml，如以下代码所示：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comment</span></span><br><span class="line"><span class="comment"># Gitment</span></span><br><span class="line"><span class="comment"># Introduction: https://imsun.net/posts/gitment-introduction/</span></span><br><span class="line"><span class="attr">comment:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">gitalk</span>  <span class="comment"># 启用哪种评论系统</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  <span class="attr">gitalk:</span> <span class="comment"># gitalk. https://gitalk.github.io/</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">hujiyi</span> <span class="comment">#必须. GitHub repository 所有者，可以是个人或者组织。</span></span><br><span class="line">    <span class="attr">admin:</span> <span class="string">hujiyi</span> <span class="comment">#必须. GitHub repository 的所有者和合作者 (对这个 repository 有写权限的用户)。</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">blogcomments</span> <span class="comment">#必须. GitHub repository.</span></span><br><span class="line">    <span class="attr">ClientID:</span> <span class="string">66f51d5c8d75dac*****</span> <span class="comment">#必须. GitHub Application Client ID.</span></span><br><span class="line">    <span class="attr">ClientSecret:</span> <span class="string">abac11570202d779515d511e338cf3**********</span> <span class="comment">#必须. GitHub Application Client Secret.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Hexo博客常用插件"><a href="#Hexo博客常用插件" class="headerlink" title="Hexo博客常用插件"></a>Hexo博客常用插件</h2><p><a href="https://blog.cofess.com/2017/08/16/comon-plug-in-and-usage-of-hexo-blog.html">Hexo博客常用插件及用法</a></p><p>&#x3D;&#x3D;&#x3D;END&#x3D;&#x3D;&#x3D;</p><hr>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
