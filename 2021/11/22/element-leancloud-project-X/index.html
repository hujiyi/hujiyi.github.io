<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>使用 Element UI 和 Leancloud 的 Vue.js 项目开发(十) - 话题详情页及评论 | Laohoo</title><meta name="author" content="laohoodman"><meta name="copyright" content="laohoodman"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="项目演示地址：https:&#x2F;&#x2F;hujiyi.github.io&#x2F;acme-world-web&#x2F;  论坛话题详情页中，首先要显示的是话题有关的内容，比如标题、作者、时间、内容等各种信息 除此以外，还要提供一个用于发表评论的表单，以及显示当前话题已有的评论内容。 评论需要使用一个单独的表(Class) 来进行存放，同时，还要记录是对哪个话题进行的评论。 查询指定 id 的话题，和增加查看次数进入详情页">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Element UI 和 Leancloud 的 Vue.js 项目开发(十) - 话题详情页及评论">
<meta property="og:url" content="https://hujiyi.github.io/2021/11/22/element-leancloud-project-X/index.html">
<meta property="og:site_name" content="Laohoo">
<meta property="og:description" content="项目演示地址：https:&#x2F;&#x2F;hujiyi.github.io&#x2F;acme-world-web&#x2F;  论坛话题详情页中，首先要显示的是话题有关的内容，比如标题、作者、时间、内容等各种信息 除此以外，还要提供一个用于发表评论的表单，以及显示当前话题已有的评论内容。 评论需要使用一个单独的表(Class) 来进行存放，同时，还要记录是对哪个话题进行的评论。 查询指定 id 的话题，和增加查看次数进入详情页">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png">
<meta property="article:published_time" content="2021-11-22T12:02:09.000Z">
<meta property="article:modified_time" content="2022-10-11T01:40:13.219Z">
<meta property="article:author" content="laohoodman">
<meta property="article:tag" content="leancloud">
<meta property="article:tag" content="element ui">
<meta property="article:tag" content="vue.js">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://hujiyi.github.io/2021/11/22/element-leancloud-project-X/index.html"><link rel="preconnect"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '使用 Element UI 和 Leancloud 的 Vue.js 项目开发(十) - 话题详情页及评论',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">56</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Laohoo</span></a><a class="nav-page-title" href="/"><span class="site-name">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(十) - 话题详情页及评论</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(十) - 话题详情页及评论</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-22T12:02:09.000Z" title="发表于 2021-11-22 20:02:09">2021-11-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-11T01:40:13.219Z" title="更新于 2022-10-11 09:40:13">2022-10-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/vue-js/">vue.js</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>项目演示地址：<a href="https://hujiyi.github.io/acme-world-web/">https://hujiyi.github.io/acme-world-web/</a></p>
<hr>
<p>论坛话题详情页中，首先要显示的是话题有关的内容，比如标题、作者、时间、内容等各种信息</p>
<p>除此以外，还要提供一个用于发表评论的表单，以及显示当前话题已有的评论内容。</p>
<p>评论需要使用一个单独的表(Class) 来进行存放，同时，还要记录是对哪个话题进行的评论。</p>
<h1 id="查询指定-id-的话题，和增加查看次数"><a href="#查询指定-id-的话题，和增加查看次数" class="headerlink" title="查询指定 id 的话题，和增加查看次数"></a>查询指定 id 的话题，和增加查看次数</h1><p>进入详情页后，要先把指定 id 的话题显示出来，同时这个话题的查看次数也在增加，相应的功能可以添加到 <code>TopicService</code> 中。</p>
<p>打开文件<code>src/api/service/topic_service.js</code>, 修改其内容如以下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;  <span class="comment">// 导入 leancloud 数据存储模块</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">BaseService</span> <span class="keyword">from</span> <span class="string">&#x27;./base_service&#x27;</span>;  <span class="comment">// 导入访问 leancloud 数据存储的基类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TABLE_NAME</span> = <span class="string">&#x27;Topic&#x27;</span>;    <span class="comment">// leancloud 中存储数据的表名(Class)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对leancloud应用中 名为 &quot;Topic&quot; 的 Class 进行数据操作的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TopicService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseService</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">table_name</span>) &#123;</span><br><span class="line">        <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">        <span class="variable language_">super</span>(table_name);</span><br><span class="line">        <span class="comment">// 当前子类的属性 this.TABLE_NAME</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">TABLE_NAME</span> = table_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询指定 id 的论坛话题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; id </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">TopicService</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getTopicById</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">        <span class="comment">// include(&quot;createdBy&quot;, &quot;lastEditor&quot;) 或者 include([&quot;createdBy&quot;, &quot;lastEditor&quot;]) 都可以</span></span><br><span class="line">        query.<span class="title function_">include</span>([<span class="string">&quot;createdBy&quot;</span>, <span class="string">&quot;lastEditor&quot;</span>]);</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">get</span>(id);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status_code&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">            <span class="string">&quot;reslut&quot;</span>: response,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查询数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status_code&quot;</span>: e.<span class="property">code</span>,</span><br><span class="line">            <span class="string">&quot;reslut&quot;</span>: e,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定 id 的话题 查看次数加1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; id </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">TopicService</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">viewsInc</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> topic = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>, id);</span><br><span class="line">        <span class="comment">// 原子操作 来增加或减少一个属性内保存的数字    </span></span><br><span class="line">        topic.<span class="title function_">increment</span>(<span class="string">&#x27;views&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> topic.<span class="title function_">save</span>();</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;修改数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出子类时使用 new 直接进行实例化</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">TopicService</span>(<span class="variable constant_">TABLE_NAME</span>);</span><br></pre></td></tr></table></figure>


<h1 id="添加用于评论的-CommentService"><a href="#添加用于评论的-CommentService" class="headerlink" title="添加用于评论的 CommentService"></a>添加用于评论的 <code>CommentService</code></h1><p>评论的内容要保存在另外一个表中，这里使用一个<code>CommentService</code> 类来实现对评论内容的管理。</p>
<p>创建文件 <code>src/api/service/comment_service.js</code>, 内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">LC</span> <span class="keyword">from</span> <span class="string">&#x27;leancloud-storage&#x27;</span>;  <span class="comment">// 导入 leancloud 数据存储模块</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">BaseService</span> <span class="keyword">from</span> <span class="string">&#x27;./base_service&#x27;</span>;  <span class="comment">// 导入访问 leancloud 数据存储的基类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TABLE_NAME</span> = <span class="string">&#x27;Comment&#x27;</span>;    <span class="comment">// leancloud 中存储数据的表名(Class)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对leancloud应用中 名为 &quot;Comment&quot; 的 Class 进行数据操作的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommentService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseService</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">table_name</span>) &#123;</span><br><span class="line">        <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">        <span class="variable language_">super</span>(table_name);</span><br><span class="line">        <span class="comment">// 当前子类的属性 this.TABLE_NAME</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">TABLE_NAME</span> = table_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发表评论</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; topicId 被评论的话题 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; content 评论的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">CommentService</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">newComment</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">topicId, content</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 根据 topicId 找出被评论的话题</span></span><br><span class="line">        <span class="keyword">let</span> topic = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="string">&#x27;Topic&#x27;</span>, topicId);</span><br><span class="line">        <span class="comment">// 创建保存评论内容的 Class</span></span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">Collection</span> = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">extend</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">        <span class="comment">// 创建评论的内容对象</span></span><br><span class="line">        <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="title class_">Collection</span>(&#123;</span><br><span class="line">            <span class="string">&quot;topic&quot;</span>: topic,      <span class="comment">// 评论的话题</span></span><br><span class="line">            <span class="string">&quot;content&quot;</span>: content,  <span class="comment">// 评论的内容</span></span><br><span class="line">            <span class="string">&quot;invisible&quot;</span>: <span class="literal">false</span>,  <span class="comment">// 不可见，如果为 true 就隐藏该评论</span></span><br><span class="line">            <span class="string">&quot;createdBy&quot;</span>: <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">currentUser</span>(),   <span class="comment">// 评论者</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">save</span>();  <span class="comment">// 保存评论数据 </span></span><br><span class="line">        <span class="keyword">if</span> (response) &#123;</span><br><span class="line">            topic.<span class="title function_">increment</span>(<span class="string">&#x27;reply&#x27;</span>, <span class="number">1</span>);    <span class="comment">// 评论数加一</span></span><br><span class="line">            topic.<span class="title function_">set</span>(<span class="string">&#x27;lastRepliedAt&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">// 更新最后评论时间</span></span><br><span class="line">            <span class="keyword">let</span> resp = <span class="keyword">await</span> topic.<span class="title function_">save</span>();  <span class="comment">// 保存</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发了评论的 topic ：&#x27;</span>, resp);</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加评论失败：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询指定 id 的话题的评论内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; topicId 话题 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; limit 每页大小</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; skip 跳过记录数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; sort_field 单个排序字段名(降序加负号) 默认按创建时间升序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">CommentService</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getCommentByTopic</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">topicId, limit = <span class="number">5</span>, skip = <span class="number">0</span>, sort_field = <span class="string">&#x27;createdAt&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> query = <span class="keyword">new</span> <span class="variable constant_">LC</span>.<span class="title class_">Query</span>(<span class="variable language_">this</span>.<span class="property">TABLE_NAME</span>);</span><br><span class="line">        <span class="keyword">const</span> topic = <span class="variable constant_">LC</span>.<span class="property">Object</span>.<span class="title function_">createWithoutData</span>(<span class="string">&#x27;Topic&#x27;</span>, topicId);  <span class="comment">// 根据 id 获取话题</span></span><br><span class="line">        query.<span class="title function_">include</span>(<span class="string">&#x27;createdBy&#x27;</span>);</span><br><span class="line">        query.<span class="title function_">equalTo</span>(<span class="string">&#x27;topic&#x27;</span>, topic);       <span class="comment">// 关系查询</span></span><br><span class="line">        <span class="comment">// 排序属性： this.isMinus()  是父类中定义的方法，判断排序的字段是否 负号 开头</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isMinus</span>(sort_field)) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(sort_field, sort_field.<span class="title function_">substr</span>(<span class="number">1</span>));</span><br><span class="line">            <span class="comment">// 去掉负号后的字段名降序</span></span><br><span class="line">            query.<span class="title function_">descending</span>(sort_field.<span class="title function_">substr</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            query.<span class="title function_">ascending</span>(sort_field);  <span class="comment">// 升序</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> total = <span class="keyword">await</span> query.<span class="title function_">count</span>();   <span class="comment">// 返回记录总数       </span></span><br><span class="line">        <span class="comment">// 分页查询参数</span></span><br><span class="line">        <span class="keyword">let</span> response = <span class="keyword">await</span> query.<span class="title function_">limit</span>(limit).<span class="title function_">skip</span>(skip).<span class="title function_">find</span>();</span><br><span class="line">        <span class="comment">// let response = await query.find();</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getCommentByTopic:&#x27;</span>, total, response);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status_code&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">            <span class="string">&quot;totalCount&quot;</span>: total,</span><br><span class="line">            <span class="string">&quot;reslut&quot;</span>: response,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查询数据错误：&#x27;</span>, e.<span class="property">code</span>, e);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;status_code&quot;</span>: e.<span class="property">code</span>,</span><br><span class="line">            <span class="string">&quot;totalCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;reslut&quot;</span>: e,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出子类时使用 new 直接进行实例化</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">CommentService</span>(<span class="variable constant_">TABLE_NAME</span>);</span><br></pre></td></tr></table></figure>


<h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>s打开文件<code>src/views/home/pages/Detail.vue</code>, 编辑文件内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span> <span class="attr">align</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:lg</span>=<span class="string">&quot;18&quot;</span> <span class="attr">:md</span>=<span class="string">&quot;20&quot;</span> <span class="attr">:sm</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-card</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>话题：&#123;&#123; topic.title &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 异步数据先显示初始数据，再显示带数据的数据 --&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 会导致三层表达式 a.b.c 渲染时会报错，是因为第一次渲染时还没有值，后来有值渲染成功 --&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 可以不理睬，不想看错误信息也可以加 v-if=&quot;topic.createdBy&quot; 来解决 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;topic.createdBy&quot;</span>&gt;</span></span><br><span class="line">                            &#123;&#123; topic.createdBy.username &#125;&#125; -</span><br><span class="line">                            &#123;&#123; topic.createdAt | datetimeFormat &#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-divider</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-html</span>=<span class="string">&quot;topic.content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-divider</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;font-size:18px;&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-comments-o fa-lg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                评论</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span>共 &#123;&#123; replyCount &#125;&#125; 条评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comment-user&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-avatar</span> <span class="attr">style</span>=<span class="string">&quot;background-color: red;&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user fa-4x&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-avatar</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;my-2&quot;</span>&gt;</span>&#123;&#123; currentUser &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;评论（支持 Markdown 语法）&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;desc&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">v-model</span>=<span class="string">&quot;content&quot;</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">placeholder</span>=<span class="string">&quot;输入评论内容&quot;</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">:disabled</span>=<span class="string">&quot;!currentUser&quot;</span></span></span><br><span class="line"><span class="tag">                                    &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;!currentUser&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:red;&quot;</span>&gt;</span>登录后发表评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:disabled</span>=<span class="string">&quot;!currentUser&quot;</span>&gt;</span>预览<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">:disabled</span>=<span class="string">&quot;!currentUser&quot;</span></span></span><br><span class="line"><span class="tag">                                            <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">                                            @<span class="attr">click</span>=<span class="string">&quot;newComment&quot;</span></span></span><br><span class="line"><span class="tag">                                        &gt;</span>评论<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-col</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in comments&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span>&#123;&#123; item.createdBy.username &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;!item.invisible&quot;</span> <span class="attr">v-html</span>=<span class="string">&quot;item.content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>***该评论内容已被隐藏***<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>&#123;&#123; item.createdAt | datetimeFormat &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-thumbs-o-up&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-thumbs-o-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span>举报<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span>隐藏<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-divider</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;horiz-container pagination&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spacer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">background</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">size-change</span>=<span class="string">&quot;getCommentByTopic($route.params.id)&quot;</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">current-change</span>=<span class="string">&quot;getCommentByTopic($route.params.id)&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">layout</span>=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:total</span>=<span class="string">&quot;replyCount&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:page-sizes</span>=<span class="string">&quot;[5, 10, 20, 30]&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:page-size.sync</span>=<span class="string">&quot;pageSize&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">:current-page.sync</span>=<span class="string">&quot;currentPage&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">CommentService</span> <span class="keyword">from</span> <span class="string">&#x27;../../../api/service/comment_service&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">TopicService</span> <span class="keyword">from</span> <span class="string">&#x27;../../../api/service/topic_service&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; marked &#125; <span class="keyword">from</span> <span class="string">&#x27;marked&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> hljs <span class="keyword">from</span> <span class="string">&#x27;highlight.js&#x27;</span>;  <span class="comment">// 需要安装 highlight.js, 例如：npm i highlight.js</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="string">&#x27;highlight.js/styles/github-dark.css&#x27;</span>;  <span class="comment">// 代码高亮样式</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Detail&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">topic</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">comments</span>: [],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">replyCount</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">pageSize</span>: <span class="number">5</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">currentPage</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">currentUser</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dialog</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;),</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">currentUser</span> = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;currentUser&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// marked.js 初始化</span></span></span><br><span class="line"><span class="language-javascript">        marked.<span class="title function_">setOptions</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">renderer</span>: <span class="keyword">new</span> marked.<span class="title class_">Renderer</span>(),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">highlight</span>: <span class="keyword">function</span> (<span class="params">code</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> hljs.<span class="title function_">highlightAuto</span>(code).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// return hljs.highlightBlock(code);</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;gfm&quot;</span>: <span class="literal">true</span>,<span class="comment">// 启动Github样式的Markdown</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;breaks&quot;</span>: <span class="literal">true</span>,<span class="comment">//支持Github换行符，必须打开gfm选项</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;tables&quot;</span>: <span class="literal">true</span>,  <span class="comment">//支持Github表格，必须打开gfm选项</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;extensions&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;headerIds&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;headerPrefix&quot;</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;highlight&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;langPrefix&quot;</span>: <span class="string">&quot;language-&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;mangle&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;pedantic&quot;</span>: <span class="literal">false</span>,<span class="comment">// 只解析符合markdown.pl定义的，不修正markdown的错误</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;sanitize&quot;</span>: <span class="literal">false</span>, <span class="comment">// 原始输出，忽略HTML标签</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;sanitizer&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;silent&quot;</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;smartLists&quot;</span>: <span class="literal">false</span>, <span class="comment">//优化列表输出</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;smartypants&quot;</span>: <span class="literal">false</span>,<span class="comment">//使用更为时髦的标点，比如在引用语法中加入破折号。</span></span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;tokenizer&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;walkTokens&quot;</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;xhtml&quot;</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> topicId = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">viewInc</span>(topicId);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">getTopicById</span>(topicId);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">getCommentByTopic</span>(topicId);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">getTopicById</span>(<span class="params">topicId</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">getTopicById</span>(topicId);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> === <span class="string">&#x27;ok&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">topic</span> = <span class="variable language_">this</span>.<span class="title function_">toJson</span>(response.<span class="property">reslut</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: <span class="string">&#x27;出现异常，无法获取数据&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">getCommentByTopic</span>(<span class="params">topicId</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">comments</span> = [];</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> skip = (<span class="variable language_">this</span>.<span class="property">currentPage</span> - <span class="number">1</span>) * <span class="variable language_">this</span>.<span class="property">pageSize</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title class_">CommentService</span>.<span class="title function_">getCommentByTopic</span>(topicId, <span class="variable language_">this</span>.<span class="property">pageSize</span>, skip);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">status_code</span> === <span class="string">&#x27;ok&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">comments</span> = response.<span class="property">reslut</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">id</span>: item.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">topicId</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;topic&#x27;</span>).<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">content</span>: <span class="variable language_">this</span>.<span class="title function_">markdown</span>(item.<span class="title function_">get</span>(<span class="string">&#x27;content&#x27;</span>)),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">invisible</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;visible&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">createdAt</span>: item.<span class="property">createdAt</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">updatedAt</span>: item.<span class="property">updatedAt</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">createdBy</span>: item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                            ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                            : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">replyCount</span> = response.<span class="property">totalCount</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">message</span>: <span class="string">&#x27;出现异常，无法获取评论数据&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">newComment</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> content = <span class="variable language_">this</span>.<span class="property">content</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (content) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> item = <span class="keyword">await</span> <span class="title class_">CommentService</span>.<span class="title function_">newComment</span>(<span class="variable language_">this</span>.<span class="property">topic</span>.<span class="property">id</span>, content);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (item) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">content</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 把新评论添加到当前评论的前面。</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">comments</span>.<span class="title function_">push</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">id</span>: item.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">topicId</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;topic&#x27;</span>).<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">content</span>: <span class="variable language_">this</span>.<span class="title function_">markdown</span>(item.<span class="title function_">get</span>(<span class="string">&#x27;content&#x27;</span>)),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">invisible</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;visible&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">createdAt</span>: item.<span class="property">createdAt</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">updatedAt</span>: item.<span class="property">updatedAt</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">createdBy</span>: item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                            ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                            : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">replyCount</span>++;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: <span class="string">`评论发表成功`</span>,</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: <span class="string">&#x27;出现错误, 无法完成评论&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 查看次数加1</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">viewInc</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">await</span> <span class="title class_">TopicService</span>.<span class="title function_">viewsInc</span>(id);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">toLogin</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;aaa&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">currentUser</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">dialog</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取用户中各个字段的值， 可以根据需要添加</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getUser</span>(<span class="params">user</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// console.log(user);</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: user.<span class="property">id</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>: user.<span class="title function_">get</span>(<span class="string">&quot;username&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">email</span>: user.<span class="title function_">get</span>(<span class="string">&quot;email&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将从服务器端取到的数据不能直接使用，转为对象格式的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">toJson</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: item.<span class="property">id</span>,   <span class="comment">// leancloud Class 自带属性，对应 leanclud Class 中的 &quot;ObjectId&quot;, 可以用&quot;.id&quot;直接引用</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;title&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 因为pre标签缺失hljs这个class，加上就好了将拿到的markdown内容，</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 用marked转成html字符串后，replace替换&lt;pre&gt;标签为&lt;pre class=&quot;hljs&quot;&gt;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// content: marked(item.get(&#x27;content&#x27;)).replace(/&lt;pre&gt;/g, &quot;&lt;pre class=&#x27;hljs&#x27;&gt;&quot;),</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">content</span>: <span class="variable language_">this</span>.<span class="title function_">markdown</span>(item.<span class="title function_">get</span>(<span class="string">&#x27;content&#x27;</span>)),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">views</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;views&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">reply</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;reply&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">level</span>: item.<span class="title function_">get</span>(<span class="string">&#x27;level&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">createdAt</span>: item.<span class="property">createdAt</span>,  <span class="comment">// leancloud Class 自带属性,创建时间,不能修改值</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">updatedAt</span>: item.<span class="property">updatedAt</span>,   <span class="comment">// leancloud Class 自带属性,最后修改时间,只能leancloud 自动修改</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * createdBy、lastEditor 指向另一个表的字段, 默认只能得到该字段在关联表中的id 值</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * 要得到完整值， 查询时字段名要包含在 include 中，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 * 取值时，要先判断是否为空，如果为空，取值会抛出异常，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                 */</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">createdBy</span>: item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;createdBy&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                    : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastEditor</span>: item.<span class="title function_">get</span>(<span class="string">&quot;lastEditor&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                    ? <span class="variable language_">this</span>.<span class="title function_">getUser</span>(item.<span class="title function_">get</span>(<span class="string">&quot;lastEditor&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                    : <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//  将 markdown 语法写的内容转为 html 显示</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">markdown</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="title function_">marked</span>(val).<span class="title function_">replace</span>(<span class="regexp">/&lt;pre&gt;/g</span>, <span class="string">&quot;&lt;pre class=&#x27;hljs&#x27;&gt;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">filters</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 使用 moment.js 定义日期时间过滤器函数   </span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">datetimeFormat</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//  计算两个时间相差多少天</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> days = <span class="title function_">moment</span>(now).<span class="title function_">diff</span>(<span class="title function_">moment</span>(val), <span class="string">&#x27;days&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (days &lt;= <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 小于三天的返回格式：1小时前</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="title function_">moment</span>(val).<span class="title function_">fromNow</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 三天以上的返回日期时间</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="title function_">moment</span>(val).<span class="title function_">format</span>(<span class="string">&quot;lll&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.title</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.info</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#c2c2c2</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.author</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: darkcyan;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.comment-user</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex-flow</span>: column;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.comment-content</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://hujiyi.github.io">laohoodman</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://hujiyi.github.io/2021/11/22/element-leancloud-project-X/">https://hujiyi.github.io/2021/11/22/element-leancloud-project-X/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://hujiyi.github.io" target="_blank">Laohoo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/leancloud/">leancloud</a><a class="post-meta__tags" href="/tags/element-ui/">element ui</a><a class="post-meta__tags" href="/tags/vue-js/">vue.js</a></div><div class="post-share"><div class="social-share" data-image="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2021/12/04/flutter-development-environment-configuration/" title="在 Windows 10/11 配置 Flutter 开发环境"><img class="cover" src="https://hujiyi.github.io/2021/02/02/flutter-introduction-part-I/flutter_eman_blog.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">在 Windows 10/11 配置 Flutter 开发环境</div></div><div class="info-2"><div class="info-item-1">关联文章 在 Windows 中同时安装多个 JDK  使用 Android SDK 命令行工具搭建 Flutter 开发环境   安装 Flutter SDKFlutter 到现在为止, 还处于高速发展的初始阶段, Flutter SDK 的各个大版本之间, 存在一些不兼容的情况, 所以建议选择使用 stable 发行通道的 Flutter SDK 最新版本。 下载 Flutter SDKFlutter SDK 下载地址：  Flutter 官方网站：https://docs.flutter.dev/development/tools/sdk/releases  清华大学镜像：https://mirrors.tuna.tsinghua.edu.cn/flutter/flutter_infra_release/releases/stable/windows/   解压 Flutter SDK将压缩包解压, 然后把其中的 flutter 目录整个放在你想放置 Flutter SDK 的路径中（例如 D:\AppData, 解压后路径为: D:\AppData\flutter）,...</div></div></div></a><a class="pagination-related" href="/2021/11/21/element-leancloud-project-IX/" title="使用 Element UI 和 Leancloud 的 Vue.js 项目开发(九) - 首页显示话题列表"><img class="cover" src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(九) - 首页显示话题列表</div></div><div class="info-2"><div class="info-item-1">项目演示地址：https://hujiyi.github.io/acme-world-web/  网站前台的规划与路由要显示论坛的话题列表，以及显示话题的详细内容、添加及显示用户的评论，需要添加相应的视图 添加前台视图文件在 src/views/home 文件夹添加一个名为 pages 的文件夹，然后在该文件夹中添加用于显示话题列表的视图文件TopicList.vue 以及 显示话题详情的视图文件 Detail.vue。 src/views/ 文件夹的最终组成结构如以下所示： 1234567891011121314151617181920212223.|-- account|   |-- pages|   |   |-- Login.vue|   |   |-- PasswordReset.vue|   |   `-- SignUp.vue|   `-- Index.vue|-- dashboard|   |-- forum|   |   |-- CommentManager.vue|   |   `-- TopicManager.vue|   |-- layout|   | ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2021/11/21/element-leancloud-project-IX/" title="使用 Element UI 和 Leancloud 的 Vue.js 项目开发(九) - 首页显示话题列表"><img class="cover" src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-21</div><div class="info-item-2">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(九) - 首页显示话题列表</div></div><div class="info-2"><div class="info-item-1">项目演示地址：https://hujiyi.github.io/acme-world-web/  网站前台的规划与路由要显示论坛的话题列表，以及显示话题的详细内容、添加及显示用户的评论，需要添加相应的视图 添加前台视图文件在 src/views/home 文件夹添加一个名为 pages 的文件夹，然后在该文件夹中添加用于显示话题列表的视图文件TopicList.vue 以及 显示话题详情的视图文件 Detail.vue。 src/views/ 文件夹的最终组成结构如以下所示： 1234567891011121314151617181920212223.|-- account|   |-- pages|   |   |-- Login.vue|   |   |-- PasswordReset.vue|   |   `-- SignUp.vue|   `-- Index.vue|-- dashboard|   |-- forum|   |   |-- CommentManager.vue|   |   `-- TopicManager.vue|   |-- layout|   | ...</div></div></div></a><a class="pagination-related" href="/2021/11/21/element-leancloud-project-VIII/" title="使用 Element UI 和 Leancloud 的 Vue.js 项目开发(八) - 论坛话题管理的实现"><img class="cover" src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-21</div><div class="info-item-2">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(八) - 论坛话题管理的实现</div></div><div class="info-2"><div class="info-item-1">项目演示地址：https://hujiyi.github.io/acme-world-web/  论坛话题的数据存储服务类在 src/api/service/ 文件夹下新建 topic_service.js,  打开文件 src/api/service/topic_service.js, 编辑其代码如下： 12345678910111213141516171819import BaseService from &#x27;./base_service&#x27;;  // 导入访问 leancloud 数据存储的基类const TABLE_NAME = &#x27;Topic&#x27;;    // leancloud 中存储数据的表名(Class)/** * 对leancloud应用中 名为 &quot;Topic&quot; 的 Class 进行数据操作的类 */class TopicService extends BaseService &#123;    constructor(table_name) &#123;        // 调用父类的构造函数       ...</div></div></div></a><a class="pagination-related" href="/2021/11/20/element-leancloud-project-VII/" title="使用 Element UI 和 Leancloud 的 Vue.js 项目开发(七) - LeanCloud 数据存储和路由守卫的使用"><img class="cover" src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-20</div><div class="info-item-2">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(七) - LeanCloud 数据存储和路由守卫的使用</div></div><div class="info-2"><div class="info-item-1">项目演示地址：https://hujiyi.github.io/acme-world-web/  LeanCloud 数据存储LeanCloud 数据存储 的两种 ClassLeanCloud 数据存储的 Class 有两种，一种是创建应用时就自带的，这一种Class的名字以 下划线开头，可以在这些 Class 中添加字段， 但一般不要删除；另一种是用户自己创建的 Class，可以由用户自定义需要的字段， 同时，自定义的每个 Class 还会有四个系统自带的字段：objectId, ACL, createdAt, updatedAt， 说明如下：  objectId: 主键字段，实际使用时，可以通过 类名.id 获取值；  ACL: 访问控制列表, 用于权限管理开发，免费用户不可用；  createdAt: 记录创建时间，添加记录时自动产生，不能更改；  updatedAt: 记录更新时间，记录有更新时自动修改，不能由用户进行修改；   在数据存储中创建 Class在数据存储中创建 Class 有两个方法： 方法一：在 LeanCloud 数据存储 的管理界面 手工 添加...</div></div></div></a><a class="pagination-related" href="/2021/11/20/element-leancloud-project-VI/" title="使用 Element UI 和 Leancloud 的 Vue.js 项目开发(六) - 实现用户注册、登录、找回密码"><img class="cover" src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-20</div><div class="info-item-2">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(六) - 实现用户注册、登录、找回密码</div></div><div class="info-2"><div class="info-item-1">项目演示地址：https://hujiyi.github.io/acme-world-web/  Leancloud 数据存储LeanCloud（原 AVOS Cloud） 是针对移动应用的一站式云端服务，专注于为应用开发者提供工具和平台。提供包括LeanStorage 数据存储、LeanMessage 通信服务、LeanAnalytics 统计分析、LeanModules 拓展模块等四大类型的后端云服务。当前项目使用了LeanStorage 数据存储来实现论坛数据的保存。 Leancloud SDK 的初始化配置信息LeanCloud 国内默认的是华北节点，但是去年华北节点的文件服务器因为某些原因，出现了域名服务方面的问题。导致文件可以上传，但是没办法访问，所以这里建设使用 华东节点。 登录 Leancloud华东节点 （没有账号的请先注册），然后创建应用，应用名称自己取，操作类似下图:   应用创建成功后，点击该应用最左边的 数据存储 图标，进入应用管理界面，如下图：   在右侧菜单选择：设置 -&gt; 应用凭证, 即可看到当前应用的 AppID, AppKey,...</div></div></div></a><a class="pagination-related" href="/2021/11/20/element-leancloud-project-V/" title="使用 Element UI 和 Leancloud 的 Vue.js 项目开发(五) - 后台管理界面"><img class="cover" src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-20</div><div class="info-item-2">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(五) - 后台管理界面</div></div><div class="info-2"><div class="info-item-1">项目演示地址：https://hujiyi.github.io/acme-world-web/  文件与路由规划相对于其他两大部分来说，后台管理界面的组成更复杂，包含的组件、视图也更多。 为了更方便进行管理， 将相应的文件分别放到不同的文件夹下。就当前项目来说，主要实现一个论坛的后台管理功能，所以在 dashboard 文件夹中分别创建三个文件夹用于存放不同的文件：  layout 文件夹： 用于存放后台管理界面（仪表盘）的组成组件；  forum 文件夹：用于存放和论坛管理有关的视图；  pages 文件夹： 用于存放仪表盘其他部分的视图；    如果有更多的内容，也可以建相应的文件夹进行分类存放  创建文件夹和文件根据以上规划，在 dashboard 文件夹 分别 创建名为：layout 、forum 、pages 的文件夹。 在 src/views/dashboard/forum/ 文件夹下添加以下两个文件：  TopicManager.vue: 论坛话题管理视图；  CommentManager.vue: 话题评论管理视图。   在...</div></div></div></a><a class="pagination-related" href="/2021/11/18/element-leancloud-project-IV/" title="使用 Element UI 和 Leancloud 的 Vue.js 项目开发(四) - 登录与注册界面设计"><img class="cover" src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/default_bg.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-18</div><div class="info-item-2">使用 Element UI 和 Leancloud 的 Vue.js 项目开发(四) - 登录与注册界面设计</div></div><div class="info-2"><div class="info-item-1">项目演示地址：https://hujiyi.github.io/acme-world-web/  账号模块的路由规划在当前项目中， 账号模块实现三个部分的功能：用户登录、用户注册、通过邮箱找回密码， 这三个部分都放在 src/views/account/ 文件夹下。 创建文件夹和文件在 src/views/account/ 下创建名为 pages 的文件夹，然后在该文件下添加三个 vue文件：Login.vue, PasswordReset.vue, SignUp.vue。 创建完成后的 views 文件夹下的项目结构如下图： 12345678910|-- account|   |-- pages|   |   |-- Login.vue|   |   |-- PasswordReset.vue|   |   `-- SignUp.vue|   `-- Index.vue|-- dashboard|   `-- Index.vue`-- home    `-- Index.vue  编辑src/views/account/pages/Login.vue,...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://hujiyi.github.io/2020/02/29/use-hexo-tag-cloud/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">laohoodman</div><div class="author-info-description">如果你交给某人一个程序，你将折磨他一整天；如果你教某人如何编写程序，你将折磨他一辈子。 —— David Leinweber.</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">56</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hujiyi"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/hujiyi" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A-id-%E7%9A%84%E8%AF%9D%E9%A2%98%EF%BC%8C%E5%92%8C%E5%A2%9E%E5%8A%A0%E6%9F%A5%E7%9C%8B%E6%AC%A1%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">查询指定 id 的话题，和增加查看次数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BA%8E%E8%AF%84%E8%AE%BA%E7%9A%84-CommentService"><span class="toc-number">2.</span> <span class="toc-text">添加用于评论的 CommentService</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text"></span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/16/learn-vue3-000/" title="Learn Vue3 目录"><img src="https://hujiyi.github.io/2024/11/16/learn-vue3-000/vuetoc.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Learn Vue3 目录"/></a><div class="content"><a class="title" href="/2024/11/16/learn-vue3-000/" title="Learn Vue3 目录">Learn Vue3 目录</a><time datetime="2024-11-16T12:35:53.000Z" title="发表于 2024-11-16 20:35:53">2024-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/27/flutter-tutorial-toc/" title="Flutter Tutorial Table Of Content"><img src="https://hujiyi.github.io/2021/02/02/flutter-introduction-part-I/flutter_eman_blog.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Flutter Tutorial Table Of Content"/></a><div class="content"><a class="title" href="/2023/02/27/flutter-tutorial-toc/" title="Flutter Tutorial Table Of Content">Flutter Tutorial Table Of Content</a><time datetime="2023-02-27T05:11:08.000Z" title="发表于 2023-02-27 13:11:08">2023-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/16/linux-from-scratch-toc/" title="从 Linux From Scratch 构建自己的操作系统 - 目录"><img src="https://hujiyi.github.io/2023/02/16/linux-from-scratch-toc/Linux-From-Scratch.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="从 Linux From Scratch 构建自己的操作系统 - 目录"/></a><div class="content"><a class="title" href="/2023/02/16/linux-from-scratch-toc/" title="从 Linux From Scratch 构建自己的操作系统 - 目录">从 Linux From Scratch 构建自己的操作系统 - 目录</a><time datetime="2023-02-16T05:04:02.000Z" title="发表于 2023-02-16 13:04:02">2023-02-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/05/installing-mysql-zip-archive-in-windows/" title="在 Windows 安装解压版的 MySQL 8"><img src="https://hujiyi.github.io/2023/01/05/installing-mysql-zip-archive-in-windows/admin-mysql-logo900.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在 Windows 安装解压版的 MySQL 8"/></a><div class="content"><a class="title" href="/2023/01/05/installing-mysql-zip-archive-in-windows/" title="在 Windows 安装解压版的 MySQL 8">在 Windows 安装解压版的 MySQL 8</a><time datetime="2023-01-05T05:05:51.000Z" title="发表于 2023-01-05 13:05:51">2023-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/21/build-vue3-desktop-app-with-vite-electron-vuetify/" title="使用 electron 和 vuetify 创建 Vue3 桌面应用程序"><img src="/2022/11/21/build-vue3-desktop-app-with-vite-electron-vuetify/electron.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 electron 和 vuetify 创建 Vue3 桌面应用程序"/></a><div class="content"><a class="title" href="/2022/11/21/build-vue3-desktop-app-with-vite-electron-vuetify/" title="使用 electron 和 vuetify 创建 Vue3 桌面应用程序">使用 electron 和 vuetify 创建 Vue3 桌面应用程序</a><time datetime="2022-11-21T01:23:54.000Z" title="发表于 2022-11-21 09:23:54">2022-11-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By laohoodman</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script src="/js/jquery.min.js"></script><script src="/js/fishes.js"></script><script src="/js/fish.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/pluginsSrc/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>